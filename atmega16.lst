
AVRASM ver. 2.1.42  C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm Thu Jan 13 15:30:36 2022

C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(193): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\AJUSTE_PRESENTACION.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(194): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\PARAMETROS_I2C.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(195): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\M64DEF.INC'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(196): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\PARAMETROS.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(198): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\ADC.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(199): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\ini_pan.asm'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(200): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\INI_PANTALLA_2.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(201): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\RELOJ.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(202): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\LINEA_PH.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(203): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\LEC_TEC.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(204): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\ENV_DOI.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(205): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\ENV_DOI_2.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(206): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\EEPROMRW.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(207): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\CON_ADC.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(208): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\COMPARA.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(209): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\CALIBRARSAL.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(210): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\CALIBRAR_PH.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(212): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\PCF8591.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1058): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\NO_TECLA.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1288): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\COMPARA2.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1289): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\PRO_RD.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1290): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\PRO_CL.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1291): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\PRO_PRO.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1292): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\MED_PH+.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1293): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\MED_SAL.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1294): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\MED_CL.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1295): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\MED_RD.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1297): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\I2C_ATMEGA16.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1300): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\DATOS.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1301): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\PRO_CICLOS.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1303): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\PANEL_A.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1304): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\TEXTO_LCD2.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1311): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\AJUSTE_PRODUCION.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1312): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\MULTIPLICAR.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1315): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\INI_ATMEGA64.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1316): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\HORAS.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1317): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\AYUDA_RD_CL.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1318): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\VIDA_REJILLA.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1319): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\CONTROL_CAUDAL.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1321): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\VOLTIOS.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1322): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\RETARDO240.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1323): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\CALIBRAR_RD.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1324): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\CALIBRAR_CL.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1484): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\PRO_RD_CL.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1485): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\RETARDO.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1486): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\VER_ERROR.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1487): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\MED_INI_SAL.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1488): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\PANTALLA2.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1491): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\DESGASTE_ELECTRODO.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1492): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\SCR.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1493): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\BORRAR_EEPROM.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1526): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\UART0.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1527): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\UART1.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1528): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\PRO_PAR.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1529): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\P_NEXTION_RS0.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1530): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\PWM_ATMEGA.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1531): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\SERVO.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1532): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\MOTOR_PAP.ASM'
C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\atmega16.asm(1534): Including file 'C:\Users\Luis Angel\Desktop\VERSION FUNCIONAL SIN SHUNT VISIBLE 2022\20x4_mos_sin cpu\CONTROL_ELECTRODO.ASM'
                 
                 
                 
                 ;     PROGRAMA PRINCIPAL
                 ;++++++++++++ CONTROL ES R20
                 ; CONTROL LINEA 0 SE UTILIZA EN RUTINA COMPARA
                 ; CONTROL LINEA 1 SE UTILIZA EN LA TRANSMISION POR RADIO, INTERRUPCION TIMER2_OVF
                 ; CONTROL LINEA 2 VERANO Ó INVIERNO A 1 INVIERNO
                 ; CONTROL LINEA 3 MAXIMA PRODUCION SE ACTIVA EN RUTINA TECLADO ACTUA EN RUTINA RELOJ
                 ; CONTROL LINEA 4 SONDA DE Ph PRESENTE
                 ; CONTROL LINEA 5 CICLO PARA VERIFICAR UNA VEZ POR SEGUNDO
                 ; CONTROL LINEA 6 SONDA DE REDOX PRESENTE
                 ; CONTROL LINEA 7 SONDA CLORO LIBRE PRESENTE
                 ; ++++++++++ CONTROL_1 ES R11
                 ; CONTROL_1 LINEA 0 SE ACTIBA UNA VEZ POR SEGUNDO
                 ; CONTROL_1 LINEA 1 OPCION UTILIZAR ACIDO Ó SOSA
                 ; CONTROL_1 LINEA 2 PARA ANULAR LA MEDICION DE CLORO Y REDOX LA ANULA ESTANDO A UNO
                 ; CONTROL_1 LINEA 3 PARA ACTIVAR LA OPCION DE CALCULAR EL PORCENTAJE DE PRODUCION
                 ; CONTROL_1 LINEA 4 FUENTE 
                 ; CONTROL_1 LINEA 5 MUESTRA SAL A AÑADIR
                 ; CONTROL_1 LINEA 6 EQUIPO CON SENSOR DE FLUJO
                 ; CONTROL_1 LINEA 7 SE ACTIVA CON LA PRIMERA INVERSION SE USA RUTINA APOYA DE RD Y CL
                 
                 ; CONTROL_2
                 
                 
                 ;   CONTROL DE LOS LED
                 ;	0	FUNCIONAMIENTO DE LA FUENTE
                 ;	1	VERANO INVIERNO
                 ;	2	INTERMITENTE
                 ;	3	TIEMPO MUERTO
                 ;	4	LED DE PH
                 ;	5	NIVEL DE ACIDO BAJO NO ESTA PRESENTE EN LA PANTALLA
                 ;	6	LUZ PANTALLA
                 ;	7	POLARIDAD
                 
                 
                 ; SITUACION DE LOS MENSAJES EN RAM
                 	.equ		PILA						=0X10FF				; PARA EL REGISTRO DE INTERRUPCIONES EN RAM
                 	.equ		LIN1						=0x100				; LINEA 1 DE LA PANTALLA EN RAM
                 	.equ		LIN2						=0X114				; LINEA 2 DE LA PANTALLA EN RAM
                 	.equ		LIN3						=0x0A0				; LINEA PARA TRANSMITIR EN LA UART
                 	.equ		L_HORAS 					=0x120				; LINEA 1 DE LA PANTALLA EN RAM PRESENTACION DE LAS HORAS
                 	.equ		LIN_2P						=0x1E0				; LINEA 2 DE PROGRAMACION DE MOMENTO "SIMULACION"
                 	.equ		PRUEBA_2					=0x220				; TEXTO
                 	.equ		PRUEBA_3					=0x230				; NO SE PUEDE USAR AQUI ESTA DEFINODA EN PARAMETROS
                 	.equ		PHP				=0X45C							; LINEA 3 CON SONDA PH
                 	.equ		PRUEBA_1		=0x560;			=0x240				; ES LA LINEA 4 EN RAM
                 	.equ		PRUEBA			=0x574;			=0x250				; ES LA LINEA 3 EN RAM
                 	.equ		POR_PRO			=0x588;			=0x260				; PRODUCION % 
                 	.equ		LIN_2S			=0x59C;			=0x270				; TEXTO " EQUIPO DETENIDO "
                 	.equ		A_SAL			=0X5B0;			=0x280				; TEXTO "  -.- gr/litro "
                 	.equ		LIN_REJILLA		=0X5C4;			=0x290				; TEXTO "  AÑADIR SAL   "
                 	.equ		LIN_1P			=0X5D8;			=0x2A0				; LINEA 1 DE PROGRAMACION " AJUSTE"
                 	.equ		LIN_CA			=0X5EC;			=0X2B0				; TEXTO  "SIN CAUDAL "
                 	.equ		E_REMOTO		=0X600;			=0x2C0				; TEXTO " EQUIPO REMOTO "
                 	.equ		E_MARCHA		=0X614;			=0x2D0				; TEXTO " EN MARCHA "
                 	.equ		E_PROD			=0X628;			=0x2E0				; TEXTO " SIN PRODUCCION "
                 	.equ		N_DEPOSITO		=0X63C;			=0x2F0				; TEXTO " NIVEL DEPOSITO "
                 	.equ		LIN4			=0X650;			=0x300				; LINEA PRESENTACION DE LA TEMPERATURA
                 	.equ		SENSOR_CAUDAL	=0X678
                 	.equ		LIN1P			=0X7E0;			=0x310				; LINEA PRIMERA PRESENTACION  "TIPO DE EQUIPO" ==================0x7e0 codigo nextion
                 	.equ		LIN2P			=0X7F4;			=0x320				; LINEA SEGUNDA PRESENTACION  " TEAP Ó DISTRIBUIDOR"
                 	.equ		EN_ESPERA		=0X68C;			=0x330				; TEXTO "EN ESPERA"
                 	.equ		N_SEG			=0X6A0;			=0x340				; PRESENTA LOS SEGUNDOS QUE FALTAN EN ERROR
                 	.equ		C_MANUAL		=0X6B4;			=0x350				; TEXTO " CONSULTAR MANUAL"
                 	.equ		AVERIA			=0X6C8;			=0x360				; TEXTO "  A V E R I A   "
                 	.equ		F_PRO			=0X6DC;			=0x370				; TEXTO "FALLO PRODUCCION"
                 	.equ		SUST_SONDA						=0x380				; TEXTO " SUSTITUIR SONDA"
                 	.equ		F_CONEX			=0X704;			=0x390				; TEXTO "ERROR CONEXION"
                 	.equ		L_BLANCA		=0X718;			=0x3A0				; LINEA "VFu Vsa Pcl Tem " 
                 	.equ		L_VOLTIOS		=0X72C;			=0x3B0				; VALORES DE LAS TENSIONES
                 	.equ		PRO_CLORO		=0X740;			=0X3C0				; PRESENTA LA PRODUCION DE CLORO EN EL REMOTO
                 	.equ		PRE_DES						=0X45C
                 	.equ		RETARDO_PRO		=0x754								; PRESENTA RETARDO DE PRODUCION AL INICIO MODO VALENCIA
                 	.equ        CONEX_ELECT		=0X768
                 	.equ		VER_SAL			=0X77C
                 	.equ		VIDA_ELECT		=0X790								; MIDE Y COLOCA EN RAM EL DESGASTE DEL ELECTRODO
                 	.equ		SCR_LIN			=0X7A4
                 	.equ		SAL_AGUA		=0X7B8								; SAL EN EL AGUA
                 	.equ		BORRAR_LINEA	=0X7A4								; LINEA EN BLANCO
                 	.equ		CAL_SAL			=0X8F8
                 	.equ		CAL_PH			=0X90C
                 	.equ		CAL_RD			=0X920
                 	.equ		CAL_CL			=0X934
                 	.equ		AJ_PRO			=0X948
                 	.equ		AJ_PH			=0X95C
                 	.equ		AJ_RD			=0X970
                 	.equ		AJ_CL			=0X984
                 	.equ		AJ_POL			=0X998
                 	.equ		AUT_RD			=0X9AC
                 	.equ		AUT_CL			=0X9C0
                 	.equ		USO_EQUIPO		=0X9D4
                 	.equ		LIN1G			=0X4E8								; DATOS PARA LA PANTALLA GRAFICA
                 	.equ		LIN2G			=0X4FC								; DATOS PARA LA PANTALLA GRAFICA	
                 	.equ		RG_232			=0XC01	; 0XB01 Y 0XB02				; DATOS RECIBIDOS DE LA RS232 TRES
                 																	; # POSICION ACCION
                 
                 
                 	.equ		ESPERA_ERROR	=0XB03					; POSICION 37  0-1
                 	.equ		FLUJO			=0XB04					; POSICION 39  0-1
                 	.equ		APOYO_CL		=0XB05					; POSICION 40  0-1
                 	.equ		BAJO_SAL		=0XB06					; POSICION 42  0-1
                 	.equ		ERROR_ELECTRODO	=0XB07					; POSICION 43  0-1
                 	.equ		AVERIA_FUENTE	=0XB08					; POSICION 44  0-1
                 	.equ		AVERIA_CPU		=0XB09					; POSICION 45  0-1		
                 	.equ		S_FLUJO			=0XB0A					; TIENE SONDA DE CAUDAL UN 1
                 	.equ		S_FUENTE		=0XB0B					; GRABA LA TENSION DE LA FUENTE
                 	.equ		CHECKSUM		=0XB0C
                 	.equ		SAL_UART		=0XB0D					; PARA MOSTRAR LA SAL EN UART
                 .equ		DA_ASCI 			=0xAC4					; SOLO PARA AJUSTE PRESENTA LOS VALORES RECIBIDOS POR ACI DE LA NEXTION
                 
                 
                 									; PRESENTA LAS HORAS DE USO DEL EQUIPO
                 
                 .DSEG											; DIRECION INICIAL DE LA PILA EN MEMORIA RAMM
                 .ORG			PILA							; POSICION EN RAM 0x16F DEFINIDO EN LINEA 11 DE ESTE FICHERO 
                 .CSEG											; GRABAR EL PROGRAMA EN LA FLASH
                 .ORG			0x0000							; DIRECCION DE INICIO PROGRAMA POSICION DE MEMORIA 0X0000							; 
                 
                 
                  
                  
000000 c738         	RJMP		RESET							; 00 	External Pin, Power-on Reset, Brown-out
000001 0000      	NOP											; 01
000002 c6fe      	RJMP		INT_0							; 02 	INTERRUPCION EXTERNA 0	
000003 0000      	NOP											; 03
000004 c6fd      	RJMP		INT_1							; 04	INTERRUPCION EXTERNA 1
000005 0000      	NOP											; 05
000006 c6fc      	RJMP		INT_2							; 06	INTERRUPCION EXTERNA 2
000007 0000      	NOP											; 07
000008 c6fb      	RJMP		INT_3							; 08 	INTERRUPCION EXTERNA 3	
000009 0000      	NOP											; 09
00000a c6fa      	RJMP		INT_4							; 0A	INTERRUPCION EXTERNA 4
00000b 0000      	NOP											; 0B
00000c c6f9      	RJMP		INT_5							; 0C	INTERRUPCION EXTERNA 5
00000d 0000      	NOP											; 0D
00000e c6f8      	RJMP		INT_6							; 0E 	INTERRUPCION EXTERNA 6	
00000f 0000      	NOP											; 0F
000010 c6f7      	RJMP		INT_7							; 10	INTERRUPCION EXTERNA 7
000011 0000      	NOP											; 11
000012 c6f6      	RJMP		TIMER2_COM						; 12	CONTADOR 2
000013 0000      	NOP											; 13
000014 c6f5      	RJMP		TIMER2_OVF						; 14	Timer/Counter2 Overflow
000015 0000      	NOP											; 15
000016 c6f4      	RJMP		TIMER1_CAPT						; 16	Timer/Counter1 Capture Event
000017 0000      	NOP											; 17	
000018 c6f3      	RJMP		TIMER1_COMPA					; 18	Timer/Counter1 Compare Match A
000019 0000      	NOP											; 19
00001a c6ff      	RJMP		TIMER1_COMPB					; 1A	Timer/Counter1 Compare Match B
00001b 0000      	NOP											; 1B	
00001c c6fe      	RJMP		TIMER1_OVF						; 1C	Timer/Counter1 Overflow
00001d 0000      	NOP											; 1D
00001e c6fd      	RJMP		TIMER0_COMP						; 1E	Timer/Counter0 COMP
00001f 0000      	NOP											; 1F
000020 c6fc      	RJMP		TIMER0_OVF						; 20	Timer/Counter0 Overflow
000021 0000      	NOP											; 21
000022 c700      	RJMP		SPI_STC							; 22	Serial Transfer Complete
000023 0000      	NOP											; 23
000024 c6ff      	RJMP		USART0_RX						; 24	USAR RX COMPLETADA
000025 0000      	NOP											; 25
000026 c700      	RJMP		USART0_UDRE						; 26	USAR DATO EN REGISTRO COMPLETADO
000027 0000      	NOP											; 27
000028 c6ff      	RJMP		USART0_TX						; 28	USAR TX COMPLETADO
000029 0000      	NOP											; 29
00002a c6fe      	RJMP		ADC_ADC							; 2A	ADC Conversion Completa
00002b 0000      	NOP											; 2B
00002c c6fd      	RJMP		EE_READY						; 2C	EEPROM LEIDA LISTA
00002d 0000      	NOP											; 2D
00002e c6fc      	RJMP		ANALOG_COMP						; 2E	COMPARADOR ANALOGICO
00002f 0000      	NOP											; 2F	
000030 c6fb      	RJMP		TIMER1_COMPC					; 30	TIMER 1 
000031 0000      	NOP											; 31	
000032 c6fa      	RJMP		TIMER3_CAPT						; 32	TIMER 3 COMPC
000033 0000      	NOP											; 33	
000034 c6f9      	RJMP		TIMER3_COMPA					; 34	TIMER 3 COMPA
000035 0000      	NOP											; 35	
000036 c6f8      	RJMP		TIMER3_COMPB					; 36	TIMER 3 COMPB
000037 0000      	NOP											; 37	
000038 c6f7      	RJMP		TIMER3_COMPC					; 38	TIMER 3 COMPC
000039 0000      	NOP											; 39
00003a c6f6      	RJMP		TIMER3_OVF						; 3A	TIMER3 OVERFLOW
00003b 0000      	NOP											; 3B										
00003c c6f5      	RJMP		USART1_RX						; 3C	USART1 RX COMPLETADO
00003d 0000      	NOP											; 3D										
00003e c6f6      	RJMP		USART1_UDRE						; 3E	USART1 RX COMPLETADO	RJMP		USART1_RX						; 3C	USART1 RX COMPLETADO
00003f 0000      	NOP											; 3F
000040 c6f5      	RJMP		USART1_TX						; 40
000041 0000      	NOP											; 41
000042 c6f4      	RJMP		TWI								; 42	INTERFACE SERIE
000043 0000      	NOP											; 43
000044 c6f3      	RJMP		SPM_RDY							; 44	Store Program Memory Ready
                 
                 .INCLUDE "AJUSTE_PRESENTACION.ASM"
                 
                 
                 
                 
                 
                 AJUSTE_PRESENTACION:
000045 d12e      	RCALL 			INI_PANTALLA		; LLAMA A LA RUTINA PARA INICIAR LA PANTALLA
                 ;BORRA LINEA 1
000046 e800      	LDI				R16,128			; BORRAR LINEA 1
000047 940e 053e 	CALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION, " ESCRIBIR LINEA 2"
000049 e0d7      	LDI				YH,HIGH(BORRAR_LINEA)	; POSICION ALTA DEL TAXTO EN RAM 080
00004a eac4      	LDI				YL,LOW (BORRAR_LINEA)	; direccion BAJA DEL TEXTO EN RAM  "CONSULTAR MANUAL"    	
00004b e114        	LDI				R17,20   			; bytes a enviar 
00004c 940e 0925 	CALL			ENVIARTEXTO	
00004e 940e 1a97 	CALL BORRA_LINEA_4
                 AJUSTE_PRESENTACION_INICIO:		; PARA QUE NO GUARREE LAS LINEAS 1 Y 4
000050 d123      	RCALL 			INI_PANTALLA		; LLAMA A LA RUTINA PARA INICIAR LA PANTALLA
000051 e000      	LDI				R16,00
000052 2e40      	MOV				R4,R16				; VALOR TIPO
000053 2e50      	MOV				R5,R16				; VALOR POTENCIA
000054 2e60      	MOV				R6,R16				; VALOR DISTRIBUIDOR			
000055 9bb4      	SBIS			PINB,4				; PRINCIPAL O REMOTO salta la siguiente instrucion si es uno
000056 c062      	RJMP			SALIR_AJUSTE		; SI HAY PUENTE REMOTO "NO TIENE TECLADOOOOOOO"
000057 e200      	LDI				R16,32				; PONE UN ESPACIO
000058 9300 07de 	STS				$7DE,R16
00005a 9300 07df 	STS				$7DF,R16
00005c 9300 07f0 	STS				$7F0,R16
00005e 9300 07f1 	STS				$7F1,R16
000060 9300 07f2 	STS				$7F2,R16
000062 9300 07f3 	STS				$7F3,R16
000064 9300 0804 	STS				$804,R16
000066 9300 0805 	STS				$805,R16
                 
                 
                 
                 AJUSTE_PRESENTACION_1:
                 ; POTENCIA 50 80 120 ETC CARGA 4 DIGITAS AL FINAL DE LA LINEA
000068 940e 0300 	CALL			ENCENDER_FUENTE		; PARA EL AJUSTE DE AMPERIOS y salida e3 a cero en ini micro
00006a 9a96      	SBI				PORTD,6				; ACTIVA UNA POLARIDAD
00006b 940e 012f 	CALL			AJUSTE_AMPERIOS		; MEDICION DE AMPERIOS ESTA AL FINAL DE ESTA RUTINA
00006d d066      	RCALL			AJUSTE_PRESENTACION_4	
                 
                 
                 ;       20x4        16x4   tipo de display
                 ; linea 1-128 		128 
                 ; linea 2-192		192
                 ; linea 3-148		144
                 ; linea 4-212		208
00006e e904      	LDI   			R16,148				; escribir en linea 3 DISTRIBUIDOR + MODELO + POTENCIA
00006f d146      	RCALL 			ENVINTR
000070 e0d7      	LDI   			YH,HIGH (LIN1P)
000071 edce      	LDI  			YL,LOW  (LIN1P)-2
000072 e114      	LDI   			R17,20
000073 940e 0925 	CALL 			ENVIARTEXTO
000075 ec00      	LDI   			R16,192				; 11000000 escribir en linea 2 
000076 d13f      	RCALL 			ENVINTR
000077 e0d7      	LDI   			YH,HIGH (LIN2P)		; POSICION ALTA DEL TAXTO EN RAM DISTRIBUIDOR
000078 efc2      	LDI   			YL,LOW  (LIN2P)-2	; direccion BAJA DEL TEXTO EN RAM  DISTRIBUIDOR    		
000079 e114      	LDI   			R17,20
00007a 940e 0925 	CALL 			ENVIARTEXTO
00007c e060      	LDI				R22,00
                 AJUSTE_PRESENTACION_2:					; RETARDO TECLADO
00007d 316e      	CPI				R22,30
00007e f3f0      	BRLO			AJUSTE_PRESENTACION_2	
                 ;LEC_TECLADO1:  ; RESULTADO EN R17 RUTINA LECTURA TECLADO
00007f 940e 04c0 	CALL			LEC_TEC				; RUTINA PARA LEER LAS TECLAS
                 ; CAMBIAR POTENCIA 50 80 120 ETC
000081 3e1f      	CPI				R17,0B11101111		; IDEM
000082 f061      	BREQ			SUBIR_R4			; SUBE LA POTENCIA
000083 3f1d      	CPI				R17,0B11111101		; IDEM
                 ;	BREQ			BAJAR_R4			; BAJA LA PTENCIA
                 ; CAMBIAR EMPRESA	TEAP AQUABEST ETC
000084 3f15      	CPI				R17,0B11110101		; IDEM COLOCA LA EMPRESA
                 ;	BREQ			BAJAR_R6
000085 3e17      	CPI				R17,0B11100111		; IDEM COLOCA LA EMPRESA
000086 f0b1      	BREQ			SUBIR_R6
                 ; CAMBIA EL TIPO  L   LS  LMG Q QS  QMG 123 456
000087 3f19      	CPI				R17,0B11111001		; COLOCA EL TIPO
                 ;	BREQ			BAJAR_R5
000088 3e1b      	CPI				R17,0B11101011		; COLOCA EL TIPO
000089 f109      	BREQ			SUBIR_R5
00008a 371f      	CPI				R17,0B01111111		; IDEM
00008b f169      	BREQ			SALIR_AJUSTE		; GRABA EN EEPROM LA POSICION DE LAS DOS LINEAS
00008c 3778      	CPI				LEC_REL, 120
00008d f159      	BREQ			SALIR_AJUSTE
00008e cfd9      	RJMP 			AJUSTE_PRESENTACION_1	
                 SUBIR_R4: ;SELECIONA LA POTENCIA DEL EQUIPO valores validos 0 1 2 3 4
00008f 9443      	INC				R4
000090 e085      	LDI				R24,5
000091 1648      	CP				R4,R24
000092 f411      	BRNE			SUBIR_R41
000093 e080      	LDI				R24,0
000094 2e48      	MOV				R4,R24
                 SUBIR_R41:
000095 cfd2      	RJMP 			AJUSTE_PRESENTACION_1	
                 BAJAR_R4: 
000096 944a      	DEC				R4
000097 2d84      	MOV				R24,R4
000098 3081      	CPI				R24,1				
000099 f010      	BRLO			BAJAR_R41
00009a e088      	LDI				R24,8
00009b 2e48      	MOV				R4,R24	
                 BAJAR_R41:
00009c cfcb      	RJMP 			AJUSTE_PRESENTACION_1
                 SUBIR_R6: ; DISTRIBUIDOR valores validos 0 1 2
00009d 9463      	INC				R6
00009e e083      	LDI				R24,3
00009f 1668      	CP				R6,R24
0000a0 f411      	BRNE			SUBIR_R61
0000a1 e081      	LDI				R24,1
0000a2 2e68      	MOV				R6,R24
                 SUBIR_R61:
0000a3 cfc4      	RJMP 			AJUSTE_PRESENTACION_1	
                 BAJAR_R6:
0000a4 946a      	DEC				R6
0000a5 2d86      	MOV				R24,R6
0000a6 3081      	CPI				R24,1
0000a7 f010      	BRLO			BAJAR_R61
0000a8 e083      	LDI				R24,3
0000a9 2e68      	MOV				R6,R24
                 BAJAR_R61:
0000aa cfbd      	RJMP 			AJUSTE_PRESENTACION_1
                 
                 SUBIR_R5: ; SELECIONA EL MODELO valores validos 0 1 2 3 4 5
                 
0000ab 9453      	INC				R5
0000ac e086      	LDI				R24,6
0000ad 1658      	CP				R5,R24
0000ae f411      	BRNE			SUBIR_R51
0000af e080      	LDI				R24,0
0000b0 2e58      	MOV				R5,R24
                 SUBIR_R51:
0000b1 cfb6      	RJMP 			AJUSTE_PRESENTACION_1	
                 BAJAR_R5:
0000b2 945a      	DEC				R5
0000b3 2d85      	MOV				R24,R5
0000b4 3081      	CPI				R24,1
0000b5 f010      	BRLO			BAJAR_R51
0000b6 e083      	LDI				R24,3
0000b7 2e68      	MOV				R6,R24
                 BAJAR_R51:
0000b8 cfaf      	RJMP 			AJUSTE_PRESENTACION_1
                 
                 
                 
                 
                 SALIR_AJUSTE:
0000b9 940e 02f2 CALL			APAGAR_FUENTE
0000bb 9896      CBI				PORTD,6
0000bc e112      	LDI				R17,texto_presentacion
0000bd 2d24      	MOV				R18,R4
0000be d4c8      	RCALL			EEPROM_ES
0000bf e113      	LDI				R17,texto_presentacion + 1
0000c0 2d25      	MOV				R18,R5
0000c1 d4c5      	RCALL			EEPROM_ES
0000c2 e114      	LDI				R17,texto_presentacion + 2
0000c3 2d26      	MOV				R18,R6
0000c4 d4c2      	RCALL			EEPROM_ES
                 
                 ;	LDI				R17,PH_SB			; OPCION INICIAL BAJAR PH
                 ;	LDI				R18,0				; VALOR A GRABAR CERO
                 ;	RCALL			EEPROM_ES
0000c5 e919      	LDI				R17,RETARDO_INICIO	; OPCION INICIAL MODO VALENCIA
0000c6 e020      	LDI				R18,0				; VALOR A GRABAR CERO
0000c7 d4bf      	RCALL			EEPROM_ES
                 ;	CALL			AJUSTE_PRODUCION	; SOLO PARA EL CASO DE QUE LA PISCINA TENGA CUBIERTA AUTOMATICA
0000c8 940e 0a54 	CALL			COMPARA2
0000ca e020      	LDI				R18,00
0000cb 2ef2      	MOV				VAL_LED,R18
0000cc 940e 091d 	CALL			LEDPANT
0000ce e060      	LDI				R22,00
                 AJUSTE_PRESENTACION_3:					; RETARDO TECLADO
0000cf 3664      	CPI				R22,100
0000d0 f3f0      	BRLO			AJUSTE_PRESENTACION_3	
0000d1 940e 0316 	CALL			L_HORA_1			; PARA INCREMENTAR 1 HORA, RESULTADO 000 HORAS
0000d3 9508      	RET
                 
                 AJUSTE_PRESENTACION_4: ;CONFIGURA LA PANTALLA DE PRESENTACION
                 
                  
                 
                 
                 
                 ; FABRICANTE O VENDEDOR LA VARIABLE ES R6
0000d4 e0d7          LDI   			YH,HIGH (LIN2P)    	; direcion alta donde se pone el texto en RAM
0000d5 efc4          LDI   			YL,LOW (LIN2P)     	; direccion baja donde se pone el texto en RAM 
0000d6 e2f9          LDI   			ZH,high(TEXTO4*2)	; direccion alta del TEXTO en Flash
0000d7 e0e0          LDI   			ZL,low(TEXTO4*2) 	; direccion baja del TEXTO en Flash 
0000d8 e100      	LDI				R16,16
0000d9 9d06      	MUL				R16,R6				; MULTIPLICA POR 16 EL VALOR DE LA POSICION EN EEPROM
0000da 0de0      	ADD				ZL,R0				; Y SUMA EL RESULTADO A ZL
0000db e100          LDI   			R16,16      		; longitud de texto a copiar en RAM
                 CARGATEXTO_4:
0000dc 95c8      	LPM      							; leemos TEXTO de FLASH y lo almacena en R0
0000dd 9631      	ADIW  			ZL,1   				; apuntamos al siguiente elemento 
0000de 8208      	ST    			Y,R0				; guardamos en RAM POSICION Y EL CONTENIDO DE R0
0000df 9621      	ADIW  			YL,1      		
0000e0 950a      	DEC   			R16      			; Hemos terminado..?? 
0000e1 f7d1      	BRNE  			CARGATEXTO_4  		; NO...seguimos cargando 
0000e2 2d06      MOV	R16,R6
0000e3 3000      CPI R16,0
0000e4 f479      BRNE CARGATEXTO_4A ; SI NO ES CERO LO HACE NORMAL VA A CARGATEXTO_4A
0000e5 e0d7      	LDI   			YH,HIGH (LIN1P)    	; direcion alta donde se pone el texto en RAM
0000e6 eec0          LDI   			YL,LOW (LIN1P)     	; direccion baja donde se pone el texto en RAM 
0000e7 e2f9          LDI   			ZH,high(TEXTO4*2)	; direccion alta del TEXTO en Flash
0000e8 e0e0          LDI   			ZL,low(TEXTO4*2) 	; direccion baja del TEXTO en Flash 
0000e9 e100      	LDI				R16,16
0000ea 9d06      	MUL				R16,R6				; MULTIPLICA POR 16 EL VALOR DE LA POSICION EN EEPROM
0000eb 0de0      	ADD				ZL,R0				; Y SUMA EL RESULTADO A ZL
0000ec e100          LDI   			R16,16      		; longitud de texto a copiar en RAM
                 CARGATEXTO_4B:
0000ed 95c8      	LPM      							; leemos TEXTO de FLASH y lo almacena en R0
0000ee 9631      	ADIW  			ZL,1   				; apuntamos al siguiente elemento 
0000ef 8208      	ST    			Y,R0				; guardamos en RAM POSICION Y EL CONTENIDO DE R0
0000f0 9621      	ADIW  			YL,1      		
0000f1 950a      	DEC   			R16      			; Hemos terminado..?? 
0000f2 f7d1      	BRNE  			CARGATEXTO_4B  		; NO...seguimos cargando 
0000f3 9508      	RET
                 
                 CARGATEXTO_4A:
                 ; CONFIGURA LINEA TRES DISTRIBUIDOR TIPO POTENCIA
0000f4 e0d7      	LDI   			YH,HIGH (LIN1P)     ; direcion alta donde se pone el texto en RAM
0000f5 eecc          LDI   			YL,LOW (LIN1P)+12     ; direccion baja donde se pone el texto en RAM 
0000f6 e2f8          LDI   			ZH,high(TEXTO3*2)	; direccion alta del TEXTO en Flash
0000f7 e0e0          LDI   			ZL,low(TEXTO3*2) 	; direccion baja del TEXTO en Flash 
0000f8 e004      	LDI				R16,4				; LONGITUD DEL TEXTO
0000f9 9d04      	MUL				R16,R4				; MULTIPLICA POR 16 EL VALOR DE LA POSICION EN EEPROM
0000fa 0de0      	ADD				ZL,R0				; Y SUMA EL RESULTADO A ZL
0000fb e004          LDI   			R16,4      		; longitud de texto a copiar en RAM
                 CARGATEXTO_3:
0000fc 95c8      	LPM      							; leemos TEXTO de FLASH y lo almacena en R0
0000fd 9631      	ADIW  			ZL,1   				; apuntamos al siguiente elemento 
0000fe 8208      	ST    			Y, R0				; guardamos en RAM POSICION Y EL CONTENIDO DE R0
0000ff 9621      	ADIW  			YL,1				; incrementa en una unidad      		
000100 950a      	DEC   			R16      			; Hemos terminado..?? 
000101 f7d1      	BRNE  			CARGATEXTO_3  		; NO...seguimos cargando 
                 ; EN LINEA TRES PONE SALICLOR O AQUABEST
                 
                 ; MODELO POSICION EN RAM
000102 e0d7          LDI   			YH,HIGH (LIN1P)     ; direcion alta donde se pone el texto en RAM
000103 eec0          LDI   			YL,LOW (LIN1P)		; direccion baja donde se pone el texto en RAM 
000104 2d26      	MOV				R18,R6
000105 3022      	CPI				R18,2				; 2 ES AQUABEST
000106 f419      	BRNE			CARGATEXTO_51		; SI ES DISTINTO 
000107 e2f8          LDI   			ZH,high(TEXTO4A*2)	; direccion alta del TEXTO en Flash
000108 ede0          LDI   			ZL,low(TEXTO4A*2) 	; direccion baja del TEXTO en Flash 
000109 c002      	RJMP			CARGATEXTO_52
                 CARGATEXTO_51:		; CARGA SALICLOR
00010a e2f8          LDI   			ZH,high(TEXTO4A*2)	; direccion alta del TEXTO en Flash
00010b eee0      	LDI   			ZL,low(TEXTO4A*2)+16; direccion baja del TEXTO en Flash 
                 CARGATEXTO_52:
00010c e022      	LDI				R18,2				; POSICION DEL TEXTO EN RAM 
00010d 9f02      	MUL				R16,R18				; MULTIPLICA POR 16 EL VALOR DE LA POSICION EN EEPROM
00010e 0de0      	ADD				ZL,R0				; Y SUMA EL RESULTADO A ZL
00010f e009          LDI   			R16,9    	  		; longitud de texto a copiar en RAM
                 CARGATEXTO_5:
000110 95c8      	LPM      							; leemos TEXTO de FLASH y lo almacena en R0
000111 9631      	ADIW  			ZL,1   				; apuntamos al siguiente elemento 
000112 8208      	ST    			Y, R0				; guardamos en RAM POSICION Y EL CONTENIDO DE R0
000113 9621      	ADIW  			YL,1				; incrementa en una unidad      		
000114 950a      	DEC   			R16      			; Hemos terminado..?? 
000115 f7d1      	BRNE  			CARGATEXTO_5  		; NO...seguimos cargando 
                 ; CARGA EL TIPO DE EQUIPO SAL MAGNESIO O BAJO EN SAL
000116 e0d7          LDI   			YH,HIGH (LIN1P)     ; direcion alta donde se pone el texto en RAM
000117 eec9          LDI   			YL,LOW (LIN1P)+9	; direccion baja donde se pone el texto en RAM 
000118 e2f8          LDI   			ZH,high(TEXTO3A*2)	; direccion alta del TEXTO en Flash
000119 e2e0          LDI   			ZL,low(TEXTO3A*2) 	; direccion baja del TEXTO en Flash 
00011a e004      	LDI				R16,4				; LONGITUD DE TEXTO
00011b 9d05      	MUL				R16,R5				; MULTIPLICA POR 16 EL VALOR DE LA POSICION EN EEPROM
00011c 0de0      	ADD				ZL,R0				; Y SUMA EL RESULTADO A ZL
00011d e004          LDI   			R16,4    	  		; longitud de texto a copiar en RAM
                 CARGA_TEXTO_6:
00011e 95c8      	LPM      							; leemos TEXTO de FLASH y lo almacena en R0
00011f 9631      	ADIW  			ZL,1   				; apuntamos al siguiente elemento 
000120 8208      	ST    			Y, R0				; guardamos en RAM POSICION Y EL CONTENIDO DE R0
000121 9621      	ADIW  			YL,1				; incrementa en una unidad      		
000122 950a      	DEC   			R16      			; Hemos terminado..?? 
000123 f7d1      	BRNE  			CARGA_TEXTO_6  		; NO...seguimos carga
000124 9508      	RET
                 
                 
                 
                 PAR_MOD_DIS: ; LEE DE LA EEPROM R4,R5,R6 PARA CONFIGURAR LINES 2 Y3 DE PRESENTACION
000125 e112      	LDI				R17,texto_presentacion
000126 d457      	RCALL			EEPROM_RW
000127 2e42      	MOV				R4,R18
000128 e113      	LDI				R17,texto_presentacion + 1
000129 d454      	RCALL			EEPROM_RW
00012a 2e52      	MOV				R5,R18
00012b e114      	LDI				R17,texto_presentacion + 2
00012c d451      	RCALL			EEPROM_RW
00012d 2e62      	MOV				R6,R18
00012e 9508      	RET
                 
                 
                 AJUSTE_AMPERIOS:
00012f e8ac      	LDI				R26,140; RAMC_SAL		; NUMERO DE MEDICIONES
000130 e026      	LDI				R18,6;P_SAL			; LINEA DE ENTRADA EN EL CONVERTIDOR
000131 940e 013c 	CALL			ADC_P
000133 9380 0ac8 	STS				AMP_PWM+4,R24
000135 940e 0590 	CALL			RADC
                 ;	STS				$7DE,R1
000137 9220 07de 	STS				$7DE,R2						; VALOR DE LAS DECENAS LO COLOCA EN LA LINEA 1 DE MODELO
000139 9230 07df 	STS				$7DF,R3						; VALOR DE LAS UNIDADES
00013b 9508      	RET
                 .INCLUDE "PARAMETROS_I2C.ASM"
                 
                 
                 /* General Master Status Codes */
                 .EQU I2C_START = 0x08
                 .EQU REP_START = 0x10
                 /* Master Transmitter Status Codes */
                 .EQU MT_SLA_ACK = 0x18
                 .EQU MT_SLA_NACK = 0x20
                 .EQU MT_DATA_ACK = 0x28
                 .EQU MT_DATA_NACK = 0x30
                 .EQU# MT_ARB_LOST = 0x38
                 /* Master Receiver Status Codes */
                 .EQU MR_ARB_LOST = 0x38
                 .EQU MR_SLA_ACK = 0x40
                 .EQU MR_SLA_NACK = 0x48
                 .EQU MR_DATA_ACK = 0x50
                 .EQU MR_DATA_NACK = 0x58
                 /* Slave Receiver Status Codes */
                 .EQU SR_SLA_ACK = 0x60
                 .EQU SR_ARB_LOST_SLA_ACK = 0x68
                 .EQU SR_GCALL_ACK = 0x70
                 .EQU SR_ARB_LOST_GCALL_ACK = 0x78
                 .EQU SR_DATA_ACK = 0x80
                 .EQU SR_DATA_NACK = 0x88
                 .EQU SR_GCALL_DATA_ACK = 0x90
                 .EQU SR_GCALL_DATA_NACK = 0x98
                 .EQU SR_STOP = 0xA0
                 /* Slave Transmitter Status Codes */
                 .EQU ST_SLA_ACK = 0xA8
                 .EQU ST_ARB_LOST_SLA_ACK = 0xB0
                 .EQU ST_DATA_ACK = 0xB8
                 .EQU ST_DATA_NACK = 0xC0
                 .EQU ST_LAST_DATA = 0xC8
                 /* Miscellaneous States */
                 .EQU NO_INFO = 0xF8
                 .EQU BUS_ERROR = 0x00
                 .INCLUDE "M64DEF.INC"			; DEFINICION DE REGISTROS
                 
                   
                   ;***** THIS IS A MACHINE GENERATED FILE - DO NOT EDIT ********************
                 ;***** Created: 2009-11-03 14:40 ******* Source: ATmega64.xml ************
                 ;*************************************************************************
                 ;* A P P L I C A T I O N   N O T E   F O R   T H E   A V R   F A M I L Y
                 ;* 
                 ;* Number            : AVR000
                 ;* File Name         : "m64def.inc"
                 ;* Title             : Register/Bit Definitions for the ATmega64
                 ;* Date              : 2009-11-03
                 ;* Version           : 2.35
                 ;* Support E-mail    : avr@atmel.com
                 ;* Target MCU        : ATmega64
                 ;* 
                 ;* DESCRIPTION
                 ;* When including this file in the assembly program file, all I/O register 
                 ;* names and I/O register bit names appearing in the data book can be used.
                 ;* In addition, the six registers forming the three data pointers X, Y and 
                 ;* Z have been assigned names XL - ZH. Highest RAM address for Internal 
                 ;* SRAM is also defined 
                 ;* 
                 ;* The Register names are represented by their hexadecimal address.
                 ;* 
                 ;* The Register Bit names are represented by their bit number (0-7).
                 ;* 
                 ;* Please observe the difference in using the bit names with instructions
                 ;* such as "sbr"/"cbr" (set/clear bit in register) and "sbrs"/"sbrc"
                 ;* (skip if bit in register set/cleared). The following example illustrates
                 ;* this:
                 ;* 
                 ;* in    r16,PORTB             ;read PORTB latch
                 ;* sbr   r16,(1<<PB6)+(1<<PB5) ;set PB6 and PB5 (use masks, not bit#)
                 ;* out   PORTB,r16             ;output to PORTB
                 ;* 
                 ;* in    r16,TIFR              ;read the Timer Interrupt Flag Register
                 ;* sbrc  r16,TOV0              ;test the overflow flag (use bit#)
                 ;* rjmp  TOV0_is_set           ;jump if set
                 ;* ...                         ;otherwise do something else
                 ;*************************************************************************
                 
                 #ifndef _M64DEF_INC_
                 #define _M64DEF_INC_
                 
                 
                 #pragma partinc 0
                 
                 ; ***** SPECIFY DEVICE ***************************************************
                 .device ATmega64
                 #pragma AVRPART ADMIN PART_NAME ATmega64
                 .equ	SIGNATURE_000	= 0x1e
                 .equ	SIGNATURE_001	= 0x96
                 .equ	SIGNATURE_002	= 0x02
                 
                 #pragma AVRPART CORE CORE_VERSION V2E
                 
                 
                 ; ***** I/O REGISTER DEFINITIONS *****************************************
                 ; NOTE:
                 ; Definitions marked "MEMORY MAPPED"are extended I/O ports
                 ; and cannot be used with IN/OUT instructions
                 .equ	UCSR1C	= 0x9d	; MEMORY MAPPED
                 .equ	UDR1	= 0x9c	; MEMORY MAPPED
                 .equ	UCSR1A	= 0x9b	; MEMORY MAPPED
                 .equ	UCSR1B	= 0x9a	; MEMORY MAPPED
                 .equ	UBRR1H	= 0x98	; MEMORY MAPPED
                 .equ	UBRR1L	= 0x99	; MEMORY MAPPED
                 .equ	UCSR0C	= 0x95	; MEMORY MAPPED
                 .equ	UBRR0H	= 0x90	; MEMORY MAPPED
                 .equ	ADCSRB	= 0x8e	; MEMORY MAPPED
                 .equ	TCCR3C	= 0x8c	; MEMORY MAPPED
                 .equ	TCCR3A	= 0x8b	; MEMORY MAPPED
                 .equ	TCCR3B	= 0x8a	; MEMORY MAPPED
                 .equ	TCNT3L	= 0x88	; MEMORY MAPPED
                 .equ	TCNT3H	= 0x89	; MEMORY MAPPED
                 .equ	OCR3AL	= 0x86	; MEMORY MAPPED
                 .equ	OCR3AH	= 0x87	; MEMORY MAPPED
                 .equ	OCR3BL	= 0x84	; MEMORY MAPPED
                 .equ	OCR3BH	= 0x85	; MEMORY MAPPED
                 .equ	OCR3CL	= 0x82	; MEMORY MAPPED
                 .equ	OCR3CH	= 0x83	; MEMORY MAPPED
                 .equ	ICR3L	= 0x80	; MEMORY MAPPED
                 .equ	ICR3H	= 0x81	; MEMORY MAPPED
                 .equ	ETIMSK	= 0x7d	; MEMORY MAPPED
                 .equ	ETIFR	= 0x7c	; MEMORY MAPPED
                 .equ	TCCR1C	= 0x7a	; MEMORY MAPPED
                 .equ	OCR1CL	= 0x78	; MEMORY MAPPED
                 .equ	OCR1CH	= 0x79	; MEMORY MAPPED
                 .equ	TWCR	= 0x74	; MEMORY MAPPED
                 .equ	TWDR	= 0x73	; MEMORY MAPPED
                 .equ	TWAR	= 0x72	; MEMORY MAPPED
                 .equ	TWSR	= 0x71	; MEMORY MAPPED
                 .equ	TWBR	= 0x70	; MEMORY MAPPED
                 .equ	OSCCAL	= 0x6f	; MEMORY MAPPED
                 .equ	XMCRA	= 0x6d	; MEMORY MAPPED
                 .equ	XMCRB	= 0x6c	; MEMORY MAPPED
                 .equ	EICRA	= 0x6a	; MEMORY MAPPED
                 .equ	SPMCSR	= 0x68	; MEMORY MAPPED
                 .equ	PORTG	= 0x65	; MEMORY MAPPED
                 .equ	DDRG	= 0x64	; MEMORY MAPPED
                 .equ	PING	= 0x63	; MEMORY MAPPED
                 .equ	PORTF	= 0x62	; MEMORY MAPPED
                 .equ	DDRF	= 0x61	; MEMORY MAPPED
                 .equ	SREG	= 0x3f
                 .equ	SPL	= 0x3d
                 .equ	SPH	= 0x3e
                 .equ	XDIV	= 0x3c
                 .equ	EICRB	= 0x3a
                 .equ	EIMSK	= 0x39
                 .equ	EIFR	= 0x38
                 .equ	TIMSK	= 0x37
                 .equ	TIFR	= 0x36
                 .equ	MCUCR	= 0x35
                 .equ	MCUCSR	= 0x34
                 .equ	TCCR0	= 0x33
                 .equ	TCNT0	= 0x32
                 .equ	OCR0	= 0x31
                 .equ	ASSR	= 0x30
                 .equ	TCCR1A	= 0x2f
                 .equ	TCCR1B	= 0x2e
                 .equ	TCNT1L	= 0x2c
                 .equ	TCNT1H	= 0x2d
                 .equ	OCR1AL	= 0x2a
                 .equ	OCR1AH	= 0x2b
                 .equ	OCR1BL	= 0x28
                 .equ	OCR1BH	= 0x29
                 .equ	ICR1L	= 0x26
                 .equ	ICR1H	= 0x27
                 .equ	TCCR2	= 0x25
                 .equ	TCNT2	= 0x24
                 .equ	OCR2	= 0x23
                 .equ	OCDR	= 0x22
                 .equ	WDTCR	= 0x21
                 .equ	SFIOR	= 0x20
                 .equ	EEARL	= 0x1e
                 .equ	EEARH	= 0x1f
                 .equ	EEDR	= 0x1d
                 .equ	EECR	= 0x1c
                 .equ	PORTA	= 0x1b
                 .equ	DDRA	= 0x1a
                 .equ	PINA	= 0x19
                 .equ	PORTB	= 0x18
                 .equ	DDRB	= 0x17
                 .equ	PINB	= 0x16
                 .equ	PORTC	= 0x15
                 .equ	DDRC	= 0x14
                 .equ	PINC	= 0x13
                 .equ	PORTD	= 0x12
                 .equ	DDRD	= 0x11
                 .equ	PIND	= 0x10
                 .equ	SPDR	= 0x0f
                 .equ	SPSR	= 0x0e
                 .equ	SPCR	= 0x0d
                 .equ	UDR0	= 0x0c
                 .equ	UCSR0A	= 0x0b
                 .equ	UCSR0B	= 0x0a
                 .equ	UBRR0L	= 0x09
                 .equ	ACSR	= 0x08
                 .equ	ADMUX	= 0x07
                 .equ	ADCSRA	= 0x06
                 .equ	ADCH	= 0x05
                 .equ	ADCL	= 0x04
                 .equ	PORTE	= 0x03
                 .equ	DDRE	= 0x02
                 .equ	PINE	= 0x01
                 .equ	PINF	= 0x00
                 
                 
                 ; ***** BIT DEFINITIONS **************************************************
                 
                 ; ***** ANALOG_COMPARATOR ************
                 ; SFIOR - Special Function IO Register
                 .equ	ACME	= 3	; Analog Comparator Multiplexer Enable
                 
                 ; ACSR - Analog Comparator Control And Status Register
                 .equ	ACIS0	= 0	; Analog Comparator Interrupt Mode Select bit 0
                 .equ	ACIS1	= 1	; Analog Comparator Interrupt Mode Select bit 1
                 .equ	ACIC	= 2	; Analog Comparator Input Capture Enable
                 .equ	ACIE	= 3	; Analog Comparator Interrupt Enable
                 .equ	ACI	= 4	; Analog Comparator Interrupt Flag
                 .equ	ACO	= 5	; Analog Compare Output
                 .equ	ACBG	= 6	; Analog Comparator Bandgap Select
                 .equ	ACD	= 7	; Analog Comparator Disable
                 
                 
                 ; ***** AD_CONVERTER *****************
                 ; ADMUX - The ADC multiplexer Selection Register
                 .equ	MUX0	= 0	; Analog Channel and Gain Selection Bits
                 .equ	MUX1	= 1	; Analog Channel and Gain Selection Bits
                 .equ	MUX2	= 2	; Analog Channel and Gain Selection Bits
                 .equ	MUX3	= 3	; Analog Channel and Gain Selection Bits
                 .equ	MUX4	= 4	; Analog Channel and Gain Selection Bits
                 .equ	ADLAR	= 5	; Left Adjust Result
                 .equ	REFS0	= 6	; Reference Selection Bit 0
                 .equ	REFS1	= 7	; Reference Selection Bit 1
                 
                 ; ADCSRA - The ADC Control and Status register A
                 .equ	ADCSR	= ADCSRA	; For compatibility
                 .equ	ADPS0	= 0	; ADC  Prescaler Select Bits
                 .equ	ADPS1	= 1	; ADC  Prescaler Select Bits
                 .equ	ADPS2	= 2	; ADC  Prescaler Select Bits
                 .equ	ADIE	= 3	; ADC Interrupt Enable
                 .equ	ADIF	= 4	; ADC Interrupt Flag
                 .equ	ADATE	= 5	; ADC  Auto Trigger Enable
                 .equ	ADFR	= ADATE	; For compatibility
                 .equ	ADSC	= 6	; ADC Start Conversion
                 .equ	ADEN	= 7	; ADC Enable
                 
                 ; ADCH - ADC Data Register High Byte
                 .equ	ADCH0	= 0	; ADC Data Register High Byte Bit 0
                 .equ	ADCH1	= 1	; ADC Data Register High Byte Bit 1
                 .equ	ADCH2	= 2	; ADC Data Register High Byte Bit 2
                 .equ	ADCH3	= 3	; ADC Data Register High Byte Bit 3
                 .equ	ADCH4	= 4	; ADC Data Register High Byte Bit 4
                 .equ	ADCH5	= 5	; ADC Data Register High Byte Bit 5
                 .equ	ADCH6	= 6	; ADC Data Register High Byte Bit 6
                 .equ	ADCH7	= 7	; ADC Data Register High Byte Bit 7
                 
                 ; ADCL - ADC Data Register Low Byte
                 .equ	ADCL0	= 0	; ADC Data Register Low Byte Bit 0
                 .equ	ADCL1	= 1	; ADC Data Register Low Byte Bit 1
                 .equ	ADCL2	= 2	; ADC Data Register Low Byte Bit 2
                 .equ	ADCL3	= 3	; ADC Data Register Low Byte Bit 3
                 .equ	ADCL4	= 4	; ADC Data Register Low Byte Bit 4
                 .equ	ADCL5	= 5	; ADC Data Register Low Byte Bit 5
                 .equ	ADCL6	= 6	; ADC Data Register Low Byte Bit 6
                 .equ	ADCL7	= 7	; ADC Data Register Low Byte Bit 7
                 
                 ; ADCSRB - The ADC Control and Status register B
                 .equ	ADTS0	= 0	; ADC Auto Trigger Source bit 0
                 .equ	ADTS1	= 1	; ADC Auto Trigger Source bit 1
                 .equ	ADTS2	= 2	; ADC Auto Trigger Source bit 2
                 
                 
                 ; ***** SPI **************************
                 ; SPDR - SPI Data Register
                 .equ	SPDR0	= 0	; SPI Data Register bit 0
                 .equ	SPDR1	= 1	; SPI Data Register bit 1
                 .equ	SPDR2	= 2	; SPI Data Register bit 2
                 .equ	SPDR3	= 3	; SPI Data Register bit 3
                 .equ	SPDR4	= 4	; SPI Data Register bit 4
                 .equ	SPDR5	= 5	; SPI Data Register bit 5
                 .equ	SPDR6	= 6	; SPI Data Register bit 6
                 .equ	SPDR7	= 7	; SPI Data Register bit 7
                 
                 ; SPSR - SPI Status Register
                 .equ	SPI2X	= 0	; Double SPI Speed Bit
                 .equ	WCOL	= 6	; Write Collision Flag
                 .equ	SPIF	= 7	; SPI Interrupt Flag
                 
                 ; SPCR - SPI Control Register
                 .equ	SPR0	= 0	; SPI Clock Rate Select 0
                 .equ	SPR1	= 1	; SPI Clock Rate Select 1
                 .equ	CPHA	= 2	; Clock Phase
                 .equ	CPOL	= 3	; Clock polarity
                 .equ	MSTR	= 4	; Master/Slave Select
                 .equ	DORD	= 5	; Data Order
                 .equ	SPE	= 6	; SPI Enable
                 .equ	SPIE	= 7	; SPI Interrupt Enable
                 
                 
                 ; ***** TWI **************************
                 ; TWBR - TWI Bit Rate register
                 .equ	I2BR	= TWBR	; For compatibility
                 .equ	TWBR0	= 0	; 
                 .equ	TWBR1	= 1	; 
                 .equ	TWBR2	= 2	; 
                 .equ	TWBR3	= 3	; 
                 .equ	TWBR4	= 4	; 
                 .equ	TWBR5	= 5	; 
                 .equ	TWBR6	= 6	; 
                 .equ	TWBR7	= 7	; 
                 
                 ; TWCR - TWI Control Register
                 .equ	I2CR	= TWCR	; For compatibility
                 .equ	TWIE	= 0	; TWI Interrupt Enable
                 .equ	I2IE	= TWIE	; For compatibility
                 .equ	TWEN	= 2	; TWI Enable Bit
                 .equ	I2EN	= TWEN	; For compatibility
                 .equ	ENI2C	= TWEN	; For compatibility
                 .equ	TWWC	= 3	; TWI Write Collition Flag
                 .equ	I2WC	= TWWC	; For compatibility
                 .equ	TWSTO	= 4	; TWI Stop Condition Bit
                 .equ	I2STO	= TWSTO	; For compatibility
                 .equ	TWSTA	= 5	; TWI Start Condition Bit
                 .equ	I2STA	= TWSTA	; For compatibility
                 .equ	TWEA	= 6	; TWI Enable Acknowledge Bit
                 .equ	I2EA	= TWEA	; For compatibility
                 .equ	TWINT	= 7	; TWI Interrupt Flag
                 .equ	I2INT	= TWINT	; For compatibility
                 
                 ; TWSR - TWI Status Register
                 .equ	I2SR	= TWSR	; For compatibility
                 .equ	TWPS0	= 0	; TWI Prescaler
                 .equ	TWS0	= TWPS0	; For compatibility
                 .equ	I2GCE	= TWPS0	; For compatibility
                 .equ	TWPS1	= 1	; TWI Prescaler
                 .equ	TWS1	= TWPS1	; For compatibility
                 .equ	TWS3	= 3	; TWI Status
                 .equ	I2S3	= TWS3	; For compatibility
                 .equ	TWS4	= 4	; TWI Status
                 .equ	I2S4	= TWS4	; For compatibility
                 .equ	TWS5	= 5	; TWI Status
                 .equ	I2S5	= TWS5	; For compatibility
                 .equ	TWS6	= 6	; TWI Status
                 .equ	I2S6	= TWS6	; For compatibility
                 .equ	TWS7	= 7	; TWI Status
                 .equ	I2S7	= TWS7	; For compatibility
                 
                 ; TWDR - TWI Data register
                 .equ	I2DR	= TWDR	; For compatibility
                 .equ	TWD0	= 0	; TWI Data Register Bit 0
                 .equ	TWD1	= 1	; TWI Data Register Bit 1
                 .equ	TWD2	= 2	; TWI Data Register Bit 2
                 .equ	TWD3	= 3	; TWI Data Register Bit 3
                 .equ	TWD4	= 4	; TWI Data Register Bit 4
                 .equ	TWD5	= 5	; TWI Data Register Bit 5
                 .equ	TWD6	= 6	; TWI Data Register Bit 6
                 .equ	TWD7	= 7	; TWI Data Register Bit 7
                 
                 ; TWAR - TWI (Slave) Address register
                 .equ	I2AR	= TWAR	; For compatibility
                 .equ	TWGCE	= 0	; TWI General Call Recognition Enable Bit
                 .equ	TWA0	= 1	; TWI (Slave) Address register Bit 0
                 .equ	TWA1	= 2	; TWI (Slave) Address register Bit 1
                 .equ	TWA2	= 3	; TWI (Slave) Address register Bit 2
                 .equ	TWA3	= 4	; TWI (Slave) Address register Bit 3
                 .equ	TWA4	= 5	; TWI (Slave) Address register Bit 4
                 .equ	TWA5	= 6	; TWI (Slave) Address register Bit 5
                 .equ	TWA6	= 7	; TWI (Slave) Address register Bit 6
                 
                 
                 ; ***** USART0 ***********************
                 ; UDR0 - USART I/O Data Register
                 .equ	UDR00	= 0	; USART I/O Data Register bit 0
                 .equ	UDR01	= 1	; USART I/O Data Register bit 1
                 .equ	UDR02	= 2	; USART I/O Data Register bit 2
                 .equ	UDR03	= 3	; USART I/O Data Register bit 3
                 .equ	UDR04	= 4	; USART I/O Data Register bit 4
                 .equ	UDR05	= 5	; USART I/O Data Register bit 5
                 .equ	UDR06	= 6	; USART I/O Data Register bit 6
                 .equ	UDR07	= 7	; USART I/O Data Register bit 7
                 
                 ; UCSR0A - USART Control and Status Register A
                 .equ	MPCM0	= 0	; Multi-processor Communication Mode
                 .equ	U2X0	= 1	; Double the USART transmission speed
                 .equ	UPE0	= 2	; Parity Error
                 .equ	DOR0	= 3	; Data overRun
                 .equ	FE0	= 4	; Framing Error
                 .equ	UDRE0	= 5	; USART Data Register Empty
                 .equ	TXC0	= 6	; USART Transmitt Complete
                 .equ	RXC0	= 7	; USART Receive Complete
                 
                 ; UCSR0B - USART Control and Status Register B
                 .equ	TXB80	= 0	; Transmit Data Bit 8
                 .equ	RXB80	= 1	; Receive Data Bit 8
                 .equ	UCSZ02	= 2	; Character Size
                 .equ	UCSZ2	= UCSZ02	; For compatibility
                 .equ	TXEN0	= 3	; Transmitter Enable
                 .equ	RXEN0	= 4	; Receiver Enable
                 .equ	UDRIE0	= 5	; USART Data register Empty Interrupt Enable
                 .equ	TXCIE0	= 6	; TX Complete Interrupt Enable
                 .equ	RXCIE0	= 7	; RX Complete Interrupt Enable
                 
                 ; UCSR0C - USART Control and Status Register C
                 .equ	UCPOL0	= 0	; Clock Polarity
                 .equ	UCSZ00	= 1	; Character Size
                 .equ	UCSZ01	= 2	; Character Size
                 .equ	USBS0	= 3	; Stop Bit Select
                 .equ	UPM00	= 4	; Parity Mode Bit 0
                 .equ	UPM01	= 5	; Parity Mode Bit 1
                 .equ	UMSEL0	= 6	; USART Mode Select
                 
                 ; UBRR0H - USART Baud Rate Register Hight Byte
                 .equ	UBRR8	= 0	; USART Baud Rate Register bit 8
                 .equ	UBRR9	= 1	; USART Baud Rate Register bit 9
                 .equ	UBRR10	= 2	; USART Baud Rate Register bit 10
                 .equ	UBRR11	= 3	; USART Baud Rate Register bit 11
                 
                 ; UBRR0L - USART Baud Rate Register Low Byte
                 .equ	UBRR0	= 0	; USART Baud Rate Register bit 0
                 .equ	UBRR1	= 1	; USART Baud Rate Register bit 1
                 .equ	UBRR2	= 2	; USART Baud Rate Register bit 2
                 .equ	UBRR3	= 3	; USART Baud Rate Register bit 3
                 .equ	UBRR4	= 4	; USART Baud Rate Register bit 4
                 .equ	UBRR5	= 5	; USART Baud Rate Register bit 5
                 .equ	UBRR6	= 6	; USART Baud Rate Register bit 6
                 .equ	UBRR7	= 7	; USART Baud Rate Register bit 7
                 
                 
                 ; ***** USART1 ***********************
                 ; UDR1 - USART I/O Data Register
                 .equ	UDR10	= 0	; USART I/O Data Register bit 0
                 .equ	UDR11	= 1	; USART I/O Data Register bit 1
                 .equ	UDR12	= 2	; USART I/O Data Register bit 2
                 .equ	UDR13	= 3	; USART I/O Data Register bit 3
                 .equ	UDR14	= 4	; USART I/O Data Register bit 4
                 .equ	UDR15	= 5	; USART I/O Data Register bit 5
                 .equ	UDR16	= 6	; USART I/O Data Register bit 6
                 .equ	UDR17	= 7	; USART I/O Data Register bit 7
                 
                 ; UCSR1A - USART Control and Status Register A
                 .equ	MPCM1	= 0	; Multi-processor Communication Mode
                 .equ	U2X1	= 1	; Double the USART transmission speed
                 .equ	UPE1	= 2	; Parity Error
                 .equ	DOR1	= 3	; Data overRun
                 .equ	FE1	= 4	; Framing Error
                 .equ	UDRE1	= 5	; USART Data Register Empty
                 .equ	TXC1	= 6	; USART Transmitt Complete
                 .equ	RXC1	= 7	; USART Receive Complete
                 
                 ; UCSR1B - USART Control and Status Register B
                 .equ	TXB81	= 0	; Transmit Data Bit 8
                 .equ	RXB81	= 1	; Receive Data Bit 8
                 .equ	UCSZ12	= 2	; Character Size
                 .equ	TXEN1	= 3	; Transmitter Enable
                 .equ	RXEN1	= 4	; Receiver Enable
                 .equ	UDRIE1	= 5	; USART Data register Empty Interrupt Enable
                 .equ	TXCIE1	= 6	; TX Complete Interrupt Enable
                 .equ	RXCIE1	= 7	; RX Complete Interrupt Enable
                 
                 ; UCSR1C - USART Control and Status Register C
                 .equ	UCPOL1	= 0	; Clock Polarity
                 .equ	UCSZ10	= 1	; Character Size
                 .equ	UCSZ11	= 2	; Character Size
                 .equ	USBS1	= 3	; Stop Bit Select
                 .equ	UPM10	= 4	; Parity Mode Bit 0
                 .equ	UPM11	= 5	; Parity Mode Bit 1
                 .equ	UMSEL1	= 6	; USART Mode Select
                 
                 ; UBRR1H - USART Baud Rate Register Hight Byte
                 ;.equ	UBRR8	= 0	; USART Baud Rate Register bit 8
                 ;.equ	UBRR9	= 1	; USART Baud Rate Register bit 9
                 ;.equ	UBRR10	= 2	; USART Baud Rate Register bit 10
                 ;.equ	UBRR11	= 3	; USART Baud Rate Register bit 11
                 
                 ; UBRR1L - USART Baud Rate Register Low Byte
                 ;.equ	UBRR0	= 0	; USART Baud Rate Register bit 0
                 ;.equ	UBRR1	= 1	; USART Baud Rate Register bit 1
                 ;.equ	UBRR2	= 2	; USART Baud Rate Register bit 2
                 ;.equ	UBRR3	= 3	; USART Baud Rate Register bit 3
                 ;.equ	UBRR4	= 4	; USART Baud Rate Register bit 4
                 ;.equ	UBRR5	= 5	; USART Baud Rate Register bit 5
                 ;.equ	UBRR6	= 6	; USART Baud Rate Register bit 6
                 ;.equ	UBRR7	= 7	; USART Baud Rate Register bit 7
                 
                 
                 ; ***** CPU **************************
                 ; SREG - Status Register
                 .equ	SREG_C	= 0	; Carry Flag
                 .equ	SREG_Z	= 1	; Zero Flag
                 .equ	SREG_N	= 2	; Negative Flag
                 .equ	SREG_V	= 3	; Two's Complement Overflow Flag
                 .equ	SREG_S	= 4	; Sign Bit
                 .equ	SREG_H	= 5	; Half Carry Flag
                 .equ	SREG_T	= 6	; Bit Copy Storage
                 .equ	SREG_I	= 7	; Global Interrupt Enable
                 
                 ; MCUCR - MCU Control Register
                 .equ	IVCE	= 0	; Interrupt Vector Change Enable
                 .equ	IVSEL	= 1	; Interrupt Vector Select
                 .equ	SM2	= 2	; Sleep Mode Select
                 .equ	SM0	= 3	; Sleep Mode Select
                 .equ	SM1	= 4	; Sleep Mode Select
                 .equ	SE	= 5	; Sleep Enable
                 .equ	SRW10	= 6	; External SRAM Wait State Select
                 .equ	SRE	= 7	; External SRAM Enable
                 
                 ; XMCRA - External Memory Control Register A
                 .equ	SRW11	= 1	; Wait state select bit upper page
                 .equ	SRW00	= 2	; Wait state select bit lower page
                 .equ	SRW01	= 3	; Wait state select bit lower page
                 .equ	SRL0	= 4	; Wait state page limit
                 .equ	SRL1	= 5	; Wait state page limit
                 .equ	SRL2	= 6	; Wait state page limit
                 
                 ; XMCRB - External Memory Control Register B
                 .equ	XMM0	= 0	; External Memory High Mask
                 .equ	XMM1	= 1	; External Memory High Mask
                 .equ	XMM2	= 2	; External Memory High Mask
                 .equ	XMBK	= 7	; External Memory Bus Keeper Enable
                 
                 ; OSCCAL - Oscillator Calibration Value
                 .equ	CAL0	= 0	; Oscillator Calibration Value
                 .equ	CAL1	= 1	; Oscillator Calibration Value
                 .equ	CAL2	= 2	; Oscillator Calibration Value
                 .equ	CAL3	= 3	; Oscillator Calibration Value
                 .equ	CAL4	= 4	; Oscillator Calibration Value
                 .equ	CAL5	= 5	; Oscillator Calibration Value
                 .equ	CAL6	= 6	; Oscillator Calibration Value
                 .equ	CAL7	= 7	; Oscillator Calibration Value
                 
                 ; XDIV - XTAL Divide Control Register
                 .equ	XDIV0	= 0	; XTAl Divide Select Bit 0
                 .equ	XDIV1	= 1	; XTAl Divide Select Bit 1
                 .equ	XDIV2	= 2	; XTAl Divide Select Bit 2
                 .equ	XDIV3	= 3	; XTAl Divide Select Bit 3
                 .equ	XDIV4	= 4	; XTAl Divide Select Bit 4
                 .equ	XDIV5	= 5	; XTAl Divide Select Bit 5
                 .equ	XDIV6	= 6	; XTAl Divide Select Bit 6
                 .equ	XDIVEN	= 7	; XTAL Divide Enable
                 
                 ; MCUCSR - MCU Control And Status Register
                 .equ	PORF	= 0	; Power-on reset flag
                 .equ	EXTRF	= 1	; External Reset Flag
                 .equ	BORF	= 2	; Brown-out Reset Flag
                 .equ	WDRF	= 3	; Watchdog Reset Flag
                 .equ	JTRF	= 4	; JTAG Reset Flag
                 .equ	JTD	= 7	; JTAG Interface Disable
                 
                 
                 ; ***** BOOT_LOAD ********************
                 ; SPMCSR - Store Program Memory Control Register
                 .equ	SPMCR	= SPMCSR	; For compatibility
                 .equ	SPMEN	= 0	; Store Program Memory Enable
                 .equ	PGERS	= 1	; Page Erase
                 .equ	PGWRT	= 2	; Page Write
                 .equ	BLBSET	= 3	; Boot Lock Bit Set
                 .equ	RWWSRE	= 4	; Read While Write section read enable
                 .equ	ASRE	= RWWSRE	; For compatibility
                 .equ	RWWSB	= 6	; Read While Write Section Busy
                 .equ	ASB	= RWWSB	; For compatibility
                 .equ	SPMIE	= 7	; SPM Interrupt Enable
                 
                 
                 ; ***** JTAG *************************
                 ; OCDR - On-Chip Debug Related Register in I/O Memory
                 .equ	OCDR0	= 0	; On-Chip Debug Register Bit 0
                 .equ	OCDR1	= 1	; On-Chip Debug Register Bit 1
                 .equ	OCDR2	= 2	; On-Chip Debug Register Bit 2
                 .equ	OCDR3	= 3	; On-Chip Debug Register Bit 3
                 .equ	OCDR4	= 4	; On-Chip Debug Register Bit 4
                 .equ	OCDR5	= 5	; On-Chip Debug Register Bit 5
                 .equ	OCDR6	= 6	; On-Chip Debug Register Bit 6
                 .equ	OCDR7	= 7	; On-Chip Debug Register Bit 7
                 .equ	IDRD	= OCDR7	; For compatibility
                 
                 ; MCUCSR - MCU Control And Status Register
                 ;.equ	JTRF	= 4	; JTAG Reset Flag
                 ;.equ	JTD	= 7	; JTAG Interface Disable
                 
                 
                 ; ***** MISC *************************
                 ; SFIOR - Special Function IO Register
                 .equ	PSR321	= 0	; Prescaler Reset Timer/Counter3, Timer/Counter2, and Timer/Counter1
                 .equ	PSR1	= PSR321	; For compatibility
                 .equ	PSR2	= PSR321	; For compatibility
                 .equ	PSR3	= PSR321	; For compatibility
                 .equ	PSR0	= 1	; Prescaler Reset Timer/Counter0
                 .equ	PUD	= 2	; Pull Up Disable
                 ;.equ	ACME	= 3	; Analog Comparator Multiplexer Enable
                 .equ	TSM	= 7	; Timer/Counter Synchronization Mode
                 
                 
                 ; ***** EXTERNAL_INTERRUPT ***********
                 ; EICRA - External Interrupt Control Register A
                 .equ	ISC00	= 0	; External Interrupt Sense Control Bit
                 .equ	ISC01	= 1	; External Interrupt Sense Control Bit
                 .equ	ISC10	= 2	; External Interrupt Sense Control Bit
                 .equ	ISC11	= 3	; External Interrupt Sense Control Bit
                 .equ	ISC20	= 4	; External Interrupt Sense Control Bit
                 .equ	ISC21	= 5	; External Interrupt Sense Control Bit
                 .equ	ISC30	= 6	; External Interrupt Sense Control Bit
                 .equ	ISC31	= 7	; External Interrupt Sense Control Bit
                 
                 ; EICRB - External Interrupt Control Register B
                 .equ	ISC40	= 0	; External Interrupt 7-4 Sense Control Bit
                 .equ	ISC41	= 1	; External Interrupt 7-4 Sense Control Bit
                 .equ	ISC50	= 2	; External Interrupt 7-4 Sense Control Bit
                 .equ	ISC51	= 3	; External Interrupt 7-4 Sense Control Bit
                 .equ	ISC60	= 4	; External Interrupt 7-4 Sense Control Bit
                 .equ	ISC61	= 5	; External Interrupt 7-4 Sense Control Bit
                 .equ	ISC70	= 6	; External Interrupt 7-4 Sense Control Bit
                 .equ	ISC71	= 7	; External Interrupt 7-4 Sense Control Bit
                 
                 ; EIMSK - External Interrupt Mask Register
                 .equ	GICR	= EIMSK	; For compatibility
                 .equ	GIMSK	= EIMSK	; For compatibility
                 .equ	INT0	= 0	; External Interrupt Request 0 Enable
                 .equ	INT1	= 1	; External Interrupt Request 1 Enable
                 .equ	INT2	= 2	; External Interrupt Request 2 Enable
                 .equ	INT3	= 3	; External Interrupt Request 3 Enable
                 .equ	INT4	= 4	; External Interrupt Request 4 Enable
                 .equ	INT5	= 5	; External Interrupt Request 5 Enable
                 .equ	INT6	= 6	; External Interrupt Request 6 Enable
                 .equ	INT7	= 7	; External Interrupt Request 7 Enable
                 
                 ; EIFR - External Interrupt Flag Register
                 .equ	GIFR	= EIFR	; For compatibility
                 .equ	INTF0	= 0	; External Interrupt Flag 0
                 .equ	INTF1	= 1	; External Interrupt Flag 1
                 .equ	INTF2	= 2	; External Interrupt Flag 2
                 .equ	INTF3	= 3	; External Interrupt Flag 3
                 .equ	INTF4	= 4	; External Interrupt Flag 4
                 .equ	INTF5	= 5	; External Interrupt Flag 5
                 .equ	INTF6	= 6	; External Interrupt Flag 6
                 .equ	INTF7	= 7	; External Interrupt Flag 7
                 
                 
                 ; ***** EEPROM ***********************
                 ; EEDR - EEPROM Data Register
                 .equ	EEDR0	= 0	; EEPROM Data Register bit 0
                 .equ	EEDR1	= 1	; EEPROM Data Register bit 1
                 .equ	EEDR2	= 2	; EEPROM Data Register bit 2
                 .equ	EEDR3	= 3	; EEPROM Data Register bit 3
                 .equ	EEDR4	= 4	; EEPROM Data Register bit 4
                 .equ	EEDR5	= 5	; EEPROM Data Register bit 5
                 .equ	EEDR6	= 6	; EEPROM Data Register bit 6
                 .equ	EEDR7	= 7	; EEPROM Data Register bit 7
                 
                 ; EECR - EEPROM Control Register
                 .equ	EERE	= 0	; EEPROM Read Enable
                 .equ	EEWE	= 1	; EEPROM Write Enable
                 .equ	EEMWE	= 2	; EEPROM Master Write Enable
                 .equ	EERIE	= 3	; EEPROM Ready Interrupt Enable
                 
                 
                 ; ***** PORTA ************************
                 ; PORTA - Port A Data Register
                 .equ	PORTA0	= 0	; Port A Data Register bit 0
                 .equ	PA0	= 0	; For compatibility
                 .equ	PORTA1	= 1	; Port A Data Register bit 1
                 .equ	PA1	= 1	; For compatibility
                 .equ	PORTA2	= 2	; Port A Data Register bit 2
                 .equ	PA2	= 2	; For compatibility
                 .equ	PORTA3	= 3	; Port A Data Register bit 3
                 .equ	PA3	= 3	; For compatibility
                 .equ	PORTA4	= 4	; Port A Data Register bit 4
                 .equ	PA4	= 4	; For compatibility
                 .equ	PORTA5	= 5	; Port A Data Register bit 5
                 .equ	PA5	= 5	; For compatibility
                 .equ	PORTA6	= 6	; Port A Data Register bit 6
                 .equ	PA6	= 6	; For compatibility
                 .equ	PORTA7	= 7	; Port A Data Register bit 7
                 .equ	PA7	= 7	; For compatibility
                 
                 ; DDRA - Port A Data Direction Register
                 .equ	DDA0	= 0	; Data Direction Register, Port A, bit 0
                 .equ	DDA1	= 1	; Data Direction Register, Port A, bit 1
                 .equ	DDA2	= 2	; Data Direction Register, Port A, bit 2
                 .equ	DDA3	= 3	; Data Direction Register, Port A, bit 3
                 .equ	DDA4	= 4	; Data Direction Register, Port A, bit 4
                 .equ	DDA5	= 5	; Data Direction Register, Port A, bit 5
                 .equ	DDA6	= 6	; Data Direction Register, Port A, bit 6
                 .equ	DDA7	= 7	; Data Direction Register, Port A, bit 7
                 
                 ; PINA - Port A Input Pins
                 .equ	PINA0	= 0	; Input Pins, Port A bit 0
                 .equ	PINA1	= 1	; Input Pins, Port A bit 1
                 .equ	PINA2	= 2	; Input Pins, Port A bit 2
                 .equ	PINA3	= 3	; Input Pins, Port A bit 3
                 .equ	PINA4	= 4	; Input Pins, Port A bit 4
                 .equ	PINA5	= 5	; Input Pins, Port A bit 5
                 .equ	PINA6	= 6	; Input Pins, Port A bit 6
                 .equ	PINA7	= 7	; Input Pins, Port A bit 7
                 
                 
                 ; ***** PORTB ************************
                 ; PORTB - Port B Data Register
                 .equ	PORTB0	= 0	; Port B Data Register bit 0
                 .equ	PB0	= 0	; For compatibility
                 .equ	PORTB1	= 1	; Port B Data Register bit 1
                 .equ	PB1	= 1	; For compatibility
                 .equ	PORTB2	= 2	; Port B Data Register bit 2
                 .equ	PB2	= 2	; For compatibility
                 .equ	PORTB3	= 3	; Port B Data Register bit 3
                 .equ	PB3	= 3	; For compatibility
                 .equ	PORTB4	= 4	; Port B Data Register bit 4
                 .equ	PB4	= 4	; For compatibility
                 .equ	PORTB5	= 5	; Port B Data Register bit 5
                 .equ	PB5	= 5	; For compatibility
                 .equ	PORTB6	= 6	; Port B Data Register bit 6
                 .equ	PB6	= 6	; For compatibility
                 .equ	PORTB7	= 7	; Port B Data Register bit 7
                 .equ	PB7	= 7	; For compatibility
                 
                 ; DDRB - Port B Data Direction Register
                 .equ	DDB0	= 0	; Port B Data Direction Register bit 0
                 .equ	DDB1	= 1	; Port B Data Direction Register bit 1
                 .equ	DDB2	= 2	; Port B Data Direction Register bit 2
                 .equ	DDB3	= 3	; Port B Data Direction Register bit 3
                 .equ	DDB4	= 4	; Port B Data Direction Register bit 4
                 .equ	DDB5	= 5	; Port B Data Direction Register bit 5
                 .equ	DDB6	= 6	; Port B Data Direction Register bit 6
                 .equ	DDB7	= 7	; Port B Data Direction Register bit 7
                 
                 ; PINB - Port B Input Pins
                 .equ	PINB0	= 0	; Port B Input Pins bit 0
                 .equ	PINB1	= 1	; Port B Input Pins bit 1
                 .equ	PINB2	= 2	; Port B Input Pins bit 2
                 .equ	PINB3	= 3	; Port B Input Pins bit 3
                 .equ	PINB4	= 4	; Port B Input Pins bit 4
                 .equ	PINB5	= 5	; Port B Input Pins bit 5
                 .equ	PINB6	= 6	; Port B Input Pins bit 6
                 .equ	PINB7	= 7	; Port B Input Pins bit 7
                 
                 
                 ; ***** PORTC ************************
                 ; PORTC - Port C Data Register
                 .equ	PORTC0	= 0	; Port C Data Register bit 0
                 .equ	PC0	= 0	; For compatibility
                 .equ	PORTC1	= 1	; Port C Data Register bit 1
                 .equ	PC1	= 1	; For compatibility
                 .equ	PORTC2	= 2	; Port C Data Register bit 2
                 .equ	PC2	= 2	; For compatibility
                 .equ	PORTC3	= 3	; Port C Data Register bit 3
                 .equ	PC3	= 3	; For compatibility
                 .equ	PORTC4	= 4	; Port C Data Register bit 4
                 .equ	PC4	= 4	; For compatibility
                 .equ	PORTC5	= 5	; Port C Data Register bit 5
                 .equ	PC5	= 5	; For compatibility
                 .equ	PORTC6	= 6	; Port C Data Register bit 6
                 .equ	PC6	= 6	; For compatibility
                 .equ	PORTC7	= 7	; Port C Data Register bit 7
                 .equ	PC7	= 7	; For compatibility
                 
                 ; DDRC - Port C Data Direction Register
                 .equ	DDC0	= 0	; Port C Data Direction Register bit 0
                 .equ	DDC1	= 1	; Port C Data Direction Register bit 1
                 .equ	DDC2	= 2	; Port C Data Direction Register bit 2
                 .equ	DDC3	= 3	; Port C Data Direction Register bit 3
                 .equ	DDC4	= 4	; Port C Data Direction Register bit 4
                 .equ	DDC5	= 5	; Port C Data Direction Register bit 5
                 .equ	DDC6	= 6	; Port C Data Direction Register bit 6
                 .equ	DDC7	= 7	; Port C Data Direction Register bit 7
                 
                 ; PINC - Port C Input Pins
                 .equ	PINC0	= 0	; Port C Input Pins bit 0
                 .equ	PINC1	= 1	; Port C Input Pins bit 1
                 .equ	PINC2	= 2	; Port C Input Pins bit 2
                 .equ	PINC3	= 3	; Port C Input Pins bit 3
                 .equ	PINC4	= 4	; Port C Input Pins bit 4
                 .equ	PINC5	= 5	; Port C Input Pins bit 5
                 .equ	PINC6	= 6	; Port C Input Pins bit 6
                 .equ	PINC7	= 7	; Port C Input Pins bit 7
                 
                 
                 ; ***** PORTD ************************
                 ; PORTD - Port D Data Register
                 .equ	PORTD0	= 0	; Port D Data Register bit 0
                 .equ	PD0	= 0	; For compatibility
                 .equ	PORTD1	= 1	; Port D Data Register bit 1
                 .equ	PD1	= 1	; For compatibility
                 .equ	PORTD2	= 2	; Port D Data Register bit 2
                 .equ	PD2	= 2	; For compatibility
                 .equ	PORTD3	= 3	; Port D Data Register bit 3
                 .equ	PD3	= 3	; For compatibility
                 .equ	PORTD4	= 4	; Port D Data Register bit 4
                 .equ	PD4	= 4	; For compatibility
                 .equ	PORTD5	= 5	; Port D Data Register bit 5
                 .equ	PD5	= 5	; For compatibility
                 .equ	PORTD6	= 6	; Port D Data Register bit 6
                 .equ	PD6	= 6	; For compatibility
                 .equ	PORTD7	= 7	; Port D Data Register bit 7
                 .equ	PD7	= 7	; For compatibility
                 
                 ; DDRD - Port D Data Direction Register
                 .equ	DDD0	= 0	; Port D Data Direction Register bit 0
                 .equ	DDD1	= 1	; Port D Data Direction Register bit 1
                 .equ	DDD2	= 2	; Port D Data Direction Register bit 2
                 .equ	DDD3	= 3	; Port D Data Direction Register bit 3
                 .equ	DDD4	= 4	; Port D Data Direction Register bit 4
                 .equ	DDD5	= 5	; Port D Data Direction Register bit 5
                 .equ	DDD6	= 6	; Port D Data Direction Register bit 6
                 .equ	DDD7	= 7	; Port D Data Direction Register bit 7
                 
                 ; PIND - Port D Input Pins
                 .equ	PIND0	= 0	; Port D Input Pins bit 0
                 .equ	PIND1	= 1	; Port D Input Pins bit 1
                 .equ	PIND2	= 2	; Port D Input Pins bit 2
                 .equ	PIND3	= 3	; Port D Input Pins bit 3
                 .equ	PIND4	= 4	; Port D Input Pins bit 4
                 .equ	PIND5	= 5	; Port D Input Pins bit 5
                 .equ	PIND6	= 6	; Port D Input Pins bit 6
                 .equ	PIND7	= 7	; Port D Input Pins bit 7
                 
                 
                 ; ***** PORTE ************************
                 ; PORTE - Data Register, Port E
                 .equ	PORTE0	= 0	; 
                 .equ	PE0	= 0	; For compatibility
                 .equ	PORTE1	= 1	; 
                 .equ	PE1	= 1	; For compatibility
                 .equ	PORTE2	= 2	; 
                 .equ	PE2	= 2	; For compatibility
                 .equ	PORTE3	= 3	; 
                 .equ	PE3	= 3	; For compatibility
                 .equ	PORTE4	= 4	; 
                 .equ	PE4	= 4	; For compatibility
                 .equ	PORTE5	= 5	; 
                 .equ	PE5	= 5	; For compatibility
                 .equ	PORTE6	= 6	; 
                 .equ	PE6	= 6	; For compatibility
                 .equ	PORTE7	= 7	; 
                 .equ	PE7	= 7	; For compatibility
                 
                 ; DDRE - Data Direction Register, Port E
                 .equ	DDE0	= 0	; 
                 .equ	DDE1	= 1	; 
                 .equ	DDE2	= 2	; 
                 .equ	DDE3	= 3	; 
                 .equ	DDE4	= 4	; 
                 .equ	DDE5	= 5	; 
                 .equ	DDE6	= 6	; 
                 .equ	DDE7	= 7	; 
                 
                 ; PINE - Input Pins, Port E
                 .equ	PINE0	= 0	; 
                 .equ	PINE1	= 1	; 
                 .equ	PINE2	= 2	; 
                 .equ	PINE3	= 3	; 
                 .equ	PINE4	= 4	; 
                 .equ	PINE5	= 5	; 
                 .equ	PINE6	= 6	; 
                 .equ	PINE7	= 7	; 
                 
                 
                 ; ***** PORTF ************************
                 ; PORTF - Data Register, Port F
                 .equ	PORTF0	= 0	; 
                 .equ	PF0	= 0	; For compatibility
                 .equ	PORTF1	= 1	; 
                 .equ	PF1	= 1	; For compatibility
                 .equ	PORTF2	= 2	; 
                 .equ	PF2	= 2	; For compatibility
                 .equ	PORTF3	= 3	; 
                 .equ	PF3	= 3	; For compatibility
                 .equ	PORTF4	= 4	; 
                 .equ	PF4	= 4	; For compatibility
                 .equ	PORTF5	= 5	; 
                 .equ	PF5	= 5	; For compatibility
                 .equ	PORTF6	= 6	; 
                 .equ	PF6	= 6	; For compatibility
                 .equ	PORTF7	= 7	; 
                 .equ	PF7	= 7	; For compatibility
                 
                 ; DDRF - Data Direction Register, Port F
                 .equ	DDF0	= 0	; 
                 .equ	DDF1	= 1	; 
                 .equ	DDF2	= 2	; 
                 .equ	DDF3	= 3	; 
                 .equ	DDF4	= 4	; 
                 .equ	DDF5	= 5	; 
                 .equ	DDF6	= 6	; 
                 .equ	DDF7	= 7	; 
                 
                 ; PINF - Input Pins, Port F
                 .equ	PINF0	= 0	; 
                 .equ	PINF1	= 1	; 
                 .equ	PINF2	= 2	; 
                 .equ	PINF3	= 3	; 
                 .equ	PINF4	= 4	; 
                 .equ	PINF5	= 5	; 
                 .equ	PINF6	= 6	; 
                 .equ	PINF7	= 7	; 
                 
                 
                 ; ***** PORTG ************************
                 ; PORTG - Data Register, Port G
                 .equ	PORTG0	= 0	; 
                 .equ	PG0	= 0	; For compatibility
                 .equ	PORTG1	= 1	; 
                 .equ	PG1	= 1	; For compatibility
                 .equ	PORTG2	= 2	; 
                 .equ	PG2	= 2	; For compatibility
                 .equ	PORTG3	= 3	; 
                 .equ	PG3	= 3	; For compatibility
                 .equ	PORTG4	= 4	; 
                 .equ	PG4	= 4	; For compatibility
                 
                 ; DDRG - Data Direction Register, Port G
                 .equ	DDG0	= 0	; 
                 .equ	DDG1	= 1	; 
                 .equ	DDG2	= 2	; 
                 .equ	DDG3	= 3	; 
                 .equ	DDG4	= 4	; 
                 
                 ; PING - Input Pins, Port G
                 .equ	PING0	= 0	; 
                 .equ	PING1	= 1	; 
                 .equ	PING2	= 2	; 
                 .equ	PING3	= 3	; 
                 .equ	PING4	= 4	; 
                 
                 
                 ; ***** TIMER_COUNTER_0 **************
                 ; TCCR0 - Timer/Counter Control Register
                 .equ	CS00	= 0	; Clock Select 0
                 .equ	CS01	= 1	; Clock Select 1
                 .equ	CS02	= 2	; Clock Select 2
                 .equ	WGM01	= 3	; Waveform Generation Mode 1
                 .equ	CTC0	= WGM01	; For compatibility
                 .equ	COM00	= 4	; Compare match Output Mode 0
                 .equ	COM01	= 5	; Compare Match Output Mode 1
                 .equ	WGM00	= 6	; Waveform Generation Mode 0
                 .equ	PWM0	= WGM00	; For compatibility
                 .equ	FOC0	= 7	; Force Output Compare
                 
                 ; TCNT0 - Timer/Counter Register
                 .equ	TCNT0_0	= 0	; 
                 .equ	TCNT0_1	= 1	; 
                 .equ	TCNT0_2	= 2	; 
                 .equ	TCNT0_3	= 3	; 
                 .equ	TCNT0_4	= 4	; 
                 .equ	TCNT0_5	= 5	; 
                 .equ	TCNT0_6	= 6	; 
                 .equ	TCNT0_7	= 7	; 
                 
                 ; OCR0 - Output Compare Register
                 .equ	OCR0_0	= 0	; 
                 .equ	OCR0_1	= 1	; 
                 .equ	OCR0_2	= 2	; 
                 .equ	OCR0_3	= 3	; 
                 .equ	OCR0_4	= 4	; 
                 .equ	OCR0_5	= 5	; 
                 .equ	OCR0_6	= 6	; 
                 .equ	OCR0_7	= 7	; 
                 
                 ; ASSR - Asynchronus Status Register
                 .equ	TCR0UB	= 0	; Timer/Counter Control Register 0 Update Busy
                 .equ	OCR0UB	= 1	; Output Compare register 0 Busy
                 .equ	TCN0UB	= 2	; Timer/Counter0 Update Busy
                 .equ	AS0	= 3	; Asynchronus Timer/Counter 0
                 
                 ; TIMSK - Timer/Counter Interrupt Mask Register
                 .equ	TOIE0	= 0	; Timer/Counter0 Overflow Interrupt Enable
                 .equ	OCIE0	= 1	; Timer/Counter0 Output Compare Match Interrupt register
                 
                 ; TIFR - Timer/Counter Interrupt Flag register
                 .equ	TOV0	= 0	; Timer/Counter0 Overflow Flag
                 .equ	OCF0	= 1	; Output Compare Flag 0
                 
                 ; SFIOR - Special Function IO Register
                 ;.equ	PSR0	= 1	; Prescaler Reset Timer/Counter0
                 ;.equ	TSM	= 7	; Timer/Counter Synchronization Mode
                 
                 
                 ; ***** TIMER_COUNTER_1 **************
                 ; TIMSK - Timer/Counter Interrupt Mask Register
                 .equ	TOIE1	= 2	; Timer/Counter1 Overflow Interrupt Enable
                 .equ	OCIE1B	= 3	; Timer/Counter1 Output CompareB Match Interrupt Enable
                 .equ	OCIE1A	= 4	; Timer/Counter1 Output CompareA Match Interrupt Enable
                 .equ	TICIE1	= 5	; Timer/Counter1 Input Capture Interrupt Enable
                 
                 ; ETIMSK - Extended Timer/Counter Interrupt Mask Register
                 .equ	OCIE1C	= 0	; Timer/Counter 1, Output Compare Match C Interrupt Enable
                 
                 ; TIFR - Timer/Counter Interrupt Flag register
                 .equ	TOV1	= 2	; Timer/Counter1 Overflow Flag
                 .equ	OCF1B	= 3	; Output Compare Flag 1B
                 .equ	OCF1A	= 4	; Output Compare Flag 1A
                 .equ	ICF1	= 5	; Input Capture Flag 1
                 
                 ; ETIFR - Extended Timer/Counter Interrupt Flag register
                 .equ	OCF1C	= 0	; Timer/Counter 1, Output Compare C Match Flag
                 
                 ; SFIOR - Special Function IO Register
                 ;.equ	PSR321	= 0	; Prescaler Reset, T/C3, T/C2, T/C1
                 ;.equ	TSM	= 7	; Timer/Counter Synchronization Mode
                 
                 ; TCCR1A - Timer/Counter1 Control Register A
                 .equ	WGM10	= 0	; Waveform Generation Mode Bit 0
                 .equ	PWM10	= WGM10	; For compatibility
                 .equ	WGM11	= 1	; Waveform Generation Mode Bit 1
                 .equ	PWM11	= WGM11	; For compatibility
                 .equ	COM1C0	= 2	; Compare Output Mode 1C, bit 0
                 .equ	COM1C1	= 3	; Compare Output Mode 1C, bit 1
                 .equ	COM1B0	= 4	; Compare Output Mode 1B, bit 0
                 .equ	COM1B1	= 5	; Compare Output Mode 1B, bit 1
                 .equ	COM1A0	= 6	; Compare Ouput Mode 1A, bit 0
                 .equ	COM1A1	= 7	; Compare Output Mode 1A, bit 1
                 
                 ; TCCR1B - Timer/Counter1 Control Register B
                 .equ	CS10	= 0	; Clock Select bit 0
                 .equ	CS11	= 1	; Clock Select 1 bit 1
                 .equ	CS12	= 2	; Clock Select1 bit 2
                 .equ	WGM12	= 3	; Waveform Generation Mode
                 .equ	CTC10	= WGM12	; For compatibility
                 .equ	WGM13	= 4	; Waveform Generation Mode
                 .equ	CTC11	= WGM13	; For compatibility
                 .equ	ICES1	= 6	; Input Capture 1 Edge Select
                 .equ	ICNC1	= 7	; Input Capture 1 Noise Canceler
                 
                 ; TCCR1C - Timer/Counter1 Control Register C
                 .equ	FOC1C	= 5	; Force Output Compare for channel C
                 .equ	FOC1B	= 6	; Force Output Compare for channel B
                 .equ	FOC1A	= 7	; Force Output Compare for channel A
                 
                 
                 ; ***** TIMER_COUNTER_2 **************
                 ; TCCR2 - Timer/Counter Control Register
                 .equ	CS20	= 0	; Clock Select
                 .equ	CS21	= 1	; Clock Select
                 .equ	CS22	= 2	; Clock Select
                 .equ	WGM21	= 3	; Waveform Generation Mode
                 .equ	CTC2	= WGM21	; For compatibility
                 .equ	COM20	= 4	; Compare Match Output Mode
                 .equ	COM21	= 5	; Compare Match Output Mode
                 .equ	WGM20	= 6	; Wafeform Generation Mode
                 .equ	PWM2	= WGM20	; For compatibility
                 .equ	FOC2	= 7	; Force Output Compare
                 
                 ; TCNT2 - Timer/Counter Register
                 .equ	TCNT2_0	= 0	; Timer/Counter Register Bit 0
                 .equ	TCNT2_1	= 1	; Timer/Counter Register Bit 1
                 .equ	TCNT2_2	= 2	; Timer/Counter Register Bit 2
                 .equ	TCNT2_3	= 3	; Timer/Counter Register Bit 3
                 .equ	TCNT2_4	= 4	; Timer/Counter Register Bit 4
                 .equ	TCNT2_5	= 5	; Timer/Counter Register Bit 5
                 .equ	TCNT2_6	= 6	; Timer/Counter Register Bit 6
                 .equ	TCNT2_7	= 7	; Timer/Counter Register Bit 7
                 
                 ; OCR2 - Output Compare Register
                 .equ	OCR2_0	= 0	; Output Compare Register Bit 0
                 .equ	OCR2_1	= 1	; Output Compare Register Bit 1
                 .equ	OCR2_2	= 2	; Output Compare Register Bit 2
                 .equ	OCR2_3	= 3	; Output Compare Register Bit 3
                 .equ	OCR2_4	= 4	; Output Compare Register Bit 4
                 .equ	OCR2_5	= 5	; Output Compare Register Bit 5
                 .equ	OCR2_6	= 6	; Output Compare Register Bit 6
                 .equ	OCR2_7	= 7	; Output Compare Register Bit 7
                 
                 ; TIMSK - 
                 .equ	TOIE2	= 6	; 
                 .equ	OCIE2	= 7	; 
                 
                 ; TIFR - Timer/Counter Interrupt Flag Register
                 .equ	TOV2	= 6	; Timer/Counter2 Overflow Flag
                 .equ	OCF2	= 7	; Output Compare Flag 2
                 
                 
                 ; ***** TIMER_COUNTER_3 **************
                 ; ETIMSK - Extended Timer/Counter Interrupt Mask Register
                 .equ	OCIE3C	= 1	; Timer/Counter3, Output Compare Match Interrupt Enable
                 .equ	TOIE3	= 2	; Timer/Counter3 Overflow Interrupt Enable
                 .equ	OCIE3B	= 3	; Timer/Counter3 Output CompareB Match Interrupt Enable
                 .equ	OCIE3A	= 4	; Timer/Counter3 Output CompareA Match Interrupt Enable
                 .equ	TICIE3	= 5	; Timer/Counter3 Input Capture Interrupt Enable
                 
                 ; ETIFR - Extended Timer/Counter Interrupt Flag register
                 .equ	OCF3C	= 1	; Timer/Counter3 Output Compare C Match Flag
                 .equ	TOV3	= 2	; Timer/Counter3 Overflow Flag
                 .equ	OCF3B	= 3	; Output Compare Flag 1B
                 .equ	OCF3A	= 4	; Output Compare Flag 1A
                 .equ	ICF3	= 5	; Input Capture Flag 1
                 
                 ; SFIOR - Special Function IO Register
                 ;.equ	PSR321	= 0	; Prescaler Reset, T/C3, T/C2, T/C1
                 ;.equ	PSR1	= PSR321	; For compatibility
                 ;.equ	PSR2	= PSR321	; For compatibility
                 ;.equ	TSM	= 7	; Timer/Counter Synchronization Mode
                 
                 ; TCCR3A - Timer/Counter3 Control Register A
                 .equ	WGM30	= 0	; Waveform Generation Mode Bit 0
                 .equ	PWM30	= WGM30	; For compatibility
                 .equ	WGM31	= 1	; Waveform Generation Mode Bit 1
                 .equ	PWM31	= WGM31	; For compatibility
                 .equ	COM3C0	= 2	; Compare Output Mode 3C, bit 0
                 .equ	COM3C1	= 3	; Compare Output Mode 3C, bit 1
                 .equ	COM3B0	= 4	; Compare Output Mode 3B, bit 0
                 .equ	COM3B1	= 5	; Compare Output Mode 3B, bit 1
                 .equ	COM3A0	= 6	; Comparet Ouput Mode 3A, bit 0
                 .equ	COM3A1	= 7	; Compare Output Mode 3A, bit 1
                 
                 ; TCCR3B - Timer/Counter3 Control Register B
                 .equ	CS30	= 0	; Clock Select 3 bit 0
                 .equ	CS31	= 1	; Clock Select 3 bit 1
                 .equ	CS32	= 2	; Clock Select3 bit 2
                 .equ	WGM32	= 3	; Waveform Generation Mode
                 .equ	CTC30	= WGM32	; For compatibility
                 .equ	WGM33	= 4	; Waveform Generation Mode
                 .equ	CTC31	= WGM33	; For compatibility
                 .equ	ICES3	= 6	; Input Capture 3 Edge Select
                 .equ	ICNC3	= 7	; Input Capture 3  Noise Canceler
                 
                 ; TCCR3C - Timer/Counter3 Control Register C
                 .equ	FOC3C	= 5	; Force Output Compare for channel C
                 .equ	FOC3B	= 6	; Force Output Compare for channel B
                 .equ	FOC3A	= 7	; Force Output Compare for channel A
                 
                 ; TCNT3L - Timer/Counter3 Low Byte
                 .equ	TCN3L0	= 0	; Timer/Counter 3 bit 0
                 .equ	TCN3L1	= 1	; Timer/Counter 3 bit 1
                 .equ	TCN3L2	= 2	; Timer/Counter 3 bit 2
                 .equ	TCN3L3	= 3	; Timer/Counter 3 bit 3
                 .equ	TCN3L4	= 4	; Timer/Counter 3 bit 4
                 .equ	TCN3L5	= 5	; Timer/Counter 3 bit 5
                 .equ	TCN3L6	= 6	; Timer/Counter 3 bit 6
                 .equ	TCN3L7	= 7	; Timer/Counter 3 bit 7
                 
                 
                 ; ***** WATCHDOG *********************
                 ; WDTCR - Watchdog Timer Control Register
                 .equ	WDTCSR	= WDTCR	; For compatibility
                 .equ	WDP0	= 0	; Watch Dog Timer Prescaler bit 0
                 .equ	WDP1	= 1	; Watch Dog Timer Prescaler bit 1
                 .equ	WDP2	= 2	; Watch Dog Timer Prescaler bit 2
                 .equ	WDE	= 3	; Watch Dog Enable
                 .equ	WDCE	= 4	; Watchdog Change Enable
                 .equ	WDTOE	= WDCE	; For compatibility
                 
                 
                 
                 ; ***** LOCKSBITS ********************************************************
                 .equ	LB1	= 0	; Lock bit
                 .equ	LB2	= 1	; Lock bit
                 .equ	BLB01	= 2	; Boot Lock bit
                 .equ	BLB02	= 3	; Boot Lock bit
                 .equ	BLB11	= 4	; Boot lock bit
                 .equ	BLB12	= 5	; Boot lock bit
                 
                 
                 ; ***** FUSES ************************************************************
                 ; LOW fuse bits
                 .equ	CKSEL0	= 0	; Select Clock Source
                 .equ	CKSEL1	= 1	; Select Clock Source
                 .equ	CKSEL2	= 2	; Select Clock Source
                 .equ	CKSEL3	= 3	; Select Clock Source
                 .equ	SUT0	= 4	; Select start-up time
                 .equ	SUT1	= 5	; Select start-up time
                 .equ	BODEN	= 6	; Brown out detector enable
                 .equ	BODLEVEL	= 7	; Brown out detector trigger level
                 
                 ; HIGH fuse bits
                 .equ	BOOTRST	= 0	; Select Reset Vector
                 .equ	BOOTSZ0	= 1	; Select Boot Size
                 .equ	BOOTSZ1	= 2	; Select Boot Size
                 .equ	EESAVE	= 3	; EEPROM memory is preserved through chip erase
                 .equ	CKOPT	= 4	; Oscillator Options
                 .equ	SPIEN	= 5	; Enable Serial programming and Data Downloading
                 .equ	JTAGEN	= 6	; Enable JTAG
                 .equ	OCDEN	= 7	; Enable OCD
                 
                 ; EXTENDED fuse bits
                 .equ	WDTON	= 0	; Watchdog timer always on
                 .equ	CompMode	= 1	; Compabillity mode
                 
                 
                 
                 ; ***** CPU REGISTER DEFINITIONS *****************************************
                 .def	XH	= r27
                 .def	XL	= r26
                 .def	YH	= r29
                 .def	YL	= r28
                 .def	ZH	= r31
                 .def	ZL	= r30
                 
                 
                 
                 ; ***** DATA MEMORY DECLARATIONS *****************************************
                 .equ	FLASHEND	= 0x7fff	; Note: Word address
                 .equ	IOEND	= 0x00ff
                 .equ	SRAM_START	= 0x0100
                 .equ	SRAM_SIZE	= 4096
                 .equ	RAMEND	= 0x10ff
                 .equ	XRAMEND	= 0xffff
                 .equ	E2END	= 0x07ff
                 .equ	EEPROMEND	= 0x07ff
                 .equ	EEADRBITS	= 11
                 #pragma AVRPART MEMORY PROG_FLASH 65536
                 #pragma AVRPART MEMORY EEPROM 2048
                 #pragma AVRPART MEMORY INT_SRAM SIZE 4096
                 #pragma AVRPART MEMORY INT_SRAM START_ADDR 0x100
                 
                 
                 
                 ; ***** BOOTLOADER DECLARATIONS ******************************************
                 .equ	NRWW_START_ADDR	= 0x7000
                 .equ	NRWW_STOP_ADDR	= 0x7fff
                 .equ	RWW_START_ADDR	= 0x0
                 .equ	RWW_STOP_ADDR	= 0x6fff
                 .equ	PAGESIZE	= 128
                 .equ	FIRSTBOOTSTART	= 0x7e00
                 .equ	SECONDBOOTSTART	= 0x7c00
                 .equ	THIRDBOOTSTART	= 0x7800
                 .equ	FOURTHBOOTSTART	= 0x7000
                 .equ	SMALLBOOTSTART	= FIRSTBOOTSTART
                 .equ	LARGEBOOTSTART	= FOURTHBOOTSTART
                 
                 
                 
                 ; ***** INTERRUPT VECTORS ************************************************
                 .equ	INT0addr	= 0x0002	; External Interrupt Request 0
                 .equ	INT1addr	= 0x0004	; External Interrupt Request 1
                 .equ	INT2addr	= 0x0006	; External Interrupt Request 2
                 .equ	INT3addr	= 0x0008	; External Interrupt Request 3
                 .equ	INT4addr	= 0x000a	; External Interrupt Request 4
                 .equ	INT5addr	= 0x000c	; External Interrupt Request 5
                 .equ	INT6addr	= 0x000e	; External Interrupt Request 6
                 .equ	INT7addr	= 0x0010	; External Interrupt Request 7
                 .equ	OC2addr	= 0x0012	; Timer/Counter2 Compare Match
                 .equ	OVF2addr	= 0x0014	; Timer/Counter2 Overflow
                 .equ	ICP1addr	= 0x0016	; Timer/Counter1 Capture Event
                 .equ	OC1Aaddr	= 0x0018	; Timer/Counter1 Compare Match A
                 .equ	OC1Baddr	= 0x001a	; Timer/Counter Compare Match B
                 .equ	OVF1addr	= 0x001c	; Timer/Counter1 Overflow
                 .equ	OC0addr	= 0x001e	; Timer/Counter0 Compare Match
                 .equ	OVF0addr	= 0x0020	; Timer/Counter0 Overflow
                 .equ	SPIaddr	= 0x0022	; SPI Serial Transfer Complete
                 .equ	URXC0addr	= 0x0024	; USART0, Rx Complete
                 .equ	UDRE0addr	= 0x0026	; USART0 Data Register Empty
                 .equ	UTXC0addr	= 0x0028	; USART0, Tx Complete
                 .equ	ADCCaddr	= 0x002a	; ADC Conversion Complete
                 .equ	ERDYaddr	= 0x002c	; EEPROM Ready
                 .equ	ACIaddr	= 0x002e	; Analog Comparator
                 .equ	OC1Caddr	= 0x0030	; Timer/Counter1 Compare Match C
                 .equ	ICP3addr	= 0x0032	; Timer/Counter3 Capture Event
                 .equ	OC3Aaddr	= 0x0034	; Timer/Counter3 Compare Match A
                 .equ	OC3Baddr	= 0x0036	; Timer/Counter3 Compare Match B
                 .equ	OC3Caddr	= 0x0038	; Timer/Counter3 Compare Match C
                 .equ	OVF3addr	= 0x003a	; Timer/Counter3 Overflow
                 .equ	URXC1addr	= 0x003c	; USART1, Rx Complete
                 .equ	UDRE1addr	= 0x003e	; USART1, Data Register Empty
                 .equ	UTXC1addr	= 0x0040	; USART1, Tx Complete
                 .equ	TWIaddr	= 0x0042	; 2-wire Serial Interface
                 .equ	SPMRaddr	= 0x0044	; Store Program Memory Read
                 
                 .equ	INT_VECTORS_SIZE	= 70	; size in words
                 
                 #endif  /* _M64DEF_INC_ */
                 
                 ; ***** END OF FILE ******************************************************
                 .INCLUDE "PARAMETROS.ASM"		; VALORES ESPECIFICOS
                 
                 ;		ESTOS SON LOS VALORES PREFIJADOS "PARAMETROS"
                 .def  temp_tec = r7
                 .def  val_led = r15		;posicion en RAM del valor de los led de pantalla
                 .equ  lcd_rw =$007		;bit de lectura escritura de la pantalla lcd
                 .equ  lcd_rs =$005		;bit para enviar datos o instruciones
                 .equ  led_pant =$004	;al subir graba los valores de los led
                 .equ  lcd_e =$006		;bit para validar los datos al descender
                 
                 ; POSICION DE LOS LED  Y CONTROL DEL TECLADO EN val_led (r15)
                 .equ  vel_tec = 120		; RETARDO EN LA VELOCIDAD DE SUBIDA O BAJADA EN PROGRAMACION DE PARAMETROS
                 .equ  PH =  007
                 .equ  CL =  006
                 .equ  ON =  005
                 ;.equ  POLARIDAD = 4
                 .equ  MAX=  004
                 .equ  MIN=  003
                 .equ  TEC=  003			; activar teclado teclado activo con valor cero
                 .equ  LUZ=  002			; luz pantalla
                 .equ  SCL=  000			; linea de reloj para i2c
                 .equ  SDA=  001			; linea de datos para i2c
                 .def  rec_datos = r19	; recibir datos de la linea i2c
                 .equ  start= 6
                 .equ  oe   = 7
                 .equ  clk  = 6
                 .equ  eoc  = 2
                 .equ  EOL = 0x5E
                 .equ  RELOAD = 0x5F
                 ; PARAMETROS
                 
                 ;.equ  cen_seg = $190
                 .def  lec_rel= r23			; los segundos en la interrupcion solo se usa en el programa principal
                 .equ  ph_max = 80
                 .equ  ph_min = 65
                 .equ  cl_max = 20
                 .equ  cl_min = 06
                 .equ  pro_max = 100			; 100%
                 .equ  pro_min = 05			; 5%
                 .equ  rd_max = 195			; 180 X 5 = 900
                 .equ  rd_min = 060			; 060 X 5 = 300
                 .equ  retardo_panel = 1		; para el control DEL PANEL RETARDO
                 
                 ; POSICION EN EEPRON DE LOS VALORES PROGRAMADOS
                 .equ  ph_men = $000			; posicion del ph programado en eepron
                 .equ  pro_men = $001		; posicion del tanto por ciento programado en eepron
                 .equ  cl_men = $002			; posicion del cloro de la piscina programado en eepron
                 .equ  rd_men = $003			; posicion del redox programado en eepron
                 .equ  clc_men = $004		; posicion para el calibrado del cloro libre
                 .equ  phc_men = $005		; posicion para el calibrado del Ph
                 .equ  sac_men = $006		; posicion para el calibrado de la sal
                 .equ  rdc_men = $007		; posicion para el calibrado del redox
                 .equ  pol_men = $010		; munero de veces que se ha encendido para la polaridad
                 .equ  ver_inv = $011		; verano-invierno se usa para la medicion de sal
                 .equ  sonda_caudal = $013	; con sonda de caudal
                 .equ  texto_presentacion = $012	; leer en la eepron  POTENCIA $012 y TYPO EN $012 + 1 DISTRIBUIDOR $012 + 2
                 
                 ; POTENCIA 		00 50					01 80			02 120	 	 03 180		04 220
                 ; TYP0			00 L					01 LS			02 LMG		 03 Q 		04 QS 		05 QMG
                 ; DISTRIBUIDOR	00 SALICLOR SERIE L		01 TEAP S.L. 	02 Aipool	 03 "            "
                 .equ  ph_sb = $022			; subir a bajar el Ph
                 .equ  pa_pm = $023			; producion manual o automatica anula la medicion de redox y cloro si es uno
                 .equ  re_pro = $024			; valor de reducion de la producion con cubiera
                 .equ  ciclos_minuto =$028	; NUMERO DE CICLOS PARA LA INVERSION MAX 4
                 .equ  ee_ciclos = $030		; VECES QUE SE ENCIENDE EN 1 CICLO 2-3-4,POSICION 31-32-33-34
                 .equ  n_min20 		= $048	; 6 min igual a 1 hora
                 .equ  n_horas 		= $049	; NUMERO DE HORAS FUNCIONANDO
                 .equ  n_horas_1 	= $04A	; NUMERO DE HORAS X 256
                 .equ  n_borrado		= $04B	; veces que se borran las horas
                 .equ  n_horasc		= $04C	; copia de seguridad de horas no se borran
                 .equ  n_horasc_1	= $04D
                 .equ  reg_rejilla 	= $050	; para la grabacion del desgaste de la rejilla VALOR SUPERIOR +8
                 .equ  apoyo_rd_cl 	= $060	; VALOR PARA ACTIVAR LA BOMBA DOSIFICADORA DE APOYO CLORO Y REDOX
                 .equ  retardo_inicio= $099	; RETARDO AL INICIO 20 O 240 SEGUNDOS
                 .equ  des_elect 	= $09B 
                 .equ  sensor_flujo	= $09D  ; SENSOR DE FLUJO ACTIVO A 0 A 1 VALOR INICIAL
                 .equ  polaridad_0	= $09E	; MEDICION DE SAL EN POLARIDAD 0
                 .equ  polaridad_1	= $09F	; MEDICION DE SAL EN POLARIDAD 1
                 .equ  mejor_polaridad =$0A0 ; POLORIDAD MAS EFICAD CERO O UNO "0 - 1"
                 .equ  inc_polaridad = 10		; DIFERENCIA ENTRE AMBAS POLARIDADES
                 ; EN 9C ESCRIBE EL PORCENTAJE DE DESGASTE
                 
                 ;.equ r_seg = $090
                 ;.equ r_min = $091
                 ;.equ r_hor = $092
                 ;.equ r_dia = $093
                 ;.equ r_mes = $094
                 ;.equ r_ano = $095
                 ;.equ r_otro	= $096
                 
                 ; ZONA PARA ALMACENAR LOS VALORES MEDIDOS DE PH,RD, CL EN MEMORIA RAN DEL MICRO
                 .equ  ram_ph 		= $200	; VALOR LEIDO PERO AMORTIGUADO " QUITADA LA OSCILACION"
                 .equ  ramp_ph 		= $201	; VALOR PROGRAMADO DEL PH
                 .equ  ramc_ph 		= $202	; VALOR PARA EL AJUSTE POR TECLADO DEL PH
                 .equ  ph_real 		= $203	; VALOR PUNTUAL REAL
                 .equ  ram_pro 		= $204	; VALOR LEIDO
                 .equ  ramp_pro 		= $205	; VALOR PROGRAMADO
                 .equ  ram_cl 		= $206	; valor leido cloro
                 .equ  ramp_cl 		= $207	; valor programado cloro
                 .equ  ramc_cl 		= $208	; VALOR PARA AL AJUSTE DE LA SONDA ECL6 POR TECLADO
                 .equ  redox_real	= $223	; ALMACENA EL REDOX REAL PARA TACTIL
                 .equ  ram_rd 		= $209	; VALOR DEL REDOX REAL
                 .equ  ramp_rd 		= $20A	; VALOR DEL REDOX PROGRAMADO
                 .equ  ramc_rd 		= $20B	; VALOR PARA EL AJUSTE DEL REDOX
                 .equ  ram_sal 		= $20C	; VALOR INICIAL DE CONCENTRACION DE SAL
                 .equ  ramc_sal 		= $20D	; VALOR PARA EL AJUSTE DE LA CONCENRACION DE SAL
                 .equ  ram_pol 		= $20E	; VALOR EN RAM LA POLARIDAD GUARDADO EN RAM
                 .equ  ram_temp 		= $20F	; VALOR EN RAM DE LA TEMPERATURA
                 .equ  ram_sal_c 	= $210
                 .equ  ram_sal_corte = $211
                 .equ  ram_pro_pro 	= $212	; % reducion de la producion con cubierta
                 .equ  ram_pro_pro_m = $213	; PORCENTAJE CON CUBIERTA
                 .equ  ram_ciclos	= $214
                 .equ  ram_caudal 	= $215	; SEGUNDOS RETRASO CAUDAL PARA CORTAR POR FALTA DE FLUJO
                 .equ  ram_rd_cl		= $216	; POSICION EN RAN DEFERENCIA PARA ACTIVAR LA DOSIFICACION DE APOYO CL_RD
                 .equ  ram_amperios 	= $217	; AMPERIOS DEL SHUNT
                 .equ  pro_remoto_1 	= $218	; PRODUCCION EN GRAMOS HORA 
                 .equ  pro_remoto_2 	= $219	; PRODUCCION EN GRAMOS HORA 
                 .equ  pro_remoto_3 	= $21A	; PRODUCCION EN GRAMOS HORA 
                 .equ  pro_remoto_4 	= $21B	; PRODUCCION EN GRAMOS HORA 
                 .equ  prod_total	= $21C
                 .equ  i2c_control	= $21D	; registro de datos para el pcf 8574
                 .equ  ram_med_ini_sal = $21E; VALOR INICIAL DE SAL POR ERROR DEL TLC27
                 .equ  nciclos		= $21F	; NUMERO DE CICLOS PARA LA INVERSION DE POLARIDAD
                 .equ  sal_electrodo = $220	; VALOR MAXIMO SEGUN POLARIDAD
                 .equ  hora = $400			; posicion en ram
                 .equ  minu = $401
                 .equ  seg  = $402
                 .equ  analogico = $420
                 
                 .equ  panel_OE =  7			; PARA EL PANEL EXTERNO ACTIVO O INACTIVO
                 .equ  panel_data= 5			; PARA EL PANEL EXTERNO BIT DEL DATO
                 .equ  panel_clk = 6			; PARA EL PANEL EXTERNO RELOJ GRABA EL DATO
                 .def  control = r20			; REGISTRO DE CONTROL VER OPCIONES EN ATMEGA16.ASM PRIMERAS LINEAS " NO UTILIZAR EN RUTINAS "
                 .def  control_1 = r11		; SEGUNDO REGISTRO DE CONTROL " NO UTILIZAR EN RUTINAS "
                 .equ  max_sal = 190
                 .equ  min_sal = 00
                 			.equ  t_ciclo = 36					; SEGUNDOS POR CICLO 33 CON CRISTAL DE CUARZO ***********************************************
                 .equ  lim_sal = 10			; PARA DAR INFORMACION AÑADIR SAL
                 .equ  lim_sal2 = 1			; limite de amperios en control remoto
                 .equ  ri2c = 5				; SALIDA PROTOCOLO I2C
                 .equ  b_acido = 5			; salida para el control de la bomba de acido
                 
                 ;.equ  s2_rd_cl	= 5			; salida para el apoyo de redox y cloro 
                 
                 .equ  eeprom = 0b10100000
                 .equ w = 0					; opcion escribir PARA PCF8591
                 .equ r = 1					; opcion leer PARA PCF8591
                 .equ pcf8591 = 0B10010000	; modulos de PH RD CL Y SAL DIRECION DE CONTROL
                 .equ retardo_programacion = 15
                 .equ retardo1 = 10			; es el retardo para cambio de opcion en programacion
                 .equ retardo2 = 26			; retardo digito encendido RETARDO2- RETARDO3
                 .equ retardo3 = 12			; retardo digito apagado
                 .equ E_fuente = 3
                 .equ t_radio_ini = 40
                 .equ t_radio_e = 8
                 .equ data_t = 7				; linea salida de datos por radio
                 
                 .equ lec_eeprom = $350
                 .equ m_prueba = $200
                 ; linea de entrada para medidas analogicas del atmega64
                 .equ p_sal = 6
                 .equ p_cl = 1
                 .equ p_rd = 2
                 .equ p_ph = 3
                 .equ p_vsal = 4
                 .equ p_vfuente = 5
                 .equ p_tcl = 6
                 .equ p_temp = 7
                 
                 
                 
                 
                 
                 
                 ;.INCLUDE "I2CP.ASM"    			; esta opcion es con i2c programado
                 .INCLUDE "ADC.ASM"
                 
                 
                 ; EN R24 EL RESULTADO EN R26 EL NUMERO DE MEDICIONES
                 ; PROGRAMA LECTOR CONVERTIDOR ANALOGICO DIGITAL
                 ; EN R18 EL CANAL A LEER
                 ; EN ADCH LOS 8 BIT MAS SIGNIFICAATIVOS
                 ; EN ADCL BIT 6 Y 7 LOS DOS MENOS SIGNIFICATIVOS
                 
                 ; REGISTRO ADMUX
                 ;  REFS1 REFS0 ADLAR MUX4 MUX3 MUX2 MUX1 MUX0
                 ;     7     6     5    4    3    2    1    0
                 ;REFS1 REFS0 Voltage Reference Selection
                 ;	0 		0 AREF, Internal Vref turned off
                 ;	0 		1 AVCC with external capacitor at AREF pin
                 ;	1	 	0 Reserved
                 ;	1 		1 Internal 2.56V Voltage Reference with external capacitor at AREF pin
                 ; ADLAR configura la forma de almacenar el resultado en ADCH Y ADCL
                 ; MUXx  SELECIONA LA ENTRADA Y AMPLIFICACION DE LA MISMA VER PAG 218
                 
                 ; REGISTRO ADCSRA
                 ;  ADEN ADSC ADATE ADIF ADIE ADPS2 ADPS1 ADPS0
                 ;    7    6     5    4    3     2     1     0
                 ; ADEN 	A UNO ACTIVA LA CONVERSION ADC
                 ; ADSC 	EMPIZA LA CONVERSION AL TERMINAR SE PONE A CERO
                 ; ADATE	AUTO TRIGER ESTA ACTIVO AL PONER UN UNO
                 ; ADIF	SE ACTIVA LA INTERRUPCION AL PONER UN UNO
                 ; ADIE	ACTIVA LA INTERRUPCION CUANDO TERMINA SI ESTE BIT ESTA A UNO
                 ; ADPS	DETERMINA EL FACTOR DE DIVISION ENTRE LA FRECUENCIA DEL MICRO Y LA DE LA DIVISION ADC
                 ;Table 85. ADC Prescaler Selections
                 ;ADPS2   ADPS1  ADPS0 Division Factor
                 ;	0 		 0 		0 	2
                 ;	0 		 0		1 	2
                 ;	0 		 1 		0 	4
                 ;	0 		 1 		1 	8
                 ;	1 		 0 		0 	16
                 ;	1 		 0 		1 	32
                 ;	1 		 1 		0 	64
                 ;	1		 1 		1 	128
                 
                 
                 ;PCF_B:
                 
                 ;PCF_C:
                 
                 
                 ADC_P:	;PONE EL PUERTO A COMO ENTRADA DE DATOS A CERO
                 
                 
00013c 2788      	CLR				R24
00013d 2411      	CLR				R1 
                 
                 
                 ; CONFIGURAR TENSION DE REFERENCIA A VDD, FORMA DE ALMACENAMIENTO CON EL REGISTRO ADLAR A 1 Y CANAL A LEER
                 ;	LD1				R16, (0<<REFS1)|(1<<REFS0)|(0<<ADLAR) LEER LINEA ADC0 ES LA PATA 40
00013e ee00      	LDI				R16,0B11100000		; SEÑAL INTERNA DE REFERENCIA A  VDC BIT 7Y6 
                 										; BIT DE ADLAR A 1 
00013f 0f02      	ADD				R16,R18				; EN R18 EL CANAL A LEER Y GANANCIA VER PAG 245
000140 b907      	OUT				ADMUX,R16
                 
                 ADC_P1:
000141 ed07      	LDI				R16,0B11010111		; PREESCALA A 128 "8.000.000/128=62.500Hz
                 ;	LDI				R16,0XCB
000142 b906      	OUT				ADCSRA,R16
                 
                 ADC_P2:
000143 ef9a      	LDI				R25,250				; RETARDO PARA LA VISUALIZACION
000144 d7e5      	RCALL			RETARDO
000145 ef9a      	LDI				R25,250				; RETARDO PARA LA VISUALIZACION
000146 d7e3      	RCALL			RETARDO
000147 b106      	IN				R16,ADCSRA
000148 0000      	NOP
000149 fb06      	BST				R16,6				; CARGA EN EL REGISTRO T DE SREG EL 6 ACSRA
00014a f3c6      	BRTS			ADC_P2				; SALTA A ADC_P1 SI EL REGISTRO ES UNO SE PONE A CERO AL TERMINAR 
00014b 95aa      	DEC				R26					; R26 CONTIENE EL NUMERO DE LECTURAS
00014c f029      	BREQ			ADC_P3_A			; SI R26 LLEGA A CERO TERMINA
00014d b115      	IN	 			R17,ADCH
00014e 1e11      	ADC				R1,R17				; SUMA EL RESULTADO A R1
00014f f788      	BRCC			ADC_P1				; SI NO HAY DESBORDAMIENTO SALTA A ADC_P1
000150 9583      	INC				R24
000151 cfef      	RJMP			ADC_P1
                 ADC_P3_A:
000152 9508      RET
                 ADC_P3:	; RESTAURA LOS VALORES DEL PUERTO A ALMACENA EN MEMORIA Y CONFIGURA LA LINEA DE PRESENTACION
000153 9380 020f 	STS				RAM_TEMP,R24		; ALMACENA LA MEDICION EN LA MEMORIA RAM
000155 e300      	LDI				R16,48				; PONE UN 0
000156 9300 030f 	STS				0x30F,R16
000158 9586      	LSR				R24					; SI ES PAR
000159 f418      	BRCC			ADC_P4				; SALTA SI EL ACARREO ES UNO QUEDA EL CINCO
00015a e305      	LDI				R16,53				; PONE UN CINCO EN LUGAR DEL 0
00015b 9300 030f 	STS				0x30F,R16
                 ADC_P4:
00015d d432      	RCALL			RADC
00015e 9220 030c 	STS				0x30C,R2
000160 9230 030d 	STS				0X30D,R3
                 ; PARA SUSTITUIR EL VALOR MAXIMO 40 GRADOS POR --.-
000162 9120 020f 	LDS				R18,RAM_TEMP
000164 e590      	LDI				R25,80
000165 d46c      	RCALL			COMP
000166 ff40      	SBRS			CONTROL,0			; VERIFICA SI ES UNO EL BIT 0 SI ES CIERTO SALTA LA SIG. INSTRUCION
000167 c007      	RJMP			ADC_P5				; POR SI NO HAY SONDA PT1000  O LA TEMP. ES MAYOR DE 25ºC
000168 e22d      	LDI				R18,45				; PONE UN - EN LUGAR DE LOS NUMEROS
000169 9320 030c 	STS				0x30C,R18
00016b 9320 030d 	STS				0x30D,R18
00016d 9320 030f 	STS				0x30F,R18
                 ADC_P5:
00016f 9508      	RET
000170 e000      	LDI				R16,00
000171 b907      	OUT				ADMUX,R16
000172 b906      	OUT				ADCSRA,R16
000173 9508      	RET
                 
                 .INCLUDE "ini_pan.asm"
                 
                 
                 INI_PANTALLA:
000174 e684      	LDI   R24, 100
                 TEM1:						; NECESITA 15mS DE RETRASO DESPUES DE CONECTAR
000175 ef9a      	LDI   R25, 250			; CICLO DE 250 us A 4Mhz x 100 = 0,025 seg
000176 d7b3      	RCALL RETARDO
000177 958a      	DEC   R24
000178 f7e1      	BRNE  TEM1
000179 e300      	LDI   R16, 48			; 00110000 se debe enviar tres veces (1)
00017a d03b      	RCALL ENVINTR
00017b e187      	LDI   R24, 23			; retardo de 4,1 ms ( 23x250=5.750 ms )
                 TEM2:	
00017c ef9a      	LDI   R25, 250
00017d d7ac      	RCALL RETARDO
00017e 958a      	DEC   R24
00017f f7e1      	BRNE  TEM2
000180 e300      	LDI   R16, 48			; 00110000 se debe enviar tres veces (1)
000181 d034      	RCALL ENVINTR
000182 e798      	LDI   R25, 120			; retardo 100us
000183 d7a6      	RCALL RETARDO
000184 e300      	LDI   R16, 48			; 00110000 se debe enviar tres veces (1)
000185 d030      	RCALL ENVINTR
000186 e798      	LDI   R25, 120
000187 d7a2      	RCALL RETARDO
000188 e308      	LDI   R16,56			; 00111000 8 BITS 2LINEAS, DIGITO DE 5X7
000189 d02c      	RCALL ENVINTR	
00018a ef9a      	LDI   R25, 250
00018b d79e      	RCALL RETARDO
00018c e00c      	LDI   R16, 0b00001100	; ENCIENDE LA PANTALLA 1CDB
00018d d028      	RCALL ENVINTR			; C CURSOR ON/OFF
00018e ef9a      	LDI   R25, 250			; D PONE UNA MARCA DONDE ESTA EL CURSOR
00018f d79a      	RCALL RETARDO			; B intermitente
000190 e006      	LDI   R16, 06			; MODO SET ,TRABAJO
000191 d024      	RCALL ENVINTR
000192 d038      	RCALL CGRAM
000193 9508      	RET
                 INI_PANTALLA1:
000194 940e 0125 	CALL			PAR_MOD_DIS
000196 940e 00d4 	CALL			AJUSTE_PRESENTACION_4
000198 e200      	LDI				R16,32				; PONE UN ESPACIO
000199 9300 07de 	STS				$7DE,R16
00019b 9300 07df 	STS				$7DF,R16
00019d 9300 07f0 	STS				$7F0,R16
00019f 9300 07f1 	STS				$7F1,R16
0001a1 9300 07f2 	STS				$7F2,R16
0001a3 9300 07f3 	STS				$7F3,R16
0001a5 9300 0804 	STS				$804,R16
0001a7 9300 0805 	STS				$805,R16
0001a9 ec00      	LDI   R16, 192			; escribir en linea uno 128 linea 2 192
0001aa d00b      	RCALL ENVINTR
0001ab e0d7      	LDI   YH, HIGH (LIN1P)
0001ac edce      	LDI   YL, LOW  (LIN1P)-2
0001ad e114      	LDI   R17,20
0001ae d776      	RCALL ENVIARTEXTO
0001af e904      	LDI   R16, 148			; 11000000 escribir en linea 2 linea (192) en linea 3
0001b0 d005      	RCALL ENVINTR
0001b1 e0d7      	LDI   YH, HIGH (LIN2P)	; POSICION ALTA DEL TAXTO EN RAM
0001b2 efc2      	LDI   YL, LOW  (LIN2P)-2	; direccion BAJA DEL TEXTO EN RAM      		
0001b3 e114      	LDI   R17,20			; numero de digitos a enviar
0001b4 d770      	RCALL ENVIARTEXTO	
0001b5 9518      	RETI
                 
                 ;       20x4        16x4   tipo de display
                 ; linea 1-128 		128 
                 ; linea 2-192		192
                 ; linea 3-148		144
                 ; linea 4-212		208
                 
                 ENVINTR:
0001b6 98ad      	CBI   PORTC, lcd_rs		; en instruccion a 0
0001b7 e392      	LDI   R25,50			; retardo necesario aprox 42us
0001b8 d771      	RCALL RETARDO
0001b9 9aae      	SBI   PORTC, lcd_e		; activa enable
0001ba bb0b      	OUT   PORTA,R16   		; ponemos el byte de TEXTO 
0001bb ee96      	LDI   R25,230      		; retardo total 230 us
0001bc d76d      	RCALL RETARDO   		; 
0001bd 98ae      	CBI   PORTC,lcd_e   	; STROBE=0 dato valido
0001be ec98      	LDI   R25, 200			; 1retardo necesario 270us 
0001bf d76a      	RCALL RETARDO
0001c0 ec98      	LDI   R25, 200			; 2retardo necesario 195us 
0001c1 d768      	RCALL RETARDO
0001c2 ec98      	LDI   R25, 200			; 3retardo necesario 195us 
0001c3 d766      	RCALL RETARDO
0001c4 ec98      	LDI   R25, 200			; 4retardo necesario 195us 
0001c5 d764      	RCALL RETARDO
0001c6 ec98      	LDI   R25, 200			; 5retardo necesario 270us son 190 faltan 80
0001c7 d762      	RCALL RETARDO			; llamada a la rutina retardo   
0001c8 e694      	LDI   R25, 100			; 6retardo necesario 80us
0001c9 d760      	RCALL RETARDO			; llamada a la rutina retardo  
0001ca 9508      	RET
                 CGRAM:  ;PARA PROGRAMAR UNA ESPACIO EN CGRAM
                 
0001cb e400      	LDI R16, 0B01000000		; ACCESO A CGRAM POSICION DE MEMORIA 00
0001cc dfe9      	RCALL ENVINTR
0001cd e000      	LDI	R16, 0B00000000
0001ce d36c      	RCALL ENVIARBYTE
0001cf e000      	LDI	R16, 0B00000000
0001d0 d36a      	RCALL ENVIARBYTE
0001d1 e000      	LDI	R16, 0B00000000
0001d2 d368      	RCALL ENVIARBYTE
0001d3 e000      	LDI	R16, 0B00000000
0001d4 d366      	RCALL ENVIARBYTE
0001d5 e000      	LDI	R16, 0B00000000
0001d6 d364      	RCALL ENVIARBYTE
0001d7 e000      	LDI	R16, 0B00000000
0001d8 d362      	RCALL ENVIARBYTE
0001d9 e000      	LDI	R16, 0B00000000
0001da d360      	RCALL ENVIARBYTE
0001db e000      	LDI	R16, 0B00000000
0001dc d35e      	RCALL ENVIARBYTE
                 ; PROGRAMAR FLECHA ARRIBA
                 
0001dd e004      	LDI	R16, 0B00000100
0001de d35c      	RCALL ENVIARBYTE
0001df e00e      	LDI	R16, 0B00001110
0001e0 d35a      	RCALL ENVIARBYTE
0001e1 e105      	LDI	R16, 0B00010101
0001e2 d358      	RCALL ENVIARBYTE
0001e3 e004      	LDI	R16, 0B00000100
0001e4 d356      	RCALL ENVIARBYTE
0001e5 e004      	LDI	R16, 0B00000100
0001e6 d354      	RCALL ENVIARBYTE
0001e7 e004      	LDI	R16, 0B00000100
0001e8 d352      	RCALL ENVIARBYTE
0001e9 e004      	LDI	R16, 0B00000100
0001ea d350      	RCALL ENVIARBYTE
0001eb e000      	LDI	R16, 0B00000000
0001ec d34e      	RCALL ENVIARBYTE
                 
                 ; PROGRAMAR FLECHA ABAJO
                 
0001ed e004      	LDI	R16, 0B00000100
0001ee d34c      	RCALL ENVIARBYTE
0001ef e004      	LDI	R16, 0B00000100
0001f0 d34a      	RCALL ENVIARBYTE
0001f1 e004      	LDI	R16, 0B00000100
0001f2 d348      	RCALL ENVIARBYTE
0001f3 e004      	LDI	R16, 0B00000100
0001f4 d346      	RCALL ENVIARBYTE
0001f5 e105      	LDI	R16, 0B00010101
0001f6 d344      	RCALL ENVIARBYTE
0001f7 e00e      	LDI	R16, 0B00001110
0001f8 d342      	RCALL ENVIARBYTE
0001f9 e004      	LDI	R16, 0B00000100
0001fa d340      	RCALL ENVIARBYTE
0001fb e000      	LDI	R16, 0B00000000
0001fc d33e      	RCALL ENVIARBYTE
                 
                 ; PROGRAMA UN A  g MINUSCULA
                 	
0001fd e000      	LDI	R16, 0B00000000
0001fe d33c      	RCALL ENVIARBYTE
0001ff e000      	LDI	R16, 0B00000000
000200 d33a      	RCALL ENVIARBYTE
000201 e00e      	LDI	R16, 0B00001110
000202 d338      	RCALL ENVIARBYTE
000203 e101      	LDI	R16, 0B00010001
000204 d336      	RCALL ENVIARBYTE
000205 e00f      	LDI	R16, 0B00001111
000206 d334      	RCALL ENVIARBYTE
000207 e001      	LDI	R16, 0B00000001
000208 d332      	RCALL ENVIARBYTE
000209 e00f      	LDI	R16, 0B00001111
00020a d330      	RCALL ENVIARBYTE
00020b e000      	LDI	R16, 0B00000000
00020c d32e      	RCALL ENVIARBYTE
                 
                 ; PONE UNA Ñ
00020d e10f      	LDI	R16, 0B00011111
00020e d32c      	RCALL ENVIARBYTE
00020f e000      	LDI	R16, 0B00000000
000210 d32a      	RCALL ENVIARBYTE
000211 e101      	LDI	R16, 0B00010001
000212 d328      	RCALL ENVIARBYTE
000213 e109      	LDI	R16, 0B00011001
000214 d326      	RCALL ENVIARBYTE
000215 e105      	LDI	R16, 0B00010101
000216 d324      	RCALL ENVIARBYTE
000217 e103      	LDI	R16, 0B00010011
000218 d322      	RCALL ENVIARBYTE
000219 e101      	LDI	R16, 0B00010001
00021a d320      	RCALL ENVIARBYTE
00021b e000      	LDI	R16, 0B00000000
00021c d31e      	RCALL ENVIARBYTE
00021d 9508      RET
                 
                 			;***+CREO QUE ESTO SOBRA*************
                 ; LIMPIA LA LINEA  2 DE PRESENTACION PARA QUE NO APAREZCA UNA Ñ
00021e e0d1          LDI   			YH,0x01        	; direcion alta donde se pone el texto en RAM VALOR ANTIGUO 00
00021f e1c0          LDI   			YL,0x10      	; direccion baja donde se pone el texto en RAM VALOR ANTIGUO EC
000220 e2fa          LDI   			ZH,high(TEXTO6*2); direccion alta del TEXTO en Flash
000221 e0e8          LDI   			ZL,low(TEXTO6*2) ; direccion baja del TEXTO en Flash 
000222 e100          LDI   			R16,16      	; longitud de texto a copiar en RAM
                 ;*** RURINA CARGAR TEXTO DE FLASH A RAM  
                 ;EN Y (YH,YL) POSICION EN RAM
                 ;EN Z (ZH,ZL) POSICION EN FLASH
                 ;EN R16 NUMERO DE LETRAS (BYTS)
                 
                 CARGATEXTO_5A:
000223 95c8      	LPM      						; leemos TEXTO de FLASH y lo almacena en R0
000224 9631      	ADIW  			ZL,1   			; apuntamos al siguiente elemento 
000225 8208      	ST    			Y, R0			; guardamos en RAM POSICION Y EL CONTENIDO DE R0
000226 9621      	ADIW  			YL,1      		
000227 950a      	DEC   			R16      		; Hemos terminado..?? 
000228 f7d1      	BRNE  			CARGATEXTO_5A  	; NO...seguimos cargando 
000229 9508      	RET
                 .INCLUDE "INI_PANTALLA_2.ASM"
                 
                 .equ lcd_e2 = 02
                 INI_PANTALLA_2:
00022a e684      	LDI   R24, 100
                 TEM1_2:						; NECESITA 15mS DE RETRASO DESPUES DE CONECTAR
00022b ef9a      	LDI   R25, 250			; CICLO DE 250 us A 4Mhz x 100 = 0,025 seg
00022c d6fd      	RCALL RETARDO
00022d 958a      	DEC   R24
00022e f7e1      	BRNE  TEM1_2
00022f e300      	LDI   R16, 48			; 00110000 se debe enviar tres veces (1)
000230 d025      	RCALL ENVINTR_2
000231 e187      	LDI   R24, 23			; retardo de 4,1 ms ( 23x250=5.750 ms )
                 TEM2_2:	
000232 ef9a      	LDI   R25, 250
000233 d6f6      	RCALL RETARDO
000234 958a      	DEC   R24
000235 f7e1      	BRNE  TEM2_2
000236 e300      	LDI   R16, 48			; 00110000 se debe enviar tres veces (1)
000237 d01e      	RCALL ENVINTR_2
000238 e798      	LDI   R25, 120			; retardo 100us
000239 d6f0      	RCALL RETARDO
00023a e300      	LDI   R16, 48			; 00110000 se debe enviar tres veces (1)
00023b d01a      	RCALL ENVINTR_2
00023c e798      	LDI   R25, 120
00023d d6ec      	RCALL RETARDO
00023e e308      	LDI   R16,56			; 00111000 8 BITS 2LINEAS, DIGITO DE 5X7
00023f d016      	RCALL ENVINTR_2	
000240 ef9a      	LDI   R25, 250
000241 d6e8      	RCALL RETARDO
000242 e00c      	LDI   R16, 0b00001100	; ENCIENDE LA PANTALLA 1CDB
000243 d012      	RCALL ENVINTR_2			; C CURSOR ON/OFF
000244 ef9a      	LDI   R25, 250			; D PONE UNA MARCA DONDE ESTA EL CURSOR
000245 d6e4      	RCALL RETARDO			; B intermitente
000246 e006      	LDI   R16, 06			; MODO SET ,TRABAJO
000247 d00e      	RCALL ENVINTR_2
000248 9508      	RET
                 INI_PANTALLA1_2:
000249 e800      	LDI   R16, 128			; escribir en linea uno
00024a d00b      	RCALL ENVINTR_2
00024b e0d7      	LDI   YH, HIGH (LIN1P)
00024c eec0      	LDI   YL, LOW  (LIN1P)
00024d e110      	LDI   R17,16
00024e d6d6      	RCALL ENVIARTEXTO
00024f ec00      	LDI   R16, 192			; 11000000 escribir en linea 2 linea (192)
000250 d005      	RCALL ENVINTR_2
000251 e0d7      	LDI   YH, HIGH (LIN2P)	; POSICION ALTA DEL TAXTO EN RAM
000252 efc4      	LDI   YL, LOW  (LIN2P)	; direccion BAJA DEL TEXTO EN RAM      		
000253 e110      	LDI   R17,16			; numero de digitos a enviar
000254 d6d0      	RCALL ENVIARTEXTO	
000255 9518      	RETI
                 
                 
                 
                 ENVINTR_2:
000256 98ad      	CBI   PORTC, lcd_rs		; en instruccion a 0
000257 e392      	LDI   R25,50			; retardo necesario aprox 42us
000258 d6d1      	RCALL RETARDO
000259 9aaa      	SBI   PORTC, LCD_E2		; activa enable
00025a bb0b      	OUT   PORTA,R16   		; ponemos el byte de TEXTO 
00025b ee96      	LDI   R25,230      		; retardo total 230 us
00025c d6cd      	RCALL RETARDO   		; 
00025d 98aa      	CBI   PORTC,LCD_E2   	; STROBE=0 dato valido
00025e ec98      	LDI   R25, 200			; 1retardo necesario 270us 
00025f d6ca      	RCALL RETARDO
000260 ec98      	LDI   R25, 200			; 2retardo necesario 195us 
000261 d6c8      	RCALL RETARDO
000262 ec98      	LDI   R25, 200			; 3retardo necesario 195us 
000263 d6c6      	RCALL RETARDO
000264 ec98      	LDI   R25, 200			; 4retardo necesario 195us 
000265 d6c4      	RCALL RETARDO
000266 ec98      	LDI   R25, 200			; 5retardo necesario 270us son 190 faltan 80
000267 d6c2      	RCALL RETARDO			; llamada a la rutina retardo   
000268 e694      	LDI   R25, 100			; 6retardo necesario 80us
000269 d6c0      	RCALL RETARDO			; llamada a la rutina retardo  
00026a 9508      	RET
                 .INCLUDE "RELOJ.ASM"
                 
                 
                 ; CONTROL FUENTE OPTO
                 ; 				MICRO PATA	1	PATA 2		LM358 PATA 1		OPTO		CLEMA
                 ; ENCENDIDO					0		0				0,57		0,61		2,09
                 ; APAGADO					0		5				3,55		1,14		0,06	
                 
                 ; VALORES % 9 25 41 57 73 89 O 91
                 ; ************* GRABA LA MEDICION DE SAL EN EEPROM CONTROL ELECTRODO LO HACE EN EL 8% DEL CICLO******************
                 GRABA_SAL:
00026b e026      	LDI				R18, P_SAL			; LINEA DE ENTRADA EN EL CONVERTIDOR PCF8591
00026c 91a0 020d 	LDS				R26, RAMC_SAL		; NUMERO DE MEDICIONES	
00026e 940e 013c 	CALL			ADC_P				; LEE LA MEDICION ACTUAL DE SAL
000270 2f28      	MOV				R18,R24
000271 e91e      	LDI				R17,POLARIDAD_0		; LEE LA POSICION EN EEPROM PARA GRABAR LA SAL POSICION 0
000272 9997      	SBIC			PORTD,7				; SALTA LA SIGUIENTE INSTRUCION SI ES 0	NO GRABA
000273 940e 0587 	CALL			EEPROM_ES
000275 9513      	INC				R17					; INCREMENTA A LA POSICION POLARIDAD 1
000276 9996      	SBIC			PORTD,6				; SALTA LA SIGUIENTE INSTRUCION SI ES 0 NO GRABA				
000277 940e 0587 	CALL			EEPROM_ES
                 
                 ; ACTIVA LA POLARIDAD MAS EFICAZ EN CASO DE SER DIFERENTES EN 5 DECIMAS
                 ;CONTROL_POL:
000279 9110 0220 	LDS				R17,SAL_ELECTRODO	;
00027b 3010      	CPI				R17,00				; COMPARA CON 0
00027c f409      	BRNE			CONTROL_POL_1		; SI ES DISTINTO VA A CONTROL_POL_1
00027d 9508      	RET									; SI ES IGUAL RETORNA AL PROGRAMA
                 CONTROL_POL_1:
00027e 9ab8      	SBI				DDRB,0				; APAGA FUENTE
00027f ec88      	LDI				R24,200
                 CONTROL_POL_2:
000280 ef9a      	LDI				R25, 250			; RETARDO TIEMPO QUE ESTA APAGADA LA FUENTE
000281 940e 092a 	CALL			RETARDO				; RUTINA DE RETARDO
000283 958a      	DEC				R24					; DESCUENTA
000284 f7d9      	BRNE			CONTROL_POL_2		; SI NO ES CERO VA A PONTROL_POL_2
000285 ea10      	LDI				R17,MEJOR_POLARIDAD	; POSICION EN EEPROM DE LA POLARIDAD MEJOR
000286 d2f7      	RCALL			EEPROM_RW			; LEE EL VALOR GRABADO
                 
                 
                 
000287 2f82      MOV		R24,R18
000288 940e 0590 CALL	RADC
00028a 9230 04ee STS		$4EE,R3
00028c 3080      	CPI				R24, 00				; COMPARA CON CERO
00028d f439      	BRNE			CONTROL_POL_3		; SI ES DISTINTO OSEA UN 1 VA A CONTROL_POL_3
00028e 9896      	CBI				PORTD,6				; DESACTIVA EL RELE DE POLARIDAD
00028f 9a97      	SBI				PORTD,7				; ACTIVA POLARIDAD INVERSA
000290 2d0f      MOV				R16,VAL_LED
000291 770f      ANDI			R16,0B01111111		; APAGA LED 7 POLARIDAD
000292 2ef0      MOV				VAL_LED,R16
                 
000293 98b8      	CBI				DDRB,0				; SALIDA DEL 4N25 A CERO
000294 9508      	RET
                 CONTROL_POL_3:
000295 9897      	CBI				PORTD,7				; DESACTIVA EL RELE DE POLARIDAD
000296 9a96      	SBI				PORTD,6				; ACTIVA POLARIDAD INVERSA
000297 2d0f      MOV				R16,VAL_LED
000298 6800      ORI				R16,0B10000000		; ENCIENDE LED 7 POLARIDAD
000299 2ef0      MOV				VAL_LED,R16
                 
                 
00029a 98b8      	CBI				DDRB,0				; ENCIENDE FUENTE
                 FIN:
00029b 9508      	RET
                 RELOJ:									; ANULACION DE LA INTERMITENCIA DEL LED DE RED
00029c 9468      	SET									; PONE EL REGISTRO T DE SREG A 1
                 
                 ;	BST				LEC_REL,0
00029d f8f2      	BLD				VAL_LED, 2			; COPIA T DE SREG EN REGISTRO 2 DE LOS LED ES INTERMITENTE 
00029e 2d0f      	MOV				R16, VAL_LED
                 ;	ORI				R16, 0B00000100		; ENCIENDE LED DE RED AZUL
00029f 2ef0      	MOV				VAL_LED, R16	
0002a0 981f      CBI PORTE,7
                 
                 ;LDI				R18,58 ; PONE DOS PUNTOS
                 ;STS				$7DF, R18
                 
                 ;BRTC RELOJ_B
                 ;LDI				R18,32 ; PONE UN ESPACIO
                 ;STS				$7DF, R18
                 
                 
                 ;BRTC RELOJ_A		; SALTA SI EL BIT T DE SREG ES CERO
                 					; ESTO ES PARA ESCRIBIR UNA LINEA CADA SEGUNDO
                 ;	LDI   			YH,high(LIN1)		; direccion alta del TEXTO en Ram
                 ;	LDI   			YL,low (LIN1)		; direccion baja del TEXTO en Ram 
                 ;	CALL 			UART_TXC_RAM		; RUTINA UART
                 ;	LDS				R24, MINU
                 ;	RCALL 			PANEL
                 ;RJMP RELOJ_B
                 ;RELOJ_A:
                 ;	LDI   			YH,high(LIN2)		; direccion alta del TEXTO en Ram
                 ;	LDI   			YL,low (LIN2)		; direccion baja del TEXTO en Ram 
                 ;	CALL 			UART_TXC_RAM		; RUTINA UART
                 ;	LDS				R24, NCICLOS
                 ;	RCALL 			PANEL
                 
                 RELOJ_B:
0002a1 d67b      	RCALL			LEDPANT
0002a2 9370 0402 	STS  			seg,lec_rel			; almacena los segundos en ram
0002a4 3274      	CPI  			lec_rel,t_ciclo		; comprueba que son UN MINUTO ....
0002a5 f3a8      	BRLO 			FIN					; SALTA AL FINAL
                 
                 RELOJ1:
                 ;	SBR				CONTROL,0B00000010	; PONE A UNO EL BIT 1
0002a6 5274      	SUBI 			lec_rel,t_ciclo		; PONE LOS SEGUNDOS A CERO Y SUMA UN MINUTO
0002a7 9370 0402 	STS  			seg, lec_rel		; Y LO GRABA EN RAM
0002a9 2f87      	MOV  			R24, lec_rel
0002aa 9130 0401 	LDS				R19, MINU
0002ac 9533      	INC  			R19					; Y SUMA UNO
                 ; ****************************GRABA EN  EEPROM LA MEDICION DE SAL Y MEJOR POLARIDAD********************************
0002ad 3039      	CPI				R19,9				; PARA GRABAR EN EEPRON LA CONCENTRACION DE SAL
0002ae f409      	BRBC			1,RELOJ1_A1
0002af dfbb      	RCALL			GRABA_SAL			; 4% DE PRODUCION	CPI				R19, 9				; VERIFICA EL CONTADOR SI ES IGUAL A 20
                 ;RELOJ1_A:
                 ;	CPI				R19,8
                 ;	BRBC			1,RELOJ1_A1
                 ;	RCALL			CONTROL_POL
                 ; NUEVOS VALORES CON CRISTAL DE CUARZO 8-22-35-48-61-74-87 INCREMENTO 13 EN VEZ DE 16
                 
                 
                 RELOJ1_A1:
0002b0 303a      	CPI				R19,10
0002b1 f409      	BRBC			1,RELIJ1B				; SI ES DISTINTO SALTA A RELIJ1B
0002b2 d057      	RCALL			L_HORA				; PARA INCREMENTAR LAS HORAS DE FUCIONAMIENTO	
                 
                 RELIJ1B:
0002b3 3139      	CPI				R19, 25				; VERIFICA EL CONTADOR SI ES IGUAL A 40
0002b4 f409      	BRBC			1,RELOJ1C			; SI ES DISTINTO SALTA A RELOJ 1C
0002b5 d054      	RCALL			L_HORA				; PARA INCREMENTAR LAS HORAS DE FUCIONAMIENTO	
                 
                 RELOJ1C:
0002b6 3239      	CPI				R19, 41				; VERIFICA EL CONTADOR SI ES IGUAL A 60
0002b7 f409      	BRBC			1, RELOJ1D			; SI ES DISTINTO SALTA A RELOJ 1D
0002b8 d051      	RCALL			L_HORA				; PARA INCREMENTAR LAS HORAS DE FUCIONAMIENTO	
                 RELOJ1D:
0002b9 3339      	CPI				R19, 57				; VERIFICA EL CONTADOR SI ES IGUAL A 80
0002ba f409      	BRBC			1, RELOJ1E				; SI ES DISTINTO SALTA A RELOJ 1E
0002bb d04e      	RCALL			L_HORA				; PARA INCREMENTAR LAS HORAS DE FUCIONAMIENTO	
                 RELOJ1E:
0002bc 3439      	CPI				R19, 73				; VERIFICA EL CONTADOR SI ES IGUAL A 80
0002bd f409      	BRBC			1, RELOJ1F			; SI ES DISTINTO SALTA A RELOJ 1F
0002be d04b      	RCALL			L_HORA				; PARA INCREMENTAR LAS HORAS DE FUCIONAMIENTO	
                 RELOJ1F:
0002bf 3539      	CPI				R19, 89				; VERIFICA EL CONTADOR SI ES IGUAL A 80
0002c0 f409      	BRBC			1, RELOJ1A			; SI ES DISTINTO SALTA A RELOJ 1A
0002c1 d048      	RCALL			L_HORA				; PARA INCREMENTAR LAS HORAS DE FUCIONAMIENTO	
                 
                 RELOJ1A:
                 
0002c2 363a      	CPI				R19, 106			; MINUTOS POR CICLO ( INVIERTE) 3 DE ESPERA CON FUENTE APAGAA
0002c3 f100      	BRBS			0, RELOJ2			; SI NO ES 106 SALTA A RELOJ2
0002c4 9130 021f 	LDS				R19, NCICLOS
0002c6 9533      	INC				R19
0002c7 9330 021f 	STS				NCICLOS, R19
0002c9 9468      		SET									; PONE A 1 EL REGISTRO T DE SREG
0002ca f8b7      		BLD				CONTROL_1,7			; LINEA DE CONTROL 7 SE HA PRODUCIDO UNA INVERSION DE POLARIDAD
0002cb 9120 0214 	LDS				R18, RAM_CICLOS
0002cd 1732      	CP				R19, R18			; CICLOS PARA LA INVERSION
0002ce f0a8      	BRBS			0, RELOJ2
                 
                 
                 ; ENVIO DE INFORMACION AL PANEL POR CABLE O RADIO UNA VEZ POR PERIODO
                 ;  A Q U I
                 ; INVIERTE LA POLARIDAD
0002cf e030      	LDI				R19,00				; AQUI PONE LOS MINUTOS A CERO
0002d0 9330 021f 	STS				NCICLOS,R19			; Y LO GRABA EN RAM
0002d2 9330 0401 	STS				MINU,R19			; Y LO ALMACENA EN RAM
                 
0002d4 e17e      	LDI				LEC_REL,30			; PARA NO ESPERAR EN CASO DE INVERSION DE POLARIDAD
0002d5 2d0f      	MOV				R16,VAL_LED
0002d6 7800      	ANDI			R16,0B10000000		; TODO A CERO MENOS BIT 7 QUE CONSERVA SU VALOR
0002d7 3800      	CPI				R16,0B10000000		; VERIFICA POLARIDAD ACTUAL PARA INVERTIR
0002d8 f039      	BREQ			RELOJ1B
0002d9 6800      	ORI				R16,0B10000000		; ENCIENDE LED 7 POLARIDAD
0002da 2ef0      	MOV				VAL_LED,R16
0002db 9897      	CBI				PORTD,7				; DESACTIVA RELE POLARIDAD
0002dc 9a96      	SBI				PORTD,6				; ACTIVA EL RELE DE LA POLARIDAD
0002dd 940e 0a54 	CALL			COMPARA2
0002df c004      	RJMP			RELOJ2
                 RELOJ1B:
0002e0 9896      	CBI				PORTD,6				; DESACTIVA EL RELE DE POLARIDAD
0002e1 9a97      	SBI				PORTD,7				; ACTIVA POLARIDAD INVERSA
0002e2 6800      	ORI				R16,0B10000000		; ENCIENDE LED 7 POLARIDAD
0002e3 2ef0      	MOV				VAL_LED,R16
                 RELOJ2:
0002e4 9330 0401 	STS  			minu,R19			; Y LO ALMACENA EN RAM
0002e6 9120 0205 	LDS				R18,RAMP_PRO		; CARGA EL PORCENTAJE DE PRODUCION DE RAM AL REGISTRO
                 ; REDUCION POR CUBIERTA CERRADA
                 ;	SBRC			CONTROL_1, 3
                 ;	CALL			MULTIPLICAR_A		; TIENE LA CUBIERTA CERRADA Y REDUCE EL PORCENTAJE DE PRODUCION
0002e8 fd43      	SBRC			CONTROL,3			; SALTA LA PROXIMA INSTRUCION SI ES CERO, SUPERCLORACION
0002e9 e624      	LDI				R18,100
0002ea 3031      	CPI				R19,01				; VERIFICA QUE A PASADO UN MINUTO PARA ENCENDER LA FUENTE
0002eb f0e8      	BRBS			0,NO				; SI ES MENOR DE UN MINUTO SALTA A NO
0002ec 0732      	CPC				R19,R18				; SI EL TIEMPO ES INFERIOR A LA PRODUCION NO APAGA VA A ENCENDER FUENTE
0002ed f070      	BRBS			0,ENCENDER
                 APAGAR:
0002ee fd47      	SBRC			CONTROL,7 			; COMPRUEBA SI TIENE SONDA DE CLORO LIBRE
0002ef 9508      	RET									; SI NO TIENE SALTA ESTA INSTRUCION
0002f0 fd46      	SBRC			CONTROL,6			; COMPRUEBA SI TIENE SONDA DE REDOX
0002f1 9508      	RET									; SI NO TIENE SALTA ESTA INSTRUCION
                 APAGAR_FUENTE:
0002f2 9ab8      	SBI				DDRB,0				; SALIDA DEL 4N25 A CERO
0002f3 9894      	CBI				PORTD,4				; APAGA CONTROL REMOTO Y VENTILADOR
0002f4 9aa8      	SBI				PORTC,0				; SALIDA PARA EL CONTROL DEL EQUIPO REMOTO APAGADO
0002f5 e100      	LDI				R16,0B00010000		; APAGA LOS MOS-FET
0002f6 9300 0065 	STS				PORTG,R16
0002f8 2d0f      	MOV				R16,VAL_LED
0002f9 770c      	ANDI			R16,0B01111100		; APAGA LED 0 FUENTE ENCENDIDA
0002fa 2ef0      	MOV				VAL_LED,R16	
                 ;		LDI			R19,116			; ENVIA UNA t			
                 ;		LDI			R27,55			; TEXTO 7 
                 
0002fb 9508      	RET
                 ENCENDER:
0002fc fd47      	SBRC			CONTROL,7 			; COMPRUEBA SI TIENE SONDA DE CLORO LIBRE
0002fd 9508      	RET									; SI NO TIENE SALTA ESTA INSTRUCION
0002fe fd46      	SBRC			CONTROL,6			; COMPRUEBA SI TIENE SONDA DE REDOX
0002ff 9508      	RET									; SI NO TIENE SALTA ESTA INSTRUCION
                 ENCENDER_FUENTE:
                 
                 ;	SBRS			CONTROL_1,4			; SALTA LA PROXIMA INSTRUCION SI ES UNO
                 ;	RJMP			APAGAR_FUENTE		; ERROR SI ES CERO
                 ;**************************************** ojo no enciende la fuente ***********************************
000300 98b8      	CBI				DDRB,0				; SALIDA DEL 4N25 A 1 
                 ;SBI DDRB,0 ; AQUI APAGA LA FUENTE PARA LA FERIA EN VEZ DE ENCENDERLA
000301 9a94      	SBI				PORTD,4				; ACTIVA CONTROL REMOTO Y VENTILADOR
000302 98a8      	CBI				PORTC,0				; SALIDA PARA EL CONTROL DEL EQUIPO REMOTO APAGADO
000303 e001      	LDI				R16,0B00000001		; ENCENDER SALIDA CONTROL REMOTO
000304 9300 0065 	STS				PORTG,R16
000306 2d0f      	MOV				R16,VAL_LED
000307 6003      	ORI				R16,0B00000011		; ENCIENDE LED 0 FUENTE ENCENDIDA
000308 2ef0      	MOV				VAL_LED,R16	
                 ;	SBR 			CONTROL, 0B00000010	; ACTIVA LA SEÑAL PARA MEDIR EL PH ANTES DEL ARRANQUE DE LA FUENTE
                 ;		LDI			R19,116			; ENVIA UNA t			
                 ;		LDI			R27,55			; TEXTO 7 
                 
                 NO:
000309 9508      	RET									; TERMINA LA RUTINA
                 
                 
                 ; MEDICION DE HORAS DE FUNCIONAMIENTO EN N_HORAS VIENE DE LA LINEAN 45
                 ; SI LA FUENTE ESTA APAGADO RETORNA
                 L_HORA: ; INCREMENTA FRACIONES DE HORA
                 
00030a 9b84      	SBIS			PIND,4				; SI LA FUENTE ESTA APAGADA SALTA A NO
00030b 940c 0309 	JMP				NO					; NO CUENTA FRACION DE HORA
00030d e418      	LDI				R17,N_MIN20			; POSICION FRACIONES DE HORA DE HORA
00030e 940e 057e 	CALL			EEPROM_RW			; LEE EN LA EPROM
000310 9523      	INC				R18					; INCREMENTA UN SESTO
000311 3026      CPI				R18,6				; COMPRUEBO SI SON YA LOS 6 
000312 f499      	BRNE			L_HORA_2			; SI NO SON VA A L_HORA_2 Y GRABA EL NUEVO DATO EN EPROM			
000313 e020      	LDI				R18,00				; COMO YA VAN 6  
000314 940e 0587 	CALL			EEPROM_ES			; BORRA LA EPROM Y SUMA UNA HORA
                 
                 
                 L_HORA_1:
                 
000316 940e 1155 	CALL			REJILLA				; CALCULO VIDA DE LA REJILLA
000318 e419      	LDI				R17, N_HORAS		; POSICION A LEER EN LA EEPROM
000319 d264      	RCALL			EEPROM_RW			; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
00031a 2fc2      	MOV				YL, R18				; RESULTADO EN R18
00031b e41a      	LDI				R17, N_HORAS_1		; POSICION A LEER EN LA EEPROM
00031c d261      	RCALL			EEPROM_RW			; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
00031d 2fd2      	MOV				YH, R18				; RESULTADO EN R18
00031e 9621      ADIW			YH:YL, 1			; INCREMENTA EN 1 CON ACARREO
00031f 2f2c      	MOV				R18, YL				; PASA A R18 EL VALOR A GRABAR EN EEPROM
000320 e419      	LDI				R17, N_HORAS		; POSICION A ESCRIBIR EN LA EEPROM POSICION BAJA
000321 d265      	RCALL			EEPROM_ES			; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
000322 2f2d      	MOV				R18, YH				; PASA A R18 EL VALOR A GRABAR EN EEPROM
000323 e41a      	LDI				R17, N_HORAS_1		; POSICION A ESCRIBIR EN LA EEPROM PASICION ALTA
000324 d262      	RCALL			EEPROM_ES			; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
000325 c003      	RJMP			L_HORA_1A			; DUPLICA DATOS
                 
                 L_HORA_2:
000326 940e 0587 	CALL			EEPROM_ES
                 
000328 9508      	RET			
                 ; DUPLICAR REGISTROS DE HORAS
                 
                 L_HORA_1A:
                 
000329 e41c      	LDI				R17, N_HORASC		; POSICION A LEER EN LA EEPROM
00032a d253      	RCALL			EEPROM_RW			; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
00032b 2fc2      	MOV				YL, R18				; RESULTADO EN R18
00032c e41d      	LDI				R17, N_HORASC_1		; POSICION A LEER EN LA EEPROM
00032d 940e 057e 	CALL			EEPROM_RW			; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
00032f 2fd2      	MOV				YH, R18				; RESULTADO EN R18
000330 9621      	ADIW			YH:YL, 1			; INCREMENTA EN 1 CON ACARREO
000331 2f2c      	MOV				R18, YL				; PASA A R18 EL VALOR A GRABAR EN EEPROM
000332 e41c      	LDI				R17, N_HORASC		; POSICION A ESCRIBIR EN LA EEPROM POSICION BAJA
000333 940e 0587 	CALL			EEPROM_ES			; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
000335 2f2d      	MOV				R18, YH				; PASA A R18 EL VALOR A GRABAR EN EEPROM
000336 e41d      	LDI				R17, N_HORASC_1		; POSICION A ESCRIBIR EN LA EEPROM PASICION ALTA
000337 d24f      	RCALL			EEPROM_ES			; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
000338 9508      	RET
                 ;PRU2: ;PONE EN LA TERCERA LINEA LA FRACION DE HORA
000339 e418      	LDI				R17,N_MIN20
00033a 940e 057e 	CALL			EEPROM_RW
00033c 2f82      	MOV				R24,R18
00033d 940e 0590 	CALL			RADC
00033f 9210 0250 	STS				$250,R1
000341 9220 0251 	STS				$251,R2
000343 9230 0252 	STS				$252,R3	
000345 9508      	RET
                 
                 ; ESTO ES PARA PRODUCIR UNA INTERMITENCIA EN EL RELE DE PH
000346 fb70      BST				LEC_REL, 0			; COPIA EL BIT CERO DE LA LECTURA DEL RELOJ EN T
000347 f016      BRTS			PRU3
000348 9895      CBI				PORTD,b_acido		; ENCIENDE BOMBA DE ACIDO
000349 c001      RJMP PRU4
                 PRU3:
00034a 9a95      SBI				PORTD,b_acido		; APAGA BOMBA DE ACIDO
                 PRU4:	
                 .INCLUDE "LINEA_PH.ASM"
                 
                 
                 
                 LINEA1PH: ; LINEA 3 PORCENTAJE DE PRODUCCION PANTALLA NORMAL CON PH
                 
00034b 9180 0205 	LDS				R24,RAMP_PRO
00034d fd43      	SBRC			CONTROL, 3		; SALTA LA PROXIMA INSTRUCION SI ES CERO, SUPERCLORACION
00034e e684      	LDI				R24, 100		; SOLO EN CASO DE SUPERCLORACION
00034f d240      	RCALL			RADC			; RUTINA PARA CONVERTIR EN ANALOGICO
000350 9210 0593 	STS				$593, R1		; PONE EN PANTALLA NORMAL
000352 9220 0594 	STS				$594, R2
000354 9230 0595 	STS				$595, R3
000356 9210 0956 	STS				$956, R1		; GRABAR EN RUTINA PROGRAMACION
000358 9220 0957 	STS				$957, R2		; GRABAR EN RUTINA PROGRAMACION
00035a 9230 0958 	STS				$958, R3		; GRABAR EN RUTINA PROGRAMACION
00035c 2f03      	MOV				R16, R19		; ESCRIBIR LINEA 2 valor 128
00035d d1e0      	RCALL			ENVINT			; En subrrutina Env_doi Envia instrucion para escribir en linea 1
00035e e0d5      	LDI				YH,HIGH(POR_PRO); POSICION BIT ALTO DEL TEXTO A ENVIAR ram en 070
00035f e8c8      	LDI				YL,LOW (POR_PRO); POSICION BIT BAJO DEL TEXTO A ENVIAR
000360 e114      	LDI				R17,20			; NUMERO DE DIGITOS A ENVIAR A PANTALLA
000361 d5c3      	RCALL			ENVIARTEXTO		; RUTINA EN ESTE FICHERO PRECISA SUBRRUTINA ENV_DOI	
000362 9508      	RET
                 
                 LINEA2PH:		; EN R19 LINEA A ESCRIBIR
000363 e200      	LDI				R16, 32			; PONE UN ESPACIO
000364 9300 0117 	STS				$117,R16			
000366 9300 011a 	STS				$11A,R16
000368 9300 0120 	STS				$120,R16
00036a 9300 0121 	STS				$121,R16
00036c 9300 011e 	STS				$11E,R16
00036e 9300 011f 	STS				$11F,R16
000370 9180 0210 	LDS				R24,RAM_SAL_C		; CARGA DE LA RAM EL VALOR DE LA MEDICION DE LA SAL YA MODIFICADA CON LA TEMPERATURA
000372 e20e      	LDI				R16,46			; PONE UN .
000373 9300 0123 	STS				$123,R16	
000375 3683      	CPI				R24,99
000376 f478      	BRBC			0,LINEA2PH_1
000377 e200      	LDI				R16,32
000378 9300 07c4 	STS				$7C4,R16
00037a 338d      	CPI				R24,61
00037b f020      	BRLO			LINEA2PH_3
00037c e38c      	LDI				R24,60				; SI ES MAYOR DE 60 PONE > Y DA VALOR DE 60 A SAL
00037d e30e      	LDI				R16,62
00037e 9300 07c4 	STS				$7C4,R16
                 LINEA2PH_3:
000380 d20f      	RCALL			RADC
                 ;	STS				$122,R1
000381 9220 07c5 	STS				$7C5,R2		; VALOR DE LAS DECENAS
000383 9230 07c7 	STS				$7C7,R3		; VALOR DE LAS UNIDADES
000385 c005      	RJMP			LINEA2PH_2
                 LINEA2PH_1:
000386 e20d      	LDI				R16, 45			; PONE UN -
000387 9300 07c5 	STS				$7C5,R16
000389 9300 07c7 	STS				$7C7,R16
                 LINEA2PH_2:
00038b 9508      RET
                 
00038c 2f03      	MOV				R16, R19			; linea 3 POSICION LINEA A ESCRIBIR
00038d d1b0      	RCALL			ENVINT
00038e e0d7      	LDI				YH, HIGH (SAL_AGUA)	; POSICION ALTA DEL TAXTO EN RAM 080
00038f ebc8      	LDI				YL, LOW  (SAL_AGUA)	; direccion BAJA DEL TEXTO EN RAM      	
000390 e114       	LDI				R17,20 				; bytes a enviar 
000391 d593      	RCALL			ENVIARTEXTO			; RUTINA PARA ENVIAR TEXTO A PANTALLA
000392 9508      	RET
                 ANADIR_SAL:
000393 e000      LDI			R16,0
000394 9300 0b06 STS			BAJO_SAL,R16			; DESACTIVA BAJO EN SAL
000396 9180 0210 	LDS				R24,RAM_SAL_C		; LEE LA SAL EN EL AGUA
000398 308a      	CPI				R24,lim_sal			; SI ES MAYOR
000399 f470      	BRBC			0,ANADIR_SAL_1		; VA A BORRAR LA LINEA 4
00039a e001      LDI			R16,1
00039b 9300 0b06 STS			BAJO_SAL,R16			; ACTIVA BAJO EN SAL
00039d e32c      	LDI				R18,60
00039e 1b28      	SUB				R18,R24
00039f 2f82      	MOV				R24,R18				; RESTA EL VALOR DE 60 GRAMOS LITRO
0003a0 d1ef      	RCALL			RADC
0003a1 9220 07d4 	STS				$7D4,R2				; COLOCA EL VALOR DE SAL A AÑADIR
0003a3 9230 07d6 	STS				$7D6,R3				; COLOCA EL VALOR DE SAL A AÑADIR
0003a5 940e 1a6e 	CALL			SCR					; MUESTRA SAL A AÑADIR
0003a7 9508      	RET			
                 ANADIR_SAL_1:			; BORRA LA LINEA 4
0003a8 ed04      	LDI				R16,212				; 11000000 escribir en linea 4 linea (192)( linea 4 seria 212)
0003a9 940e 053e 	CALL			ENVINT
0003ab e0d7      	LDI				YH,HIGH(SAL_AGUA)	; POSICION ALTA DEL TAXTO EN RAM 080
0003ac ebc8      	LDI				YL,LOW (SAL_AGUA)	; direccion BAJA DEL TEXTO EN RAM      	
0003ad e114         	LDI				R17,20 				; bytes a enviar 
0003ae 940e 0925 	CALL			ENVIARTEXTO			; RUTINA PARA ENVIAR TEXTO A PANTALLA
0003b0 9508      	RET
                 
                 LIN_AUTO_RD:			; LINEA 3 "PROD. AUTO RDX ---mV"
0003b1 2f03      	MOV				R16,R19				; 11000000 escribir en linea 4 linea (192)( linea 4 seria 212)
0003b2 940e 053e 	CALL			ENVINT
0003b4 e0d9      	LDI				YH,HIGH(AUT_RD)		; POSICION ALTA DEL TAXTO EN RAM 080
0003b5 eacc      	LDI				YL,LOW (AUT_RD)		; direccion BAJA DEL TEXTO EN RAM      	
0003b6 e114         	LDI				R17,20 				; bytes a enviar 
0003b7 940e 0925 	CALL			ENVIARTEXTO			; RUTINA PARA ENVIAR TEXTO A PANTALLA
0003b9 9508      	RET
                 
                 LIN_AUTO_CL:			; LINEA 3 "PROD. AUTO CL -.- PPM"
0003ba 2f03      	MOV				R16,R19				; 11000000 escribir en linea 4 linea (192)( linea 4 seria 212)
0003bb 940e 053e 	CALL			ENVINT
0003bd e0d9      	LDI				YH,HIGH(AUT_CL)		; POSICION ALTA DEL TAXTO EN RAM 080
0003be ecc0      	LDI				YL,LOW (AUT_CL)		; direccion BAJA DEL TEXTO EN RAM      	
0003bf e114         	LDI				R17,20 				; bytes a enviar 
0003c0 940e 0925 	CALL			ENVIARTEXTO			; RUTINA PARA ENVIAR TEXTO A PANTALLA
                 
0003c2 9508      	RET
                 
                 .INCLUDE "LEC_TEC.ASM"
                 
                 ; 1º VERIFICA SI SE HA PULSADO LA TECLA 00000001
                 ; PARA PODER ENTRAR EN PROGRAMACION APARTADO TECLADO
                 ; 2º LEE LOS VALORES DE LOS PARAMETROS EN LA EEPROM
                 ; Y LOS ALMACENA EN R30, R31, r28 APARTADO TECLA
                 ; 3º ENTRA EN AJUSTE DEL PH TECLA1*
                 ; EN EL APARTADO TECLA1A SE VERIFICA LA OPCION PASAR A CL( 6 Y 2) Ó SALIR (6 Y 4)
                 ; TECLA1B PULSANDO LA TECLA 3 AUMENTA
                 ; TECLA1C PULSANDO LA TECLA 4 DISMINUYE
                 ; EN EL REGISTRO R7 SE CUENTA EL RETARDO SIN PULSAR TECLAS
                 ; RUTINA PARA LA LECTURA DEL TECLADO ALMACENA EL VALOR EN RAM $241
                 
                 ;DTP:	; OPCION CALIBRAR PARA DTP PULSAR FLECHA CALIBRAR Y PROGRAMAR
                 ;	LDS			R24, $0328
                 ;	CPI			R24, 84
                 ;	BRNE		DTP2					; SI NO ES IGUAL SALTA A DTP1 NO VA A CALIBRAR
                 ;	RET	
                 ;DTP2:
                 ;	RJMP		LEC2A
                 
                 ;CUBIERTA:
                 ;	SET								; PONE A 1 EL REGISTRO T DE SREG
                 ;	BLD			CONTROL_1, 3		; LINEA DE CONTROL 3 CUBIERTA CERRADA APLICA PORCENTAJE DE PRODUCION	
                 ;	RET
                 
                 
                 TECLADO:
                 ;CALL		DATO_ASCI				; MUESTRA EN PANTALLA ASCI LOS VALORES DE RG_232 LA RUTINA ESTA EN PRO_PAR
0003c3 9120 0c02 	LDS			R18,RG_232+1		; ES LA POSICION DONDE GRABA LA PANTALLA DONDE ESTA SE USA EN LA RUTINA PAGE
0003c5 3029      	CPI			R18,9	
0003c6 f5a9      	BRNE		TECLADO_1			; SI ESTA LA NEXTION EN PANTALLA DE DATOS DEL EQUIPO NO VERIFICA NADA MAS
0003c7 d654      	RCALL		LIN_PGRAFICA		; ENVIA LOS DATOS	
0003c8 9508      	RET
                 
                 LEC2A:		; CALIBRAR SAL Y PH
0003c9 2d0f      	MOV			R16, VAL_LED		; ENCIENDE LUZ PANTALLA
0003ca 6400      	ORI			R16, 0B01000000
0003cb 2ef0      	MOV			VAL_LED, R16
0003cc d550      	RCALL		LEDPANT				; ACTUALIZAR LOS LED DE LA PANTALLA	
0003cd c21a      	RJMP		PRO6				; RUTINA CALIBRACIN SAL Y PH
                 
                 
                 ;C_POLARIDAD:
                 ;	LDI			R19, 108
                 ;	STS			MINU, R19
                 ;	LDI			LEC_REL, 30
                 ;	LDI			R19, 3
                 ;	STS			NCICLOS, R19
                 ;	RET
                 ;INVIERNO:
                 ;	LDI			R17, VER_INV		; POSICION  EN EEPROM $011
                 ;	LDI			R18, 0
                 ;	RCALL		EEPROM_ES
                 ;	MOV			R16, VAL_LED
                 ;	ORI			R16, 0B00000010		; ENCIENDE LED VERANO INVIERNO
                 ;	MOV			VAL_LED, R16
                 ;	SBR			CONTROL, 0B00000100	; ENCIENDE LED INVIERNO
                 ;	RET
                 
                 LEC2B:		; CALIBRAR CLORO Y REDOX
0003ce 2d0f      	MOV			R16, VAL_LED		; ENCIENDE LUZ PANTALLA
0003cf 6400      	ORI			R16, 0B01000000
0003d0 2ef0      	MOV			VAL_LED, R16
0003d1 d54b      	RCALL		LEDPANT				; ACTUALIZAR LOS LED DE LA PANTALLA	
0003d2 c28b      	RJMP		PRO7				; RUTINA CALIBRACIN CLORO Y REDOX
                 
                 
                 
                 LEC2D:		; PRESENTACION DE LA TEMPERATURA AL PULSAR SALIR   OOJJOO  PRESENTA EN PANTALLA 2
                 ;	CALL			BORRAR_PANTALLA
                 ;RJMP TECLADO
                 ;       20x4        16x4   tipo de display
                 ; linea 1-128 		128 
                 ; linea 2-192		192
                 ; linea 3-148		144
                 ; linea 4-212		208
0003d3 e027      	LDI				R18,P_TEMP			; LINEA A LEER
0003d4 e5a0      	LDI				R26,80				; NUMERO DE LECTURAS
0003d5 940e 013c 	CALL			ADC_P
                 ;LDI R24,00
0003d7 9380 020f 	STS				RAM_TEMP,R24		; GUARDA LA LECTURA EN LA MEMORIA RAM
0003d9 940e 06c8 	CALL			PCF2_T				; RUTINA QUE PREPARA LA PRESENTACION DE LA TEMPERATURA
                 
0003db e904      	LDI				R16, 148		; ESCRIBIR LINEA 3 PRESENTA LA TEMPERATURA
0003dc d161      	RCALL			ENVINT			; En subrrutina Env_doi Envia instrucion para escribir en linea 1
0003dd e0d6      	LDI				YH, HIGH (LIN4)	; POSICION BIT ALTO DEL TEXTO A ENVIAR
0003de e5c0      	LDI				YL, LOW  (LIN4)	; POSICION BIT BAJO DEL TEXTO A ENVIAR
0003df e114      	LDI				R17,20			; NUMERO DE DIGITOS A ENVIAR A PANTALLA
0003e0 d544      	RCALL			ENVIARTEXTO		; RUTINA EN ESTE FICHERO PRECISA SUBRRUTINA ENV_DOI	
0003e1 940e 06c8 	CALL			PCF2_T			; PRESENTA LA TEMPERATUTA
0003e3 940e 105b 	CALL			HORAS			; PRESENTA HORAS Y AMPERIOS (PROD CLORO)
0003e5 ec00      	LDI				R16,192
0003e6 d157      	RCALL			ENVINT
0003e7 e0d7      	LDI				YH, HIGH (VIDA_ELECT)	; POSICION BIT ALTO DEL TEXTO A ENVIAR
0003e8 e9c0      	LDI				YL, LOW  (VIDA_ELECT)	; POSICION BIT BAJO DEL TEXTO A ENVIAR
0003e9 e114      	LDI				R17,20			; NUMERO DE DIGITOS A ENVIAR A PANTALLA
0003ea d53a      	RCALL			ENVIARTEXTO		; RUTINA EN ESTE FICHERO PRECISA SUBRRUTINA ENV_DOI	
0003eb e800      	LDI				R16,128
0003ec d151      	RCALL			ENVINT
0003ed e0d9      	LDI				YH, HIGH (USO_EQUIPO)	; POSICION BIT ALTO DEL TEXTO A ENVIAR
0003ee edc4      	LDI				YL, LOW  (USO_EQUIPO)	; POSICION BIT BAJO DEL TEXTO A ENVIAR
0003ef e114      	LDI				R17,20			; NUMERO DE DIGITOS A ENVIAR A PANTALLA
0003f0 d534      	RCALL			ENVIARTEXTO		; RUTINA EN ESTE FICHERO PRECISA SUBRRUTINA ENV_DOI	
0003f1 feb6      	SBRS			CONTROL_1,6		; SALTA LA PROXIMA INSTRUCION SI ES CERO,
0003f2 c003      	RJMP			LEC2D1			; PRESENTA EL TEXTO "SENSOR DE FLUJO"
0003f3 940e 1a97 	CALL			BORRA_LINEA_4
0003f5 cfcd      	RJMP			TECLADO
                 LEC2D1:
0003f6 ed04      	LDI				R16, 212		; ESCRIBIR LINEA 4 PRESENTA SENSOR DE FLUJO
0003f7 d146      	RCALL			ENVINT			; En subrrutina Env_doi Envia instrucion para escribir en linea 1
0003f8 e0d6      	LDI				YH, HIGH (SENSOR_CAUDAL)	; POSICION BIT ALTO DEL TEXTO A ENVIAR
0003f9 e7c8      	LDI				YL, LOW  (SENSOR_CAUDAL)	; POSICION BIT BAJO DEL TEXTO A ENVIAR
0003fa e114      	LDI				R17,20			; NUMERO DE DIGITOS A ENVIAR A PANTALLA
0003fb d529      	RCALL			ENVIARTEXTO		; RUTINA EN ESTE FICHERO PRECISA SUBRRUTINA ENV_DOI	
                 
                 
                 ; TECLA 0 PROGRAMAR		0B11111110		FE	254
                 ; TECLA 1 MENOS			0B11111101		FD	253
                 ; TECLA 2 FLECHA		0B11111011		FB	251
                 ; TECLA 3 CALIBRAR		0B11110111		F7	247
                 ; TECLA 4 MAS			0B11101111		EF	239
                 ; TECLA 5 CAUDAL
                 ; TECLA 6 NIVEL ACIDO
                 ; TECLA 7 SALIR			0B01111111		7F	127
                 
                 
                 TECLADO_1:
0003fc 940e 0505 	CALL		LEC_TECB			; VA A COMPROBAR LA OPCION NEXTION
0003fe d0c1      	RCALL		LEC_TEC
                 
0003ff 3f17      	CPI			R17, 0B11110111		; RUTINA AJUSTE SAL Y PH 								" CALIBRAR "
000400 f241      	BREQ		LEC2A
                 
000401 95a8      	WDR
                 ;	CPI			R17, 0B11101001		; FUERZA EL CAMBIO DE POLARIDAD					"FLECHA MAS Y MENOS"
                 ;	BREQ		C_POLARIDAD
000402 361f      	CPI			R17, 0B01101111		; ACTIVA RELE DE PH Y CONTROL REMOTO DEL ESCLAVO 	 	"MAS Y SALIR"
000403 f0d1      	BREQ		ACT_RELE_PH
                 
                 ;	CPI			R17, 0B11110010		; OPCIONAL DTP											;FLECHA PROGRAMAR CALIBRAR 
                 ;	BREQ		LEC2A
                 ;	CPI			R17, 0B11100111		; INVIERNO												ANULADA "CALIBRAR Y MAS"
                 ;	BREQ		PONER_AJUSTE1		; PONE EN PANTALLA DATOS RUTINA PWM_ATMEGA
                 
                 ;	BREQ		INVIERNO
                 ;	CPI			R17, 0B10011111		;  REDUCE LA PRODUCION POR TENER CUBIERTA ATOMATICA		ANULADA
                 ;	BREQ		CUBIERTA
                 ;JMP PONER_AJUSTE ;SI SE ACTIVA SALE EL TEXTO DE MOST Y SHUN EN LA PARTE DE ARRIBA DE LA PANTALLA
                 ;	CPI			R17, 0B11110101		; VERANO												"CALIBRAR Y MENOS
                 ;	BREQ		VERANO
                 ;	BREQ		PONER_AJUSTE1		; PONE EN PANTALLA DATOS RUTINA PWM_ATMEGA
                 
000404 3f19      	CPI			R17, 0B11111001		; DESACTIVAR_SUPER_CLORACION 							"FLECHA Y MENOS"
000405 f0a1      	BREQ		DESACTIVAR_SUPER_CLORACION
000406 3e1b      	CPI			R17, 0B11101011		; ACTIVAR_SUPER_CLORACION 								"FLECHA Y MAS
000407 f071      	BREQ		ACTIVAR_SUPER_CLORACION
                 
000408 3e1c      	CPI			R17, 0B11101100		; RUTINA AJUSTE CLORO Y REDOX 							"PROGRAMAR MENOS Y MAS"
000409 f221      	BREQ		LEC2B
                 ;	CPI			R17, 0B10111111		; RUTINA NIVEL DE ACIDO									EN PANTALLA
                 ;	BREQ		LEC2C
                 ;	MOV			R24, VAL_LED
                 ;	ANDI		R24, 0B11011111		; APAGA LED NIVEL DE ACIDO ES FICTICIO EL 5 NO SALE EN PANTALLA
                 ;	MOV			VAL_LED, R24
00040a 371f      	CPI			R17, 0B01111111		; PARA USO EQUIPO TEMPERATURA ETC						"SALIR"
00040b f239      	BREQ		LEC2D
                 
00040c 3f1e      	CPI			R17, 0B11111110		; TECLA 1 ENTRA EN PROGRAMACION DE VALORES 				"PROGRAMAR"
00040d f071      	BREQ		TECLA4VR			; SI ESTAN PULSADAS VA A TECLA4VR Y LUEGP A TECLA4V PRODUCION
                 
00040e 3712      	CPI			R17, 0B01110010		; ENTRA EN PROGRAMACION MODELO Y DISTRIBUIDOR	"FLECHA, CALIBRAR SALIR Y PROGRAMAR" POR ESTE ORDEN
00040f f081      	BREQ		INICIO				; FLECHA CALIBRAR PROGRAMAR Y SALIR
                 ;	CPI			R17,0B11011111		; CONTROL DE CAUDAL EN PANTALLA CLEMA
                 ;	BREQ		SIN_CAUDAL
                 ;	BLD			R17, 5
                 
                 ; ESTAS DOS LUNEAS oo jj oo ********* HAY QUE ACTIVARLAS ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
000410 9b0c      	SBIS		PINE,4				; SONDA DE CAUDAL NUEVA TOMA EN EL MISMO PCB
000411 c014      	RJMP		SIN_CAUDAL
                 	
000412 e030      	LDI			R19,0
000413 9330 0b0a 	STS			S_FLUJO,R19			; DESACTIVA LA SEÑAL DEL SENSOR
                 
000415 9508      	RET
                 ;PONER_AJUSTE1:				;****** PRESENTA EN LINEA 1 % MOS Y SEÑAL DEL SHUNT
                 ;	JMP			PONER_AJUSTE		; PONE EN PANTALLA DATOS RUTINA PWM_ATMEGA
                 
                 ACTIVAR_SUPER_CLORACION:
000416 6048      	SBR			CONTROL, 0B00001000
000417 940e 0300 	CALL		ENCENDER_FUENTE
000419 9508      	RET
                 DESACTIVAR_SUPER_CLORACION:
00041a 7f47      	CBR			CONTROL, 0B00001000
00041b 9508      	RET
                 
                 TECLA4VR:	; INSTRUCION DE REPLICA
00041c 940c 0b51 	JMP			TECLA4V
                 ACT_RELE_PH:
00041e 940c 04cb 	JMP			RELE_PH
                 
                 INICIO:
000420 940e 0050 	CALL		AJUSTE_PRESENTACION_INICIO		; ANTERIORMENTE SIN EL "_INICIO"
000422 9508      	RET
                 CUBIERTA_ABIERTA:
000423 94e8      	CLT								; PONE A 0 EL REGISTRO T DE SREG
000424 f8b3      	BLD			CONTROL_1, 3		; LINEA DE CONTROL 3 CUBIERTA ABIERTA NO APLICA PORCENTAJE DE PRODUCION	
000425 9508      	RET
                 
                 
                 
                 
                 ;SIN_CAUDAL: ; APAGA LA FUENTE Y LA BOMBA DE PH LECTURA UNA VEZ POR SEGUNDO
                 
                 SIN_CAUDAL:
000426 feb0      	SBRS			CONTROL_1,0			; SALTA LA PROXIMA INSTRUCION SI ES UNO,
000427 cffe      	RJMP			SIN_CAUDAL			; RETARDO UN SEGUNDO
000428 94e8      	CLT									; LIMPIA EL REGISTRO T
000429 f8b0      	BLD				CONTROL_1, 0		; PASA EL REGISTRO T A CONTROL_1
00042a 9468      	SET
00042b f8b6      	BLD				CONTROL_1,6
00042c e001      	LDI				R16,1
00042d 9300 0b06 	STS				BAJO_SAL,R16
00042f 940e 1bac 	CALL			CADENA_UART
                 
                 SIN_CAUDAL_1:
000431 feb0      	SBRS			CONTROL_1,0			; SALTA LA PROXIMA INSTRUCION SI ES UNO,
000432 cffe      	RJMP			SIN_CAUDAL_1			; RETARDO UN SEGUNDO
000433 94e8      	CLT									; LIMPIA EL REGISTRO T
000434 f8b0      	BLD				CONTROL_1, 0		; PASA EL REGISTRO T A CONTROL_1
000435 94e8      	CLT
000436 f8b6      	BLD				CONTROL_1,6
000437 e000      	LDI				R16,0
000438 9300 0b06 	STS				BAJO_SAL,R16
00043a 940e 1bac 	CALL			CADENA_UART
                 
                 
                 
00043c d4e0      	RCALL		LEDPANT				; ACTUALIZAR LOS LED DE LA PANTALLA	
00043d 940e 02f2 	CALL		APAGAR_FUENTE
00043f 9895      	CBI			PORTD,b_acido		; APAGA BOMBA DE ACIDO b_acido es 5
000440 e372      	LDI			LEC_REL, 50			; PONE EN EL CONTADOR DEL RELOJ EL TIEMPO DE RETARDO POR FALTA DE FLUJO
000441 2d0f      	MOV			R16, VAL_LED
000442 7e0e      	ANDI		R16, 0B11101110		; APAGA LED 0, FUENTE APAGADA, LLENADO PISCINA Y PH LED 4
000443 2ef0      	MOV			VAL_LED, R16	
000444 d4d8      	RCALL		LEDPANT				; ACTUALIZAR LOS LED DE LA PANTALLA	
000445 e800      	LDI			R16, 128			; ESCRIBIR LINEA 1 VER QUE PASA CON VALOR 1
000446 d0f7      	RCALL		ENVINT				; En subrrutina Env_doi Envia instrucion para escribir en linea 1
000447 e0d5      	LDI			YH,HIGH (LIN_CA)	; POSICION BIT ALTO DEL TEXTO A ENVIAR "SIN CAUDAL"
000448 eeca      	LDI			YL,LOW  (LIN_CA)-2	; POSICION BIT BAJO DEL TEXTO A ENVIAR
000449 e114      	LDI			R17,20				; NUMERO DE DIGITOS A ENVIAR A PANTALLA
00044a d4da      	RCALL		ENVIARTEXTO			; RUTINA EN ESTE FICHERO PRECISA SUBRRUTINA ENV_DOI
00044b e734      	LDI			R19,116				; ENVIA UNA t
00044c e3b0      	LDI			R27,48				; TEXTO 0
00044d e104      	LDI			R16,20				; NUMERO DE CARACTERES A ESCRIBIR
00044e e0d5      	LDI			YH,HIGH(LIN_CA)		; ENVIA A NEXTION SI CAUDAL EN t0
00044f eeca      	LDI			YL,LOW (LIN_CA)-2
000450 940e 1dce 	CALL		P_NEXTION_TEXTO
                 
000452 cf70      	RJMP		TECLADO
                 
                 GRABA:
000453 93e0 0201 	STS			RAMP_PH, R30		; ESCRIBE EN RAM EL NUEVO VALOR PROGRAMADO DEL PH
000455 e010      	LDI			R17, ph_men
000456 2f2e      	MOV			R18, R30			; GRABA EL VALOR DE PH EN EEPROM EN LA POSICION 240
                 ;	RCALL		I2CE_2404			; ESCRIBE EL NUEVO VALOR EN LA EEPRON EXTERNA
000457 d12f      	RCALL		EEPROM_ES
000458 e212      	LDI			R17, PH_SB
000459 e021      	LDI			R18, 1
00045a feb1      	SBRS		CONTROL_1, 1		; salta la siguiente instrucion si es UNO
00045b e020      	LDI			R18, 0
00045c d12a      	RCALL		EEPROM_ES
00045d 2d0f      	MOV			R16, VAL_LED
00045e 7b0f      	ANDI		R16, 0B10111111		; APAGA LED PANTALLA
00045f 2ef0      	MOV			VAL_LED, R16
000460 d4bc      	RCALL		LEDPANT				; ACTUALIZAR LOS LED DE LA PANTALLA	
000461 d51d      	RCALL		NO_TECLA
000462 9508      	RET
                 
                 TECLA: 
                 
                 		; ACTUALIZAR LOS LED DE LA PANTALLA	
000463 91e0 0201 	LDS			R30, RAMP_PH		; CARGA EL VALOR DEL PH EN R30 DE LA MEMORIA RAM
000465 2477      	CLR				R7				; PONE A CERO EL RETARDO SALIDA TECLADO
                 TECLA1V:
000466 306a      	CPI			r22, RETARDO1
000467 f3f0      	BRLO		TECLA1V	
000468 91e0 0201 	LDS			R30, RAMP_PH		; CARGA DESDE LA RAM EL PH PROGRAMADO
00046a e060      	LDI			R22,00
                 ; PROGRAMACION DE PARAMETROS PH
                 
                 TECLA1:								; AJUSTAR PH VALOR EN R30
                 
00046b 95a8      	WDR
00046c ff44      	SBRS		CONTROL, 4			; COMPRUEBA QUE TIENE SONDA DE PH
00046d 940c 0e5c 	JMP 		TECLA5V				; SI NO TIENE SONDA DE PH VA A PROGRAMAR LOS CICLOS
00046f 2d87      	MOV			R24, TEMP_TEC
000470 308f      	CPI			R24, retardo_programacion	; PARA COMPARARLO CON EL RETARDO 20 SEGUNDOS SIN PULSAR TECLA
000471 f70a      	BRPL		GRABA				; Y SALIR DE PROGRAMACION DE PARAMETROS
000472 e1c4      	LDI			R28,20				; CARGA EL RETARDO
000473 d4b6      	RCALL		RETARDO				; PARA IR A LA RUTINA DE RETARDO
000474 d04b      	RCALL		LEC_TEC
000475 3f1f      	CPI			R17, 0B11111111		; COMPRUEBA SI SE A PULSADO ALGUNA TECLA
000476 f009      	BREQ		TECLA1A				; SI SE HA PULSADO SALTA A TECLA1A
000477 2477      	CLR				R7				; PONE A CERO EL RETARDO SALIDA TECLADO
                 TECLA1A:
                 
                 			
                 			; OPCION SALTAR PARA AJUSTE DE REDOX
000478 3f1b      	CPI			R17, 0B11111011		; TECLA 2
000479 f1d1      	BREQ		TECLA2S				; SALTA PARA AJUSTAR EL REDOX
                 			; OPCION SALIR DE LECTURA DE TECLADO 
00047a 371f      	CPI			R17, 0B01111111		; TECLA 5
00047b f409      	BRNE		TECLA1B				; SI NO ES 80 SALTA A TECLA1D
00047c cfd6      	RJMP		GRABA				; TERMINA Y SALE PARA GRABAR
                 TECLA1B:	; OPCION AUMENTAR PH
00047d 3e1f      	CPI			R17, 0B11101111		; TECLA 2
00047e f431      	BRNE		TECLA1C				; SI NO ESTA PULSADA SALTA PARA VERIFICAR OTRA TECLA
00047f 2477      	CLR				R7				; PONE A CERO EL RETARDO SALIDA TECLADO
000480 95e3      	INC			R30					; INCREMENTA EL VALOR
000481 e060      	LDI			R22, 0				; CARGA EL RETARDO DE LECTURA DEL TECLADO
000482 35e0      	CPI			R30, PH_MAX			; VERIFICA SI ESTA EN EL VALOR MAXIMO
000483 f00c      	BRLT		TECLA1C				; SI NO SUPERA EL VALOR MAXIMO SALTA
000484 e5e0      	LDI			R30, PH_MAX			; SI SUPERA EL MAXIMO LO PONE AL MAXIMO
                 TECLA1C:	; OPCION DISMINUIR PH
000485 3f1d      	CPI			R17, 0B11111101		; TECLA MENOS
000486 f431      	BRNE		TECLA1C_A				; SI NO ESTA PULSADA SALTA
000487 2477      	CLR				R7				; PONE A CERO EL RETARDO SALIDA TECLADO
000488 95ea      	DEC			R30					; DISMINUYE EL VALOR
000489 e060      	LDI			R22, 0				; CARGA EL RETARDO DE LECTURA DEL TECLADO
00048a 34e1      	CPI			R30, PH_MIN			; COMPRUEBA SI SE ELCANZA EL VALOR MINIMO
00048b f458      	BRBC		0,	TECLA1D			; SI ES MAYOR  SALTA A TECLA1D
00048c e4e1      	LDI			R30, PH_MIN			; SI SE ALCANZA PONE EL VALOR MINIMO
                 TECLA1C_A:	; PARA UTILIZAR ACIDO DISMINUIR PH OPCION INICIAL
00048d 3f14      	CPI			R17, 0B11110100		; TECLA CALIBRAR MENOS Y PROGRAMAR
00048e f419      	BRNE		TECLA1C_B			; SI NO ESTA PULSADA SALTA
00048f 2477      	CLR				R7				; PONE A CERO EL RETARDO SALIDA TECLADO
000490 94e8      	CLT								; PONE A CERO EL BIT T DE SREG
000491 f8b1      	BLD			CONTROL_1, 1		; PASA LA OPCION AL REGISTRO DE CONTROL 
                 
                 TECLA1C_B:	; PARA UTILIZAR SOSA ELEVAR PH
000492 3e16      	CPI			R17, 0B11100110		; TECLA CALIBRAR MAS Y PROGRAMAR
000493 f419      	BRNE		TECLA1D				; SI NO ESTA PULSADA SALTA
000494 2477      	CLR				R7				; PONE A CERO EL RETARDO SALIDA TECLADO
000495 9468      	SET								; PONE A UNO EL BIT T DE SREG
000496 f8b1      	BLD			CONTROL_1, 1		; PASA LA OPCION AL REGISTRO DE CONTROL
                 
                 TECLA1D:	; PONER EL VALOR EN PANTALLA DEL PH
000497 e060      LDI			R22,00
000498 e220      LDI			R18,32
000499 9320 096b STS			$96B,R18			; APAGA EL VALOR EN PANTALLA
00049b 9320 096d STS			$96D,R18			
00049d 940e 04d7 CALL		PRO_TECLA
                 TECLA1D_1:
00049f 306c      	CPI			R22,RETARDO3
0004a0 f3f0      	BRLO		TECLA1D_1
0004a1 e001      	LDI			R16,01				; CODIGO FLECHA ABAJO
0004a2 99b7      	SBIC		PINB,7				; PUENTE SUBIR PH
0004a3 e002      	LDI			R16,02				; CODIGO FLECHA ARRIBA
0004a4 9300 096f 	STS			$96F,R16			; PONE LA FLECHA PARA ARRIBA O PARA ABAJO
0004a6 2f8e      	MOV			R24, R30			; PONE EL VALOR EN R24 PARA CONVERTIRLO EN DECIMAL
0004a7 d0e8      	RCALL		RADC   				; CONVERTIR UN NUMERO EN DIGITOS DATO EN R24
0004a8 9220 096b 	STS			$96B, R2			; PONE EL RESULTADO EN PANTALLA DECENAS DE PH
0004aa e20e      	LDI			R16, 46				; pone un punto
0004ab 9300 096c 	STS			$096C, R16
0004ad 9230 096d 	STS			$096D, R3			; PONE EL RESULTADO EN PANTALLA UNIDADES DE PH
0004af 940e 04d7 	CALL		PRO_TECLA
                 TECLA1E:
0004b1 316a      	CPI			R22, RETARDO2		; VALOR DEL TIEMPO DE RATARDO LECTURA DEL TECLADO
0004b2 f3f0      	BRLO		TECLA1E				; COMPRUEBA EL TIEMPO DE RETARDO 
0004b3 cfb7      	RJMP		TECLA1	
                 
                 
                 TECLA2S:  ;GRABA EL VALOR DEL PH Y LEE EL DE REDOX
0004b4 93e0 0201 	STS			RAMP_PH, R30		; ACTUALIZA EN RAM EL NUEVO VALOR PROGRAMADO DEL PH
0004b6 e010      	LDI			R17, PH_MEN
0004b7 2f2e      	MOV			R18, R30			; GRABA EL VALOR DE PH EN EEPROM EN LA POSICION 240
                 ;	RCALL		I2CE_2404			; ESCRIBE EL NUEVO VALOR EN LA EEPRON EXTERNA
0004b8 d0ce      	RCALL		EEPROM_ES
0004b9 d4c5      	RCALL		NO_TECLA
0004ba fd47      	SBRC		CONTROL, 7			; COMPRUEBA QUE TIENE SONDA DE CL
0004bb c63a      	RJMP		TECLA3V				; PROGRAMACION DE CLORO
0004bc fd46      	SBRC		CONTROL, 6			; COMPRUEBA QUE TIENE SONDA DE REDOX
0004bd c5d6      	RJMP 		TECLA2V				; PROGRAMACION DE REDOX
0004be 940c 0e5c 	JMP			TECLA5V				; PARA PROGRAMAR LOS CICLOS
                 
                 
                 
                 LEC_TEC: 	;RUTINA LECTURA DEL TECLADO
0004c0 2700      	CLR			R16
0004c1 bb0a      	OUT			DDRA, R16			; PUERTO A COMO ENTRADA
0004c2 bb0b      	OUT			PORTA, R16			; CON VALOR 1 EN TODAS LAS SALIDAS
0004c3 98ab      	CBI			PORTC, TEC			; pone a 0 el bit de PARA ACTIVAR EL TECLADO
0004c4 0000      	NOP
0004c5 b319      	IN			R17, PINA			; lee el valor del puerto a y lo almacena en r17
0004c6 ef0f      	SER			R16					; PONE R16 TODO A 1
0004c7 9aab      	SBI			PORTC, TEC			; pone a 1 el bit PARA DESACTIVAR TECLADO
0004c8 bb0a      	OUT			DDRA, R16			; PUERTO A COMO SALIDA
                 ;MOV R18,R17
                 ;LDI			R17,203
                 ;CALL		EEPROM_ES			; ACTUALIZA EL VALOR EN LA POSICION 200 DE LA EEPROM
                 ;MOV R17,R18
                 ;SBRS		R17,5				; ES LA TECLA DE CAUDAL SI ES UNO VA A RET
0004c9 95a8      	WDR
0004ca 9508      	RET
                 
                 
                 
                 RELE_PH:		;PARA ENCENDER RELE PH 15 SEGUNDOS
0004cb e070      	LDI			LEC_REL, 0
0004cc 940e 0c46 	CALL		PRO2H 				; ENCIENDE BOMBA DE PH Y LED
0004ce 9ac1      	SBI			PORTB, 1			; ENCIENDE BOMBA DE APOYA DE CLORO
                 ;	SBI			PORTB, 6
                 ;	SBI			PORTB, 7
0004cf 940e 091d 	CALL		LEDPANT
                 RELE_PH_1:
0004d1 307f      	CPI			LEC_REL, 15
0004d2 f3f0      	BRLO		RELE_PH_1
0004d3 940e 0c41 	CALL		PRO2F1	 			; APAGA BOMBA DE PH Y LED
0004d5 98c1      	CBI			PORTB, 1			; APAGA BOMBA DE APOYO DE CLORO
                 ;	CBI			PORTB, 6
                 ;	CBI			PORTB, 7
                 
0004d6 9508      	RET
                 ;       20x4        16x4   tipo de display
                 ; linea 1-128 		128 
                 ; linea 2-192		192
                 ; linea 3-148		144
                 ; linea 4-212		208
                 
                 PRO_TECLA:
                 ; ************************* OJO PARA EVITAR QUE SALGA DE PROGRAMACION DE VALORES
                 ;LDI			R16, 00				; SI ES ASI....
                 ;MOV			TEMP_TEC, R16		; PONE EL CONTADOR DE RETARDO A CERO
                 
                 
                 					; PROGRAMACION DE PRODUCION	
                 
0004d7 e800      	LDI				R16, 128		; 11000000 escribir en linea 2 linea (192)
0004d8 d065      	RCALL			ENVINT
0004d9 e0d9      	LDI				YH,HIGH (AJ_PRO); POSICION ALTA DEL TAXTO EN RAM 080
0004da e4c8      	LDI				YL,LOW  (AJ_PRO); direccion BAJA DEL TEXTO EN RAM      	
0004db e114        	LDI				R17,20 			; bytes a enviar 
0004dc d448      	RCALL			ENVIARTEXTO		; RUTINA PARA ENVIAR TEXTO E PANTALLA
0004dd e300      	LDI				R16,48			; ENVIA UN 0
0004de e0d9      	LDI				YH,HIGH (AJ_PRO); POSICION ALTA DEL TAXTO EN RAM 080
0004df e4c8      	LDI				YL,LOW  (AJ_PRO); direccion BAJA DEL TEXTO EN RAM      	
                 ;	CALL			P_NEXTION_TEXTO
                 
                 
                 					; PROGRAMACION DE PH
                 
0004e0 ec00      	LDI				R16, 192		; 11000000 escribir en linea 2 linea (192)
0004e1 d05c      	RCALL			ENVINT
0004e2 e0d9      	LDI				YH,HIGH (AJ_PH); POSICION ALTA DEL TAXTO EN RAM 080
0004e3 e5cc      	LDI				YL,LOW  (AJ_PH); direccion BAJA DEL TEXTO EN RAM      	
0004e4 e114        	LDI				R17,20 			; bytes a enviar 
0004e5 d43f      	RCALL			ENVIARTEXTO		; RUTINA PARA ENVIAR TEXTO E PANTALLA
0004e6 fd47      	SBRC			CONTROL, 7		; COMPRUEBA QUE TIENE SONDA DE CL
0004e7 c00d      	RJMP			PRO_TECLA_1		; PROGRAMACION DE CLORO
0004e8 e301      	LDI				R16,49			; ENVIA UN 1
0004e9 e0d9      	LDI				YH,HIGH (AJ_PH); POSICION ALTA DEL TAXTO EN RAM 080
0004ea e5cc      	LDI				YL,LOW  (AJ_PH); direccion BAJA DEL TEXTO EN RAM    
                 ;	CALL			P_NEXTION_TEXTO
                 					; PROGRAMACION DE REDOX
                 
0004eb e904      	LDI				R16, 148		; ESCRIBIR LINEA 3
0004ec d051      	RCALL			ENVINT
0004ed e0d9      	LDI				YH,HIGH (AJ_RD); POSICION ALTA DEL TAXTO EN RAM 080
0004ee e7c0      	LDI				YL,LOW  (AJ_RD); direccion BAJA DEL TEXTO EN RAM      	
0004ef e114        	LDI				R17,20 			; bytes a enviar 
0004f0 d434      	RCALL			ENVIARTEXTO		; RUTINA PARA ENVIAR TEXTO E PANTALLA
0004f1 e302      	LDI				R16,50			; ENVIA UN 2
0004f2 e0d9      	LDI				YH,HIGH (AJ_RD); POSICION ALTA DEL TAXTO EN RAM 080
0004f3 e7c0      	LDI				YL,LOW  (AJ_RD); direccion BAJA DEL TEXTO EN RAM   
                 ;	CALL			P_NEXTION_TEXTO
0004f4 c006      	RJMP			PRO_TECLA_2
                 PRO_TECLA_1:		; PROGRAMACION DE CLORO
0004f5 e904      	LDI				R16, 148		; 11000000 escribir en linea 2 linea (192)
0004f6 d047      	RCALL			ENVINT
0004f7 e0d9      	LDI				YH,HIGH (AJ_CL); POSICION ALTA DEL TAXTO EN RAM 080
0004f8 e8c4      	LDI				YL,LOW  (AJ_CL); direccion BAJA DEL TEXTO EN RAM      	
0004f9 e114        	LDI				R17,20 			; bytes a enviar 
0004fa d42a      	RCALL			ENVIARTEXTO		; RUTINA PARA ENVIAR TEXTO E PANTALLA
                 PRO_TECLA_2:		; PROGRAMACION DE CICLOS
0004fb ed04      	LDI				R16, 212		; 11000000 escribir en linea 2 linea (192)
0004fc d041      	RCALL			ENVINT
0004fd e0d9      	LDI				YH,HIGH (AJ_POL); POSICION ALTA DEL TAXTO EN RAM 080
0004fe e9c8      	LDI				YL,LOW  (AJ_POL); direccion BAJA DEL TEXTO EN RAM      	
0004ff e114        	LDI				R17,20 			; bytes a enviar 
000500 d424      	RCALL			ENVIARTEXTO		; RUTINA PARA ENVIAR TEXTO E PANTALLA
000501 e303      	LDI				R16,51
000502 e0d9      	LDI				YH,HIGH (AJ_POL); POSICION ALTA DEL TAXTO EN RAM 080
000503 e9c8      	LDI				YL,LOW  (AJ_POL); direccion BAJA DEL TEXTO EN RAM  
                 ;	CALL			P_NEXTION_TEXTO	   
                 	; ENVIAR A LA UART UN RETORNO DE CARRO
                 
000504 9508      	RET
                 
                 ; RURINA GESTION NEXTION PAGINA A ENVIAR Y RUTINA PROGRAMACION O CALIBRACION
                 
                 						
                 LEC_TECB:		; PANTALLA INFORMACION
                 
                 
                 
                 ;COMPROBACION NUEVO DATO
000505 9120 0c01 LDS			R18,RG_232				; CARGA EL PRIMER DATO RECIBIDO DEL PUERTO SERIE
000507 3f2f      CPI			R18,0XFF				; SI ES FF ES QUE NO HAY DATO NUEVO
000508 f409      BRNE		LEC_TECB1				; ESTA LINEA LA SALTA SI NO HAY DATO NUEVO
000509 9508      RET									; RETORNA
                 
                 
                 LEC_TECB1:
                 
00050a 95a8      WDR
00050b 9120 0c02 LDS			R18,RG_232+1			; LEE EL SEGUNDO DATO ENVIADO POR NEXTION PULSADOR INFORMACION
00050d 3021      CPI			R18,1					; SI  SE HA PULSADO VA A PANTALLA DE INFORMACION NEXTION
00050e f421      BRNE		LEC_TECB_A				; SI NO ES 1 VA A COMPROBAR SIGUIENTE PANTALLA
00050f e1fe      LDI			R31,30					; CARGA EL RETARDO DE 10 SEGUNDOS PARA SALIR DE LA PANTALLA INFORMACION
000510 940e 1eb0 CALL		INI_NEXTION_I			; VA A PANTALLA INFORMACION NEXTION
000512 c01b      RJMP		LEC_TECB_F				; TERMINA Y RESTAURA LOS VALORES A FF
                 
                 LEC_TECB_A:		; PANTALLA PARAMETROS
000513 3022      CPI			R18,2
000514 f421      BRNE		LEC_TECB_C
000515 e1fe      LDI			R31,30
000516 940e 1ee4 CALL		INI_NEXTION_PA
000518 c015      RJMP		LEC_TECB_F				; TERMINA Y RESTAURA LOS VALORES A FF
                 
                 
                 LEC_TECB_C:		; PANTALLA PROGRAMACION
000519 3023      CPI			R18,3
00051a f439      BRNE		LEC_TECB_D
00051b e1fe      LDI			R31,30
00051c 940e 1f24 CALL		INI_NEXTION_CA
00051e 2722      CLR			R18
00051f 9320 0c02 STS			RG_232+1,R18
000521 c00c      RJMP		LEC_TECB_F				; TERMINA Y RESTAURA LOS VALORES A FF
                 
                 LEC_TECB_D:		; PANTALLA ERROR DE AQUI NO SALE
000522 3024      CPI			R18,4
000523 f411      BRNE		LEC_TECB_E						;  VA A RUTINA VER ERROR
000524 940c 1906 JMP			VER_ERROR
                 
                 LEC_TECB_E:		; PANTALLA INFORMACION DE DATOS DEL EQUIPO
000526 3029      CPI			R18,9
000527 f431      BRNE		LEC_TECB_F		
000528 e309      LDI			R16,57
000529 9300 0a01 STS			0xA01,R16
00052b 940e 1f9e CALL		P_NEXTION_PAGE
00052d 9508      RET
                 
                 
                 
                 LEC_TECB_F:		; COMPRUEBA SELÑAL DE WIFI
00052e 9120 0c01 LDS			R18,RG_232
                 
                 ;		LDI			R17,205
                 ;		CALL		EEPROM_ES				; ACTUALIZA EL VALOR EN LA POSICION 201 DE LA EEPROM
000530 3721      CPI			R18,113							; CODIGO DE LA ALMOHADILLA ENVIADA POR WIFI
000531 f411      BRNE		LEC_TECB_G
000532 940e 1c2f CALL		N_PRO_PAR						; PROGRAMACION DE PARAMETROS DE LA WIFI
                 
                 LEC_TECB_G:
000534 9508      RET
000535 ef0f      SER			R16
000536 9300 0c01 STS			RG_232,R16
                 ;STS			RG_232+1,R16
000538 9300 0c03 STS			RG_232+2,R16
00053a 9508      RET
                 
                 
                 
                 
                 
                 
                 
                 
                 
                 .INCLUDE "ENV_DOI.ASM"			; ENVIO A PANTALLA 1
                 
                 ; envio de 1 byte EN DATOS O INSTRUCION Y LECTURA DEL BUSY
                 ; EN R16 VALOR A ENVIAR
                 
                 ENVIARBYTE:
00053b d01e      	RCALL 		R_BUSY
00053c 9aad      	SBI   		PORTC, lcd_rs		; en datos a 1 
00053d c002      	RJMP  		ENV1
                 ENVINT:
00053e d01b      	RCALL 		R_BUSY
00053f 98ad      	CBI   		PORTC, lcd_rs		; en instruccion a 0
                 ENV1:   
000540 9aae      	SBI   		PORTC, lcd_e		; activa enable
000541 bb0b      	OUT   		PORTA,R16   		; ponemos el byte de TEXTO 
000542 e590      	LDI   		R25,80      		; retardo total 230 us
000543 d3e6      	RCALL 		RETARDO   			; 
000544 98ae      	CBI   		PORTC,lcd_e   		; STROBE=0 dato valido
                 ;CALL		UART_TXC_1			; ENVIAR EL DATO A LA  UART0
                 ;CALL		UART_TXC_3			; ENVIAR EL DATO A LA  UART1
                 
000545 9508      	RET
                 ; RUTINA VERIFICACION DEL BUSY
                 ;BUSY:
000546 931f      	PUSH  		R17
000547 9aaf      	SBI   		PORTC, LCD_RW
000548 98ad      	CBI	  		PORTC, LCD_RS
000549 2711      	CLR   		R17
00054a bb1a      	OUT   		DDRA, R17			; PUERTO A COMO SALIDA
00054b bb1b      	OUT   		PORTA, R17			; CON VALOR 1 EN TODAS LAS SALIDAS
                 BUSY1:
00054c 9aae      	SBI	  		PORTC, LCD_E		; activar la lectura
00054d 0000      	NOP
00054e b319      	IN    		R17, PINA			; lee el valor del puerto a y lo almacena en r17
00054f 7810      	ANDI  		R17, 0b10000000		; poner todos a cero menos el bit 7
000550 98ae      	CBI	  		PORTC, LCD_E		
000551 3010      	CPI	  		R17, 0B00000000		; VERIFICA SI ESTA OCUPADO EL DISPLAY
000552 f7c9      	BRNE  		BUSY1				; SI ESTA OCUPADO SIGUE ESPERANDO
000553 ef1f      	SER   		R17					; PONE R16 TODO A 1
000554 bb1a      	OUT   		DDRA, R17			; PUERTO A COMO SALIDA
000555 bb1b      	OUT   		PORTA, R17			; CON VALOR 1 EN TODAS LAS SALIDAS
000556 9aad      	SBI   		PORTC, LCD_RS
000557 98af      	CBI   		PORTC, LCD_RW	
000558 911f      	POP   		R17
000559 9508      	RET
                 R_BUSY:
                 
00055a e081      LDI R24, 1
00055b 940e 092a CALL RETARDO
00055d 9508      RET
                 .INCLUDE "ENV_DOI_2.ASM"		; ENVIO A PANTALLA 2
                 
                 ; envio de 1 byte EN DATOS O INSTRUCION Y LECTURA DEL BUSY
                 ENVIARBYTE_2:
00055e dffb      	RCALL 		R_BUSY
00055f 9aad      	SBI   		PORTC, lcd_rs		; en datos a 1 
000560 c002      	RJMP  		ENV1_2
                 ENVINT_2:
000561 dff8      	RCALL 		R_BUSY
000562 98ad      	CBI   		PORTC, lcd_rs		; en instruccion a 0
                 
                 ENV1_2:   
000563 9aaa      	SBI   		PORTC, LCD_E2		; activa enable
000564 bb0b      	OUT   		PORTA,R16   		; ponemos el byte de TEXTO 
000565 e590      	LDI   		R25,80      		; retardo total 230 us
000566 940e 092a 	CALL 		RETARDO   			; 
000568 98aa      	CBI   		PORTC,LCD_E2   		; STROBE=0 dato valido
000569 9508      	RET
                 ; RUTINA VERIFICACION DEL BUSY
                 BUSY_2:
00056a 931f      	PUSH  		R17
00056b 9aaf      	SBI   		PORTC, LCD_RW
00056c 98ad      	CBI	  		PORTC, LCD_RS
00056d 2711      	CLR   		R17
00056e bb1a      	OUT   		DDRA, R17			; PUERTO A COMO SALIDA
00056f bb1b      	OUT   		PORTA, R17			; CON VALOR 1 EN TODAS LAS SALIDAS
                 BUSY1_2:
000570 9aaa      	SBI	  		PORTC, LCD_E2		; activar la lectura
000571 0000      	NOP
000572 b319      	IN    		R17, PINA			; lee el valor del puerto a y lo almacena en r17
000573 7810      	ANDI  		R17, 0b10000000		; poner todos a cero menos el bit 7
000574 98aa      	CBI	  		PORTC, LCD_E2		
000575 3010      	CPI	  		R17, 0B00000000		; VERIFICA SI ESTA OCUPADO EL DISPLAY
000576 f7c9      	BRNE  		BUSY1_2				; SI ESTA OCUPADO SIGUE ESPERANDO
000577 ef1f      	SER   		R17					; PONE R16 TODO A 1
000578 bb1a      	OUT   		DDRA, R17			; PUERTO A COMO SALIDA
000579 bb1b      	OUT   		PORTA, R17			; CON VALOR 1 EN TODAS LAS SALIDAS
00057a 9aad      	SBI   		PORTC, LCD_RS
00057b 98af      	CBI   		PORTC, LCD_RW	
00057c 911f      	POP   		R17
00057d 9508      	RET
                 .INCLUDE "EEPROMRW.ASM"
                 
                 ; LA DIRECION EN R16 (HIGH) Y R17 (LOW); R16 ES PARA ACADER A LA PARTE ALTA DE DE LA EEPROM
                 ; NO ES NECESARIO PONER EL VALOR SE PONE UN 0 PARA ACEDER A LOS PROMEROS 256 BITS
                 EEPROM_RW:	
00057e 99e1      	SBIC				EECR,EEWE	
00057f cffe      	RJMP				EEPROM_RW			; VERIFICA QUE NO ESTA OCUPADA LA EEPROM
                 ;2º PASO ESCRIBIR LA DIRECCION DE LA QUE SE QUIERE LEER EL DATO EN EL REGISTRO EEAR
000580 e000      	LDI					R16,00
000581 bb0f      	OUT					EEARH, R16 	   		; DIRECION $1F
000582 bb1e      	OUT					EEARL, R17 			; DIRECION $1E
                 ;3º ACTIVAR EL BIT DE LECTURA
000583 9ae0      	SBI					EECR, EERE			; BIT DE LECTURA
000584 0000      	NOP
                 ;4º EL DATO SE ENCUENTRA EN EL REGISTRO EEDR Y PASA AL REGISTRO R18
000585 b32d      	IN					R18, EEDR
000586 9508      	RET
                 ; **** RUTINA ESCRIBIR EN EEPROM EN R16(HIG) Y R17(LOW) DIRECION  EN R18 EL DATO **
                 ;  OJO R16 ES PUESTO A CERO EN LA RUTINA SOLO ACEDE A LOS 256 BIT INICIALES
                 ; PASO 1º ESPERAR A QUE EL REGISTRO EEWE DE EECR SEA CERO CONTROL DE EEPRON ($1C)
                 EEPROM_ES:	
000587 99e1      	SBIC				EECR,EEWE	
000588 cffe      	RJMP				EEPROM_ES
                 ; 2 PASO ESCRIBIR LA DIRECCION EN LA QUE ELMACENAR EL DATO 
000589 e000      	LDI					R16,00
00058a bb0f      	OUT					EEARH, R16 	   	
00058b bb1e      	OUT					EEARL, R17 		; DIRECION $1E
                 ; 3 PASO ESCRIBIR EL DATO A ELMACENAR EN EL REGISTRO EEDR
00058c bb2d      	OUT					EEDR, R18 
                 ; 4 PASO Escribir un uno en el bit EEMWE del registro EECR.
00058d 9ae2      	SBI					EECR, EEMWE
                 ; 5 PASO Escribir un uno en el bit EEWE del registro EECR
00058e 9ae1      	SBI					EECR, EEWE
00058f 9508      	RET
                 .INCLUDE "CON_ADC.ASM"
                 
                 RADC:
000590 938f      	PUSH	R24
000591 932f      	PUSH	R18
000592 2411      	CLR   R1
000593 2422      	CLR   R2
000594 2433      	CLR   R3
000595 3684      	CPI   R24, 100
000596 f030      	BRLO  RADC2
000597 9413      	INC   R1
                 RADC1:	
000598 5684      	SUBI  R24, 100 
000599 3684      	CPI   R24, 100
00059a f010      	BRLO  RADC2
00059b 9413      	INC   R1
00059c cffb      	RJMP  RADC1
                 RADC2:
00059d 308a      	CPI   R24, 10
00059e f030      	BRLO  RADC4
00059f 9423      	INC   R2
                 RADC3:
0005a0 508a      	SUBI  R24, 10	
0005a1 308a      	CPI   R24, 10
0005a2 f010      	BRLO  RADC4
0005a3 9423      	INC   R2
0005a4 cffb      	RJMP  RADC3
                 RADC4:
0005a5 2e38      	MOV   R3, R24
0005a6 e320      	LDI   R18, 48
0005a7 0e12      	ADD   R1, R18
0005a8 0e22      	ADD   R2, R18
0005a9 0e32      	ADD   R3, R18
0005aa 1521      	CP			R18, R1		; COMPARA PARA VER SI ES CERO Y ELIMINARLO PONIENDO UN ESPACIO EN BLANCO
0005ab f411      	BRNE		RADC5  		; SI NO ES CERO SALTA A RADC5
0005ac e220      	LDI			R18, 32		; CARGA EL CODIGO DEL ESPACIO PARA
0005ad 2e12      	MOV			R1, R18		; PASARLO A R1
                 RADC5:
0005ae 912f      	POP		 R18
0005af 918f      	POP		R24
0005b0 9508      	RET
                 ; PARA CONVERTIR EL REDOX EMPIEZA EN 500
                 
                 RADC5I:
0005b1 938f      	PUSH	R24
0005b2 2411      	CLR		R1
0005b3 2422      	CLR		R2
0005b4 2433      	CLR		R3
0005b5 3184      	CPI		R24, 20
0005b6 f030      	BRLO	RADC52
0005b7 9413      	INC		R1
                 RADC51:	
0005b8 5184      	SUBI	R24, 20 
0005b9 3184      	CPI		R24, 20
0005ba f010      	BRLO	RADC52
0005bb 9413      	INC		R1
0005bc cffb      	RJMP	RADC51
                 RADC52:
0005bd 3082      	CPI			R24, 2
0005be f030      	BRLO		RADC54
0005bf 9423      	INC			R2
                 RADC53:
0005c0 5082      	SUBI		R24, 2	
0005c1 3082      	CPI			R24, 2
0005c2 f010      	BRLO		RADC54
0005c3 9423      	INC			R2
0005c4 cffb      	RJMP		RADC53
                 RADC54:
0005c5 3081      	CPI			R24,1
0005c6 f028      	BRLO		RADC56
0005c7 9433      	INC			R3
0005c8 9433      	INC			R3
0005c9 9433      	INC			R3
0005ca 9433      	INC			R3
0005cb 9433      	INC			R3
                 
                 
                 RADC56:
0005cc e320      	LDI   		R18, 48
0005cd 0e12      	ADD   		R1, R18
0005ce 0e22      	ADD   		R2, R18
0005cf 0e32      	ADD  		R3, R18
0005d0 918f      	POP			R24
                 
0005d1 9508      	RET
                 
                 
                 
                 .INCLUDE "COMPARA.ASM"
                 
                 ; SI R18 ES MAYOR QUE R25 EL BIT CERO DEL REGISTRO CONTROL (R20)ES PUESTO A 1 EN CASO CONTRARIO A CERO
                 
                 COMP:
0005d2 932f      	PUSH		R18						; SALVA EL REGISTRO EN LA PILA
0005d3 939f      	PUSH		R25
0005d4 fd97      	SBRC		R25, 7					; SI EL BIT 7 ES UNO ES QUE ES MAYOR DE 125 VA A COMP1
0005d5 c00d      	RJMP		COMP1
0005d6 fd27      	SBRC		R18,7  					; SI EL BIT 7 ES CERO SALTA LA SIGUIENTE INSTRUCION SI NO ES QUE ES MAYOR
0005d7 c003      	RJMP		MAYOR
0005d8 1b29      	SUB			R18, R25				; RESTA LOS DOS REGISTROS
0005d9 f40c      	BRGE		MAYOR
0005da c004      	RJMP		MENOR
                 MAYOR:
0005db 6041      	SBR			CONTROL, 0B00000001		; PONE A 1 EL BIT CERO DEL REGISTRO CONTROL PORQUE ES MAYOR R18 QUE R25
0005dc 919f      	POP			R25
0005dd 912f      	POP			R18						; REPONE EL REGISTRO DE LA PILA
0005de 9508      	RET
                 MENOR:
0005df 7f4e      	CBR			CONTROL, 0B00000001		; PONE A CERO EL BIT CERO PORQUE ES MEDOR R18 QUE R25
0005e0 919f      	POP			R25
0005e1 912f      	POP			R18
0005e2 9508      	RET
                 ; SI R25 ES MAYOR DE 127 ( EL BIT 7 ES UNO )
                 COMP1:
0005e3 ff27      	SBRS		R18,7					; SI EL BIT 7 ES UNO VA A MENOR
0005e4 cffa      	RJMP		MENOR
0005e5 1b29      	SUB			R18,R25
0005e6 f7a4      	BRGE		MAYOR
0005e7 cff7      	RJMP		MENOR
                 .INCLUDE "CALIBRARSAL.ASM"
                 
                 ; EN ESTA RUTINA ESTA EL CONTROL DE LA PANTALLA
                 
                 PRO6:	; PARA AJUSTAR LA SAL DEL AGUA
                 ;CALL CONTROL_POL		; PONE LA POLARIDAD BUENA EN EL CASO DE ESTAR EN LA MALA
0005e8 d05c      	RCALL			CAL_TECLA			; PROGRAMA PANTALLA CALIBRACCION
0005e9 91e0 020d 	LDS				R30, RAMC_SAL		; VALOR PARA EL CALIBRADO DE LA CONCENTRACION DE SAL
0005eb e060      	LDI				R22, 00
0005ec 2477      	CLR				R7					; PONE A CERO EL RETARDO SALIDA TECLADO
                 PRO6A:
0005ed e220      	LDI				R18,32				; APAGA EL DIGITO SAL
0005ee 9320 0905 	STS				$905,R18			; PONE EN PANTALLA EL VALOR CALIBRADO DE LA SAL UNIDADES
0005f0 9320 0907 	STS				$907,R18			; PONE EN PANTALLA EL VALOR CALIBRADO DE LA SAL DECIMAS
0005f2 d052      	RCALL			CAL_TECLA
                 PRO6B:			; TIEMPO DIGITO APAGADO
0005f3 306c      	CPI				R22,RETARDO3		; VALOR DEL TIEMPO DE RATARDO LECTURA DEL TECLADO DIGITO APAGADO
0005f4 f3f0      	BRLO			PRO6B				; COMPRUEBA EL TIEMPO DE RETARDO 
                 
0005f5 940e 0300 	CALL			ENCENDER_FUENTE
0005f7 940e 091d 	CALL			LEDPANT
0005f9 95a8      	WDR
                 	; VALOR DE MEDICION TOTAL SAL	********************* PONER UN VALOR FIJO
                 
0005fa e400      	LDI				R16,0x40			; SE PONE UN VALOR FIJO PARA MEDIR LA SAL
0005fb 9300 0087 	STS				OCR3AH,R16
0005fd e400      	LDI				R16,0x40
0005fe 9300 0086 	STS				OCR3AL,R16	
                 
000600 e026      	LDI				R18, P_SAL			; LINEA DE ENTRADA EN EL CONVERTIDOR PCF8591
000601 2fae      	MOV				R26, R30			; NUMERO DE LECTURAS Ó CALIBRACION
                 ;SUBI			R26,6					; PARA AJUSTAR CON LA RUTINA MEDICION DE SAL
                 
000602 940e 013c 	CALL			ADC_P
                 ;	LDS				R18,RAM_MED_INI_SAL	; CARGA EL ERROR INICIAL DEL TLC26 EN R18
                 ;	SUB				R24,R18				; RESTA EL ERROR INICIAL DE LA MEDICION
000604 940e 0590 	CALL			RADC
000606 9380 020c 	STS				RAM_SAL, R24		; ALMACENA LA MEDICION EN LA MEMORIA RAM
000608 9220 0905 	STS				$905,R2				; PONE EN PANTALLA EL VALOR CALIBRADO DE LA SAL UNIDADES
00060a 9230 0907 	STS				$907,R3				; PONE EN PANTALLA EL VALOR CALIBRADO DE LA SAL DECIMAS
00060c d038      	RCALL			CAL_TECLA
                 PRO6C:
00060d 316a      	CPI				R22,RETARDO2		; VALOR DEL TIEMPO DE RATARDO LECTURA DEL TECLADO DIGITO ENCENDIDO
00060e f320      	BRLO			PRO6B				; COMPRUEBA EL TIEMPO DE RETARDO 
                 
                 	; VALOR DE MEDICION 	
00060f 95a8      	WDR
                 ;	LDI				R18, P_SAL			; LINEA DE ENTRADA EN EL CONVERTIDOS PCF8591
                 ;	LDI				R26, 231			; NUMERO DE LECTURAS Ó CALIBRACION
                 ;	CALL			ADC_P
                 
                 ;	STS				RAM_SAL_C, R24
                 ;	LDI				R16, 216			; PARA INVERTIR EL VALOR DEL PH
                 ;	SUB				R16, R24			; Y RESTANDOLO DEL LEIDO			
                 ;	LDS				R19, RAMC_PH		; LEE EL VALOR DE CALIBRACION Y
                 ;	ADD				R16, R31			; EL VALOR DE CALIBRACION
                 ;	STS				RAM_PH, R16			; GRABA EL VALOR EN RAN EN RAM
000610 e060      LDI R22,00						; reatardo lectura de las valores pues es muy rapido r22 = 20 linea 10  
000611 deae      	RCALL			LEC_TEC
000612 3f1d      	CPI				R17, 0B11111101		; TECLA - BAJA EL VALOR
000613 f051      	BREQ			BAJAR_SAL
000614 3e1f      	CPI				R17, 0B11101111		; TECLA + INCREMENTA EL VALOR
000615 f089      	BREQ			SUBIR_SAL
000616 371f      	CPI				R17, 0B01111111		; TECLA 7 SALIR GRABA LOS VALORES Y TERMINA
000617 f109      	BREQ			SALIR_SAL
                 
000618 3f1b      	CPI				R17, 0B11111011		; TECLA FLECHA GRABA Y VA A CALIBRACION DE PH
000619 f0b1      	BREQ			SALIR_SAL1
00061a 2d87      	MOV				R24, TEMP_TEC
00061b 3382      	CPI				R24, 50				; PARA COMPARARLO CON EL RETARDO SIN PULSAR TECLA
00061c f4e2      	BRPL			SALIR_SAL			; Y SALIR DE PROGRAMACION DE PARAMETROS
00061d cfcf      	RJMP			PRO6A
                 
                 ; AJUSTE CALIBRACION CONCENTRACION DE SAL
                 BAJAR_SAL:
00061e 2477      	CLR				R7					; PONE A CERO EL RETARDO SALIDA TECLADO
00061f 95ea      	DEC				R30
000620 95ea      	DEC				R30
000621 95ea      	DEC				R30
000622 e060      	LDI				R22,00
000623 33e2      	CPI				R30, 50
000624 f408      	BRBC			0, BAJAR_SAL1 
000625 e3e2      	LDI				R30, 50
                 BAJAR_SAL1:
000626 cfc6      	RJMP			PRO6A
                 SUBIR_SAL:
000627 2477      	CLR				R7					; PONE A CERO EL RETARDO SALIDA TECLADO
000628 95e3      	INC				R30
000629 95e3      	INC				R30
00062a 95e3      	INC				R30	
00062b e060      	LDI				R22,00
00062c 3de2      	CPI				R30, 210			; VALOR MAXIMO DE NUMERO DE VECES DE LECTURA.
00062d f008      	BRBS			0, SUBIR_SAL1		; SI MAYOR SALTA A SUBIR_PH1 Y PONE R31 CON EL VALOR MAZIMO
00062e ede2      	LDI				R30,210
                 SUBIR_SAL1:
00062f cfbd      	RJMP			PRO6A
                 SALIR_SAL1:  ; GRABA LOS NUEVOS VALORES Y VA A CALIBRAR PH
000630 93e0 020d 	STS				RAMC_SAL, R30		; VALOR PARA EL CALIBRADO DE LA CONCENTRACION DE SAL
000632 e016      	LDI				R17, SAC_MEN		; POSICION DE MEMORIA A ESCRIBIR EN EEPROM $005
000633 2f2e      	MOV				R18, R30 
000634 df52      	RCALL			EEPROM_ES			; GRABA EN EEPROM EL VALOR DE LA NUEVA CALIBRACCION
000635 d2e7      	RCALL			LEDPANT				; ACTUALIZAR LOS LED DE LA PANTALLA	
                 ;CALL GRABA_SAL
                 
                 ;STS	SAL_ELECTRODO,R30	
000636 d348      	RCALL			NO_TECLA			; PARA ESPERAR A QUE SE SUELTE LA TECLA SALIR
000637 940c 065e 	JMP				PRO7
                 SALIR_SAL:  ; SALE Y GRABAR LOS VALORES
000639 93e0 020d 	STS				RAMC_SAL, R30		; VALOR PARA EL CALIBRADO DE LA CONCENTRACION DE SAL
00063b e016      	LDI				R17, SAC_MEN		; POSICION DE MEMORIA A ESCRIBIR EN EEPROM $005
00063c 2f2e      	MOV				R18, R30 
00063d df49      	RCALL			EEPROM_ES			; GRABA EN EEPROM EL VALOR DE LA NUEVA CALIBRACCION
00063e 2d0f      	MOV				R16, VAL_LED		;APAGA LUZ PANTALLA
00063f 7b0f      	ANDI			R16, 0B10111111
000640 2ef0      	MOV				VAL_LED, R16
000641 d2db      	RCALL			LEDPANT				; ACTUALIZAR LOS LED DE LA PANTALLA	
                 ;CALL GRABA_SAL
                 ;LDI	R30,00
                 ;STS	SAL_ELECTRODO,R30	
000642 940e 097f 	CALL			NO_TECLA
000644 9508      	RET
                 
                 ; linea 1-128
                 ; linea 2-192
                 ; linea 3-148
                 ; linea 4-212
                 
                 
                 CAL_TECLA:		; PRESENTA LA PANTALLA DE CALIBRACCION DE VALOES
                 
                 ;***********************OJO PARA EVITAR QUE SALGA DE CALIBRACION***************
                 ;LDI R16,00
                 ;MOV TEMP_TEC,R16
                 
                 
                 					; CALIBRACION DE SAL
000645 e800      	LDI				R16, 128		; 11000000 escribir en linea 2 linea (192)
000646 def7      	RCALL			ENVINT
000647 e0d8      	LDI				YH,HIGH(CAL_SAL); POSICION ALTA DEL TAXTO EN RAM 080
000648 efc8      	LDI				YL,LOW (CAL_SAL); direccion BAJA DEL TEXTO EN RAM      	
000649 e114        	LDI				R17,20 			; bytes a enviar 
00064a d2da      	RCALL			ENVIARTEXTO		; RUTINA PARA ENVIAR TEXTO E PANTALLA
                 					; CALIBRACCION DE PH
                 
00064b ec00      	LDI				R16, 192		; 11000000 escribir en linea 2 linea (192)
00064c def1      	RCALL			ENVINT
00064d e0d9      	LDI				YH,HIGH (CAL_PH); POSICION ALTA DEL TAXTO EN RAM 080
00064e e0cc      	LDI				YL,LOW  (CAL_PH); direccion BAJA DEL TEXTO EN RAM      	
00064f e114        	LDI				R17,20 			; bytes a enviar 
000650 d2d4      	RCALL			ENVIARTEXTO		; RUTINA PARA ENVIAR TEXTO E PANTALLA
                 					;CALIBRACION  DE REDOX
                 
000651 e904      	LDI				R16, 148		; ESCRIBIR LINEA 3
000652 deeb      	RCALL			ENVINT
000653 e0d9      	LDI				YH,HIGH (CAL_RD); POSICION ALTA DEL TAXTO EN RAM 080
000654 e2c0      	LDI				YL,LOW  (CAL_RD); direccion BAJA DEL TEXTO EN RAM      	
000655 e114        	LDI				R17,20 			; bytes a enviar 
000656 d2ce      	RCALL			ENVIARTEXTO		; RUTINA PARA ENVIAR TEXTO E PANTALLA
                 
                 					; CALIBRACION DE CLORO
000657 ed04      	LDI				R16, 212		; 11000000 escribir en linea 2 linea (192)
000658 dee5      	RCALL			ENVINT
000659 e0d9      	LDI				YH,HIGH (CAL_CL); POSICION ALTA DEL TAXTO EN RAM 080
00065a e3c4      	LDI				YL,LOW  (CAL_CL); direccion BAJA DEL TEXTO EN RAM      	
00065b e114        	LDI				R17,20 			; bytes a enviar 
00065c d2c8      	RCALL			ENVIARTEXTO		; RUTINA PARA ENVIAR TEXTO E PANTALLA
                 ; AQUI ENVIA UN RETORNO DE CARRA ALA UART 0 Y 1
                 
                 
                 
00065d 9508      	RET
                 .INCLUDE "CALIBRAR_PH.ASM"
                 
                 ; EN ESTA RUTINA ESTA EL CONTROL DE LA PANTALLA
                 ; LINEA DE CONTROL "CONTROL.4!
                 PRO7:	; CALIBRAR EL PH
00065e ff44      	SBRS			CONTROL,4			; SALTA LA PROXIMA INSTRUCION SI ES UNO,
00065f 940c 05e8 	JMP				PRO6				; VA A CALIBRAR SAL OTRA VEZ
000661 91e0 0202 	LDS				R30, RAMC_PH		; VALOR PARA EL CALIBRADO DE LA CONCENTRACION DE SAL
000663 e060      	LDI				R22, 00
000664 2477      	CLR				R7					; PONE A CERO EL RETARDO SALIDA TECLADO
                 PRO7A:
000665 e060      	LDI				R22,00
000666 e220      	LDI				R18,32				; APAGA EL DIGITO SAL
000667 9320 0918 	STS				$918,R18
000669 9320 0919 	STS				$919,R18			; PONE EN PANTALLA EL VALOR CALIBRADO DE LA SAL UNIDADES
00066b 9320 091b 	STS				$91B,R18			; PONE EN PANTALLA EL VALOR CALIBRADO DE LA SAL DECIMAS
00066d dfd7      	RCALL			CAL_TECLA
                 PRO7B:			; TIEMPO DIGITO APAGADO
00066e 306c      	CPI				R22,RETARDO3		; VALOR DEL TIEMPO DE RATARDO LECTURA DEL TECLADO
00066f f3f0      	BRLO			PRO7B				; COMPRUEBA EL TIEMPO DE RETARDO 
000670 940e 091d 	CALL			LEDPANT
000672 95a8      	WDR
                 	; VALOR DE MEDICION TOTAL PH	
000673 e023      	LDI				R18, P_PH			; LINEA DE ENTRADA EN EL CONVERTIDOR PCF8591
000674 eea7      	LDI				R26, 231			; NUMERO DE LECTURAS Ó CALIBRACION
000675 940e 013c 	CALL			ADC_P
                 			; RESTA EL ERROR INICIAL DE LA MEDICION
                 
                 
                 
000677 ed08      	LDI				R16, 216			; RESTA 10 PARA LUEGO SUMARLE LA CALIBRACION ENTRE 0 Y 20
000678 1b08      	SUB				R16, R24			; Y RESTANDOLO DEL LEIDO			
000679 2f3e      	MOV				R19, R30			; LEE EL VALOR DE CALIBRACION que suele ser 10
00067a 0f03      	ADD				R16, R19			; SE LA SUMA AL LEIDO
00067b 2f80      	MOV				R24, R16
00067c 9380 0200 	STS				RAM_PH, R24			; ALMACENA LA MEDICION EN LA MEMORIA RAM
00067e 940e 0590 	CALL			RADC
000680 e22e      LDI R18,46		; PONE UN PUNTO 7.4
000681 9320 091a STS $91A,R18
000683 9210 0918 	STS				$918,R1
000685 9220 0919 	STS				$919,R2				; PONE EN PANTALLA EL VALOR CALIBRADO DE LA SAL UNIDADES
000687 9230 091b 	STS				$91B,R3				; PONE EN PANTALLA EL VALOR CALIBRADO DE LA SAL DECIMAS
000689 dfbb      	RCALL			CAL_TECLA
                 PRO7C:
00068a 316a      	CPI				R22,RETARDO2				; VALOR DEL TIEMPO DE RATARDO LECTURA DEL TECLADO
00068b f310      	BRLO			PRO7B				; COMPRUEBA EL TIEMPO DE RETARDO 
                 ; TECLA 0 PROGRAMAR
                 ; TECLA 1 MENOS
                 ; TECLA 2 FLECHA
                 ; TECLA 3 CALIBRAR
                 ; TECLA 4 MAS
                 ; TECLA 5 
                 ; TECLA 6 NIVEL ACIDO
                 ; TECLA 7 SALIR
                 	; VALOR DE MEDICION 	
00068c 95a8      	WDR
00068d e060      	LDI				R22,00				; reatardo lectura de las valores 
00068e de31      	RCALL			LEC_TEC
00068f 3f1d      	CPI				R17, 0B11111101		; TECLA - BAJA EL VALOR
000690 f061      	BREQ			BAJAR_PH
000691 3e1f      	CPI				R17, 0B11101111		; TECLA + INCREMENTA EL VALOR
000692 f091      	BREQ			SUBIR_PH
000693 371f      	CPI				R17, 0B01111111		; TECLA 7 SALIR VA A CALIBRACION REDOX
000694 f141      	BREQ			SALIR_PH1
000695 3f1b      	CPI				R17, 0B11111011		; TECLA FLECHA GRABA Y VA A CALIBAR EDOX
000696 f0e9      	BREQ			SALIR_PH
000697 2d87      	MOV				R24, TEMP_TEC
000698 3382      	CPI				R24, 50				; PARA COMPARARLO CON EL RETARDO SIN PULSAR TECLA
000699 f51a      	BRPL			SALIR_PH1			; Y SALIR DE PROGRAMACION DE PARAMETROS
                 
00069a 3e17      	CPI				R17, 0B11100111		; PONER EL VALOR POR DEFECTO DEL PH 140
00069b f081      	BREQ			CALI_PH
                 
                 
00069c cfc8      	RJMP			PRO7A
                 BAJAR_PH:
00069d 2477      	CLR				R7					; PONE A CERO EL RETARDO SALIDA TECLADO
00069e 95ea      	DEC				R30
00069f e060      	LDI				R22,00
0006a0 30e2      	CPI				R30, 2
0006a1 f410      	BRBC			0, BAJAR_PH1 
0006a2 e0e2      	LDI				R30, 2
0006a3 cfc1      	RJMP			PRO7A
                 BAJAR_PH1:
0006a4 cfc0      	RJMP			PRO7A
                 SUBIR_PH:
0006a5 2477      	CLR				R7					; PONE A CERO EL RETARDO SALIDA TECLADO
0006a6 95e3      	INC				R30
0006a7 e060      	LDI				R22,00
0006a8 31e6      	CPI				R30, 22				; MINUTOS POR CICLO ( INVIERTE)
0006a9 f008      	BRBS			0, SUBIR_PH1		; SI MAYOR SALTA A SUBIR_PH1 Y PONE R31 CON EL VALOR MAZIMO
0006aa e1e6      	LDI				R30,22
                 SUBIR_PH1:
0006ab cfb9      	RJMP			PRO7A
                 CALI_PH:
0006ac e0ea      	LDI				R30,10				; VALOR DE FABRICA PARA CALIBRAR PH
0006ad 93e0 0202 	STS				RAMC_PH, R30		; VALOR PARA EL CALIBRADO DE LA CONCENTRACION DE SAL
0006af e015      	LDI				R17, PHC_MEN		; POSICION DE MEMORIA A ESCRIBIR EN EEPROM $005
0006b0 2f2e      	MOV				R18, R30 
0006b1 ded5      	RCALL			EEPROM_ES	
0006b2 d2cc      	RCALL			NO_TECLA
0006b3 cfb1      	RJMP			PRO7A
                 SALIR_PH:  ; GRABA LOS NUEVOS VALORES Y VA A CALIBRAR REDOX
0006b4 93e0 0202 	STS				RAMC_PH, R30		; VALOR PARA EL CALIBRADO DE LA CONCENTRACION DE SAL
0006b6 e015      	LDI				R17, PHC_MEN		; POSICION DE MEMORIA A ESCRIBIR EN EEPROM $005
0006b7 2f2e      	MOV				R18, R30 
0006b8 dece      	RCALL			EEPROM_ES			; GRABA EN EEPROM EL VALOR DE LA NUEVA CALIBRACCION
0006b9 d263      	RCALL			LEDPANT				; ACTUALIZAR LOS LED DE LA PANTALLA	
0006ba d2c4      	RCALL			NO_TECLA			; PARA ESPERAR A QUE SE SUELTE LA TECLA SALIR
0006bb 940c 1201 	JMP				PRO8
                 SALIR_PH1:  ; GRABA LOS VALORES Y TERMINA
0006bd 93e0 0202 	STS				RAMC_PH, R30		; VALOR PARA EL CALIBRADO DEL PH
0006bf e015      	LDI				R17, PHC_MEN		; POSICION DE MEMORIA A ESCRIBIR EN EEPROM $005
0006c0 2f2e      	MOV				R18, R30 
0006c1 dec5      	RCALL			EEPROM_ES			; GRABA EN EEPROM EL VALOR DE LA NUEVA CALIBRACCION
0006c2 2d0f      	MOV				R16, VAL_LED		;APAGA LUZ PANTALLA
0006c3 7b0f      	ANDI			R16, 0B10111111
0006c4 2ef0      	MOV				VAL_LED, R16
0006c5 d257      	RCALL			LEDPANT				; ACTUALIZAR LOS LED DE LA PANTALLA	
0006c6 d2b8      	RCALL			NO_TECLA
0006c7 9508      	RET
                 
                 ;.INCLUDE "CALIBRACION_CL.ASM"
                 .INCLUDE "PCF8591.ASM"
                 
                 
                 
                 PCF2_T:  ;LEE LA TEMPERATURA Y CONFIGURA LA LINEA DE PRESENTACION
0006c8 9180 020f 	LDS				R24,RAM_TEMP		; LEE LA TEMPERATUTA DE LA RAM
0006ca e300      	LDI				R16,48				; PONE UN 0
0006cb 9300 0660 	STS				0x660,R16			; 20X4 DECIMALES 0 o 5
0006cd 9300 015f 	STS				0x15F,R16
0006cf 9300 073b 	STS				0x73B,R16			; ESCRIBE EN PANTALLA GRAFICA UN 0
0006d1 9586      	LSR				R24					; SI ES PAR
0006d2 f438      	BRCC			PCF3_T				; SALTA SI EL ACARREO ES UNO QUEDA EL CINCO
0006d3 e305      	LDI				R16, 53				; PONE UN CINCO EN LUGAR DEL 0
0006d4 9300 0660 	STS				0x660,R16			; 20X4 DECIMALES 0 o 5
0006d6 9300 015f 	STS				0x15F,R16
0006d8 9300 073b 	STS				0x73B,R16			; ESCRIBE EN PANTALLA GRAFICA
                 PCF3_T:
0006da deb5      	RCALL			RADC
0006db 9220 065d 	STS				0x65D,R2			; ESCRIBE PANTALLA 20X4 SE PRESENTA AL PULSAR SALIR
0006dd 9230 065e 	STS				0x65E,R3			; ESCRIBE PANTALLA 20X4 SE PRESENTA AL PULSAR SALIR
0006df 9220 0738 	STS				0x738,R2			; ESCRIBE EN PANTALLA GRAFICA
0006e1 9230 0739 	STS				0x739,R3			; ESCRIBE EN PANTALLA GRAFICA
0006e3 9220 015c 	STS				0x15C,R2
0006e5 9230 015d 	STS				0x15D,R3
                 ; PARA SUSTITUIR EL VALOR MAXIMO 40 GRADOS POR --.-
0006e7 9120 020f 	LDS				R18,RAM_TEMP
0006e9 e590      	LDI				R25,80
0006ea dee7      	RCALL			COMP
0006eb ff40      	SBRS			CONTROL,0			; VERIFICA SI ES UNO EL BIT 0 SI ES CIERTO SALTA LA SIG. INSTRUCION
0006ec c013      	RJMP			PRO4_T				; POR SI NO HAY SONDA PT1000  O LA TEMP. ES MAYOR DE 25ºC
0006ed e22d      	LDI				R18, 45				; PONE UN - EN LUGAR DE LOS NUMEROS
0006ee 9320 030c 	STS				0x30C,R18
0006f0 9320 030d 	STS				0x30D,R18
0006f2 9320 030f 	STS				0x30F,R18
0006f4 9320 015c 	STS				0x15C,R18
0006f6 9320 015d 	STS				0x15D,R18
0006f8 9320 015f 	STS				0x15F,R18
0006fa 9320 0738 	STS				0x738,R18			; ESCRIBE EN PANTALLA GRAFICA 
0006fc 9320 0739 	STS				0x739,R18			; ESCRIBE EN PANTALLA GRAFICA
0006fe 9320 073b 	STS				0x73B,R18			; ESCRIBE EN PANTALLA GRAFICA
                 PRO4_T:
000700 9508      	RET
                 
                 
                 INT_0:
000701 9518      	RETI
                 INT_1:
000702 9518      	RETI
                 INT_2:
000703 9518      	RETI
                 INT_3:
000704 9518      	RETI
                 INT_4:
000705 9518      	RETI
                 INT_5:
000706 9518      	RETI
                 INT_6:
000707 9518      	RETI
                 INT_7:
000708 9518      	RETI
                 TIMER2_COM:
000709 9518      	RETI
                 TIMER2_OVF:
00070a 9518      	RETI
                 TIMER1_CAPT:
00070b 9518      	RETI
                 TIMER1_COMPA:
00070c b6af      	IN				R10,SREG
00070d 92af      	PUSH			R10
00070e 931f      	PUSH			R17
00070f e010      	LDI				R17, 00
000710 bd1c      	OUT				TCNT1L,R17		
000711 bd1d      	OUT				TCNT1H,R17
000712 9473      	INC				temp_tec
000713 9573      	INC				LEC_REL				; INCREMENTA LOS SEGUNDOS DEL RELOJ
000714 9468      	SET									; PONE A 1 EL REGISTRO T DE SREG
000715 f8b0      	BLD				CONTROL_1,0			; LINEA DE CONTROL 5 ACTIVADA UNA VEZ POR SEGUNDO
000716 911f      	POP				R17
000717 90af      	POP				R10
000718 beaf      	OUT				SREG,R10
000719 9518      	RETI
                 TIMER1_COMPB:
00071a 9508      	RET
                 TIMER1_OVF:
00071b 9508      	RET
                 TIMER0_COMP:
00071c 9518      	RETI
                 TIMER0_OVF:
00071d b6af      	IN				R10,SREG
00071e 92af      	PUSH			R10
00071f 9563      	INC				R22
000720 90af      	POP				R10
000721 beaf      	OUT				SREG,R10
000722 9518      	RETI
                 SPI_STC:
000723 9518      	RETI
                 USART0_RX:
000724 940e 1ac5 	CALL			BIT_REC_0
000726 9518      	RETI
                 USART0_UDRE:
000727 9518      	RETI
                 USART0_TX:
000728 9518      	RETI
                 ADC_ADC:
000729 9518      	RETI
                 EE_READY:
00072a 9518      	RETI
                 ANALOG_COMP:
                 ;	SBI 			PORTE,7
                 ;	CLR				R16					; APAGA LED 0 FUENTE ENCENDIDA
                 ;	MOV				VAL_LED,R16	
                 ;	CALL			LEDPANT
                 ;	CALL			APAGAR_FUENTE
                 ;	ldi				r16,(1<<SE)       ; ACTIVAR SLEEP 
                 ;	out				MCUCR, r16
                 ;	SLEEP
                 
00072b 9518      	RETI
                 TIMER1_COMPC:
00072c 9518      	RETI
                 TIMER3_CAPT:
00072d 9518      	RETI
                 TIMER3_COMPA:
                 
00072e 9518      	RETI
                 TIMER3_COMPB:
00072f 9518      	RETI
                 TIMER3_COMPC:
000730 9518      	RETI
                 TIMER3_OVF:
000731 9518      	RETI
                 USART1_RX:
000732 940e 1b59 	CALL			BIT_REC_1
000734 9518      	RETI
                 USART1_UDRE:		; RUTINA RECIBE UN DATO TECLA PULSADA
000735 9518      	RETI
                 USART1_TX:
000736 9518      	RETI
                 TWI:
000737 9518      	RETI
                 SPM_RDY:
000738 9518      	RETI
                 
                 
                 RESET:
                 
000739 e100      	LDI				R16,HIGH (PILA)		; Coloca en el start point de 16 bits la 
00073a bf0e      	OUT				SPH,R16 			; direcion de inicio para las interrupciones
00073b ef1f      	LDI				R17,LOW (PILA)		; y uso de las instruciones PUHS y POP      
00073c bf1d      	OUT				SPL,R17 
                 
                 
                 
                 ;*********INICIALIZAR PANTALLA //////////////
                 
00073d ef9a      	LDI   R25, 250			; CICLO DE 250 us A 4Mhz x 100 = 0,025 seg
00073e d1eb      	RCALL RETARDO
                 ;CALL BORRA_EEPROM		; BORRA LA EEPROM INTERNA DEL MICRO
                 
00073f 940e 0fd4 	CALL			INI_ATMEGA64 		; INICIALIZAR PARAMETROS
                 ;call PRU1		; RUTINA PARA ESCRIBIR EN FLASH
000741 24bb      CLR R11
                 ;*********************** RETARDO ERROR  PANTALLA **********************
                 
                 
000742 ef0f      	SER				R16
000743 2ef0      	MOV				VAL_LED,R16
000744 d1d8      	RCALL			LEDPANT
000745 da2e      	RCALL 			INI_PANTALLA		; LLAMA A LA RUTINA PARA INICIAR LA PANTALLA
000746 dae3      	RCALL			INI_PANTALLA_2		; INICIALIZA PANTALLA2
000747 da4c      	RCALL			INI_PANTALLA1		; RUTINA PRESENTACION DE DATOS
000748 940e 0f21 	CALL			INI_LCD_2			; CARGO EL TEXTO DE LA PANTALL 2
                 ;JMP			BIT_REC
                 ;CALL		BIT_REC_1				; RECIBE 3 BITS
00074a 940e 19e3 	CALL			DES_ELECTRODO		; CALCULA EL DESGASTE DEL ELECTRODO
00074c e070      	LDI   			LEC_REL,00			; PONE A CERO EL CONTADOR DEL RELOJ	
                 
                 
                 RET1:
00074d 3072      	CPI	  			LEC_REL,2			; VALOR DEL TIEMPO DE RATARDO PRESENTACION
00074e f3f0      	BRLO  			RET1				; COMPRUEBA EL TIEMPO DE RETARDO SI ES MENOR DE 2 A RET1
00074f e0d5      	LDI   			YH,high(LIN_2S)		; direccion alta del TEXTO en Ram
000750 e9cc      	LDI   			YL,low (LIN_2S)		; direccion baja del TEXTO en Ram 
                 ;	RCALL			UART_INI
000751 e372      	LDI				LEC_REL,50			; VALOR INICIAL RETARDO DE ENCENDIDO
000752 e393      	LDI				R25,51				;Valor para configurar 9600BPS A 8MH de la UART 51para 11.059 71
000753 e040      	LDI				CONTROL,0
                 ; PARAMETROS INICIALES LECTURA DEL PORCENTAJE DE PRODUCION EN CASO DE CUBIERTA CERRADA
000754 e214      	LDI 			R17,RE_PRO
000755 940e 057e 	CALL			EEPROM_RW
000757 9320 0212 	STS				RAM_PRO_PRO,R18
                 ; ACTIVACION DE LA BOMBA DE APOYO PARA CLORO Y REDOX
000759 e610      	LDI				R17,apoyo_rd_cl	; POSICION EN EEPROM
00075a de23      	RCALL			EEPROM_RW			; RUTINA DE LECTURA DE EPROM
00075b 3029      	CPI				R18,9				; COMPARA CON 9
00075c f010      	BRLO			RD_CL1				; SI ES MENOR VA A RD_CL1
00075d e028      	LDI				R18,8
00075e de28      	RCALL			EEPROM_ES			; ACTUALIZA LA EEPROM CON 4
                 RD_CL1:
00075f 9320 0216 	STS				ram_rd_cl,R18		; PASA A RAM EL VALOR
                 
                 ; PARAMETROS NUMERO DE CICLOS PARA LA INVERSION
000761 e218       	LDI				R17, ciclos_minuto	; POSICION DEL PH PROGRAMADO EN EEPROM $000
                 ;	RCALL			I2CL_2404			; A LA RUTINA DE LECTURA DE LA EEPROM
000762 de1b      	RCALL			EEPROM_RW			; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
000763 3025      	CPI				R18,5				; COMPARA CON 5 SI ES MAYOR RECTIFICA EL VALOR
000764 f010      	BRLO			SALTA_1
000765 e024      	LDI				R18,4				; Y PONE 4 NUEVA ORDEN SON 2 ****************************************
000766 2f32      	MOV				R19,R18
                 SALTA_1:
000767 9320 0214 	STS				RAM_CICLOS,R18
000769 e330      	LDI				R19,48
00076a 0f32      	ADD				R19,R18
00076b 9330 09aa 	STS				0x9AA,R19
00076d e218      	LDI				R17,CICLOS_MINUTO
00076e de18      	RCALL			EEPROM_ES			; ACTUALIZA LA EEPROM CON EL VALOR INICIAL
00076f e310      	LDI				R17,EE_CICLOS
000770 0f12      	ADD				R17,R18
000771 940e 057e 	CALL			EEPROM_RW
000773 9523      	INC				R18
000774 3c28      	CPI				R18,200			; SI ES MAYOR DE 200 PONE EL REGISTRO A CERO
000775 f418      	BRBC			0,SALTA2			; Y SALTA A 2 PORA INCREMENTAR EL SEGUNDO REGISTRO
000776 940e 0587 	CALL			EEPROM_ES
000778 c00a      	RJMP			SALTA3
                 SALTA2:
000779 e020      	LDI				R18,0				; GRABA CERO 
00077a 940e 0587 	CALL			EEPROM_ES
00077c e130      	LDI				R19,16
00077d 0f13      	ADD				R17,R19
00077e 940e 057e 	CALL			EEPROM_RW			; LEE EL REGISTRO ALTO
000780 9523      	INC				R18					; Y LO INCREMENTA EN 1 UNIDAD
000781 940e 0587 	CALL			EEPROM_ES			; Y LO GRABA
                 
                 
                 SALTA3:
                 ; PARAMETROS INICIALES AJUSTADOS DEL PH
000783 e010       	LDI				R17,PH_MEN			; POSICION DEL PH PROGRAMADO EN EEPROM $000
                 ;	RCALL			I2CL_2404			; A LA RUTINA DE LECTURA DE LA EEPROM
000784 ddf9      	RCALL			EEPROM_RW			; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
000785 e590      	LDI				R25,PH_MAX
000786 de4b      	RCALL			COMP
000787 fd40      	SBRC			CONTROL,0
000788 e42a      	LDI				R18,74
000789 e491      	LDI				R25,PH_MIN
00078a de47      	RCALL			COMP
00078b ff40      	SBRS			CONTROL,0
00078c e42a      	LDI				R18,74				; SI SE MENOR PONE EL PH NORMAL
00078d e010      	LDI				R17,PH_MEN
00078e ddf8      	RCALL			EEPROM_ES			; ACTUALIZA LA EEPROM CON EL VALOR INICIAL
00078f 9320 0201 	STS				RAMP_PH,R18		; GRABAR EN LA MEMORIA RAM EL VALOR PROGRAMADO DEL PH $1D1
                 
                 ; CALIBRACION SONDA DE PH	 VALOR ENTRE 20 Y CERO INICIAL 10
000791 e015      	LDI				R17,PHC_MEN		; POSICION DE MEMORIA A LEER EN EEPROM $005
                 ;	RCALL			I2CL_2404			; A LA RUTINA DE LECTURA DE LA EEPROM
000792 ddeb      	RCALL			EEPROM_RW			; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
000793 e194      	LDI				R25,20
000794 de3d      	RCALL			COMP				; COMPARA R18 CON R25
000795 fd40      	SBRC			CONTROL,0			; VERIFICA SI ES CERO EL BIT 0 SI ES CIERTO SALTA LA SIG. INSTRUCION
000796 e02a      	LDI				R18,10
000797 9320 0202 	STS				RAMC_PH,R18		; VALO CALIBRACION PH $1D2
000799 e015      	LDI				R17,PHC_MEN
00079a ddec      	RCALL			EEPROM_ES			; ACTUALIZA EL VALOR INICIAL DEL PH
00079b e48a      	LDI				R24,74				; VALOR INICIAL DE MEDICION DEL PH
00079c 9380 0200 	STS				RAM_PH,R24			; ALMACENA EN LA MEMORIA RAM EL PH $1D0
                 
                 ; PARAMETROS INICIALES AJUSTE DE LA SAL
                 
                 
                 ; CALIBRACION MEDICION CONCENTRACION DE SAL	NUMERO DE MEDICIONES ENTRE 50 Y 180 EN CASO CONTRARIO PONE 100
00079e e016      	LDI				R17,SAC_MEN			; POSICION DE MEMORIA A LEER EN EEPROM $006
                 ;	RCALL			I2CL_2404			; A LA RUTINA DE LECTURA DE LA EEPROM
00079f ddde      	RCALL			EEPROM_RW			; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
0007a0 ed92      	LDI				R25,210
0007a1 de30      	RCALL			COMP				; COMPARA R18 CON R25
0007a2 fd40      	SBRC			CONTROL,0			; VERIFICA SI ES CERO EL BIT 0 SI ES CIERTO SALTA LA SIG. INSTRUCION
0007a3 eb20      	LDI				R18,176
0007a4 e392      	LDI				R25,50
0007a5 de2c      	RCALL			COMP
0007a6 ff40      	SBRS			CONTROL,0
0007a7 eb20      	LDI				R18,176				; SI SE MENOR PONE EL PH NORMAL
0007a8 e016      	LDI				R17,SAC_MEN
0007a9 dddd      	RCALL			EEPROM_ES			; GUARDA EN EEPROM EL VALOR INICIAL DE 100
0007aa 9320 020d 	STS				RAMC_SAL,R18		; VALOR CALIBRACION SAL $1DD
0007ac eb80      	LDI				R24, 176			; VALOR INICIAL DE MEDICION DE LA SAL
0007ad 9380 020c 	STS				RAM_SAL,R24			; ALMACENA EN LA MEMORIA RAM
0007af 9380 0210 	STS				RAM_SAL_C,R24		; ALMACENA LA MEDICION EN LA MEMORIA RAM
                 
                 ; PARAMETROS INICIALES DE CLORO LIBRE
0007b1 e012      	LDI				R17,CL_MEN			; POSICION DE MEMORIA A LEER EN EEPROM $002
                 ;	RCALL			I2CL_2404			; A LA RUTINA DE LECTURA DE LA EEPROM
0007b2 ddcb      	RCALL			EEPROM_RW			; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
0007b3 e195      	LDI				R25,CL_MAX + 1
0007b4 de1d      	RCALL			COMP
0007b5 fd40      	SBRC			CONTROL,0			; VERIFICA SI ES CERO EL BIT 0 SI ES CIERTO SALTA LA SIG. INSTRUCION
0007b6 e02a      	LDI				R18,10
0007b7 e096      	LDI				R25,CL_MIN
0007b8 de19      	RCALL			COMP
0007b9 ff40      	SBRS			CONTROL,0
0007ba e028      	LDI				R18,8				; SI SE MENOR PONE EL PH NORMAL
0007bb 9320 0206 	STS				RAM_CL,R18			; GRABAR EN LA MEMORIA RAM $1D6
0007bd 9320 0207 	STS				RAMP_CL,R18			; GRABAR EN LA MEMORIA RAM $1D7
                 ; COLOCA EN FORMA DE TEXTO EL VALOR DEL CLORO PROGRAMADO PARA MOSTRARLO EN LA NEXTION
0007bf 2f82      	MOV				R24, R18			; PONE EL VALOR EN R24 PARA CONVERTIRLO EN DECIMAL
0007c0 ddcf      	RCALL			RADC   				; CONVERTIR UN NUMERO EN DIGITOS DATO EN R24
0007c1 9220 0992 	STS				$992, R2			; PONE EL RESULTADO EN PANTALLA DECENAS DE CL
0007c3 e20e      	LDI				R16, 46
0007c4 9300 0993 	STS				$993, R16
0007c6 9230 0994 	STS				$994, R3			; PONE EL RESULTADO EN PANTALLA UNIDADES DE CL
0007c8 95a8      	WDR
                 
                 ; PARAMETROS INICIALES AJUSTE DE LA SONDA DE CLORO LIBRE
0007c9 e014      	LDI				R17,CLC_MEN			; POSICION DE MEMORIA A LEER EN EEPROM $004
                 ;	RCALL			I2CL_2404			; A LA RUTINA DE LECTURA DE LA EEPROM
0007ca ddb3      	RCALL			EEPROM_RW			; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
0007cb ef9a      	LDI				R25,250				; VALOR MAXIMO
0007cc de05      	RCALL			COMP
0007cd fd40      	SBRC			CONTROL,0			; VERIFICA SI ES CERO EL BIT 7 SI ES CIERTO SALTA LA SIG. INSTRUCION
0007ce ec28      	LDI				R18,200				; VALOR ESTANDAR
0007cf e996      	LDI				R25,150				; VALOR MINIMO
0007d0 de01      	RCALL			COMP				; RUTINA COMPARACION
0007d1 ff40      	SBRS			CONTROL,0
0007d2 ec28      	LDI				R18,200				; SI ES MENOR PONE EL NORMAL
0007d3 9320 0208 	STS				RAMC_CL,R18			; GRABA EL VCALOR DE CALIBRACION DEL CLORO $1D8
0007d5 95a8      	WDR
                 
                 ; PARAMETROS INICIALES DEL REDOX programados
0007d6 e013      	LDI				R17,RD_MEN			; POSICION DE MEMORIA A LEER EN EEPROM $003
                 ;	RCALL			I2CL_2404			; A LA RUTINA DE LECTURA DE LA EEPROM
0007d7 dda6      	RCALL			EEPROM_RW			; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
0007d8 ec94      	LDI				R25,RD_MAX	+ 1		; REDOX MAXIMO 170X5=850
0007d9 ddf8      	RCALL			COMP
0007da fd40      	SBRC			CONTROL,0			; VERIFICA SI ES CERO EL BIT 0 SI ES CIERTO SALTA LA SIG. INSTRUCION
0007db e820      	LDI				R18,128				; REDOX PREFIJADO
0007dc e390      	LDI				R25,RD_MIN			; REDOX MINIMO
0007dd ddf4      	RCALL			COMP
0007de ff40      	SBRS			CONTROL,0
0007df e820      	LDI				R18,128				; REDOX PREFIJADO
0007e0 9320 0209 	STS				RAM_RD,R18			; GRABAR EN LA MEMORIA RAM $1D9
0007e2 9320 020a 	STS				RAMP_RD,R18			; GRABAR EN LA MEMORIA RAM $1DA
0007e4 95a8      	WDR
                 ; VALORES DE CALIBRACION DEL REDOX, 230 MEDICIONES
0007e5 e017      	LDI				R17,RDC_MEN			; POSICION DE MEMORIA A LEER EN EEPROM $007
                 ;	RCALL			I2CL_2404			; A LA RUTINA DE LECTURA DE LA EEPROM
0007e6 dd97      	RCALL			EEPROM_RW			; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
0007e7 ef9e      	LDI				R25,254				; VALOR MAXIMO
0007e8 dde9      	RCALL			COMP
0007e9 fd40      	SBRC			CONTROL,0			; VERIFICA SI ES CERO EL BIT 7 SI ES CIERTO SALTA LA SIG. INSTRUCION
0007ea ee2d      	LDI				R18,237				; VALOR ESTANDAR
0007eb ec98      	LDI				R25,200				; VALOR MINIMO
0007ec dde5      	RCALL			COMP				; RUTINA COMPARACION
0007ed ff40      	SBRS			CONTROL,0
0007ee ee2d      	LDI				R18,237				; SI SE MENOR PONE EL NORMAL
0007ef 9320 020b 	STS				RAMC_RD,R18			; GRABA EL VCALOR DE CALIBRACION DEL CLORO $1DB
                 
                 
                 ; parametros iniciales de la producion
0007f1 e011      	LDI				R17,PRO_MEN			; POSICION DE MEMORIA A LEER EN EEPROM $001
                 ;	RCALL			I2CL_2404			; A LA RUTINA DE LECTURA DE LA EEPROM
0007f2 dd8b      	RCALL			EEPROM_RW			; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
0007f3 e695      	LDI				R25,PRO_MAX + 1
0007f4 dddd      	RCALL			COMP
0007f5 fd40      	SBRC			CONTROL,0			; VERIFICA SI ES CERO EL BIT 0 SI ES CIERTO SALTA LA SIG. INSTRUCION
0007f6 e52a      	LDI				R18,90
0007f7 e095      	LDI				R25,PRO_MIN
0007f8 ddd9      	RCALL			COMP
0007f9 ff40      	SBRS			CONTROL,0
0007fa e52a      	LDI				R18,90				; SI SE MENOR PONE EL PH NORMAL
0007fb 9320 0204 	STS				RAM_PRO,R18			; GRABAR EN LA MEMORIA RAM $1D4
0007fd 9320 0205 	STS				RAMP_PRO,R18		; GRABAR EN LA MEMORIA RAM $1D5
0007ff 95a8      	WDR
                 
000800 e080      	LDI				R24,00				; VALOR INICIAL PARA ACTIVAR EL PERRO GUARDIAN
000801 bd81      	OUT				WDTCR,R24			; ACTIVA EL PERRO GUARDIAN
000802 2744      	CLR				CONTROL
000803 9894      	CBI				PORTD,4				; APAGA VENTILADOR Y CONTROL REMOTO
000804 2700      	CLR   			R16
000805 9300 0402 	STS  			seg,R16				; PONE A CERO LOS SEGUNDOS
000807 9300 0401 	STS   			minu,R16			; PONE A CERO LOS MINUTOS
000809 9300 0400 	STS   			hora,R16			; PONE A CERO LAS HORAS
00080b 2ef0      	MOV				VAL_LED,R16
00080c d110      	RCALL			LEDPANT
00080d 9895      	CBI				PORTD,B_ACIDO		; APAGA BOMBA DE ACIDO
                 ; DETECTAR EL CONTROL DE FLUJO
                 ; SE ACTIVA HACIENDO UN PUENTE EN LA CLEMA AL ENCENDER EL EQUIPO
00080e e91d      	LDI				R17,SENSOR_FLUJO	; LEE SI YA TIENE SENSOR DE FLUJO POSICION 09D EN EEPROM
00080f 940e 057e 	CALL			EEPROM_RW
000811 3f2f      	CPI				R18,$FF
000812 f409      	BRNE			SONDA_SI			; SI DISTINTO TIENE SONDA
000813 c006      	RJMP			SONDA_NO
                 SONDA_SI:
000814 94e8      	CLT									; PONE A CERO EL BIT T DE SREG
000815 f8b6      	BLD				CONTROL_1,6			; PASA EL BIT T A CONTROL_1,6 SONDA DE CAUDAL PONE A CERO
000816 e021      	LDI				R18,1
000817 9320 0b04 	STS				FLUJO,R18			; PASA LA SEÑAL UN UNO A REGISTRO DE RS232 QUE ES B04 EN RAM
000819 c010      	RJMP			SONDA_ACT
                 SONDA_NO:		; COMPRUEBA SI TIENE SONDA CONECTADA
00081a 9468      	SET									; PONE A CERO EL BIT T DE SREG
00081b f8b6      	BLD				CONTROL_1,6			; PASA EL BIT A CONTROL_1,6 ANULA SONDA SONDA DE CAUDAL
00081c ef2f      	LDI				R18,$FF
00081d 9320 0b04 	STS				FLUJO,R18			; PASA LA SEÑAL A REGISTRO DE RS232
00081f 990c      	SBIC			PINE,4				; SALTA LA SIGUIENTE INSTRUCCION SI ES UNO  TIENE SONDA
000820 c009      	RJMP			SONDA_ACT			; VA A SIN_SONDA SI ES UNO
000821 e91d      	LDI				R17,sensor_flujo
000822 e021      	LDI				R18,1				; GRABA UN 1 SE ACTIVA LA SONDA DE CAUDAL 
000823 940e 0587 	CALL			EEPROM_ES			; ACTIVA LA DETECCION 
000825 94e8      	CLT			
000826 f8b6      	BLD				CONTROL_1,6			; PASA EL BIT A CONTROL_1,6 SONDA DE CAUDAL
000827 e021      	LDI				R18,1
000828 9320 0b04 	STS				FLUJO,R18			; PASA LA SEÑAL A REGISTRO DE RS232
                 SONDA_ACT:
                 ; OPCION VERANO INVIERNO
00082a e111      	LDI				R17,VER_INV			; POSICION DE MEMORIA A LEER EN EEPROM $1DE
                 ;	RCALL			I2CL_2404			; A LA RUTINA DE LECTURA DE LA EEPROM
00082b dd52      	RCALL			EEPROM_RW			; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
00082c fb20      	BST				R18,0				; ALMACENA EL BIT CERO EN EL REGISTRO T DE SREG
00082d f40e      	BRTC			INVIERNO_A			; SALTA A INVIERNO SI ES CERO
00082e c017      	RJMP			VERANO_A
                 INVIERNO_A:
00082f e310      	LDI				R17,EE_CICLOS
000830 940e 057e 	CALL			EEPROM_RW
000832 9523      	INC				R18
000833 3c28      	CPI				R18,200				; SI ES MAYOR DE 200 PONE EL REGISTRO A CERO
000834 f418      	BRBC			0,SALTA2A			; Y SALTA A 2 PORA INCREMENTAR EL SEGUNDO REGISTRO
000835 940e 0587 	CALL			EEPROM_ES
000837 c00a      	RJMP			SALTA3A
                 SALTA2A:
000838 e020      	LDI				R18,0				; GRABA CERO 
000839 940e 0587 	CALL			EEPROM_ES
00083b e130      	LDI				R19,16
00083c 0f13      	ADD				R17,R19
00083d 940e 057e 	CALL			EEPROM_RW			; LEE EL REGISTRO ALTO
00083f 9523      	INC				R18					; Y LO INCREMENTA EN 1 UNIDAD
000840 940e 0587 	CALL			EEPROM_ES			; Y LO GRABA
                 SALTA3A:
000842 2d0f      	MOV				R16,VAL_LED
000843 6002      	ORI				R16,0B00000010		; ENCIENDE LED VERANO INVIERNO
000844 2ef0      	MOV				VAL_LED,R16
000845 6044      	SBR				CONTROL,0B00000100	; ACTIVA LA SEÑAL DE INVIERNO EN CONTROL
                 VERANO_A:
                 
                 
                 ; OPCION PRODUCION AUTOMATICA O ANULACION DE LA MEDICION DE CLORO Y REDOX
000846 e213      	LDI				R17,PA_PM
000847 940e 057e 	CALL			EEPROM_RW
000849 fb20      	BST				R18,0				; PASA EL REGISTRO 0 DE R18 A T		
00084a f8b2      	BLD				CONTROL_1,2			; PASA EL REGISTRO T DE SREG A CONTROL1_2
                 ; POR ERROR EN EL SIMULADOR DESACTIVA LA PRESENTACION DE AÑADIR SAL
00084b 9468      	SET									; PONE ES REGISTRO T A 0 SET LO PONE A 1
00084c f8b5      	BLD				CONTROL_1,5			; PASA EL REGISTRO T A CONTROL_1
                 ; OPCION INICIO DE POLARIDAD
00084d e110      	LDI				R17,POL_MEN			; POSICION DE MEMORIA A LEER EN EEPROM $1DE
                 ;	RCALL			I2CL_2404			; A LA RUTINA DE LECTURA DE LA EEPROM
00084e dd2f      	RCALL			EEPROM_RW			; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
00084f 9320 020e 	STS				RAM_POL,R18
000851 e110      	LDI				R17,POL_MEN			; POSICION EN EEPROM DE LA POLARIDAD
000852 9120 020e 	LDS				R18,RAM_POL			; VALOR POLARIDAD CICLO ANTEIOR
000854 9523      	INC				R18					; INCREMENTAMOS UNO			
                 ;	RCALL			I2CE_2404			; ESCRIBE EL NUEVO VALOR EN LA EEPRON EXTERNA
000855 dd31      	RCALL			EEPROM_ES
000856 fb20      	BST				R18,0				; ALMACENA EL BIT MENOS IMPORTANTE DE LA MEDICION DEL POLARIDAD EN EL REGISTRO T DE SREG
000857 f41e      	BRTC			RELE_POLARIDAD		; SI ESE BIT ES CERO 
                 ;	BLD				VAL_LED,3			; Y LA PASA AL CONTROL DE POLARIDAD	PARA NO APAGAR EL RELE Y ACTIBAR LED
000858 f8f7      	BLD				VAL_LED,7			; ESTE ES EL LED DE SAL QUE NO VALE PA NA
000859 9a96      	SBI				PORTD,6				; APAGA RELE POLARIDAD 1
00085a c001      	RJMP			REMOTO
                 RELE_POLARIDAD:
00085b 9a97      	SBI				PORTD,7				; APAGA RELE POLARIDAD 0
                 
                 ; TERMINA INICIALIZACION DEL PROCESO ********************************************************/////
                 
                 ; ********* PROGRAMA PRINCIPAL //////////////// AQUI PROGRAMA PRINCIPAL *************************
                 
                 REMOTO:	;*******************SELECIONA LA POLARIDAD MAS EFECTIVA ************************************
                 
00085c 940e 2138 	CALL			CONTROL_ELECTRODO   ;**** UTILIZA R20 QUE ES EL REGISTRO DE CONTROL PRINCIPAL NO IMPORTA
                 ; RETARDO PARA VALENCIA 240 SEGUNDOS
00085e e030      LDI	R19,00
00085f 9330 0b00 STS	0XB00,R19
000861 9330 0b01 STS	0XB01,R19
000863 9330 0b02 STS	0XB02,R19
000865 9330 0b03 STS	0XB03,R19
                 ;STS	0XB04,R19	; NO BORRAR SEÑAL CON SENSOR DE FLUJO
000867 9330 0b05 STS	0XB05,R19
000869 9330 0b06 STS	0XB06,R19
00086b 9330 0b07 STS	0XB07,R19
00086d 9330 0b08 STS	0XB08,R19
00086f 9330 0b09 STS	0XB09,R19
                 
                 ;	LDI				R17, retardo_inicio
                 ;	RCALL			EEPROM_RW			; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
                 ;	CPI				R18, 1				; SI ES UNO VA A RUTINA DE RETARDO
                 ;	BRNE			REMOTO23			; COMO ES DISTINTO VA A REMOTO23
                 ;	CALL			RETARDO240			; RUTINA DE RETARDO240
                 REMOTO23:
000871 98c1      	CBI				PORTB,S_RD_CL		; DESCONECTA EL  APOYO LA BOMBA 1
000872 9468      	SET
000873 f8b4      	BLD				CONTROL_1,4
000874 940e 0a54 	CALL			COMPARA2
000876 e030      	LDI				R19,00
000877 9330 021f 	STS				NCICLOS,R19			; LIMPIA LA POSICION NCICLOS en ram
000879 9330 0401 	STS				MINU,R19
00087b e134      	LDI				R19,20
00087c 2f73      	MOV				LEC_REL,R19
00087d 9bb3      	SBIS			PINB,3				; VERIFICA QUE FUENTE TIENE LA 150 CON PUENTE
00087e 6042      	SBR				CONTROL,0B00000010	; PONE A UNO EL BIT 1 SI HAY PUENTE
00087f 940e 1947 	CALL			MED_INI_SAL			; LEE EL VALOR INICIAL DE LA SAL PARA ELIMINAR EL ERROR
000881 9bb4      	SBIS			PINB,4				; PRINCIPAL O REMOTO salta la siguiente instrucion si es uno
000882 c00a      	RJMP			REMOTO1				; SI HAY PUENTE REMOTO
000883 e02a      	LDI				R18,10				; PONE EL CONTADOR DE SEGUNDOS A 10
000884 9320 0215 	STS				RAM_CAUDAL,R18		; LIMPIA DE SEGUNDOS EL CONTROL DE CAUDAL ENPIEZA EN 10 SEGUNGOS
                 ; LINEA 5 6 Y 7 DEL PUERTO B COMO SALIDA DDRB A CREO PARA ENCENDER LA FUENTE DESDE EL PRINCIPIO
000886 e606      	LDI				R16,0B01100110		; PUERTO 4 REMOTO Y 3 TIPO DE FUENTE COMO ENTRADA SEÑAL
000887 bb07      	OUT   			DDRB,R16			; PUERTO 5 6 Y 7 ENTRADA DEL MESTRO
                 ;CALL			;
                 ;CALL			LEC2D					; PARA ACTUALIZAR HORAS TEMPERATURA Y VIDA DEL ELECTRODO
                 ;CALL			P_NEXTION_TEAP				; ENVIA EL ANAGRAMA PEQUEÑO DE TEAP
000888 940e 1fa9 CALL			P_NEXTION_AC			; ACTUALIZA HORAS, TEMPERATURA Y DESGASTE DEL LECTRODO
                 ; INICIALIZA EL TIMER A USAR EN PWM
                 ;CALL		DC_PWM_0		; ACTIVA PWM TIMER 0 ***********************************************************
                 ;CALL		DC_PWM_2		; ACTIVA PWM TIMER 2 ***********************************************************
00088a 940e 1fce CALL		DC_PWM_3		; ACTIVA PWM TIMER 3 ***********************************************************
                 
00088c c029      	RJMP			PRO					; NO HAY PUENTE PROGRAMA MAESTRO
                 
                 										; PROGRAMA DEL EQUIPO REMOTO
                 REMOTO1: ;CAMBIAMOS EL TEXTO EN LA MEMORIA RAM
                 ;   LDI   			YH,0x01        		; direcion alta donde se pone el texto en RAM
                 ;   LDI   			YL,0xE0      		; direccion baja donde se pone el texto en RAM 
                 ;   LDI   			ZH,high(TEXTO2*2)	; direccion alta del TEXTO en Flash
                 ;   LDI   			ZL,low(TEXTO2*2) 	; direccion baja del TEXTO en Flash 
                 ;   LDI   			R16,48      		; longitud de texto a copiar en RAM
                 ;*** RURINA CARGAR TEXTO DE FLASH A RAM  
                 ;EN Y (YH,YL) POSICION EN RAM
                 ;EN Z (ZH,ZL) POSICION EN FLASH
                 ;EN R16 NUMERO DE LETRAS (BYTS)
                 CARGATEXTO1:
                 ;	LPM      							; leemos TEXTO de FLASH y lo almacena en R0
                 ;	ADIW  			ZL,1   				; apuntamos al siguiente elemento 
                 ;	ST    			Y,R0				; guardamos en RAM POSICION Y EL CONTENIDO DE R0
                 ;	ADIW  			YL,1      			
                 ;	DEC   			R16      			; Hemos terminado..?? 
                 ;	BRNE  			CARGATEXTO1   		; NO...seguimos cargando 
                 ; ELIMINADO PARA NO UTILIZAR LA PANTALLA
00088d e800      	LDI				R16, 128				; 11000000 escribir en linea 2 linea (192)( linea 4 seria 212)
00088e dcaf      	RCALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION, " ESCRIBIR LINEA 2";	LDI				YH, HIGH (E_PROD)	; POSICION ALTA DEL TAXTO EN RAM 080
00088f e0d6      	LDI				YH,HIGH(AVERIA)
000890 ecc8      	LDI				YL,LOW(AVERIA)		; direccion BAJA DEL TEXTO EN RAM  " SIN PRODUCCION 
000891 e110      	LDI				R17,16   			; bytes a enviar 
000892 d092      	RCALL			ENVIARTEXTO			; RUTINA PARA ENVIAR TEXTO E PANTALLA
000893 9895      	CBI				PORTD,B_ACIDO		; APAGA BOMBA DE ACIDO
000894 e007      	LDI				R16,0B00000111		;PUERTO 4 REMOTO Y 3 TIPO DE FUENTE COMO ENTRADA SEÑAL
000895 bb07      	OUT   			DDRB,R16			; PUERTO 5 6 Y 7 ENTRADA DEL MESTRO
000896 ef0f      	LDI				R16,0B11111111		;PUERTO 4 Y 3 COMO ENTRADA SEÑAL PARA EL CONTROL REMOTO		
000897 bb08      	OUT   			PORTB,R16			; Y PUERTO 0 TIPO DE FUENTE
                 ; CONFIGURAR PUERTO E4 COMO ENTRADA DE CONTROL MARCHA PARADA
000898 e000      	LDI				R16,0B00000000
000899 b902      	OUT				DDRE,R16
00089a e100      	LDI				R16,0B00010000		; PUERTO 4 ENTRADA SEÑAL ON OFF
00089b b903      	OUT				PORTE,R16
                 
                 ;	IN				R18,PINB			; VERIFICA LA CONEXION DEL CABLE DE CONTROL
                 ;	CPI				R18,0x0F
                 ;	BRLO			REMOTO2				; SI ES MENOR VA A REMOTO2, CABLE MAL CONESTADO
                 ;	RJMP			CARGATEXTO1
                 REMOTO2:
00089c e800      	LDI				R16,128				; 1ª LINEA DE PANTALLA
00089d dca0      	RCALL			ENVINT				; Y ENVIA EN MANSAJE A PANTALLA 1º INFORMACION DE LINEA Y....
00089e e0d6      	LDI				YH,HIGH(E_REMOTO) 	; TEXTO A ENVIAR A PANTALLA " EQUIPO REMOTO "
00089f e0c0      	LDI				YL,LOW(E_REMOTO) 	; TEXTO A ENVIAR A PANTALLA
0008a0 e114      	LDI				R17,20				; NUMERO DE DIGITOS A ENVIAR A PANTALLA
0008a1 d083      	RCALL			ENVIARTEXTO			;  EL TEXTO 16 CARACTERES
0008a2 d9f9      	RCALL			RELOJ
0008a3 d079      	RCALL			LEDPANT
                 ;	LDS  			R19,minu			; CARGA LOS MINUTOS 
                 ;	CPI				R19,01				; PARA ACTIVAR LA MEDICION DEL PH VARIAS VECES EN EL PRIMER MINUTO
                 ;	BRBS			0, REMOTO2			
                 ;	CPI				R19,100				; COMPARA CON 100 PARA NO ENCENDER LA FUENTE Y PODER INVERTIR LA POLARIDAD
                 ;	BRBC			0, REMOTO2			; SI ES MAYOR NO MIDE NI REDOS NI CLORO SALTA A REMOTO2 y para la fuente
                 ;	RCALL			PRO4				; MEDICION CLORO LIBRE-- ES LA LINEA DE CONTROL REMOTO
                 ;	CALL			PRO_CONTROL			; CONTROL MEDIENTE CABLE PLANO COMO REMOTO
0008a4 9b0c      	SBIS			PINE,4				; AQUI VERIFICA SI ESTA EN MARCHA O PARADO
0008a5 c007      	RJMP			REMOTO2A
0008a6 ec00      	LDI				R16,192				; 11000000 escribir en linea 2 linea (192)( linea 4 seria 212)
0008a7 dc96      	RCALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION, " ESCRIBIR LINEA 2"
0008a8 e0d6      	LDI				YH,HIGH(E_MARCHA)	; POSICION ALTA DEL TAXTO EN RAM 080
0008a9 e1c4      	LDI				YL,LOW(E_MARCHA)	; direccion BAJA DEL TEXTO EN RAM  " EN MARCHA "    	
0008aa 940e 0300 	CALL			ENCENDER_FUENTE
0008ac c006      	RJMP			REMOTO2B
                 REMOTO2A:
0008ad ec00      	LDI				R16,192				; 11000000 escribir en linea 2 linea (192)( linea 4 seria 212)
0008ae dc8f      	RCALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION, " ESCRIBIR LINEA 2"
0008af e0d6      	LDI				YH,HIGH(E_PROD)		; POSICION ALTA DEL TAXTO EN RAM 080
0008b0 e2c8      	LDI				YL,LOW(E_PROD)		; direccion BAJA DEL TEXTO EN RAM  " SIN PRODUCCION "    	
0008b1 940e 02f2 	CALL			APAGAR_FUENTE
                 REMOTO2B:
0008b3 e114       	LDI				R17,20   			; bytes a enviar 
0008b4 d070      	RCALL			ENVIARTEXTO			; RUTINA PARA ENVIAR TEXTO E PANTALLA
0008b5 cfe6      	RJMP			REMOTO2
                 
                 ; LEE LOS AMPERIOS O PRODUCION DE CLORO  "ESTO ESTA ANULADO
                 ;	LDI				R18,P_TCL			; LEE LOS AMPERIOS
                 ;	LDI				R26,110				; NUMERO DE LECTURAS AMPERIOS
                 ;	CALL			ADC_P
                 ;	CPI				R24,4				; MENOS DE 2 PONE UN CERO
                 ;	BRLO			REMOTOB_1
                 ;	RJMP			REMOTOB_2
                 ;REMOTOB_1:
                 ;	LDI				R24,00				; PONE UN CERO
                 ;;REMOTOB_2:
                 ;	LSR				R24
                 ;	CALL			RADC
                 ;	STS				$74B,R2				; PARA PANTALLA 20X4
                 ;	STS				$74C,R3				; PARA PANTALLA 20X4
                 ;	LDI				R16,214				; 11000000 escribir en linea 4, linea 2 ES (192)( linea 4 seria 212)
                 ;	RCALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION, " ESCRIBIR LINEA 2"
                 ;	LDI				YH,HIGH(PRO_CLORO)		; POSICION ALTA DEL TAXTO EN RAM 080
                 ;	LDI				YL,LOW(PRO_CLORO)		; direccion BAJA DEL TEXTO EN RAM  " SIN PRODUCCION "    
                 ;	LDI				R17,20   			; bytes a enviar 
                 ;	RCALL			ENVIARTEXTO			; RUTINA PARA ENVIAR TEXTO E PANTALLA
                 ;	RJMP			REMOTO2				; SALTA A REMORO2
                 							
                 
                 
                 PRO: ; PROGRAMA PRINCIPAL MASTER
                 ;CALL		DC_PWM_0		; ACTIVA PWM TIMER 0 ***********************************************************
                 ;CALL		DC_PWM_2		; ACTIVA PWM TIMER 2 ***********************************************************
                 
0008b6 9468      	SET
0008b7 f8f3      	BLD				VAL_LED,3			; COPIA T DE SREG EN REGISTRO 2 DE LOS LED ES INTERMITENTE
0008b8 d064      	RCALL			LEDPANT
0008b9 95a8      	WDR
0008ba feb0      	SBRS			CONTROL_1,0			; SALTA LA PROXIMA INSTRUCION SI ES UNO,
0008bb cffa      	RJMP			PRO
0008bc 940e 1ff1 CALL		DC_PWM_0A		; ACTIVA PWM TIMER  ***********************************************************
                 ;CALL		SERVO			; CONTROLA UN SERVO CON POT DE Ph
                 ;CALL		MOTOR_PAP
0008be 940e 1aa0 	CALL			UART_INI0			; INICIALIZA PUERTO SERIE 0
                 
                 ;	CALL			UART_INI1			; INICIALIZA PUERTO SERIE 1
0008c0 940e 1dfa 	CALL			INI_NEXTION_P		; NEXTION PANTALLA PRINCIPAL 
                 ;SBRS			LEC_REL,0			; PARA ENVIAR DATOS CADA DOS SEGUDOS	
                 ;	CALL			CADENA_UART			; ENVIAR DATOS AL LOLIN *********************************
0008c2 94e8      	CLT									; PONE A CERO EL BIT T DE SREG
0008c3 f8f3      	BLD				VAL_LED,3			; COPIA T DE SREG EN REGISTRO 2 DE LOS LED ES INTERMITENTE
0008c4 f8b0      	BLD				CONTROL_1, 0		; PASA EL REGISTRO T A CONTROL_1
0008c5 d057      	RCALL			LEDPANT
0008c6 dafc      	RCALL			TECLADO				; LEER TECLADO
                 
                 
                 PRO_1: ; LA CONFIGURACION DE LAS LINEAS EN LA RUTINA "LINEA_PH"
                 
                 ; FRECUENCIA MEDICION DE PH
0008c7 940e 0a03 	CALL			LINEA3
0008c9 d2fc       	RCALL			PRO2				; ESTA RUTINA PARA MEDIR Y CONTROLAR EL PH
0008ca ff44       	SBRS			CONTROL,4			; COMPRUEBA QUE TIENE SONDA DE PH
0008cb c00c      	RJMP			PROA3 				; SI NO TIENE VA A...
                 ; COMPRUEBA QUE TIENE SONDA DE CLORO LIBRE
0008cc fd47      	SBRC			CONTROL, 7 			; COMPRUEBA SI TIENE SONDA DE CLORO LIBRE
0008cd c018      	RJMP			PRO3A_CL			; SI TIENE SALTA A 
0008ce fd46      	SBRC			CONTROL,6			; COMPRUEBA SI TIENE SONDA DE REDOX
0008cf c01e      	RJMP			PRO3A_RD			; SI TIENE SALTA A 
                 ; COMO NO TIENE SONDAS PRESENTA PH Y PRODUCCION
                 
                 
                 ; PANTALLA CON SONDA DE PH Y SIN REDOX NO CLORO
                 
                 ; RUTINA PARA 
                 
                 
0008d0 ec30      	LDI				R19,192
0008d1 d061      	RCALL			LINEA1 				; LINEA2 CON SONDA DE PH LINEA 1 "pHp -.- pH agua -.-"
0008d2 e934      	LDI				R19,148
0008d3 da77      	RCALL			LINEA1PH			; CON SONDA DE PH LINEA 3 "PRODUCION 90 %" RUTINA LINEA_PH
0008d4 ed34      	LDI				R19,212
0008d5 da8d      	RCALL			LINEA2PH			; LINEA 4 "SAL EN AGUA" O AÑADIR SAL
0008d6 dabc      	RCALL			ANADIR_SAL			; MUESTRA AÑADIR SAL SI ES NECESARIO
0008d7 c01d      	RJMP			PROA4			
                 
                 PROA3:		; PANTALLA SIN SONDA DE PH
0008d8 e904      	LDI				R16, 148			; BORRAR LINEA 3
0008d9 940e 053e 	CALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION, " ESCRIBIR LINEA 2"
0008db e0d7      	LDI				YH,HIGH(BORRAR_LINEA)	; POSICION ALTA DEL TAXTO EN RAM 080
0008dc eac4      	LDI				YL,LOW (BORRAR_LINEA)	; direccion BAJA DEL TEXTO EN RAM  "CONSULTAR MANUAL"    	
0008dd e114        	LDI				R17,20   			; bytes a enviar 
0008de 940e 0925 	CALL			ENVIARTEXTO			
                 
0008e0 ed34      	LDI				R19,212				; VALOR DE LA LINEA A ESCRIBIR
0008e1 da81      	RCALL			LINEA2PH			; MOSTRAR SAL EN EL AGUA 
0008e2 dab0      	RCALL			ANADIR_SAL			; MUESTRA LA SAL A AÑADIR SI ES NECESARIO LINEA 4
0008e3 ec30      	LDI				R19,192
0008e4 da66      	RCALL			LINEA1PH			; Mostrar linea 1 solo % de produccion
                 			; LINEA 4 MUESTRA SAL A AÑADIR EN CASO DE SER MENOR DE 5
0008e5 c00f      	RJMP			PROA4
                 PRO3A_CL: ; PANTALLA CON CLORO
                 
                 ;       20x4        16x4   tipo de display
                 ; linea 1-128 		128 
                 ; linea 2-192		192
                 ; linea 3-148		144
                 ; linea 4-212		208
0008e6 ec30      	LDI				R19,192
0008e7 d04b      	RCALL			LINEA1 				; LINEA2 CON SONDA DE PH LINEA 1 "pHp -.- pH agua -.-"
0008e8 e934      	LDI				R19,148
0008e9 dad0      	RCALL			LIN_AUTO_CL			; LINEA 3 "PROD. AUTO CL -.- PPM"
0008ea ed34      	LDI				R19,212
0008eb da77      	RCALL			LINEA2PH			; LINEA 4 "SAL EN AGUA" O AÑADIR SAL
0008ec daa6      	RCALL			ANADIR_SAL			; MUESTRA LA SAL A AÑADIR SI ES NECESARIO LINEA 4	
0008ed c007      	RJMP 			PROA4
                 
                 PRO3A_RD:	; PANTALLA CON REDOX
0008ee ec30      	LDI				R19,192
0008ef d043      	RCALL			LINEA1 				; LINEA 2 "pHp -.- pH agua -.-"
0008f0 e934      	LDI				R19,148
0008f1 dabf      	RCALL			LIN_AUTO_RD			; LINEA 3 "PROD. AUTO RDX ---mV"
0008f2 ed34      	LDI				R19,212
0008f3 da6f      	RCALL			LINEA2PH			; LINEA 4 "SAL EN AGUA" O AÑADIR SAL
0008f4 da9e      	RCALL			ANADIR_SAL			; MUESTRA LA SAL A AÑADIR SI ES NECESARIO LINEA 4
                 ;RCALL  BORRAR_PANTALLA
                 
                 ; FRECUENCIA MEDICION DE TEMPERATURA y SAL SOLO CON FUENTE ENCENDIDA
                 
                 PROA4:
0008f5 940e 119a 	CALL			VOLTIOS				; RUTINA QUE MIDE LAS VOLTIOS Y LAS PASA A P GRAFICA YMIDE AMPERIOS
0008f7 9b84      	SBIS			PIND,4				; SI LA FUENTE ESTA APAGADA SALTA A
0008f8 c00f      	RJMP			PROA				; PROA PARA NO MEDIR LA SAL
0008f9 9130 0401 	LDS				R19,MINU
0008fb 3031      	CPI				R19,1				; RETARDO PARA MEDIR LA SAL DEL 3%
0008fc f058      	BRLO			PROA
                 ;LDS		R19,SEG
                 ;CPI	R19,4
                 ;BRLO PROA
0008fd d376      	RCALL			PRO3				; RUTINA MEDICION DE SAL
0008fe d854      	RCALL			ADC_P3				; CONVIERTE EL VALOR LEIDO A PANTALLA 
                 
                 ; MEDICCION DE LA TEMPERATURA
                 ;	LDI				R19,0				; DIRECIONAMIENTO DEL PERIFERICO
0008ff e027      	LDI				R18,P_TEMP			; LINEA A LEER
000900 e5a0      	LDI				R26,80				; NUMERO DE LECTURAS
000901 940e 013c 	CALL			ADC_P
                 PROA4A:
                 ;LDI R24,00
000903 9380 020f 	STS				RAM_TEMP,R24		; GUARDA LA LECTURA EN LA MEMORIA RAM
000905 940e 06c8 	CALL			PCF2_T				; RUTINA QUE PREPARA LA PRESENTACION DE LA TEMPERATURA
000907 0000      	NOP
                 
                 PROA:  
000908 d993      	RCALL			RELOJ
000909 dab9      	RCALL			TECLADO
                 ;CALL LIN_PGRAFICA						; PONE LA INFORMACION EN LA PANTALLA GRAFICA
00090a 95a8      	WDR
00090b 0000      	NOP
                 
                 
                 ; PARA MEDIR EL CLORO O REDOX LO MIDE DESPUES DE 30 SEGUNDOS
00090c 95a8      	WDR
00090d 9130 0401 	LDS  			R19,minu			; CARGA LOS MINUTOS 
00090f 3634      	CPI				R19,100				; COMPARA CON 100 PARA NO ENCENDER LA FUENTE Y PODER INVERTIR LA POLARIDAD
000910 f440      	BRBC			0,PRO1B				; SI ES MAYOR NO MIDE NI REDOS NI CLORO SALTA A PRO1B y para la fuente
000911 3031      	CPI				R19,1				; NO ENCIENDE LS FUENTE
000912 f028      	BRBS			0,PRO1A
                 ;	SBRS			CONTROL_1,2			; SALTA LA PROXIMA INSTRUCION SI ES UNO MIDE CLORO Y REDOX, OPCION NORMAL
                 ;	RJMP			PRO1A				; APAGA EL CIRCUITO DE APOYO Y NO MIDE MAS
000913 d412      	RCALL			PRO4				; MEDICION CLORO LIBRE
000914 fd47      	SBRC			CONTROL,7 			; COMPRUEBA SI TIENE SONDA DE CLORO LIBRE
000915 c002      	RJMP			PRO1A				; SI TIENE SALTA A PRO1A
000916 d454      	RCALL			PRO5				; MEDICION REDOX
000917 95a8      	WDR
                 PRO1A:
000918 cf9d      	RJMP			PRO					; COMIENZA EL CICLO DEL PROGRAMA PRINCIPAL	
                 
                 PRO1B: ; RUTINA PARA CUANDO EL TIEMPO ES SUPERIOR A 100	 APAGA LA FUENTE  
000919 daa9      	RCALL			TECLADO				; LEER TACLADO	
00091a 940e 02f2 	CALL			APAGAR_FUENTE
00091c cf99      	RJMP			PRO
                 ;+++++++++ TERMINA PROGRAMA PRINCIPAL +++++++++++++++++
                 
                 ;*** RUTINA PARA CONTROLAR LOS LED DE LA PANTALLA Y LA LUZ
                 LEDPANT:
00091d bafb      	OUT				PORTA,val_led		; r15 registro control led pantalla
00091e 98ac      	CBI				PORTC,led_pant		; pone a 0 el bit de grabacion del 74lh374 
00091f 0000      	NOP
000920 0000      	NOP
000921 9aac      	SBI				PORTC,led_pant		; pone a 1 , graba el valor de portA en el 74LH374, enciende los led
000922 0000      	NOP
000923 0000      	NOP
000924 9508      	RET
                 
                 ;*** RUTINA PARA ENVIAR TEXTO A PANTALLA EN R17 NUMERO DE LETRAS
                 ;    EN Y LA POSICION EN MEMORIA RAM ( YH, YL )	PRECISA RUTINA ENVIARBYTE
                 ENVIARTEXTO: 
000925 9109      	LD				r16, Y+      		; carga byte en r0 e incrementa Y
000926 dc14      	RCALL			ENVIARBYTE  		; lo enviamos 
000927 951a      	DEC				r17 				; descuenta uno
000928 f7e1      	BRNE			ENVIARTEXTO   		; si quedan mas seguimos enviando 
000929 9508      	RET
                 
                 
                 ;***********RETARDO DE 22 uS*********** 
                 ; el retardo es : 195uS de retardo para r25=250 y 4Mhz de frecuencia
                 ;  PARA 4MZ SOLO UNA INSTRUCION NOP PARA 8MZ 6 INSTRUCIONES NOP
                 
                 RETARDO:
00092a 95a8      	WDR
00092b 0000      	NOP
00092c 0000      	NOP
00092d 0000      	NOP
00092e 0000      	NOP
00092f 0000      	NOP
000930 959a      	DEC				R25 
000931 f7c1      	BRNE			RETARDO   		;
000932 9508      	RET
                 
                 ; RUTINA PARA CARGAR LOS VALORES PROGRAMADOS EN EEPROM A RAM
                 ; CARGA EL PH
                 
                 
                 LINEA1: ;RUTINA ESCRITURA LINEA2 CON PH 
000933 ec00      	LDI				R16,192				; ESCRIBIR LINEA 2
000934 dc09      	RCALL			ENVINT				; En subrrutina Env_doi Envia instrucion para escribir en linea 1
000935 e0d4      	LDI				YH, HIGH(PHP)		; POSICION BIT ALTO DEL TEXTO A ENVIAR ram en 070
000936 e5cc      	LDI				YL, LOW(PHP)		; POSICION BIT BAJO DEL TEXTO A ENVIAR
000937 e114      	LDI				R17,20				; NUMERO DE DIGITOS A ENVIAR A PANTALLA
000938 dfec      	RCALL			ENVIARTEXTO			; RUTINA EN ESTE FICHERO PRECISA SUBRRUTINA ENV_DOI	
000939 9508      	RET	
                 
                 
00093a 9300 010f 	STS				$10F,R16
00093c 9300 0111 	STS				$111,R16	
00093e fd47      	SBRC			CONTROL,7 			; COMPRUEBA SI TIENE SONDA DE CLORO LIBRE
00093f c013      	RJMP			LINEA1A
000940 fd46      	SBRC			CONTROL,6			; COMPRUEBA SI TIENE SONDA DE REDOX
000941 c011      	RJMP			LINEA1A
000942 9180 0205 	LDS				R24,RAMP_PRO
                 ;	SBRC			CONTROL_1,3
                 ;	LDS				R24,RAM_PRO_PRO_M	; SOLO EN CASO DE ACTUAR EL PORCENTAJE DE PRODUCION
000944 fd43      	SBRC			CONTROL,3			; SALTA LA PROXIMA INSTRUCION SI ES CERO, SUPERCLORACION
000945 e684      	LDI				R24,100				; SOLO EN CASO DE SUPERCLORACION
000946 dc49      	RCALL			RADC				; RUTINA PARA CONVERTIR EN ANALOGICO
                 
000947 9210 0106 	STS				$106,R1
000949 9220 0107 	STS				$107,R2
00094b 9230 0108 	STS				$108,R3
00094d e205      	LDI				R16,37				; PONE UN %
00094e 9300 0109 	STS				$109,R16
000950 e200      	LDI				R16,32
000951 9300 010a 	STS				$10A,R16			; BORRA LA O DE AUTO
                 LINEA1A:
000953 e500      	LDI				R16,80				; PONE UNA P
000954 9300 010c 	STS				$10C,R16			; EN LA MEMORIA RAM DEL MICRO
000956 e608      	LDI				R16,104				; PONE UNA h
000957 9300 010d 	STS				$10D,R16			; EN LA MEMORIA RAM DEL MICRO	
                 ; NO ESCRIBE EL PH LOS PRIMEROS DOS MINUTOS
000959 9130 021f 	LDS				R19,NCICLOS
00095b 3030      	CPI				R19,00				; VERIFICA QUE A PASADO UN MINUTO PARA ENCENDER LA FUENTE
00095c f0d8      	BRBS			0,LINEA1_A			; SI ES MENOR DE DOS MINUTOS SALTA A VOLVER
                 
00095d 9130 0401 	LDS				R19,MINU
00095f 3032      	CPI				R19,02				; VERIFICA QUE A PASADO UN MINUTO PARA ENCENDER LA FUENTE
000960 f0b8      	BRBS			0,LINEA1_A			; SI ES MENOR DE DOS MINUTOS SALTA A VOLVER
                 
000961 9180 0200 	LDS				R24,RAM_PH			; LEE EL PH DE LA RAM
000963 dc2c      	RCALL			RADC				; RUTINA PARA CONVERTIR EN ANALOGICO
                 ;	STS				$110,R1
000964 9220 010f 	STS				$10F,R2				; RESULTADO DE DECENAS
000966 9230 0111 	STS				$111,R3				; RESULTADO UNIDADES			
000968 9180 0200 	LDS				R24,RAM_PH
00096a 3684      	CPI				R24,100				; VALOR MAX DEL PH SOLO DOS CIFRAS
00096b f060      	BRBS			0, LINEA1_A			; SI ES MAYOR NO SALTA Y PONE E.E
00096c e200      	LDI 			R16,32
00096d 9300 010d 	STS				$10D,R16			; PONE UN ESPACIO 
00096f e405      	LDI				R16,69				; PONE E
000970 9300 010f 	STS				$10F,R16
000972 e503      	LDI				R16,83				; PONE UNA S
000973 9300 0111 	STS				$111,R16
000975 e20e      	LDI				R16,46				; PONE .
000976 9300 010f 	STS				$10F,R16
                 
                 LINEA1_A:
000978 ec00      	LDI				R16,192				; ESCRIBIR LINEA 2
000979 dbc4      	RCALL			ENVINT				; En subrrutina Env_doi Envia instrucion para escribir en linea 1
00097a e0d1      	LDI				YH, HIGH(LIN1)		; POSICION BIT ALTO DEL TEXTO A ENVIAR ram en 070
00097b e0c0      	LDI				YL, LOW(LIN1)		; POSICION BIT BAJO DEL TEXTO A ENVIAR
00097c e114      	LDI				R17,20				; NUMERO DE DIGITOS A ENVIAR A PANTALLA
00097d dfa7      	RCALL			ENVIARTEXTO			; RUTINA EN ESTE FICHERO PRECISA SUBRRUTINA ENV_DOI	
00097e 9508      	RET	
                 
                 
                 .INCLUDE "NO_TECLA.ASM"
                 
                 NO_TECLA:
00097f 95a8      	WDR
000980 940e 04c0 	CALL		LEC_TEC
000982 3f1f      	CPI			R17, 0B11111111		; IDEM
000983 f7d9      	BRNE		NO_TECLA			; SI NO COINCIDE  VA A NO_TECLA
000984 ef0f      	SER			R16					; PONE R16 TODO A 1
000985 e060      	LDI			R22, 00				; PONE EL RETARDO A CERO
000986 2477      	CLR			TEMP_TEC			; PONE A CERO EL RETARDO SALIDA TECLADO QUE ES R7
000987 e073      LDI LEC_REL,3	; PARA ACTUALIZAR LA MEDICION EN EL SEGUNDO 5
000988 9508      	RET
                 
                 
                 NIVEL_DEPOSITO:
000989 ec00      	LDI				R16,192		; ESCRIBIR EN LINEA 2
00098a dbb3      	RCALL			ENVINT				; Y ENVIA EN MANSAJE A PANTALLA 1º INFORMACION DE LINEA Y....
00098b e0d6      	LDI				YH,HIGH(N_DEPOSITO) ;TEXTO A ENVIAR A PANTALLA "NIVEL DEPOSITO"
00098c e3cc      	LDI				YL,LOW(N_DEPOSITO) ;TEXTO A ENVIAR A PANTALLA
00098d e114      	LDI				R17,20				; NUMERO DE DIGITOS A ENVIAR A PANTALLA
00098e df96      	RCALL			ENVIARTEXTO			; 2º EL TEXTO 16 CARACTERES
00098f 9508      	RET
                 
                 LINEA2: ; RUTINA ESCRITURA LINEA2
000990 fef5      	SBRS			VAL_LED,5			; VERIFICA EL LED 5 FALTA DE NIVEL EN EL DEPOSITO
000991 c002      	RJMP			LINEA10				; Y SALTA ESTA INSTRUCION SI ES UNO "HAY NIVEL"
000992 ff71      	SBRS			LEC_REL,1
000993 cff5      	RJMP			NIVEL_DEPOSITO		; VA CADA 3 SEGUNDOS AL MENSAJE DE "NIVEL DEPOSITO"
                 
                 LINEA10:
                 
000994 e503      	LDI				R16,83				; PONE UNA S
000995 9300 0115 	STS				$115,R16
000997 e601      	LDI				R16,97				; PONE UNA a
000998 9300 0116 	STS				$116,R16	
00099a e60c      	LDI				R16,108				; PONE UNA l
00099b 9300 0117 	STS				$117,R16	
00099d e20e      	LDI				R16,46				; PONE UN .
00099e 9300 011b 	STS				$11B,R16			; PUNTO DE LA SAL	
0009a0 9300 0124 	STS				$124,R16			; PUNTO DEL PH
0009a2 e200      	LDI				R16,32				; CODIGO DEL ESPACIO			
0009a3 9300 0118 	STS				$118,R16
0009a5 9300 0122 	STS				$122,R16
0009a7 9180 0210 	LDS				R24,RAM_SAL_C		; CARGA DE LA RAM EL VALOR DE LA MEDICION DE LA SAL
0009a9 3683      	CPI				R24,99
0009aa f468      	BRBC			0,LINEA10_A
                 
0009ab 338d      	CPI				R24,61
0009ac f020      	BRLO			LINEA10_1
0009ad e38c      	LDI				R24,60				; SI ES MAYOR DE 60 PONE > Y DA VALOR DE 60 A SAL
0009ae e30e      	LDI				R16,62
0009af 9300 0118 	STS				$118,R16			; COLOCA EL SIMBOLO >			
                 LINEA10_1:
                 ;	SUBI			R24,0				; RESTA UNA CANTIDAD COMO CONTENIDO DE CAL EN EL AGUA
0009b1 0000      	NOP
0009b2 dbdd      	RCALL			RADC
                 ;	STS				$118,R1
0009b3 9220 011a 	STS				$11A,R2				; VALOR DE LAS DECENAS
0009b5 9230 011c 	STS				$11C,R3				; VALOR DE LAS UNIDADES
0009b7 c005      	RJMP			LINEA10_B
                 LINEA10_A:
0009b8 e20d      	LDI				R16,45				; PONE UN -
0009b9 9300 011a 	STS				$11A,R16
0009bb 9300 011c 	STS				$11C,R16
                 LINEA10_B:
0009bd e500      	LDI				R16,80				; PONE UNA P 
0009be 9300 011f 	STS				$11F,R16
0009c0 e608      	LDI				R16,104				; PONE UNA H
0009c1 9300 0120 	STS				$120,R16
0009c3 e500      	LDI				R16,80 				; PONE UNA P
0009c4 9300 0121 	STS				$121, R16	
0009c6 ff47      	SBRS			CONTROL, 7 			; COMPRUEBA SI TIENE SONDA DE CLORO LIBRE
0009c7 c011      	RJMP			LINEA2A				; SI NO TIENE SALTA A LINEA2A
0009c8 9180 0206 	LDS				R24, RAM_CL
0009ca dbc5      	RCALL			RADC
0009cb e200      	LDI				R16,32				; PONE UN ESPACIO PARA ELIMINAR LA P
0009cc 9300 0121 	STS				$121,R16
0009ce e403      	LDI				R16,67				; ESCRIBE UN C
0009cf 9300 011f 	STS				$11F,R16
0009d1 e60c      	LDI				R16,108 			; PONE UNA l
0009d2 9300 0120 	STS				$120,R16	
0009d4 9220 0123 	STS				$123,R2
0009d6 9230 0125 	STS				$125,R3			
0009d8 c01c      	RJMP			LINEA2B
                 LINEA2A: 		; CON SONDA DE REDOX
0009d9 ff46      	SBRS			CONTROL,6			; COMPRUEBA SI TIENE SONDA DE REDOX
0009da c013      	RJMP			LINEA2C				; SI NO TIENE SALTA A LINEA 3A
0009db 9180 0209 	LDS				R24,RAM_RD
0009dd dbd3      	RCALL			RADC5I				; RUTINA ESPECIAL PARA CONVERTIR EL REDOX EN BCD
0009de e200      	LDI				R16,32				; PONE UN ESPACIO PARA ELIMINAR LA P
0009df 9300 0121 	STS				$121,R16
0009e1 e502      	LDI				R16,82				; PONE UNA R
0009e2 9300 011f 	STS				$11F,R16
0009e4 e604      	LDI				R16,100				; PONE UNA d
0009e5 9300 0120 	STS				$120,R16
0009e7 9210 0123 	STS				$123,R1
0009e9 9220 0124 	STS				$124,R2	
0009eb 9230 0125 	STS				$125,R3		
0009ed c007      	RJMP			LINEA2B
                 LINEA2C:	
0009ee 9180 0201 	LDS				R24,RAMP_PH
0009f0 db9f      	RCALL			RADC	
                 ;	STS				$120,R1
0009f1 9220 0123 	STS				$123,R2
0009f3 9230 0125 	STS				$125,R3			
                 ;	RJMP			LINEA2B
                 ;	LDI				R16,45				; PONE UNA -
                 ;	MOV				R3,R16
                 ;	MOV				R2,R16				; PONE UNA -
                 ;	STS				$09D,R2	
                 ;	STS				$09F,R3		
                 
                 LINEA2B:
0009f5 e200      	LDI				R16,32
0009f6 9300 0126 	STS				$126,R16			; LIMPIA LA PANTALLA
0009f8 9300 0127 	STS				$127,R16
0009fa 9300 0128 	STS				$128,R16
0009fc e904      	LDI				R16,148				; 11000000 escribir en linea 2 linea (192)( linea 4 seria 212)
0009fd db40      	RCALL			ENVINT
0009fe e0d1      	LDI				YH,HIGH(LIN2)		; POSICION ALTA DEL TAXTO EN RAM 080
0009ff e1c4      	LDI				YL,LOW (LIN2)		; direccion BAJA DEL TEXTO EN RAM      	
000a00 e114        	LDI				R17,20 				; bytes a enviar 
000a01 df23      	RCALL			ENVIARTEXTO			; RUTINA PARA ENVIAR TEXTO A PANTALLA
000a02 9508      	RET
                 ;       20x4        16x4   tipo de display
                 ; linea 1-128 		128 
                 ; linea 2-192		192
                 ; linea 3-148		144
                 ; linea 4-212		208
                 
                 LINEA3:      
000a03 e800      	LDI				R16,128				; ESCRIBIR LINEA 1 MODELO DEL EQUIPO
000a04 db39      	RCALL			ENVINT				; En subrrutina Env_doi Envia instrucion para escribir en linea 1
000a05 e0d7      	LDI				YH,HIGH(LIN1P)		; POSICION BIT ALTO DEL TEXTO A ENVIAR ram en 070
000a06 edce      	LDI				YL,LOW (LIN1P)-2	; POSICION BIT BAJO DEL TEXTO A ENVIAR
000a07 e114      	LDI				R17,20				; NUMERO DE DIGITOS A ENVIAR A PANTALLA
000a08 df1c      	RCALL			ENVIARTEXTO			; RUTINA EN ESTE FICHERO PRECISA SUBRRUTINA ENV_DOI
                 ;	RET
                 
                 ;LINEA4: PONE EN PANTALLA 20X4 SEGUNDOS Y MINUTOS
                 
000a09 2f87      	MOV				R24,LEC_REL
000a0a db85      	RCALL			RADC
                 
000a0b 9220 0569 	STS				$569,R2
000a0d 9230 056a 	STS				$56A,R3
000a0f 9180 0401 	LDS				R24,MINU
000a11 db7e      	RCALL			RADC
                 
000a12 9220 056e 	STS				$56E,R2
000a14 9230 056f 	STS				$56F,R3	
000a16 9180 021f 	LDS				R24,NCICLOS
000a18 db77      	RCALL			RADC
                 ;	STS				$24E,R2
000a19 9230 0573 	STS				$573,R3
                 ;	LDI				R16,212			; 11000000 escribir en linea 4 linea (192)( linea 4 seria 212)
                 ;	RCALL			ENVINT
                 ;	LDI				YH,HIGH(PRO_CLORO)	; POSICION ALTA DEL TAXTO EN RAM 080
                 ;	LDI				YL,LOW (PRO_CLORO)	; direccion BAJA DEL TEXTO EN RAM      	
                  ; 	LDI				R17,20   			; bytes a enviar 
                 ;	RCALL			ENVIARTEXTO			; RUTINA PARA ENVIAR TEXTO E PANRALLA
                 
000a1b 9508      	RET
                 
                 
                 
                 
                 LIN_PGRAFICA:		;	************* PRESENTA EN NEXTION TODA LA INFORMACION
                 
                 
                 ;CALL ENCENDER_GRA	; ENCIENDE LA PANTALLA GRAFICA
                 
000a1c e734      LDI R19,116				; LETRA t
000a1d e3b0      LDI	R27,48				; LINEA 0
000a1e e104      LDI	R16,20				; 20 CARACTERES A ENVIAR
000a1f e0d7      LDI	YH, HIGH (LIN1P)
000a20 eec0      LDI	YL, LOW (LIN1P)
                 ;CALL P_NEXTION_TEXTO		;PRO_GRA_1		
                 
                 
                 
000a21 e734      LDI R19,116				; LETRA t
000a22 e3b1      LDI	R27,49				; LINEA 1
000a23 e104      LDI	R16,20				; 20 CARACTERES A ENVIAR
000a24 e0d7      LDI	YH, HIGH (LIN1P)
000a25 eec0      LDI	YL, LOW (LIN1P)
000a26 940e 1dce CALL P_NEXTION_TEXTO		;PRO_GRA_1		
                 
000a28 e734      LDI R19,116				; LETRA t
000a29 e3b2      LDI	R27,50				; LINEA 2
000a2a e104      LDI	R16,20				; 20 CARACTERES A ENVIAR
000a2b e0d1      LDI	YH, HIGH (LIN1)
000a2c e0c0      LDI	YL, LOW (LIN1)
                 ;CALL P_NEXTION_TEXTO		;PRO_GRA_1		
                 
000a2d e734      LDI R19,116				; LETRA t
000a2e e3b3      LDI	R27,51				; LINEA 3
000a2f e104      LDI	R16,20				; 20 CARACTERES A ENVIAR
000a30 e0d1      LDI	YH, HIGH (LIN2)
000a31 e1c4      LDI	YL, LOW (LIN2)
                 ;CALL P_NEXTION_TEXTO		;PRO_GRA_1		
                 
                 
000a32 e734      LDI R19,116				; LETRA t
000a33 e3b4      LDI	R27,52				; LINEA 4
000a34 e104      LDI	R16,20				; 20 CARACTERES A ENVIAR
000a35 e0d4      LDI	YH, HIGH (PHP)
000a36 e5cc      LDI	YL, LOW (PHP)
000a37 940e 1dce CALL P_NEXTION_TEXTO		;PRO_GRA_1		
                 
000a39 e734      LDI R19,116				; LETRA t
000a3a e3b5      LDI	R27,53				; LINEA 5
000a3b e104      LDI	R16,20				; 20 CARACTERES A ENVIAR
000a3c e0d5      LDI	YH, HIGH (PRUEBA_1)
000a3d e6c0      LDI	YL, LOW (PRUEBA_1)
000a3e 940e 1dce CALL P_NEXTION_TEXTO		;PRO_GRA_1		
                 
000a40 e734      LDI R19,116				; LETRA t
000a41 e3b6      LDI	R27,54				; LINEA 6
000a42 e104      LDI	R16,20				; 20 CARACTERES A ENVIAR
000a43 e0d7      LDI	YH, HIGH (L_BLANCA)
000a44 e1c8      LDI	YL, LOW (L_BLANCA)
000a45 940e 1dce CALL P_NEXTION_TEXTO		;PRO_GRA_1		
                 
000a47 e734      LDI R19,116				; LETRA t
000a48 e3b7      LDI	R27,55				; LINEA 7
000a49 e104      LDI	R16,20				; 20 CARACTERES A ENVIAR
000a4a e0d7      LDI	YH, HIGH (L_VOLTIOS)
000a4b e2cc      LDI	YL, LOW (L_VOLTIOS)
000a4c 940e 1dce CALL P_NEXTION_TEXTO		;PRO_GRA_1		
                 
000a4e 9508      RET
                 
                 ENVIARTEXTO_2: 
000a4f 9109      	LD				r16, Y+      		; carga byte en r0 e incrementa Y
000a50 db0d      	RCALL			ENVIARBYTE_2  		; lo enviamos 
000a51 951a      	DEC				r17 				; descuenta uno
000a52 f7e1      	BRNE			ENVIARTEXTO_2  		; si quedan mas seguimos enviando 
000a53 9508      	RET
                 
                 
                 ;.INCLUDE "SAA1064.ASM"
                 .INCLUDE "COMPARA2.ASM"
                 
000a54 932f      	PUSH			R18				; SALVAMOS EL REGISTRO A UTILIZAR Y LA GUARDAMOS EN LA PILA
000a55 2722      	CLR				R18				; SE LIMPIA EL REGISTRO A UTILIZAR
000a56 2e02      	MOV				R0, R18			; Y LOS DEMAS
000a57 2e12      	MOV				R1, R18
000a58 2e22      	MOV				R2, R18
000a59 2e32      	MOV				R3, R18
000a5a e2f3      	LDI   			ZH, $23			; direccion alta del TEXTO en Flash
000a5b e0e0      	LDI   			ZL, $00			; direccion baja del TEXTO en Flash 
000a5c ef0a      	LDI   			R16,250     	; longitud de texto a copiar en RAM
                 CARGATEXTO_3A:
000a5d 95c8      	LPM      						; leemos TEXTO de FLASH y lo almacena en R0
000a5e 963a      	ADIW  			ZL,10  			; apuntamos al siguiente elemento 
000a5f 0c20      	ADD   			R2, R0			; guardamos en RAM POSICION Y EL CONTENIDO DE R0
000a60 f40b      	BRVC			CARGATEXTO_3A1
000a61 9433      	INC				R3
                 CARGATEXTO_3A1:
000a62 950a      	DEC   			R16      		; Hemos terminado..?? 
000a63 f7c9      	BRNE  			CARGATEXTO_3A  	; NO...seguimos cargando 
000a64 d016      	RCALL			ACT1
000a65 e2e4      	LDI				R30, $024		; POSICION 0x26
000a66 162e      	CP				R2, R30
000a67 f459      	BRNE			ACT
000a68 e2f9      	LDI				R31, $029		; POSICION 0x27
000a69 163f      	CP				R3, R31
000a6a f441      	BRNE			ACT
000a6b ef2b      	LDI				R18, 251		; SI SE MENOR PONE EL PH NORMAL
000a6c e215      	LDI				R17, $025
000a6d 940e 0587 	CALL			EEPROM_ES		; ACTUALIZA LA EEPROM
000a6f 9468      	SET
000a70 f8b4      	BLD				CONTROL_1, 4
000a71 912f      	POP				R18
000a72 9508      	RET
                 ACT:
000a73 94e8      	CLT
000a74 f8b4      	BLD				CONTROL_1, 4
000a75 ef2f      	LDI				R18, 255		; SI SE MENOR PONE EL PH NORMAL
000a76 e215      	LDI				R17, $025
000a77 940e 0587 	CALL			EEPROM_ES		; ACTUALIZA LA EEPROM CON EL VALOR INICIAL
000a79 912f      	POP				R18
000a7a 9508      	RET	
                 ACT1:
000a7b 2d22      	MOV				R18, R2
000a7c e216      	LDI				R17, $026
000a7d 940e 0587 	CALL			EEPROM_ES
000a7f 2d23      	MOV				R18, R3
000a80 e217      	LDI				R17, $027
000a81 940e 0587 	CALL			EEPROM_ES
000a83 9508      	RET
                 
                 .INCLUDE "PRO_RD.ASM"
                 
                 
                 ; TECLA 0 PROGRAMAR
                 ; TECLA 1 MENOS
                 ; TECLA 2 FLECHA
                 ; TECLA 3 CALIBRAR
                 ; TECLA 4 MAS
                 ; TECLA 5 
                 ; TECLA 6 NIVEL ACIDO
                 ; TECLA 7 SALIR
                 
                 
                 TECLA2T:
                 
000a84 93e0 020a 	STS			RAMP_RD, R30		; ACTUALIZA EN RAM EL NUEVO VALOR PROGRAMADO DEL PH
000a86 e013      	LDI			R17, RD_MEN
000a87 2f2e      	MOV			R18, R30			; GRABA EL VALOR DEL REDOX EN EEPROM 242
                 ;	RCALL		I2CE_2404			; ESCRIBE EL NUEVO VALOR EN LA EEPRON EXTERNA
000a88 dafe      	RCALL		EEPROM_ES	
000a89 d2e1      RCALL PRO5		; PARA EVITAR EL ERROR EN FUENTE LA ENCIENDE SI ES MAYOR EL VALOR DE REDOX
000a8a 2d0f      	MOV			R16, VAL_LED
000a8b 7b0f      	ANDI		R16, 0B10111111
000a8c 2ef0      	MOV			VAL_LED, R16
000a8d de8f      	RCALL		LEDPANT				; ACTUALIZAR LOS LED DE LA PANTALLA	
000a8e def0      	RCALL		NO_TECLA
000a8f 9508      	RET
                 TECLACL_RD:		; PROGRAMACION DEL VALOR PARA EL APOYO DE CLORO DOSIFICACION
000a90 93e0 020a STS RAMP_RD,R30
000a92 940e 1814 CALL TECLA6V ;***************  VA A PROGRAMAR VALOR DEL APOYO DE REDOX
                 TECLA2V:
000a94 306a      	CPI			R22, RETARDO1
000a95 f3f0      	BRLO		TECLA2V
000a96 91e0 020a 	LDS			R30, RAMP_RD		; CARGA DE LA RAMM EL VALOR DE REDOX PROGRAMADO
000a98 e060      	LDI			R22, 00
                 
                 TECLA2:								; AJUSTAR PH VALOR EN R30
000a99 95a8      	WDR
000a9a 2d87      	MOV			R24, TEMP_TEC
000a9b 308f      	CPI			R24, retardo_programacion	; PARA COMPARARLO CON EL RETARDO 20 SEGUNDOS SIN PULSAR TECLA
000a9c f73a      	BRPL		TECLA2T						; Y SALIR DE PROGRAMACION DE PARAMETROS										RDO 20 SEGUNDOS SIN PULSAR TECLA
000a9d 940e 04c0 	CALL		LEC_TEC
000a9f 3f1f      	CPI			R17, 0B11111111		; COMPRUEBA SI SE A PULSADO ALGUNA TECLA
000aa0 f011      	BREQ		TECLA2A				; SI SE HA PULSADO SALTA A TECLA2A
000aa1 e000      	LDI			R16, 00				; SI ES ASI....
000aa2 2e70      	MOV			TEMP_TEC, R16		; PONE EL CONTADOR DE RETARDO A CERO
                 TECLA2A:
                 ;CPI	R17,0B11111110 ; VA A PROGRAMAR EL AJUSTE DE CORO Y REDOX
                 ;BREQ TECLACL_RD
                 			; OPCION SALTAR PARA AJUSTE DE CLORO
000aa3 3f1b      	CPI			R17, 0B11111011		; TECLA 2
000aa4 f181      	BREQ		TECLA2U				; SALTA PARA AJUSTAR EL CLORO SI TIENE
                 			; OPCION SALIR DE LECTURA DE TECLADO 
000aa5 371f      	CPI			R17, 0B01111111		; TECLA 5
000aa6 f409      	BRNE		TECLA2B				; SI NO ES 80 SALTA A TECLA1D
000aa7 cfdc      	RJMP		TECLA2T				; TERMINA Y SALE PARA GRABAR
                 TECLA2B:	; OPCION AUMENTAR RD
000aa8 3e1f      	CPI			R17, 0B11101111		; TECLA 4 INCREMENTA EL VALOR
000aa9 f439      	BRNE		TECLA2C				; SI NO ESTA PULSADA SALTA PARA VERIFICAR OTRA TECLA
000aaa e000      	LDI			R16, 00				; PONE EL RETARDO DEL TECLADO A 0
000aab 2e70      	MOV			TEMP_TEC, R16
000aac 95e3      	INC			R30					; INCREMENTA EL VALOR
000aad e060      	LDI			R22, 0				; CARGA EL RETARDO DE LECTURA DELTECLADO
000aae 3ce3      	CPI			R30, RD_MAX			; VERIFICA SI ESTA EN EL VALOR MAXIMO
000aaf f008      	BRBS		0, TECLA2C			; SI NO SUPERA EL VALOR MAXIMO SALTA
000ab0 eaea      	LDI			R30, 170			; SI SUPERA EL MAXIMO LO PONE AL MAXIMO
                 TECLA2C:	; OPCION DISMINUIR RD
000ab1 3f1d      	CPI			R17, 0B11111101		; TECLA 1 PARA DISMINUIR
000ab2 f439      	BRNE		TECLA2D				; SI NO ESTA PULSADA SALTA
000ab3 e000      	LDI			R16, 00				; PONE EL RETARDO DEL TECLADO A 0
000ab4 2e70      	MOV			TEMP_TEC, R16
000ab5 95ea      	DEC			R30					; DISMINUYE EL VALOR
000ab6 e060      	LDI			R22, 0				; CARGA EL RETARDO DE LECTURA DEL TECLADO
000ab7 33e0      	CPI			R30, RD_MIN			; COMPRUEBA SI SE ELCANZA EL VALOR MINIMO
000ab8 f408      	BRBC		0, TECLA2D			; SI NO SE ALCANZA SALTA
000ab9 e8e2      	LDI			R30, 130			; SI SE ALCANZA PONE EL VALOR MINIMO de redox
                 ;********************** IR A PROGRAMACION DEL VALOR PARA EL APOYO DE REDOX******************
                 TECLA2D:
000aba 3f1e      	CPI			R17, 0B11111110		; TECLA 0 PARA VA A PROGRAMAR LA DIFERENCIA PARA EL APOYO DE REDOX
000abb f411      	BRNE		TECLA2D_1			; SI NO ESTA PULSADA SALTA
000abc 940e 0a90 	CALL		TECLACL_RD
                 
                 TECLA2D_1:	; PONER EL VALOR EN PANTALLA
000abe e060      LDI			R22,00
000abf e280      LDI			R24,32
000ac0 9380 097f 	STS			$097F, R24			; PARA VER LA FRECUENCIA EN PANTALLA
000ac2 9380 0980 	STS			$0980, R24			; BORRA EL VALOR
000ac4 9380 0981 	STS			$0981, R24	
000ac6 da10      RCALL		PRO_TECLA
                 TECLA2D_2:
000ac7 306c      CPI			R22,RETARDO3
000ac8 f3f0      BRLO		TECLA2D_2
                 
000ac9 2f8e      	MOV			R24, R30
000aca dae6      	RCALL		RADC5I    			; CONVERTIR UN NUMERO EN DIGITOS DATO EN R24
000acb 9210 097f 	STS			$097F, R1			; PARA VER LA FRECUENCIA EN PANTALLA
000acd 9220 0980 	STS			$0980, R2
000acf 9230 0981 	STS			$0981, R3		
000ad1 da05      	RCALL		PRO_TECLA
                 ;	RCALL		LINEAP2
                 TECLA2E:
000ad2 316a      	CPI			R22,RETARDO2		; VALOR DEL TIEMPO DE RATARDO LECTURA DEL TECLADO
000ad3 f3f0      	BRLO		TECLA2E				; COMPRUEBA EL TIEMPO DE RETARDO 
000ad4 cfc4      	RJMP		TECLA2				; PARA PROGRAMAR EL REDOX REPITE CICLO	
                 
                 TECLA2U:   ; GRABA EL VALOR DEL REDOX Y CARGA EL CLORO EN R30
000ad5 93e0 020a 	STS			RAMP_RD, R30		; ACTUALIZA EN RAM EL NUEVO VALOR PROGRAMADO DEL REDOX
000ad7 e013      	LDI			R17, RD_MEN
000ad8 2f2e      	MOV			R18, R30			; GRABA EL VALOR DEL REDOX EN EEPROM 242
                 ;	RCALL		I2CE_2404			; ESCRIBE EL NUEVO VALOR EN LA EEPRON EXTERNA
000ad9 daad      	RCALL		EEPROM_ES	
000ada e000      	LDI			R16, 00				; PONE EL RETARDO DEL TECLADO A 0
000adb 2e70      	MOV			TEMP_TEC, R16
000adc dea2      	RCALL		NO_TECLA
000add c37e      	RJMP		TECLA5V				; PROGRAMAR CICLOS
                 
                 
                 
                 
                 
                 
                 .INCLUDE "PRO_CL.ASM"	
                 
                 TECLA3T:
000ade 93e0 0207 	STS			RAMP_CL, R30		; ACTUALIZA EN RAM EL NUEVO VALOR PROGRAMADO DEL CL
000ae0 e012      	LDI			R17, CL_MEN
000ae1 2f2e      	MOV			R18, R30			; GRABA EL VALOR DEL CLORO LIBRE EN EEPROM 242
000ae2 daa4      	RCALL		EEPROM_ES
                 ;	RCALL		I2CE_2404
                 
000ae3 2d0f      	MOV			R16, VAL_LED
000ae4 7b0f      	ANDI		R16, 0B10111111
000ae5 2ef0      	MOV			VAL_LED, R16
000ae6 de36      	RCALL		LEDPANT				; ACTUALIZAR LOS LED DE LA PANTALLA	
000ae7 de97      	RCALL		NO_TECLA
000ae8 9508      	RET
                 
                 TECLA3U: ;GRABA EL VALOR DEL CLORO Y CARGA EL VALOR % PRODUCION
000ae9 93e0 0207 	STS			RAMP_CL, R30		; ACTUALIZA EN RAM EL NUEVO VALOR PROGRAMADO DEL CL
                 ;	LDI			R16, 00
000aeb e012      	LDI			R17, CL_MEN
000aec 2f2e      	MOV			R18, R30			; GRABA EL VALOR DEL CLORO LIBRE EN EEPROM 242
                 ;	RCALL		I2CE_2404			; ESCRIBE EL NUEVO VALOR EN LA EEPRON EXTERNA
000aed da99      	RCALL		EEPROM_ES
000aee de90      	RCALL		NO_TECLA
000aef e000      	LDI			R16, 00				; PONE EL RETARDO DEL TECLADO A 0
000af0 2e70      	MOV			TEMP_TEC, R16
000af1 c36a      	RJMP		TECLA5V
                 TECLARD_CL: 		;VA A PROGRAMACION DEL APAYO DE CLORO
000af2 93e0 0207 STS RAMP_CL,R30
000af4 940e 1814 CALL TECLA6V
                 TECLA3V:
000af6 306a      	CPI			R22, RETARDO1
000af7 f3f0      	BRLO		TECLA3V
000af8 91e0 0207 	LDS			R30, RAMP_CL
000afa e060      	LDI			R22,0
                 TECLA3:							; AJUSTAR PH VALOR EN R30
000afb 95a8      	WDR
000afc 2d87      	MOV			R24, TEMP_TEC
000afd 308f      	CPI			R24, retardo_programacion	; PARA COMPARARLO CON EL RETARDO 20 SEGUNDOS SIN PULSAR TECLA
000afe f6fa      	BRPL		TECLA3T						; Y SALIR DE PROGRAMACION DE PARAMETROS					
000aff 940e 04c0 	CALL		LEC_TEC
000b01 3010      	CPI			R17, 000		; COMPRUEBA SI SE A PULSADO ALGUNA TECLA
000b02 f011      	BREQ		TECLA3A			; SI SE HA PULSADO SALTA A TECLA2A
000b03 e000      	LDI			R16, 00			; SI ES ASI....
000b04 2e70      	MOV			TEMP_TEC, R16			; PONE EL CONTADOR DE RETARDO A CERO
                 TECLA3A:
000b05 3f1e      CPI	R17,0B11111110 ; VA A PROGRAMAR EL AJUSTE DE CORO Y REDOX
000b06 f359      BREQ TECLARD_CL			; OPCION SALTAR PARA AJUSTE DE REDOX
                 ;	CPI			R17, 0B00000100	; TECLA 6
000b07 3f1b      	CPI			R17, 0B11111011	; IDEM
000b08 f301      	BREQ		TECLA3U			; SALTA PARA AJUSTAR EL FACTOR DE PRODUCION
                 			; OPCION SALIR DE LECTURA DE TECLADO 
                 ;	CPI			R17, 0B10000000	; TECLA 5 
000b09 371f      	CPI			R17, 0B01111111 ; IDEM
000b0a f409      	BRNE		TECLA3B			; SI NO ES 80 SALTA A TECLA1D
000b0b cfd2      	RJMP		TECLA3T							; TERMINA Y SALE PARA GRABAR
                 TECLA3B:	; OPCION AUMENTAR RD
                 ;	CPI			R17, 0b00010000	; TECLA 2 INCREMENTA EL VALOR
000b0c 3e1f      	CPI			R17, 0B11101111 ; IDEM
000b0d f439      	BRNE		TECLA3C			; SI NO ESTA PULSADA SALTA PARA VERIFICAR OTRA TECLA
000b0e e000      	LDI			R16, 00				; PONE EL RETARDO DEL TECLADO A 0
000b0f 2e70      	MOV			TEMP_TEC, R16
000b10 95e3      	INC			R30				; INCREMENTA EL VALOR
000b11 e060      	LDI			R22, 0			; CARGA EL RETARDO DE LECTURA DELTECLADO
000b12 31e4      	CPI			R30, CL_MAX		; VERIFICA SI ESTA EN EL VALOR MAXIMO
000b13 f00c      	BRLT		TECLA3C		; SI NO SUPERA EL VALOR MAXIMO SALTA
000b14 e1e4      	LDI			R30, CL_MAX		; SI SUPERA EL MAXIMO LO PONE AL MAXIMO
                 TECLA3C:	; OPCION DISMINUIR RD
                 ;	CPI			R17, 0b00000010	; TECLA 2 PARA DISMINUIR
000b15 3f1d      	CPI			R17, 0B11111101	; IDEM
000b16 f439      	BRNE		TECLA3D			; SI NO ESTA PULSADA SALTA
000b17 e000      	LDI			R16, 00				; PONE EL RETARDO DEL TECLADO A 0
000b18 2e70      	MOV			TEMP_TEC, R16
000b19 95ea      	DEC			R30				; DISMINUYE EL VALOR
000b1a e060      	LDI			R22, 0			; CARGA EL RETARDO DE LECTURA DEL TECLADO
000b1b 30e6      	CPI			R30, CL_MIN		; COMPRUEBA SI SE ELCANZA EL VALOR MINIMO
000b1c f408      	BRBC 		0, TECLA3D		; SI NO SE ALCANZA SALTA
000b1d e0e6      	LDI			R30, CL_MIN		; SI SE ALCANZA PONE EL VALOR MINIMO
                 ; *************OPCION AYUSTAR APOYO DE CLORO  **************************
                 TECLA3D:
000b1e 3f1e      	CPI			R17, 0B11111110		; TECLA 0 PARA VA A PROGRAMAR LA DIFERENCIA PARA EL APOYO DE REDOX
000b1f f411      	BRNE		TECLA3D_1			; SI NO ESTA PULSADA SALTA
000b20 940e 0a90 	CALL		TECLACL_RD
                 
                 TECLA3D_1:	; PONER EL VALOR EN PANTALLA
000b22 e060      	LDI			R22,00
000b23 e280      	LDI			R24,32
000b24 9380 0992 	STS			$992,R24
000b26 9380 0994 	STS			$994,R24
000b28 d9ae      	RCALL		PRO_TECLA
                 TECLA3E:
000b29 306c      	CPI			R22, RETARDO3	; VALOR DEL TIEMPO DE RATARDO LECTURA DEL TECLADO
000b2a f3f0      	BRLO		TECLA3E			; COMPRUEBA EL TIEMPO DE RETARDO 
                 
                 
000b2b 2f8e      	MOV			R24, R30		; PONE EL VALOR EN R24 PARA CONVERTIRLO EN DECIMAL
000b2c da63      	RCALL		RADC   			; CONVERTIR UN NUMERO EN DIGITOS DATO EN R24
000b2d 9220 0992 	STS			$992, R2		; PONE EL RESULTADO EN PANTALLA DECENAS DE CL
000b2f e20e      	LDI			R16, 46
000b30 9300 0993 	STS			$993, R16
000b32 9230 0994 	STS			$994, R3		; PONE EL RESULTADO EN PANTALLA UNIDADES DE CL
000b34 d9a2      	RCALL		PRO_TECLA
                 TECLA3F:
000b35 316a      	CPI			R22, RETARDO2	; VALOR DEL TIEMPO DE RATARDO LECTURA DEL TECLADO
000b36 f3f0      	BRLO		TECLA3F			; COMPRUEBA EL TIEMPO DE RETARDO 
000b37 cfc3      	RJMP		TECLA3	
                 .INCLUDE "PRO_PRO.ASM"
                 
                 ; TECLA 0 PROGRAMAR
                 ; TECLA 1 MENOS
                 ; TECLA 2 FLECHA
                 ; TECLA 3 CALIBRAR
                 ; TECLA 4 MAS
                 ; TECLA 5 
                 ; TECLA 6 NIVEL ACIDO
                 ; TECLA 7 SALIR
                 
                 
                 TECLA4T:	; GRABA EL NUEVO PORCENTAJE DE PRODUCCION Y TERMINA
000b38 93e0 0205 	STS			RAMP_PRO, R30		; ACTUALIZA EN RAM EL NUEVO VALOR PROGRAMADO DE LA PRODUCION
                 ;	LDI			R16, 00
000b3a e011      	LDI			R17, pro_men
000b3b 2f2e      	MOV			R18, R30			; GRABA EL VALOR DEL REDOX EN EEPROM POSICION 241
                 ;	RCALL		I2CE_2404			; ESCRIBE EL NUEVO VALOR EN LA EEPRON EXTERNA
000b3c da4a      	RCALL		EEPROM_ES
000b3d 2d0f      	MOV			R16, VAL_LED
000b3e 7b0f      	ANDI		R16, 0B10111111
000b3f 2ef0      	MOV			VAL_LED, R16
000b40 dddc      	RCALL		LEDPANT				; ACTUALIZAR LOS LED DE LA PANTALLA	
000b41 de3d      	RCALL		NO_TECLA
                 ;CALL		P_NEXTION_PAGE
000b42 9508      	RET
                 
                 TECLA4U:  ; GRABA EL PORCENTAJE Y CARGA LOS CICLOS PARA LA INVERSION
000b43 93e0 0205 	STS			RAMP_PRO, R30		; ACTUALIZA EN RAM EL NUEVO VALOR PROGRAMADO DE LA PRODUCION
                 ;	LDI			R16, 00
000b45 e011      	LDI			R17, pro_men
000b46 2f2e      	MOV			R18, R30			; GRABA EL VALOR DEL REDOX EN EEPROM POSICION 241
                 ;	RCALL		I2CE_2404			; ESCRIBE EL NUEVO VALOR EN LA EEPRON EXTERNA
000b47 da3f      	RCALL		EEPROM_ES
                 
000b48 91e0 0214 	LDS			R30, RAM_CICLOS
000b4a e000      	LDI			R16, 00				; PONE EL RETARDO DEL TECLADO A 0
000b4b 2e70      	MOV			TEMP_TEC, R16
000b4c de32      	RCALL		NO_TECLA
000b4d c915      	RJMP		TECLA				; VA A RUTINA PROGRAMACION DE PH
                 AJUSTE_PRE:
000b4e 940e 0045 	CALL		AJUSTE_PRESENTACION
000b50 9508      	RET
                 TECLA4V:
000b51 306a      	CPI			r22, RETARDO1
000b52 f3f0      	BRLO		TECLA4V	
000b53 91e0 0205 	LDS			R30, RAMP_PRO		; LEE EL VALOR PROGRAMADO EN LA RAM
000b55 e060      	LDI			R22,00
                 
                 TECLA4:								; AJUSTAR EL VALOR DEL TANTO POR CIENTO DE LA PRODUCION VALOR EN R30
000b56 2d0f      	MOV			R16, VAL_LED
000b57 6400      	ORI			R16, 0B01000000		; ENCIENDE LA LUZ DE LA PANTALLA
000b58 2ef0      	MOV			VAL_LED, R16
000b59 ddc3      	RCALL		LEDPANT		
                 
                 
000b5a 95a8      	WDR
000b5b 2d87      	MOV			R24, TEMP_TEC
000b5c 308f      	CPI			R24, retardo_programacion	; PARA COMPARARLO CON EL RETARDO 20 SEGUNDOS SIN PULSAR TECLA
000b5d f6d2      	BRPL		TECLA4T				; Y SALIR DE PROGRAMACION DE PARAMETROS					
000b5e 940e 04c0 	CALL		LEC_TEC				; RUTINA LECTURA DE TECLADO
000b60 3f1f      	CPI			R17, 0B11111111		; COMPRUEBA SI SE A PULSADO ALGUNA TECLA
000b61 f011      	BREQ		TECLA4A				; SI SE HA PULSADO SALTA A TECLA4A
000b62 e000      	LDI			R16, 00				; SI ES ASI....
000b63 2e70      	MOV			TEMP_TEC, R16		; PONE EL CONTADOR DE RETARDO A CERO
                 TECLA4A:
                 
000b64 3712      	CPI			R17, 0B01110010
000b65 f341      	BREQ		AJUSTE_PRE			; AJUSTE PRESENTACION	
                 			; OPCION SALTAR PARA AJUSTE DE PH
000b66 3f1b      	CPI			R17, 0B11111011		; TECLA 2
000b67 f2d9      	BREQ		TECLA4U				; SALTA PARA AJUSTAR EL PH
                 			; OPCION SALIR DE LECTURA DE TECLADO 
000b68 371f      	CPI			R17, 0B01111111		; TECLA 5 
000b69 f409      	BRNE		TECLA4B				; SI NO ES 80 SALTA A TECLA1D
000b6a cfcd      	RJMP		TECLA4T				; TERMINA Y SALE PARA GRABAR
                 TECLA4B:	; OPCION AUMENTAR
000b6b 3e1f      	CPI			R17, 0B11101111		; TECLA 2 INCREMENTA EL VALOR
000b6c f439      	BRNE		TECLA4C				; SI NO ESTA PULSADA SALTA PARA VERIFICAR OTRA TECLA
000b6d e000      	LDI			R16, 00				; PONE EL RETARDO DEL TECLADO A 0
000b6e 2e70      	MOV			TEMP_TEC, R16
000b6f 95e3      	INC			R30					; INCREMENTA EL VALOR
000b70 e060      	LDI			R22, 0				; CARGA EL RETARDO DE LECTURA DELTECLADO
000b71 36e4      	CPI			R30, PRO_MAX		; VERIFICA SI ESTA EN EL VALOR MAXIMO
000b72 f00c      	BRLT		TECLA4C				; SI NO SUPERA EL VALOR MAXIMO SALTA
000b73 e6e4      	LDI			R30, PRO_MAX		; SI SUPERA EL MAXIMO LO PONE AL MAXIMO
                 TECLA4C:	; OPCION DISMINUIR PRODUCION
000b74 3f1d      	CPI			R17, 0B11111101		; TECLA 2 PARA DISMINUIR
000b75 f439      	BRNE		TECLA4C1			; SI NO ESTA PULSADA SALTA
000b76 e000      	LDI			R16, 00				; PONE EL RETARDO DEL TECLADO A 0
000b77 2e70      	MOV			TEMP_TEC, R16
000b78 95ea      	DEC			R30					; DISMINUYE EL VALOR
000b79 e060      	LDI			R22, 0				; CARGA EL RETARDO DE LECTURA DEL TECLADO
000b7a 30e5      	CPI			R30, PRO_MIN		; COMPRUEBA SI SE ELCANZA EL VALOR MINIMO
000b7b f4a0      	BRBC 		0, TECLA4D			; SI NO SE ALCANZA SALTA
000b7c e0e5      	LDI			R30, PRO_MIN		; SI SE ALCANZA PONE EL VALOR MINIMO
                 TECLA4C1:	; OPCION PRODUCION MANUAL ANULA REDOX Y CLORO
000b7d 3f15      	CPI			R17, 0B11110101		; TECLA CALIBRAR Y MENOS
000b7e f449      	BRNE		TECLA4C2			; SI NO ESTA PULSADA SALTA
000b7f e213      	LDI			R17, PA_PM
000b80 e020      	LDI			R18, 0
000b81 940e 0587 	CALL		EEPROM_ES
000b83 98c1      	CBI			PORTB, S_RD_CL		; DESCONECTA EL  APOYO LA BOMBA DE REDOX Y CLORO
000b84 94e8      	CLT								; PONE A 1 EL REGISTRO T DE SREG
000b85 f8b2      	BLD			CONTROL_1,2			; LINEA DE CONTROL 
000b86 7b4f      	CBR			CONTROL, 0B01000000	; LINEA DE CONTROL PARA LA FUENTE EN RUTINA RELOJ SI EL VALOR MEDIDO
000b87 774f      	CBR			CONTROL, 0B10000000	; LINEA DE CONTROL PARA LA FUENTE EN RUTINA RELOJ SI EL VALOR MEDIDO
                 TECLA4C2:	; OPCION PRODUCION AUTOMATICA MIDE CLORO  Y REDOX
000b88 3e17      	CPI			R17, 0B11100111		; TECLA CALIBRAR Y MAS
000b89 f431      	BRNE		TECLA4D				; SI NO ESTA PULSADA SALTA
000b8a e213      	LDI			R17, PA_PM
000b8b e021      	LDI			R18, 1
000b8c 940e 0587 	CALL		EEPROM_ES
000b8e 9468      	SET								; PONE A CERO EL BIT T DE SREG
000b8f f8b2      	BLD			CONTROL_1,2			; PASA EL REGISTRO T A CONTROL_1
                 
                 
                 
                 TECLA4D:	; PONER EL VALOR EN PANTALLA
                 
000b90 3f17      	CPI			R17, 0B11110111		; TECLA CALI 
000b91 f0b9      	BREQ		TECLA4F				; VA A PRESENTAR EN PAMTALLA TENSION E INTENSIDAD
000b92 e060      	LDI			R22,00
000b93 e200      	LDI				R16,32			; BORRA EL VALOR EN PANTALLA UNA VEZ POR SEGUNDO
000b94 9300 0956 	STS				$956,R16
000b96 9300 0957 	STS				$957,R16
000b98 9300 0958 	STS				$958,R16
000b9a d93c      	RCALL		PRO_TECLA
                 TECLA4D_1:
000b9b 3067      	CPI			R22,RETARDO3-5		; VALOR DEL TIEMPO DE RATARDO LECTURA DEL TECLADO
000b9c f3f0      	BRLO		TECLA4D_1			; COMPRUEBA EL TIEMPO DE RETARDO DIGITO APAGADO
                 
000b9d 2f8e      	MOV			R24, R30			; PONE EL VALOR EN R24 PARA CONVERTIRLO EN DECIMAL
000b9e d9f1      	RCALL		RADC   				; CONVERTIR UN NUMERO EN DIGITOS DATO EN R24
000b9f 9210 0956 	STS			$0956, R1			
000ba1 9220 0957 	STS			$0957, R2			; PONE EL RESULTADO EN PANTALLA DECENAS DE PH
000ba3 9230 0958 	STS			$0958, R3			; PONE EL RESULTADO EN PANTALLA UNIDADES DE PH
000ba5 d931      	RCALL		PRO_TECLA
                 
                 TECLA4E:
000ba6 316a      	CPI			R22, RETARDO2		; VALOR DEL TIEMPO DE RATARDO LECTURA DEL TECLADO
000ba7 f3f0      	BRLO		TECLA4E				; COMPRUEBA EL TIEMPO DE RETARDO 
000ba8 cfad      	RJMP		TECLA4	
                 
                 
                 TECLA4F:
                 
                 ;       20x4        16x4   tipo de display
                 ; linea 1-128 		128 
                 ; linea 2-192		192
                 ; linea 3-148		144
                 ; linea 4-212		208
000ba9 e904      	LDI				R16,148				; ESCRIBIR LINEA 3
000baa d993      	RCALL			ENVINT				; En subrrutina Env_doi Envia instrucion para escribir en linea 1
000bab e0d7      	LDI				YH, HIGH(L_BLANCA)	; POSICION BIT ALTO DEL TEXTO A ENVIAR ram en 070
000bac e1c8      	LDI				YL, LOW (L_BLANCA)	; POSICION BIT BAJO DEL TEXTO A ENVIAR
000bad e114      	LDI				R17,20				; NUMERO DE DIGITOS A ENVIAR A PANTALLA
000bae dd76      	RCALL			ENVIARTEXTO			; RUTINA EN ESTE FICHERO PRECISA SUBRRUTINA ENV_DOI	
                 
000baf ed04      	LDI				R16,212				; ESCRIBIR LINEA 4
000bb0 d98d      	RCALL			ENVINT				; En subrrutina Env_doi Envia instrucion para escribir en linea 1
000bb1 e0d7      	LDI				YH, HIGH(L_VOLTIOS)	; POSICION BIT ALTO DEL TEXTO A ENVIAR ram en 070
000bb2 e2cc      	LDI				YL, LOW (L_VOLTIOS)	; POSICION BIT BAJO DEL TEXTO A ENVIAR
000bb3 e114      	LDI				R17,20				; NUMERO DE DIGITOS A ENVIAR A PANTALLA
000bb4 dd70      	RCALL			ENVIARTEXTO			; RUTINA EN ESTE FICHERO PRECISA SUBRRUTINA ENV_DOI	
000bb5 cfa0      	RJMP			TECLA4
                 .INCLUDE "MED_PH+.ASM"
                 
                 ; opto		pata2		pata3
                 ; ph 7.0	 0,97		  0,76
                 ; ph 3.8	 1.02		  0,76
                 
                 ;		RUTINA MED_PH
                 ; PINB,7 SELECCIONA SUBIR O BAJAR PH SIN PUENTE BAJAR
                 
                 
                 PRO2F2: ; APAGA BOMBA DE PH Y LED EN ESTE CASO ES POR DEFECTO DE SONDA
000bb6 9300 0200 	STS				RAM_PH, R16
000bb8 2d0f      	MOV				R16, VAL_LED
000bb9 7e0f      	ANDI			R16, 0B11101111		; APAGA LED 4 PH EN PANTALLA
000bba 2ef0      	MOV				VAL_LED, R16
000bbb 9895      	CBI				PORTD,b_acido		; APAGA BOMBA DE ACIDO
000bbc e405      	LDI				R16,69				; PONE UNA E "ERROR DE SONDA"
000bbd 9300 046d 	STS				$46D,R16
000bbf e503      	LDI				R16,83				; PONE UNA S "ERROR DE SONDA"
000bc0 9300 046f 	STS				$46F,R16
000bc2 e200      	LDI				R16,32
000bc3 9300 046c 	STS				$46C,R16
                 VOLVER:
000bc5 9508      	RET
                 
                 PRO2:	; PARA MEDIR EL PH
000bc6 95a8      	WDR
000bc7 e023      	LDI				R18, P_PH				; LINEA DE ENTRADA EN EL CONVERTIDOR PCF8591
000bc8 eea7      	LDI				R26,231				; NUMERO DE LECTURAS Ó CALIBRACION
000bc9 940e 013c 	CALL			ADC_P
                 ;RCALL RADC
                 ;STS				$131, R1
                 ;STS				$132, R2
                 ;STS				$133, R3
                 ;*****************************************PARA MOSTRAR EL PH SIN SONDA*******************************************************
                 ;LDI R24,148  ; PH FIJO A 7.3
                 
000bcb e00f      	LDI				R16, 15				; VALOR MINIMO NO SE DETECTA SONDA DE Ph
000bcc 1780      	CP				R24, R16
000bcd f418      	BRSH			PRO2D				; SALTA PRO5D SI EL MODULO ESTA CONECTADO
000bce 7e4f      	CBR			CONTROL, 0B00010000		; LINEA DE CONTROL SIN SONDA DE Ph SOLO PRESENTA LINEA DE PRODUCION Y SAL
000bcf 9895      	CBI				PORTD,b_acido		; APAGA BOMBA DE ACIDO
000bd0 9508      	RET
                 ; TIENE QUE SER EL VALOR LEIDO + Ó - DOS UNIDADES PARA QUE SE GRABE EN LA RAM
                 
                 PRO2D:
000bd1 6140      	SBR				CONTROL, 0B00010000	; LINEA DE CONTROL LA PONE A 1 TIENE SONDA DE PH
000bd2 9130 0401 	LDS				R19, MINU
000bd4 3031      	CPI				R19, 01				; VERIFICA QUE HAN PASADO DOS MINUTO PARA EMPEZAR A MEDIR
000bd5 f378      	BRBS			0, VOLVER			; SI ES MENOR DE DOS MINUTOS SALTA A VOLVER
000bd6 ed08      	LDI				R16, 216			; RESTA 10 PARA LUEGO SUMERLE LA CALIBRACION ENTRE 0 Y 20
000bd7 1b08      	SUB				R16, R24			; Y RESTANDOLO DEL LEIDO			
000bd8 9130 0202 	LDS				R19, RAMC_PH		; LEE EL VALOR DE CALIBRACION que suele ser 10
000bda 0f03      	ADD				R16, R19			; SE LA SUMA AL LEIDO
000bdb 3708      	CPI				R16, 120
000bdc f6c8      	BRBC			0, PRO2F2			; APAGA BAMBA DE PH Y LED PANTALLA POR FALLO EN SONDA			
000bdd 2f80      	MOV				R24, R16
000bde 3072      	CPI				LEC_REL, 2			; SI NO SON 5 EJECUTA LA PROXIMA INSTRUCION
000bdf f411      	BRNE			PRO2DA1				; Y SALTA A PRO3A1 PARA NO GRABAR DIRECTAMENTE PH REAL MEDID0
000be0 9300 0200 	STS				RAM_PH, R16
                 PRO2DA1:
                 
000be2 e28e      	LDI				R24, 46				; PONE EL PUNTO DEL PH
000be3 9380 025e 	STS				$25E, R24
000be5 9300 0203 	STS 			PH_REAL, R16
000be7 9180 0200 	LDS				R24, RAM_PH			; LEE EL VALOR GRABADO EN RAM Y AMORTIGUADO
000be9 9602      	ADIW			R24, 2				; INCREMENTO EN DOS UNIDADES Y
000bea 1708      	CP				R16, R24			; LO COMPARA CON EL VALOR ULTIMO LEIDO
000beb f024      	BRLT			PRO2D1				; SI NO ES MAYOR DE DOS DECIMAS NO LO ALMACENA
000bec 958a      	DEC				R24
000bed 9380 0200 	STS				RAM_PH, R24			; ALMACENA LA MEDICION EN LA MEMORIA RAM
000bef c006      	RJMP			PRO2D2
                 PRO2D1:
000bf0 5084      	SUBI			R24, 4
000bf1 1780      	CP				R24,R16				; Y LO VUELVE A COMPARAR CON EL ALMACENADO
000bf2 f01c      	BRLT			PRO2D2
000bf3 9583      	INC				R24
000bf4 9380 0200 	STS				RAM_PH, R24			; ALMACENA LA MEDICION EN LA MEMORIA RAM
                 PRO2D2:
000bf6 9180 0200 LDS R24,RAM_PH
000bf8 d997      	RCALL			RADC				; PONER VALOR REAL PH EN LINEA 2
000bf9 9210 046c 	STS				$46C,R1
000bfb 9220 046d 	STS				$46D,R2				; COLOCA EN PANTALLA NORMAL LAS UNIDADES
000bfd 9230 046f 	STS				$46F,R3				; COLOCA EN PANTALLA NORMAL LAS DECIMAS DE PH
000bff 9210 0918 	STS				$918,R1				; COLOCA EN PANTALLA CALIBRACION LAS DECENAS
000c01 9220 0919 	STS				$919,R2				; COLOCA EN PANTALLA CALIBRACION LAS INIDADES
000c03 9230 091b 	STS				$91B,R3				; COLOCA EN PANTALLA CALIBRACION LAS DECIMAS
                 
000c05 9180 0201 LDS R24,RAMP_PH
000c07 d988      	RCALL			RADC				; PONER VALOR DEL PH PROGRAMADO EN LINEA 2
                 ;	STS				$45F, R1
000c08 9220 0460 	STS				$460, R2			; PONE EN PANTALLA NORMAL LAS UNIDADES DE PH PROGRAMADO
000c0a 9230 0462 	STS				$462, R3			; PONE EN PANTALLA NORMAL LAS DECIMAS DE PH PROGRAMADO
000c0c 9220 096b 	STS				$96B, R2			; COLOCA EN PANTALLA PROGRAMACION LAS UNIDADES
000c0e 9230 096d 	STS				$96D, R3			; COLOCA EN PANTALLA PROGRAMACION LAS DECIMAS
000c10 e22e      LDI	R18,46 ;COLOCA UN PUNTO
000c11 9320 096c STS	$96C,R18
000c13 9320 091a STS $91A,R18
000c15 9130 0200 	LDS				R19, RAM_PH			
000c17 9120 0201 	LDS				R18, RAMP_PH
                 ; APAGA BOMBA DE PH SI EL VALOR LEIDO ES MAYOR DE 9.0 POSIBLE AVERIA APAGA BOMBA
000c19 e58b      	LDI				R24,91				; VALOR MAX. DEL PH PARA APAGAR BOMBA DOSIFICADORA DE PH
000c1a 1738      	CP				R19,R24				; SI R19 ES MENOR QUE R24 VA A PRO2A
000c1b f00c      	BRLT			PRO2E				; SI NO ES MAYOR R19 QUE R24 NO SALTA A PRO2E SEGUIMOS
000c1c c024      	RJMP			PRO2F1				; APAGA LED Y BOMBA DE PH
                 PRO2E:
                 ;APAGAR BOMBA DE PH DESPUES DE X MINUTOS/hora
000c1d 9190 0401 	LDS  			R25, minu			; CARGA LOS MINUTOS BOMBA ENCENDIDA
000c1f e38c      	LDI				R24, 60				; CARGA EL TIEMPO DE FUNCIONAMIENTO DE LA BOMBA
000c20 1798      	CP				R25, R24
000c21 f008      	BRLO			PRO2E1				; VA A PRO2E1 SI R25 ES MENOR QUE R24
000c22 c01e      	RJMP			PRO2F1				; APAGA LED Y BOMBA DE PH
                 PRO2E1:
                 ; VERIFICAR NIVEL DE ACIDO
000c23 fcf5      	SBRC			VAL_LED, 5			; VERIFICA EL LED 5 FALTA DE NIVEL EN EL DEPOSITO
000c24 c01c      	RJMP			PRO2F1				; Y SALTA ESTA INSTRUCION SI ES UNO "HAY NIVEL" PAGA LED Y BOMBA DE PH
                 ; OPCION PROPORCIONAL A 8 CICLOS Y DETECCION OPCION SUBIR O BAJAR PH
                 PRO2E2:
000c25 7097      	ANDI			R25, 7				; ELIMINA LOS BIT 3-4-5-6-7 DEL REGISTRO DE CICLOS HORA
                 ; OPCION SUBIR O BAJAR PH ENTRADA DE SEÑAL EN PINB,7
000c26 b266      	IN				R6, PINB			; VERIFICA SI HAY PUENTE EN PIND3 CON NEGATIVO
000c27 fc67      	SBRC			R6, 7				; EN CUYO CASO VA A PRO2E SUBIR PH
000c28 c00c      	RJMP			PRO2E4				; OPCION BAJAR PH
                 PRO2E3: ; OPCION SUBIR PH
000c29 9130 0200 	LDS				R19, RAM_PH			
000c2b 9120 0201 	LDS				R18, RAMP_PH
000c2d 9533      	INC				R19
000c2e 1b23      	SUB				R18, R19
000c2f fd27      	SBRC			R18, 7				; VERIFICA SI HAY DESBORDAMIENTO
000c30 c010      	RJMP			PRO2F1				; EN CUYO CASO APAGA LA BOMBA DE PH
000c31 0f22      	LSL				R18
000c32 1729      	CP				R18, R25
000c33 f068      	BRLO			PRO2F1
000c34 c011      	RJMP			PRO2H				; APAGA LED Y BOMBA DE PH
                 
                 PRO2E4: ; OPCION NORMAL BAJAR PH
000c35 9130 0200 	LDS				R19, RAM_PH			
000c37 9120 0201 	LDS				R18, RAMP_PH
000c39 9523      	INC				R18					; INCREMENTA EN UNO PARA QUE PARE EN CASO DE SER IGUALES
000c3a 1b32      	SUB				R19, R18
000c3b fd37      	SBRC			R19, 7				; VERIFICA SI HAY DESBORDAMIENTO
000c3c c004      	RJMP			PRO2F1				; EN CUYO CASO APAGA LA BOMBA DE PH
000c3d 0f33      	LSL				R19					; MULTIPLICA POR 2
000c3e 1739      	CP				R19, R25
000c3f f008      	BRLO			PRO2F1				; ENCIENDE BOMBA DE PH
000c40 c005      	RJMP			PRO2H
                 PRO2F1: ; APAGA BOMBA DE PH Y LED
000c41 2d0f      	MOV				R16, VAL_LED
000c42 7e0f      	ANDI			R16, 0B11101111		; APAGA LED 4 PH EN PANTALLA
000c43 2ef0      	MOV				VAL_LED, R16
000c44 9895      	CBI				PORTD,b_acido		; APAGA BOMBA DE ACIDO
                 
                 
000c45 9508      	RET
                 PRO2H: ;ENCIENDE BOMBA DE PH Y LED
000c46 2d0f      	MOV				R16, VAL_LED
000c47 6100      	ORI				R16, 0B00010000		; ENCIENDE LED 4 PH EN PANTALLA
000c48 2ef0      	MOV				VAL_LED, R16	
000c49 9a95      	SBI				PORTD,b_acido		; ENCIENDE BOMBA DE ACIDO
                 
000c4a 940e 1de9 		CALL		P_NEXTION_FINAL 	; ENVIA 3 0xFF
                 
000c4c 9508      	RET
                 .INCLUDE "MED_SAL.ASM"
                 
                 ; AJUSTAR CON EL POT DE 1Mh Nº 57  LA INTENSIDAD DEL EQUIPO
                 ; AJUSTAR CON EL POT 10K Nº 21 LA CONCENTRACION DE SAL
                 ; CON UNA TENSION DE 1,60 EN PATA 4 DEBE MARCAR 6,2
                 ; RUTINA MED_SAL EL RESULTADO EN R4
                 PRO3D1B: 			; ACTIBA EL PILOTO DE SAL BAJA
000c4d e091      	LDI				R25,1
000c4e 9390 0b06 	STS				0XB06,R25				; PONE EN 0XB06 UN 1
000c50 c02f      	RJMP			PRO3D
                 
                 PRO3D1A:		;	PRESENTACION DE AVERIA EN FUENTE O RELE
000c51 ef30      	LDI				R19,240			; SEGUNDOS DE RETARDO
000c52 940e 18c1 	CALL			RUT_RETARDO			; SI NO HAN PASADO SIGUE CONTANDO
                 ;	CLR				LEC_REL
                 PRO3D1AA: ;RUTINA DE RETARDO PARA LE PRESENTACION DEL ERROR 
000c54 91a0 020d 	LDS				R26, RAMC_SAL		; NUMERO DE MEDICIONES
000c56 e026      	LDI				R18,P_SAL			; LINEA DE ENTRADA EN EL CONVERTIDOR
000c57 940e 013c 	CALL			ADC_P
                 ;	LDS				R18,RAM_MED_INI_SAL	; CARGA EL ERROR INICIAL DEL TLC26 EN R18
                 ;	SUB				R24,R18				; RESTA EL ERROR INICIAL DE LA MEDICION
                 PRO3D1AB:
000c59 fd87      	SBRC			R24,7				; SALTA LA SIGUIENTE INSTRUCION SI EL BIT 7 DE R24 ES CERO OSEA MENOR DE 126
000c5a e080      	LDI				R24,00				; LO PONE A CERO POR HABER DADO LA VUELTA
000c5b 3088      	CPI				R24,8				; SI LA MEDICION REAL ES MENOR DE 0,8 7+1 para evitar la repeticion ciclica NO EJECUTA LA SIGUIENTE INSTRU
000c5c f490      	BRBC			0, PRO3_NEXTION				; FALSO ERROR MEDICION MAYOR DE 7
                 
                 ; RUTINA ESCRITURA LINEA2 EN CASO DE ERROR EQUIPO DETENIDO AVERIA Y PAGINA ERROR DE NEXTION LA 4
000c5d e304      		LDI			R16,52				; ESCRIBE EN RAM LA PAGINA A ENVIAR LA 04
000c5e 9300 0a01 		STS			0xA01,R16
000c60 940e 1f9e 		CALL		P_NEXTION_PAGE		; TERMINA EL TIEMPO Y VA A PANTALLA PRINCIPAL
                 
000c62 940e 1906 	CALL			VER_ERROR
000c64 940e 02f2 	CALL			APAGAR_FUENTE
000c66 9895      	CBI				PORTD,b_acido		; APAGA BOMBA DE ACIDO
000c67 2d0f      	MOV				R16, VAL_LED
000c68 7f0e      	ANDI			R16, 0B11111110		; APAGA LED 0 FUENTE ENCENDIDA
000c69 2ef0      	MOV				VAL_LED, R16	
000c6a 940e 091d 	CALL			LEDPANT
000c6c c085      	RJMP			PRO3CA4			
                 
                 
                 
                 PRO3D2A_1: 			; PARA SALTAR MAS VA A RUTINA VERIFICACION DE CAUDAL 
000c6d 940c 116e 	JMP				CONTROL_CAUDAL		; EL RETORNO SE HACE A PRO3D
                 
                 PRO3_NEXTION:				; PARA IR A LA PAGINA PRINCIPAL
                 
000c6f e300      		LDI			R16,48				; ESCRIBE EN RAM LA PAGINA A ENVIAR LA 00
000c70 9300 0a01 		STS			0xA01,R16
000c72 940e 1f9e 		CALL		P_NEXTION_PAGE		; VA A PANTALLA PRINCIPAL
                 
                 
                 PRO3:				; PARA MEDIR LA SAL DEL AGUA AQUI EMPIEZA
000c74 95a8      	WDR
                 
                 ;	LDI				R16,0x2E			; SE PONE UN VALOR FIJO PARA MEDIR LA  SAL 70% DE PRODUCCION 0x02E
                 ;	STS				OCR3AH,R16
                 ;	LDI				R16,0x2E
                 ;	STS				OCR3AL,R16	
                 	; VALOR DE MEDICION TOTAL	
000c75 e026      	LDI				R18,P_SAL			; LINEA DE ENTRADA EN EL CONVERTIDOR PCF8591
000c76 91a0 020d 	LDS				R26, RAMC_SAL		; NUMERO DE MEDICIONES	
000c78 940e 013c 	CALL			ADC_P
                 ;LDI R24,54			;******************************* ********************************************************************
000c7a 9380 0b0d 	STS				SAL_UART,R24
                 PRO3C:
000c7c 3086      	CPI				R24,06				; SI LA MEDICION REAL ES MENOR DE 0,6 SALTA DIRECTAMENTE
000c7d f298      	BRBS			0,PRO3D1A			; VA A RETARDO CUENTA 240 SEGUNDOS
000c7e 308f      	CPI				R24,15				; PARA ENVIAR MENSAJE DE SAL BAJA		
000c7f f268      	BRBS			0,PRO3D1B			; ACTIBA EL PILOTO DE SAL BAJA RETORNA A PRO3D
                 ; ELIMINADA LA OPCION DE CONTROL CAUDAL POR BAJA PRODUCION
                 ;	CPI				R24, 20
                 ;	BRBS			0, PRO3D2A_1		; VA A PUENTE DE SALTO Y RETORNA A PRO3D
                 ;	LDI				R18, 10				; PONE EL CONTADOR DE SEGUNDOS A 10
                 ;	STS				RAM_CAUDAL, R18		; LIMPIA DE SEGUNDOS EL CONTROL DE CAUDAL ENPIEZA EN 10 SEGUNGOS
                 
                 PRO3D: ;Grabar el valor en RAM Ó NO
000c80 2f08      	MOV				R16, R24			; PASA EL VALOR DE LA LECTURA A R16
000c81 940e 0590 	CALL			RADC				; PRESENTA EN LINEA 3 LA MEDICION DE SAL REAL
000c83 9210 0254 	STS				$254, R1			; DECENAS
000c85 9220 0255 	STS				$255, R2			; UNIDADES
000c87 9230 0257 	STS				$257, R3			; DECIMAS	
000c89 9210 0904 	STS				$904,R1				; PONE EN PANTALLA CALIBRAR SAL
000c8b 9220 0905 	STS				$905,R2				; PONE EN PANTALLA CALIBRAR SAL
000c8d 9230 0907 	STS				$907,R3				; PONE EN PANTALLA CALIBRAR SAL
                 
                 ; ACTUALIZA LA SAL SIN AMORTIGUADOR
000c8f 3075      	CPI				LEC_REL, 5			; SI NO SON 5 EJECUTA LA PROXIMA INSTRUCION
000c90 f421      	BRNE			PRO3A1				; Y SALTA A PRO3A1 PARA NO GRABAR DIRECTAMENTE LA SAL REAL MEDIDA
000c91 9300 020c 	STS				RAM_SAL, R16		; ALMACENA EN LA MEMORIA RAM
000c93 9300 0210 	STS				RAM_SAL_C, R16		; ALMACENA LA MEDICION EN LA MEMORIA RAM
                 PRO3A1:
                 ; AQUI INCREMENTA EL VALOR DE R24
000c95 9180 020c 	LDS				R24, RAM_SAL		; LEE EL VALOR GRABADO EN RAM
000c97 9583      	INC				R24					; INCREMENTO EN UNA UNIDAD 
000c98 9583      	INC				R24
000c99 1708      	CP				R16, R24			; LO COMPARA CON EL VALOR ULTIMO LEIDO
000c9a f030      	BRCS			PRO3D1				; SI NO ES MAYOR DE DOS DECIMAS NO LO ALMACENA
000c9b 958a      	DEC				R24
000c9c 9380 020c 	STS				RAM_SAL, R24		; ALMACENA LA MEDICION EN LA MEMORIA RAM
000c9e 9380 0210 	STS				RAM_SAL_C, R24
000ca0 c008      	RJMP			PRO3D2				; SALTA A PRO3D2 COMPENSACION POR TEMPERARURA
                 PRO3D1:
000ca1 5084      	SUBI			R24,4
000ca2 1780      	CP				R24,R16				; Y LO VUELVE A COMPARAR CON EL ALMACENADO
000ca3 f028      	BRCS			PRO3D2				; SALTA A PRO3D2
000ca4 9583      	INC				R24
000ca5 9380 020c 	STS				RAM_SAL, R24		; ALMACENA LA MEDICION EN LA MEMORIA RAM
000ca7 9380 0210 	STS				RAM_SAL_C, R24		; 
                 PRO3D2:		; COMPENSACION POR TEMPERATURA
000ca9 9120 020f 	LDS				R18, RAM_TEMP
000cab e09a      	LDI				R25, 10
000cac d925      	RCALL			COMP				; COMPRUEBA SI ES MAYOR DE 4 GRADOS
000cad ff40      	SBRS			CONTROL, 0			; VERIFICA SI ES CERO EL BIT 0 SI ES CIERTO SALTA LA SIG. INSTRUCION
000cae c010      	RJMP			PRO3D2C				; POR SI NO HAY SONDA PT1000  O LA TEMP. ES MAYOR DE 35ºC
000caf e590      	LDI				R25, 80
000cb0 d921      	RCALL			COMP
000cb1 fd40      	SBRC			CONTROL, 0			; VERIFICA SI ES CERO EL BIT 0 SI ES CIERTO SALTA LA SIG. INSTRUCION
000cb2 c00c      	RJMP			PRO3D2C				; POR SI NO HAY SONDA PT1000  O LA TEMP. ES MAYOR DE 35ºC
000cb3 7f4b      	CBR				CONTROL, 0B00000100	; SEÑAL DE CONTROL EN VERANO INVIERNO A CERO
                 ; COMPENSACION DE LA LECTURA DE SAL EN FUNCION DE LA TEMPERATURA
000cb4 9180 020c 	LDS				R24, RAM_SAL		; CARGA EN R24 EL VALOR LEIDO DE LA SAL
000cb6 0f88      	LSL				R24					; LO MULTIPLICA POR DOS JE JE
000cb7 1b92      	SUB				R25, R18			; RESTA A R25 QUE ES 70 LA TEMPERATURA REAL
000cb8 0f99      	LSL				R25					; MULTIPLICA POR 2
000cb9 e338      	LDI				R19, 128 - 72
000cba 0f93      	ADD				R25, R19
000cbb 9f98      	MUL				R25, R24
000cbc 2d81      	MOV				R24, R1
000cbd 9380 0210 	STS				RAM_SAL_C, R24		; ALMACENA LA MEDICION EN LA MEMORIA RAM
                 PRO3D2C:
000cbf fd43       	SBRC			CONTROL, 3			; SALTA LA PROXIMA INSTRUCION SI ES CERO, NO SUPERCLORACION
000cc0 c004      	RJMP			PRO3D2A				; LA SALTA SI NO ESTA EN SUPERCLORACION
000cc1 308a      	CPI				R24, lim_sal		; LIMITE DE SAL  MENSAJE " AÑADIR SAL" " -.- kG/M3"
000cc2 f030      	BRBS			0,PRO3CA			; SI ES MAYOR DE 15 NO VA
000cc3 9468      	SET									; PONE ES REGISTRO T A 0 SET LO PONE A 1
000cc4 f8b5      	BLD				CONTROL_1, 5		; PASA EL REGISTRO T A CONTROL_1
                 
                 PRO3D2A:
000cc5 9508      	RET
                 PRO3D2B:	; GRABA LA NUEVA MEDICION DE SAL PARA PODER VERIFICAR SI VARIA
000cc6 9380 0211 	STS				RAM_SAL_CORTE, R24
000cc8 9508      	RET
                 
                 ; PRESENTACION EN PANTALLA DE ERROR EN CONCENTRACION DE SAL EN EL AGUA, CONCENTRACION BAJA
                 ; INDICA GRAMOS POR LITRO A AÑADIR
                 PRO3CA:
000cc9 95a8      	WDR									; ACTUALIZA EL PERRO GUARDIAN
000cca ff71      	SBRS			LEC_REL, 1			; TEMPORIZA A 2 SEGUNDOS
000ccb 9508      	RET
                 
                 PRO2CA4: ; RETORNO DE ERROR_2
000ccc 9190 0211 	LDS				R25, RAM_SAL_CORTE	; LEE EL VALOR ANTERIOR PARA COMPARARLO CON EL NUEVO
000cce 1789      	CP				R24, R25
000ccf f7b1      	BRNE			PRO3D2B				; SALTA SI SON DISTINTOS LOS VALORES			
                 	; SI SON IGUALES PRESENTA EN PANTALLA ERROR Y VALOR DE SAL A AÑADIR
000cd0 e39f      	LDI				R25, 63				; CANTIDAD A LA QUE RESTAR
000cd1 1b98      	SUB				R25, R24			; LA MEDICION DE SAL
000cd2 2f89      	MOV				R24, R25			; LA MUEVE A R24 PARA CONVERTIRLA EL UNIDADES Y DECIMAS
000cd3 5083      	SUBI			R24, 3
000cd4 d8bb      	RCALL			RADC
000cd5 9220 05bb 	STS				$05BB, R2			; GRABA EN RAM LAS UNIDADES
000cd7 9230 05bd 	STS				$05BD, R3			; GRABA EN RAM LAS DECIMAS
                 ; CAMBIA EL MENSAJE SI LA CONCENTRACION ES NULA
000cd9 e095      	LDI				R25, 0x05			
000cda 9180 0211 	LDS				R24, RAM_SAL_CORTE	; VA A ERROR ELECTRODO POR SER LA MEDIDA DE SAL MENOR DE 0,5
000cdc 1789      	CP				R24, R25
000cdd f40c      	BRGE			PRO3CA3_1			; SI ES MENOR O IGUAL SALTA "FALLO ELECTRODO", "AVERIA"
000cde df72      	RCALL			PRO3D1A				; RUTINA AVERIA FALLO ELECTRODO EQUIPO DETENIDO
                 
                 PRO3CA3_1:
000cdf 94e8      	CLT									; PONE ES REGISTRO T A 0 SET LO PONE A 1
000ce0 f8b5      	BLD				CONTROL_1, 5		; PASA EL REGISTRO T A CONTROL_1
000ce1 9508      	RET
                 
                 ;PRO3CA3:  ; RUTINA AÑADIR SAL; TEXTO "AÑADIR SAL" 1ª LINEA
000ce2 e800      	LDI				R16, 128			; SI NO SIGUE EN FALLO REJILLA
000ce3 940e 053e 	CALL			ENVINT				; Y ENVIA EN MANSAJE A PANTALLA 1º INFORMACION DE LINEA Y....
000ce5 e0d5      	LDI				YH,HIGH (LIN_REJILLA) ; POSICION BIT ALTA DEL TEXTO A ENVIAR A PANTALLA "AÑADIR SAL"
000ce6 ecc4      	LDI				YL, LOW (LIN_REJILLA) ; POSICION BIT BAJA DEL TEXTO A ENVIAR A PANTALLA
000ce7 e114      	LDI				R17, 20				; NUMERO DE DIGITOS A ENVIAR A PANTALLA
000ce8 dc3c      	RCALL			ENVIARTEXTO			; 2º EL TEXTO 16 CARACTERES
                 ; TEXTO "-.- KG/M3" 1ª LINEA  Y 2ª LINEA "EQUIPO DETENIDO"
000ce9 95a8      	WDR
000cea e904      	LDI				R16, 148			; ESCRIBE LINEA 3 
000ceb 940e 053e 	CALL			ENVINT				; Y ENVIA EN MANSAJE A PANTALLA 1º INFORMACION DE LINEA Y....
000ced e0d5      	LDI				YH,HIGH (A_SAL) 	; POSICION BIT ALTA DEL TEXTO A ENVIAR A PANTALLA "-.- GR/LITRO"
000cee ebc0      	LDI				YL, LOW (A_SAL)		; POSICION BIT BAJA DEL TEXTO A ENVIAR A PANTALLA
000cef e114      	LDI				R17, 20				; NUMERO DE DIGITOS A ENVIAR A PANTALLA
000cf0 dc34      	RCALL			ENVIARTEXTO			; 2º EL TEXTO 16 CARACTERES
000cf1 9508      	RET
                 
                 PRO3CA4: ; PONEEN PANTALLA Y BORRA LINEA 3 Y 4
                 
000cf2 e800      	LDI				R16, 128			; 11000000 escribir en linea 2 linea (192)( linea 4 seria 212)
000cf3 940e 053e 	CALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION, " ESCRIBIR LINEA 2"
000cf5 e0d5      	LDI				YH, HIGH (LIN_2S)	; POSICION ALTA DEL TAXTO EN RAM 080
000cf6 e9cc      	LDI				YL, LOW  (LIN_2S)	; direccion BAJA DEL TEXTO EN RAM  "EUIPO DETENIDO"    	
000cf7 e114        	LDI				R17,20   			; bytes a enviar 
000cf8 940e 0925 	CALL			ENVIARTEXTO			; RUTINA PARA ENVIAR TEXTO E PANTALLA
000cfa ec00      	LDI				R16, 192			; 11000000 escribir en linea 2 linea (192)( linea 4 seria 212)
000cfb 940e 053e 	CALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION, " ESCRIBIR LINEA 2"
000cfd e0d6      	LDI				YH, HIGH (AVERIA)	; POSICION ALTA DEL TAXTO EN RAM 080
000cfe ecc8      	LDI				YL, LOW  (AVERIA)	; direccion BAJA DEL TEXTO EN RAM  "CONSULTAR MANUAL"    	
000cff e114        	LDI				R17,20   			; bytes a enviar 
000d00 940e 0925 	CALL			ENVIARTEXTO			; RUTINA PARA 
000d02 e904      	LDI				R16, 148			; 11000000 escribir en linea 2 linea (192)( linea 4 seria 212)
000d03 940e 053e 	CALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION, " ESCRIBIR LINEA 2"
000d05 e0d7      	LDI				YH, HIGH (BORRAR_LINEA)	; POSICION ALTA DEL TAXTO EN RAM 080
000d06 eac4      	LDI				YL, LOW  (BORRAR_LINEA)	; direccion BAJA DEL TEXTO EN RAM  "CONSULTAR MANUAL"    	
000d07 e114        	LDI				R17,20   			; bytes a enviar 
000d08 940e 0925 	CALL			ENVIARTEXTO			; RUTINA PARA 
000d0a ed04      	LDI				R16, 212			; 11000000 escribir en linea 2 linea (192)( linea 4 seria 212)
000d0b 940e 053e 	CALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION, " ESCRIBIR LINEA 2"
000d0d e0d7      	LDI				YH, HIGH (BORRAR_LINEA)	; POSICION ALTA DEL TAXTO EN RAM 080
000d0e eac4      	LDI				YL, LOW  (BORRAR_LINEA)	; direccion BAJA DEL TEXTO EN RAM  "CONSULTAR MANUAL"    	
000d0f e114        	LDI				R17,20   			; bytes a enviar 
000d10 940e 0925 	CALL			ENVIARTEXTO			; RUTINA PARA 
                 
000d12 e305      		LDI			R16,53				; ESCRIBE EN RAM LA PAGINA A ENVIAR LA 05
000d13 9300 0a01 		STS			0xA01,R16
000d15 940e 1f9e 		CALL		P_NEXTION_PAGE		; PAGINA DE TEXTO NEXTION A V E R I A
                 
                 
                 
000d17 9100 0b0b LDS			R16,S_FUENTE		; VERIFICA LA TENSION DE LA FUENTE
000d19 310e      CPI			R16,30
000d1a f020      BRLO		AV_FUENTE			; SI ES MENOR VA A AVERIA EN FUENTE
000d1b e001      LDI			R16,1
000d1c 9300 0b09 STS			AVERIA_CPU,R16		; POSICION B09 EN RAM
000d1e c003      RJMP		AV_FUENTE_N
                 AV_FUENTE:
000d1f e001      LDI			R16,1
000d20 9300 0b08 STS			AVERIA_FUENTE,R16	; POSICION B08 EN RAM
                 AV_FUENTE_N:
000d22 940e 1bac CALL		CADENA_UART
                 PRO3D1A_1:
000d24 cfff      	RJMP			PRO3D1A_1
                 .INCLUDE "MED_CL.ASM"
                 
                 ; CALIBRACION
                 
                 ; CON PUENTE EN LA CLEMA AJUSTAR LA SILIDA A 80Mv MEDICION DE CLORO 00 SEÑAL MINIMA PARA ACTIVAR EL MODULO
                 ; CON 1.30 Mv MARAC 1 PPM DE CLORO
                 ; CON 1.80 Mv MARCA 2 PPM DE CLORO
                 ; CON 2.5  Mv MARCA EL MAXIMO 3.3 PPM SI SUPERA ESTA TENSION DE 2.5 NO MARCA MAS CLORO DA 3.3
                 
                 
                 ;		RUTINA MED_CL
                 PRO41:
000d25 9508      	RET
                 PRO4:	; PARA MEDIR EL CLORO
                 ;	LDS  			R19, minu			; CARGA LOS MINUTOS 
                 ;	CPI				R19, 00				; PARA NO ENCENDER EL PRIMER MINUTO
                 ;	BRBS			0, PRO41
000d26 95a8      	WDR
                 	; VALOR DE MEDICION TOTAL	
000d27 e021      	LDI				R18, P_CL				; LINEA DE ENTRADA EN EL CONVERTIDOS PCF8591
000d28 91a0 0208 	LDS				R26, RAMC_CL		; NUMERO DE LECTURAS Ó CALIBRACION 1D8 SON 200 MEDICIONES
                 ;	CALL			PCF
000d2a 940e 013c 	CALL			ADC_P	
000d2c 9586      	LSR				R24					; DIVIDIMOS ENTRE DOS
000d2d 9586      	LSR				R24					; DIVIDIMOS ENTRE DOS TOTAL 4
000d2e 2f08      	MOV				R16, R24
                 
                 
                 PRO4A:
000d2f e08a      	LDI				R24, 10				; VALOR DE CLORO MINIMO PARA ACTIVAR LA OPCION AUTOMATICO CORRESPONDE A 0,2 DE CLORO
000d30 1780      	CP				R24, R16
000d31 f014      	BRLT			PRO4D				; SI ES MAYOR EL VOLOR MEDIDO VA A PRO4D
000d32 774f      	CBR			CONTROL, 0B10000000		; LINEA DE CONTROL PARA LA FUENTE EN RUTINA RELOJ MODO "AUTO" SI EL VALOR MEDIDO
                 										; ES SUPERIOR A 0,3 SE ACTIVA SI NO SE DESACTIVA		
000d33 9508      	RET									; RETORNA POR NO HABER DETECTADO SEÑAL MINIMA DE SONDA 0,3 PPM
                 
                 PRO4D: ;Grabar el valor en RAM Ó NO
                 
000d34 500f      	SUBI			R16, 15
000d35 6840      	SBR			CONTROL, 0B10000000		; LINEA DE CONTROL PARA LA FUENTE EN RUTINA RELOJ SE ACTIVA
000d36 9180 0206 	LDS				R24, RAM_CL			; LEE EL VOLOR GRABADO EN RAM
000d38 940e 0590 CALL RADC		; PRESENTA EN PANTALLA
000d3a 9210 09cd STS				$9CD, R1
000d3c 9220 09ce STS				$9CE, R2
000d3e e23e      LDI				R19,46				; PONE EL PUNTO
000d3f 9330 09cf STS				$9CF,R19
000d41 9230 09d0 STS				$9D0, R3
                 ; PRESENTA EN CALIBRAR Y QUITA LA OPCION N/D
000d43 9220 0941 STS				$941, R2
000d45 e23e      LDI				R19,46				; PONE EL PUNTO
000d46 9330 0942 STS				$942,R19
000d48 9230 0943 STS				$943, R3
                 
000d4a 9583      	INC				R24					; INCREMENTO EN UNA UNIDAD Y 
000d4b 1708      	CP				R16, R24			; LO COMPARA CON EL VALOR ULTIMO LEIDO
000d4c f01c      	BRLT			PRO4D1				; SI NO ES MAYOR DE DOS DECIMAS NO LO ALMACENA
000d4d 9380 0206 	STS				RAM_CL, R24			; ALMACENA LA MEDICION EN LA MEMORIA RAM 206
000d4f c006      	RJMP			PRO4D2
                 PRO4D1:
000d50 958a      	DEC				R24					; RESTA UNA UNIDAD AL VALOR LEIDO
000d51 958a      	DEC				R24					; RESTA UNA UNIDAD AL VALOR LEIDO
000d52 1780      	CP				R24,R16				; Y LO VUELVE A COMPARAR CON EL ALMACENADO
000d53 f014      	BRLT			PRO4D2
000d54 9380 0206 	STS				RAM_CL, R24			; ALMACENA LA MEDICION EN LA MEMORIA RAM
                 PRO4D2:
000d56 2f30      	MOV				R19, R16			; LO MUEVE A R19 PORQUE R16 SE USA EN LA RUTINA EEPROM_RW
000d57 9120 0207 	LDS				R18,RAMP_CL			; CONTENIDO DE CLORO PROGRAMADO 207
                 PRO4E: ;EN R18 VALOR PROGRAMADO; DESACTIVA LA PRODUCION DE CLORO SI EL VALOR LEIDO ES MAYOR QUE EL PROGRAMADO
000d59 9130 0206 	LDS				R19,RAM_CL			; R19 ES EL VALOR REAL DEL CLORO LIBRE
000d5b 940e 111e 	CALL			AYUDA_CL
000d5d 9523      	INC				R18					; R18 ES EL VALOR PROGRAMADO
000d5e 1732      	CP				R19,R18				; SI EL CL MEDIDO ES MENOR QUE EL PROGRAMADO
000d5f f018      	BRLO			PRO4F				; SALTA A PRO4A (OP1 > OP2 SALTA)
000d60 940e 02f2 	CALL			APAGAR_FUENTE
000d62 c006      	RJMP			PRO4G
                 PRO4F: ;ACTIVA LA PRODUCION DE CLORO SI EL VALOR LEIDO ES MENOR QUE EL PROGRAMADO
000d63 952a      	DEC				R18
000d64 952a      	DEC				R18
000d65 1723      	CP				R18,R19
000d66 f014      	BRLT			PRO4G
000d67 940e 0300 	CALL			ENCENDER_FUENTE
                 PRO4G:
000d69 9508      	RET
                 .INCLUDE "MED_RD.ASM"
                 
                 ; EL VALOR DEL POTENCIAL REDOX SE OPTIENE DIVIDIENDO LA FRECUENCIA POR 3,8
                 ; CALIBRACION
                 ; 1.87 DA UN REDOX DE 640
                 ; 2.10 DA UN REDOX DE 740
                 ; SEÑAL MINIMA 0.75 PARA DETECTAR EL MODULO REDOX EQUIVALE A UN REDOX DE 70 Mv
                 ; REDOX MAXIMO 925Mv CON 2,5 VOLTIOS
                 PRO51:
000d6a 9508      	RET
                 
                 PRO5:	; PARA MEDIR EL REDOX
                 
000d6b 9130 0401 	LDS  			R19, minu			; CARGA LOS MINUTOS 
000d6d 3030      	CPI				R19, 00				; PARA NO ENCENDER EL PRIMER MINUTO
000d6e f3d8      	BRBS			0, PRO51
                 ; VALOR DE MEDICION TOTAL	
                 
                 PRO5A:
                 
000d6f 95a8      	WDR
000d70 2788      	CLR				R24
                 	; VALOR DE MEDICION TOTAL	
000d71 e022      	LDI				R18, P_RD			; LINEA DE ENTRADA EN EL CONVERTIDOS PCF8591
                 ;	LDI				R26, 230
000d72 91a0 020b 	LDS				R26, RAMC_RD		; NUMERO DE LECTURAS Ó CALIBRACION
                 ;	CALL			PCF					; RUTINA MEDICION
000d74 940e 013c 	CALL			ADC_P
                 ;******************************************************PARA MOSTRAR REDOX SIN SONDA****************************************************
                 ; PONE EN PANTALLA GRAFICA EL VALOR DEL REDOX  LINEA 6
                 
                 
                 
                 
000d76 2f08      	MOV				R16, R24
000d77 528e      subi	r24, 46
000d78 9380 0223 STS		redox_real,R24
000d7a 940e 05b1 call	radc5i; LINEA 4 PRESENTACION DEL REDOX
                 
                 
                 
                 
000d7c e38c      	LDI				R24, 60				; VALOR MINIMO PARA ACTIVAR CONTROL POR REDOX
000d7d 1708      	CP				R16, R24
000d7e f410      	BRSH			PRO5A_1				; SALTA PRO5D SI EL MODULO ESTA CONECTADO SEÑAL MAYOR DE 110
000d7f 7b4f      	CBR			CONTROL, 0B01000000		; LINEA DE CONTROL PARA LA FUENTE EN RUTINA RELOJ SI EL VALOR MEDIDO
000d80 9508      	RET
                 PRO5A_1:
                 
                 
                 
000d81 ed8a      	LDI				R24, 218			; VALOR MAXIMO PARA ACTIVAR CONTROL POR REDOX
000d82 1780      	CP				R24, R16
000d83 f410      	BRSH			PRO5D				; SALTA PRO5D SI EL MODULO ESTA CONECTADO SEÑAL MAYOR DE 218 X 5 =1090
000d84 7b4f      	CBR			CONTROL, 0B01000000		; LINEA DE CONTROL PARA LA FUENTE EN RUTINA RELOJ SI EL VALOR MEDIDO
000d85 9508      	RET
                 PRO5D: ;Grabar el valor en RAM Ó NO
000d86 9210 0563 	STS				$563,R1				; PANTALLA GRAFICA LINEA 6
000d88 9220 0564 	STS				$564,R2				; PANTALLA GRAFICA LINEA 6
000d8a 9230 0565 	STS				$565,R3				; PANTALLA GRAFICA LINEA 6
                 
000d8c 9210 09bb 	STS				$9BB,R1				; PRESENTA EL PANTALLA NORMAL
000d8e 9220 09bc 	STS				$9BC,R2				; PRESENTA EL PANTALLA NORMAL
000d90 9230 09bd 	STS				$9BD,R3				; PRESENTA EL PANTALLA NORMAL
                 	; PRESENTACION EN PROGRAMAR
000d92 9210 097f 	STS				$97F,R1				; PRESENTA EN PANTALLA PROGRAMAR
000d94 9220 0980 	STS				$980,R2				; PRESENTA EN PANTALLA PROGRAMAR
000d96 9230 0981 	STS				$981,R3				; PRESENTA EN PANTALLA PROGRAMAR
                 	; PRESENTA EN PANTALLA CALIBRAR
000d98 9210 092d 	STS				$92D,R1				; PRESENTA EN PANTALLA CALIBRAR
000d9a 9220 092e 	STS				$92E,R2				; PRESENTA EN PANTALLA CALIBRAR
000d9c 9230 092f 	STS				$92F,R3				; PRESENTA EN PANTALLA CALIBRAR
000d9e 520e      	SUBI			R16, 46				; AJUSTA PUNTO CERO
000d9f 6440      	SBR			CONTROL, 0B01000000		; LINEA DE CONTROL REDOX PARA LA SEÑAL EN PANTALLA
000da0 9180 0209 	LDS				R24, RAM_RD			; LEE EL VALOR GRABADO EN RAM
000da2 9583      	INC				R24					; INCREMENTO EN DOS UNIDADES Y 
000da3 1780      	CP				R24, R16			; LO COMPARA CON EL VALOR ULTIMO LEIDO
000da4 f418      	BRSH			PRO5D1				; SI NO ES MAYOR DE DOS DECIMAS NO LO ALMACENA
000da5 9380 0209 	STS				RAM_RD, R24			; ALMACENA LA MEDICION EN LA MEMORIA RAM
000da7 c006      	RJMP			PRO5D2
                 PRO5D1:
000da8 958a      	DEC				R24					; RESTA UNA UNIDAD AL VALOR LEIDO
000da9 958a      	DEC				R24					; RESTA UNA UNIDAD AL VALOR LEIDO
000daa 1708      	CP				R16,R24				; Y LO VUELVE A COMPARAR CON EL ALMACENADO
000dab f410      	BRSH			PRO5D2
000dac 9380 0209 	STS				RAM_RD, R24			; ALMACENA LA MEDICION EN LA MEMORIA RAM
                 PRO5D2:
000dae 2f30      	MOV				R19, R16			; LO MUEVE A R19 PORQUE R16 SE USA EN LA RUTINA EEPROM_RW
000daf 9120 020a 	LDS				R18, RAMP_RD		; VALOR PROGRAMADO DE REDOX
                 ; PRESENTA EL REDOX PRORAMADO 
000db1 2f82      	MOV				R24,R18
000db2 940e 05b1 	CALL			RADC5I
000db4 9210 092d 	STS				$92D,R1
000db6 9220 092e 	STS				$92E,R2
000db8 9230 092f 	STS				$92F,R3
000dba 9120 020a 	LDS				R18,RAMP_RD	
                 PRO5E: ; EN R18 VALOR PROGRAMADO
                 	; APAGA LA PRODUCION DE CLORO SI EL VALOR LEIDO ES MAYOR QUE EL PROGRAMADO
000dbc 9130 0209 	LDS				R19, RAM_RD			; R19 ES EL VALOR REAL REDOX
                 ; RUTINA DE APOYO AL REDOX
000dbe 940e 1101 	CALL			AYUDA_RD			; RUTINA DE APOYO AL REDOX
000dc0 9523      	INC				R18					; R18 ES EL VALOR PROGRAMADO
000dc1 1732      	CP				R19,R18				; SI EL REDOX MEDIDO ES MENOR QUE EL PROGRAMADO
000dc2 f018      	BRLO			PRO5F				; SALTA A PRO5A (OP1 > OP2 SALTA)
000dc3 940e 02f2 	CALL			APAGAR_FUENTE
000dc5 c006      	RJMP			PRO5G
                 PRO5F: ;ACTIVA LA PRODUCION DE CLORO SI EL VALOR LEIDO ES MENOR QUE EL PROGRAMADO
000dc6 952a      	DEC				R18
000dc7 952a      	DEC				R18
000dc8 1723      	CP				R18,R19
000dc9 f010      	BRLO			PRO5G
000dca 940e 0300 	CALL			ENCENDER_FUENTE
                 PRO5G:
000dcc 9508      	RET
                 ;.INCLUDE "AJUSTE_CL.ASM"
                 .INCLUDE "I2C_ATMEGA16.ASM"
                 
                 		; ------------------LOS PINES SCL Y SDA SE HAN DE CONFIGURAR COMO SALIDA -------------------------
                 		; RUTINA PARA LA LECTURA DEL CONVERTIDOR ANALOGICO DIGITAL PCF8591
                 		; EN R17 DIRECCION DEL PERIFERICO
                 		; EN R18 LINEA DE ENTRADA A LEER Y CONFIGURACION DEL PERIFERICO
                 		; EN R26 NUMERO DE LECTURAS MAX. 250
                 		; EN R24 EL RESULTADO O EL VALOR A GRABAR
                 
                 ERROR_1:
000dcd 9508      	RET
                 
                 PCF:
000dce 2411      	CLR				R1
000dcf 2788      	CLR				R24
000dd0 27dd      	CLR				YH				; PONE A CERO LA PARTE ALTA DEL REGISTRO Y
000dd1 0f11      	LSL				R17
                 I2C_ATMEGA:
                 ; INICIALIZACION DEL PERIFERICO A 100KHZ
000dd2 e002      	LDI				R16,2
000dd3 e7c0      	LDI				YL,TWBR
000dd4 8308      	ST				Y,R16
000dd5 e003      	LDI				R16,(1<<TWPS1) | (1<<TWPS0)
000dd6 e7c1      	LDI				YL,TWSR
000dd7 8308      	ST				Y,R16
                 ; CONDICION DE START
000dd8 ea04      	LDI				R16,(1<<TWINT)|(1<<TWSTA)|(1<<TWEN)
000dd9 e7c4      	LDI				YL,TWCR
000dda 8308      	ST				Y,R16
                 ESPERA1: ; ESPERA EL ENVIO DE LA CONDICION START
000ddb e7c4      	LDI				YL,TWCR
000ddc 8108      	LD				R16,Y
000ddd ff07      	SBRS			R16,TWINT
000dde cffc      	RJMP			ESPERA1
                 ; CHEQUEAR SI HA HABIDO ERROR EN EL ENVIO DE LA ORDEN START
000ddf e7c1      	LDI				YL,TWSR
000de0 8108      	LD				R16,Y
                 ;	ANDI			R16,0xF8
                 ;	CPI				R16,I2C_START
                 ;	BRNE			ERROR_1	;  ****AQUI HAY UN ESCESO DE SALTO SE PONE UN RET DIRECTO
                 ; CARGA EN TWDR LA DIRECION DEL PERIFERICO A LEER EN OPCION ESCRITURA W
000de1 e900      	LDI				R16,PCF8591 + W
000de2 0f01      	ADD				R16,R17							
000de3 e7c3      	LDI				YL,TWDR
000de4 8308      	ST				Y,R16
000de5 e804      	LDI				R16,(1<<TWINT) | (1<<TWEN)
000de6 e7c4      	LDI				YL,TWCR
000de7 8308      	ST				Y,R16
                 ; ESPERA EL ENVIO DE LA DIRECION DEL PERIFERICO
                 ESPERA2:
000de8 e7c4      	LDI				YL,TWCR
000de9 8108      	LD				R16,Y
000dea ff07      	SBRS			R16,TWINT
000deb cffc      	RJMP			ESPERA2
                 ; CHEQUEAR SI HA HABIDO ERROR EN EL ENVIO DE LA DIRECION DEL PERIFERICO
000dec e7c1      	LDI				YL,TWSR
000ded 8108      	LD				R16,Y
                 ;	ANDI			R16,0xF8
                 ;	CPI				R16,MT_SLA_ACK
                 ;	BRNE			ERROR
                 ; CARGA EL DATO EN EL REGISTRO TWDR EL VALOR DEL PUERTO A LEER EN R24 
000dee 2f02      	MOV				R16,R18
000def e7c3      	LDI				YL,TWDR
000df0 8308      	ST				Y,R16
000df1 e804      	LDI				R16,(1<<TWINT) | (1<<TWEN)
000df2 e7c4      	LDI				YL,TWCR
000df3 8308      	ST				Y,R16
                 ; ESPERA EL ENVIO DEL DATO AL PERIFERICO
                 ESPERA3:
000df4 e7c4      	LDI				YL,TWCR
000df5 8108      	LD				R16,Y
000df6 ff07      	SBRS			R16,TWINT
000df7 cffc      	RJMP			ESPERA3
                 ; CHEQUEA EL VALOR DEL REGISTRO POR SI HUBIERA ERROR
000df8 e7c1      	LDI				YL,TWSR
000df9 8108      	LD				R16,Y
                 ;	ANDI			R16,0xF8
                 ;	CPI				R16,MT_DATA_ACK
                 ;	BRNE			ERROR
                 ; TRANSMITIR SEÑAL DE STOP
000dfa e904      	LDI				R16,(1<<TWINT)|(1<<TWEN)|(1<<TWSTO)
000dfb e7c4      	LDI				YL,TWCR
000dfc 8308      	ST				Y,R16
000dfd 0000      	NOP
000dfe 0000      	NOP
                 I2C_ATMEGA_1:  ;  LEER EL DATO DE TENSION EN LA ENTRADA SELECIONADA
                 ; INICIALIZACION A 400KhZ
000dff e002      	LDI				R16,2
000e00 e7c0      	LDI				YL,TWBR
000e01 8308      	ST				Y,R16
000e02 e003      	LDI				R16,(1<<TWPS1) | (1<<TWPS0)
000e03 e7c1      	LDI				YL,TWSR
000e04 8308      	ST				Y,R16
                 ; CONDICION DE START
000e05 ea04      	LDI				R16,(1<<TWINT)|(1<<TWSTA)|(1<<TWEN)
000e06 e7c4      	LDI				YL,TWCR
000e07 8308      	ST				Y,R16
                 ESPERA4: ; ESPERA EL ENVIO DE LA CONDICION START *** RE_START
000e08 e7c4      	LDI				YL,TWCR
000e09 8108      	LD				R16,Y
000e0a ff07      	SBRS			R16,TWINT
000e0b cffc      	RJMP			ESPERA4
                 ; CHEQUEAR SI HA HABIDO ERROR EN EL ENVIO DE LA ORDEN START
000e0c e7c1      	LDI				YL,TWSR
000e0d 8108      	LD				R16,Y
                 ;	ANDI			R16,0xF8
                 ;	CPI				R16,REP_START
                 ;	BRNE			ERROR	
                 ; CARGA EN TWDR LA DIRECION DEL PERIFERICO A LEER EN OPCION LECTURA
000e0e e901      	LDI				R16,PCF8591 + R
000e0f 0f01      	ADD				R16, R17		
000e10 e7c3      	LDI				YL,TWDR
000e11 8308      	ST				Y,R16
000e12 e804      	LDI				R16,(1<<TWINT) | (1<<TWEN)
000e13 e7c4      	LDI				YL,TWCR
000e14 8308      	ST				Y,R16
                 ;	OUT				TWCR,R16
                 ; ESPERA EL ENVIO DE LA DIRECION DEL PERIFERICO
                 ESPERA5:
000e15 e7c4      	LDI				YL,TWCR
000e16 8108      	LD				R16,Y
000e17 ff07      	SBRS			R16,TWINT
000e18 cffc      	RJMP			ESPERA5
                 ; CHEQUEAR SI HA HABIDO ERROR EN EL ENVIO DE LA DIRECION DEL PERIFERICO
000e19 e7c1      	LDI				YL,TWSR
000e1a 8108      	LD				R16,Y
                 ;	ANDI			R16,0xF8
                 ;	CPI				R16,MR_SLA_ACK
                 ;	BRNE			ERROR
                 ;RECIBIR EL DATO
                 
000e1b e804      	LDI				R16,(1<<TWINT) | (1<<TWEN)
000e1c e7c4      	LDI				YL,TWCR
000e1d 8308      	ST				Y,R16
                 ; ESPERA EL ENVIO DEL VALOR 
                 ESPERA6:
000e1e e7c4      	LDI				YL,TWCR
000e1f 8108      	LD				R16,Y
000e20 ff07      	SBRS			R16,TWINT
000e21 cffc      	RJMP			ESPERA6
                 ; CHEQUEAR SI HA HABIDO ERROR
000e22 e7c1      	LDI				YL,TWSR
000e23 8108      	LD				R16,Y
                 ;	ANDI			R16,0xF8
                 ;	CPI				R16,MR_DATA_NACK
                 ;	BRNE			ERROR
000e24 e7c3      	LDI				YL,TWDR
000e25 8138      	LD				R19,Y
                 ; TRANSMITIR SEÑAL DE STOP
000e26 e904      	LDI				R16,(1<<TWINT)|(1<<TWEN)|(1<<TWSTO)
000e27 e7c4      	LDI				YL,TWCR
000e28 8308      	ST				Y,R16
000e29 95aa      	DEC				R26				; RESTA UNA MEDICION
000e2a f029      	BREQ			I2C_ATMEGA_2	; SI A LLEGADO A CERO SALTA A PCF2 Y TERMINA
000e2b 1e13      	ADC				R1, R19
000e2c f690      	BRCC			I2C_ATMEGA_1	; SI NO HAY DESBIRDAMIENTO SALTA A PCF1
000e2d 9583      	INC				R24
000e2e 95a8      	WDR
000e2f cfcf      	RJMP			I2C_ATMEGA_1
                 I2C_ATMEGA_2:
000e30 9508      	RET
                 ERROR:
000e31 9508      	RET
                 
                 ;.INCLUDE "I2C_ATMEGA16_B.ASM"
                 ;.INCLUDE "I2C_ATMEGA16_C.ASM"
                 .INCLUDE "DATOS.ASM"
                 
                 
                 ; FUENTE			MICRO          		 LM358		OPTO
                 ;			PATA1		PATA 2		PATA 1
                 
                 ;	ON		0		0		0,57		0,61
                 
                 ;	OFF		0		5		3,55		1,14
                 
                 ; DATOS DEL MODULO DE PH
                 
                 ;	Ph			A7800			TLC27		SALIDA MODULO	NEGATIVO CLEMA
                 ;			PATA 2		PATA 3		PATA 3
                 
                 ;	7.0		1,018		0,801						1.01
                 
                 ;	3.5		1,058		0,807						1.01
                 .INCLUDE "PRO_CICLOS.ASM"
                 
                 
                 
                 
                 
                 ; GRABA EL NUMERO DE CICLOS Y SALE DE PROGRAMACION
                 TECLA5T:
000e32 93e0 0214 	STS			RAM_CICLOS,R30		; ACTUALIZA EN RAM EL NUEVO VALOR PROGRAMADO DE LA PRODUCION
000e34 e218      	LDI			R17,CICLOS_MINUTO
000e35 2f2e      	MOV			R18,R30				; GRABA EL VALOR DEL REDOX EN EEPROM POSICION 241
000e36 940e 0587 	CALL		EEPROM_ES
000e38 2d0f      	MOV			R16,VAL_LED
000e39 7b0f      	ANDI		R16,0B10111111
000e3a 2ef0      	MOV			VAL_LED, R16
000e3b 940e 091d 	CALL		LEDPANT				; ACTUALIZAR LOS LED DE LA PANTALLA	
000e3d 940e 097f 	CALL		NO_TECLA
000e3f 9508      	RET
                 
                 BORRAR_EEPROM:	;HORAS TOTALES DEL ELECTRODO INCREMENTA EN 1 POSICION 4B DE EEPRON NUMERO DE VECES QUE SE BORRA
000e40 2722      	CLR			R18
000e41 e419      	LDI			R17,N_HORAS			; BORRA LAS HORAS DE USO DE LA REJILLA
000e42 940e 0587 	CALL		EEPROM_ES
000e44 e41a      	LDI			R17,N_HORAS_1
000e45 940e 0587 	CALL		EEPROM_ES
                 		; INCREMENTA EL NUMERO DE VECES QUE SE BORRA POSICION 04B
000e47 e41b      	LDI			R17,N_BORRADO
000e48 940e 057e 	CALL		EEPROM_RW
000e4a 9523      	INC			R18
000e4b 940e 0587 	CALL		EEPROM_ES
000e4d 940e 097f 	CALL		NO_TECLA
000e4f 9508      	RET
                 
                 TECLA5U:  ; GRABA EL  NUMERO DE CICLOS Y VA A apoyo rd/cl
000e50 93e0 0214 	STS			RAM_CICLOS, R30		; ACTUALIZA EN RAM EL NUEVO VALOR PROGRAMADO DE LA PRODUCION
000e52 e218      	LDI			R17,CICLOS_MINUTO
000e53 2f2e      	MOV			R18,R30				; GRABA EL VALOR DEL REDOX EN EEPROM POSICION 241
000e54 940e 0587 	CALL		EEPROM_ES
000e56 e000      	LDI			R16,00				; PONE EL RETARDO DEL TECLADO A 0
000e57 2e70      	MOV			TEMP_TEC,R16
000e58 940e 097f 	CALL		NO_TECLA
000e5a 940c 0b51 	JMP			TECLA4V				; VA A LA OPCION PARA PROGRAMAR PRODUCCION
                 
                 TECLA5V:
000e5c 94e8      	CLT								; PONE A 1 EL REGISTRO T DE SREG
000e5d f8b5      	BLD			CONTROL_1, 5		; LINEA DE CONTROL 
000e5e 306a      	CPI			r22, RETARDO1
000e5f f3e0      	BRLO		TECLA5V	
000e60 e060      	LDI			R22,00
000e61 e218      	LDI			R17,CICLOS_MINUTO
000e62 940e 057e 	CALL		EEPROM_RW
000e64 2fe2      MOV	R30,R18
                 
000e65 3021      	CPI			R18,1
000e66 f411      	BRNE		TECLA5
000e67 9468      	SET								; PONE A 1 EL REGISTRO T DE SREG
000e68 f8b5      	BLD			CONTROL_1,5			; LINEA DE CONTROL 
                 
                 TECLA5:								; AJUSTAR EL VALOR DEL TANTO POR CIENTO DE LA PRODUCION VALOR EN R30
000e69 95a8      	WDR
000e6a 2d87      	MOV			R24,TEMP_TEC
000e6b 308f      	CPI			R24,retardo_programacion	; PARA COMPARARLO CON EL RETARDO 20 SEGUNDOS SIN PULSAR TECLA
000e6c f62a      	BRPL		TECLA5T						; Y SALIR DE PROGRAMACION DE PARAMETROS					
000e6d 940e 04c0 	CALL		LEC_TEC
000e6f 3f1f      	CPI			R17,0B11111111		; COMPRUEBA SI SE A PULSADO ALGUNA TECLA
000e70 f011      	BREQ		TECLA5A				; SI SE HA PULSADO SALTA A TECLA2A
000e71 e000      	LDI			R16,00				; SI ES ASI....
000e72 2e70      	MOV			TEMP_TEC,R16		; PONE EL CONTADOR DE RETARDO A CERO
                 TECLA5A:
                 ;       20x4        16x4   tipo de display
                 ; linea 1-128 		128 
                 ; linea 2-192		192
                 ; linea 3-148		144
                 ; linea 4-212		208
                 
                 			; OPCION BORRA REGISTRO DE HORAS
000e73 3e1c      	CPI			R17,0B11101100		; PROGRAMAR, MAS Y MENOS
000e74 f259      	BREQ		BORRAR_EEPROM
                 			; OPCION PRESENTAR DESGASTE ELECTRODO
000e75 3f13      	CPI			R17,0B11110011		; CALIBRAR Y FLECHA
000e76 f1f9      	BREQ		TECLA5H
                 			; OPCION SALTAR PARA AJUSTE DE PRODUCCION
000e77 3f1b      	CPI			R17,0B11111011		; TECLA 2
000e78 f2b9      	BREQ		TECLA5U				; SALTA PARA AJUSTAR LA PRODUCCION
                 			; OPCION SALIR DE LECTURA DE TECLADO 
000e79 371f      	CPI			R17,0B01111111		;TECLA 5
000e7a f409      	BRNE		TECLA5B				; SI NO ES 80 SALTA A TECLA1D
000e7b cfb6      	RJMP		TECLA5T				; TERMINA Y SALE PARA GRABAR
                 TECLA5B:	; OPCION AUMENTAR
000e7c 3e1f      	CPI			R17,0B11101111		; IDEM
000e7d f431      	BRNE		TECLA5C				; SI NO ESTA PULSADA SALTA PARA VERIFICAR OTRA TECLA
000e7e e000      	LDI			R16, 00				; PONE EL RETARDO DEL TECLADO A 0
000e7f 2e70      	MOV			TEMP_TEC,R16
000e80 95e3      	INC			R30					; INCREMENTA EL VALOR
000e81 30e4      	CPI			R30,4				; VERIFICA SI ESTA EN EL VALOR MAXIMO
000e82 f00c      	BRLT		TECLA5C				; SI NO SUPERA EL VALOR MAXIMO SALTA
000e83 e0e4      	LDI			R30,4				; SI SUPERA EL MAXIMO LO PONE AL MAXIMO
                 TECLA5C:	; OPCION DISMINUIR CICLOS
000e84 3f1d      	CPI			R17,0B11111101		; IDEM
000e85 f431      	BRNE		TECLA5C1				; SI NO ESTA PULSADA SALTA
000e86 e000      	LDI			R16,00				; PONE EL RETARDO DEL TECLADO A 0
000e87 2e70      	MOV			TEMP_TEC, R16
000e88 95ea      	DEC			R30					; DISMINUYE EL VALOR
000e89 30e1      	CPI			R30,1				; COMPRUEBA SI SE ELCANZA EL VALOR MINIMO
000e8a f408      	BRBC 		0, TECLA5C1			; SI NO SE ALCANZA SALTA
000e8b e0e1      	LDI			R30,1				; SI SE ALCANZA PONE EL VALOR MINIMO
                 TECLA5C1:	; OPCION 240 SEGUNDOS DE RETARDO
000e8c 3f15      	CPI			R17,0B11110101		; TECLA CALIBRAR Y MENOS
000e8d f459      	BRNE		TECLA5C2			; SI NO ESTA PULSADA SALTA
000e8e e919      	LDI			R17,retardo_inicio
000e8f e020      	LDI			R18,0
000e90 940e 0587 	CALL		EEPROM_ES
000e92 e220      LDI R18,32
000e93 9320 09a9 STS	$9A9,R18
000e95 94e8      	CLT								; PONE A 1 EL REGISTRO T DE SREG
000e96 f8b5      	BLD			CONTROL_1, 5		; LINEA DE CONTROL 
000e97 7b4f      	CBR			CONTROL,0B01000000	; LINEA DE CONTROL PARA LA FUENTE EN RUTINA RELOJ SI EL VALOR MEDIDO
000e98 774f      	CBR			CONTROL,0B10000000	; LINEA DE CONTROL PARA LA FUENTE EN RUTINA RELOJ SI EL VALOR MEDIDO
                 TECLA5C2:	; OPCION 20 SEGUNDOS DE RETARDO
000e99 3e17      	CPI			R17, 0B11100111		; TECLA CALIBRAR Y MAS
000e9a f449      	BRNE		TECLA5E				; SI NO ESTA PULSADA SALTA
000e9b e919      	LDI			R17,retardo_inicio
000e9c e021      	LDI			R18,1
000e9d 940e 0587 	CALL		EEPROM_ES
000e9f ea25      LDI R18,165
000ea0 9320 09a9 STS $9A9,R18
                 
                 ; PARA PONER EM PANTALLA UNA M O UNA V
000ea2 9468      	SET								; PONE A CERO EL BIT T DE SREG
000ea3 f8b5      	BLD			CONTROL_1,5			; PASA EL REGISTRO T A CONTROL_1
                 
                 TECLA5E:
000ea4 e060      LDI	R22,00
000ea5 e280      	LDI			R24,32				; PONE UN ESPACIO EN EL LUGAR DE CICLOS
000ea6 9380 09aa 	STS			$9AA,R24
000ea8 940e 04d7 	CALL		PRO_TECLA			; ACTUALIZA LA PANTALLA
                 
                 TECLA5F:	;TIEMPO APAGADO EL DIGITO
000eaa 306c      	CPI			R22, RETARDO3		; VALOR DEL TIEMPO DE RATARDO LECTURA DEL TECLADO
000eab f3f0      	BRLO		TECLA5F				; COMPRUEBA EL TIEMPO DE RETARDO 
000eac 2f8e      	MOV			R24,R30				; PONE EL VALOR EN R24 PARA CONVERTIRLO EN DECIMAL
000ead 940e 0590 	CALL		RADC   				; CONVERTIR UN NUMERO EN DIGITOS DATO EN R24
000eaf 9230 09aa 	STS			$9AA,R3				; PONE EL RESULTADO EN PANTALLA UNIDADES DE CICLOS
000eb1 940e 04d7 	CALL		PRO_TECLA
                 TECLA5G:
000eb3 316a      	CPI			R22, RETARDO2		; VALOR DEL TIEMPO DE RATARDO LECTURA DEL TECLADO
000eb4 f3f0      	BRLO		TECLA5G				; COMPRUEBA EL TIEMPO DE RETARDO 
000eb5 cfb3      	RJMP		TECLA5	
                 
                 ; ESCRIBIR LINEA 1
                 
                 
                 TECLA5H:	; PRESENTA EN LINEA 2 EL DESGASTE DEL ELECTRODO
                 
000eb6 940e 1a7f CALL BORRAR_PANTALLA
000eb8 ec00      	LDI				R16,192			; 11000000 escribir en linea 2 linea (192)
000eb9 940e 053e 	CALL			ENVINT
000ebb e0d7      	LDI				YH,HIGH(VIDA_ELECT); POSICION ALTA DEL TAXTO EN RAM 080
000ebc e9c0      	LDI				YL,LOW(VIDA_ELECT)	; direccion BAJA DEL TEXTO EN RAM      	
000ebd e114        	LDI				R17,20 			; bytes a enviar 
000ebe 940e 0925 	CALL			ENVIARTEXTO		; RUTINA PARA ENVIAR TEXTO EN PANNALLA
000ec0 940e 097f CALL NO_TECLA
000ec2 cfa6      	RJMP			TECLA5
                 ;.INCLUDE "RADIO.ASM"
                 .INCLUDE "PANEL_A.ASM"
                 
                 ; LA LINEA OE ES RESET DE PANEL
                 ; en R24 el digito, en el micro  puertos B-  5 dato  6 reloj  "7 OE ACTIVAR SALIDA"  OJO TAMBIAN SE USA PARA RADIO
                 
                 
                 PANEL:
                 
                 ;	CBI			PORTB, PANEL_OE		; PONE A UNO PARA INHIBIR LA SALIDA OJO ES INVERTIDA DESPUES LA SEÑAL POR EL 74HC132
                 
000ec3 98c5      	CBI			PORTB, PANEL_DATA	; PONE A CERO EL BIT 0 DEL PUERTO B
000ec4 98c6      	CBI			PORTB, PANEL_CLK
                 ;	SBI			PORTB, PANEL_OE		; PONE A UNO PARA QUE SE VISUALICEN LOS NUMEROS ( ES INVERTIDA LA SEÑAL )
000ec5 e120      	LDI			R18, 16				; NUMERO DE CARACTERES
000ec6 c003      	RJMP		BYTA
                 PANEL_1:
000ec7 950a      	DEC			R16
000ec8 f409      	BRNE		BYTA				; VA A BYTA SI ES DISTINTO DE CERO	
                 	
000ec9 9508      	RET
                 
                 BYTA:
000eca 98c5      	CBI			PORTB,  PANEL_DATA	; PONE A CERO EL BIT 0 DEL PUERTO B
000ecb 98c6      	CBI			PORTB,  PANEL_CLK	; PONE A CERO EL NIVEL DEL RELOJ
                 ;	SBRC		R24, 7				; si es cero salta la siguiente instrucion
000ecc fd83      	SBRC		R24, 3				; si es cero salta la siguiente instrucion
000ecd 9ac5      	SBI			PORTB,  PANEL_DATA	; PONE A UNO EL BIT 0 DEL PUERTO B
000ece e091      	LDI 		R25, retardo_panel
000ecf 940e 092a 	CALL		RETARDO
000ed1 9ac6      	SBI			PORTB,  PANEL_CLK	; SEÑAL DEL RELOJ A UNO DATO VALIDO
000ed2 e091      	LDI 		R25, retardo_panel
000ed3 940e 092a 	CALL		RETARDO
                 
                 ; BYT 1
000ed5 98c5      	CBI			PORTB,  PANEL_DATA	; PONE A CERO EL BIT 0 DEL PUERTO B
000ed6 98c6      	CBI			PORTB,  PANEL_CLK	; PONE A CERO EL NIVEL DEL RELOJ
                 ;	SBRC		R24, 6				; si es cero salta la siguiente instrucion
000ed7 fd82      	SBRC		R24, 2				; si es cero salta la siguiente instrucion
000ed8 9ac5      	SBI			PORTB,  PANEL_DATA	; PONE A CERO EL BIT 0 DEL PUERTO B
000ed9 e091      	LDI 		R25, retardo_panel
000eda 940e 092a 	CALL		RETARDO
000edc 9ac6      	SBI			PORTB,  PANEL_CLK	; SEÑAL DEL RELOJ A UNO DATO VALIDO
000edd e091      	LDI 		R25, retardo_panel
000ede 940e 092a 	CALL		RETARDO
                 
                 ; BYT 2
000ee0 98c5      	CBI			PORTB,  PANEL_DATA	; PONE A CERO EL BIT 0 DEL PUERTO B
000ee1 98c6      	CBI			PORTB,  PANEL_CLK	; PONE A CERO EL NIVEL DEL RELOJ
                 ;	SBRC		R24, 5				; si es cero salta la siguiente instrucion
000ee2 fd81      	SBRC		R24, 1				; si es cero salta la siguiente instrucion
000ee3 9ac5      	SBI			PORTB,  PANEL_DATA	; PONE A CERO EL BIT 0 DEL PUERTO B
000ee4 e091      	LDI 		R25, retardo_panel
000ee5 940e 092a 	CALL		RETARDO
000ee7 9ac6      	SBI			PORTB,  PANEL_CLK	; SEÑAL DEL RELOJ A UNO DATO VALIDO
000ee8 e091      	LDI 		R25, retardo_panel
000ee9 940e 092a 	CALL		RETARDO
                 
                 ; BYT 3
000eeb 98c5      	CBI			PORTB,  PANEL_DATA	; PONE A CERO EL BIT 0 DEL PUERTO B
000eec 98c6      	CBI			PORTB,  PANEL_CLK	; PONE A CERO EL NIVEL DEL RELOJ
                 ;	SBRC		R24, 4				; si es cero salta la siguiente instrucion
000eed fd80      	SBRC		R24, 0				; si es cero salta la siguiente instrucion
000eee 9ac5      	SBI			PORTB,  PANEL_DATA	; PONE A CERO EL BIT 0 DEL PUERTO B
000eef e091      	LDI 		R25, retardo_panel
000ef0 940e 092a 	CALL		RETARDO
000ef2 9ac6      	SBI			PORTB,  PANEL_CLK	; SEÑAL DEL RELOJ A UNO DATO VALIDO
000ef3 e091      	LDI 		R25, retardo_panel
000ef4 940e 092a 	CALL		RETARDO
                 
                 ; BYT 4
000ef6 98c5      	CBI			PORTB,  PANEL_DATA	; PONE A CERO EL BIT 0 DEL PUERTO B
000ef7 98c6      	CBI			PORTB,  PANEL_CLK	; PONE A CERO EL NIVEL DEL RELOJ
                 ;	SBRC		R24, 3				; si es cero salta la siguiente instrucion
000ef8 fd85      	SBRC		R24, 5				; si es cero salta la siguiente instrucion
000ef9 9ac5      	SBI			PORTB,  PANEL_DATA	; PONE A CERO EL BIT 0 DEL PUERTO B
000efa e091      	LDI 		R25, retardo_panel
000efb 940e 092a 	CALL		RETARDO
000efd 9ac6      	SBI			PORTB,  PANEL_CLK	; SEÑAL DEL RELOJ A UNO DATO VALIDO
000efe e091      	LDI 		R25, retardo_panel
000eff 940e 092a 	CALL		RETARDO
                 
                 
                 ; BYT 5
000f01 98c5      	CBI			PORTB,  PANEL_DATA	; PONE A CERO EL BIT 0 DEL PUERTO B
000f02 98c6      	CBI			PORTB,  PANEL_CLK	; PONE A CERO EL NIVEL DEL RELOJ
                 ;	SBRC		R24, 2				; si es cero salta la siguiente instrucion
000f03 fd86      	SBRC		R24, 6				; si es cero salta la siguiente instrucion
000f04 9ac5      	SBI			PORTB,  PANEL_DATA	; PONE A CERO EL BIT 0 DEL PUERTO B
000f05 e091      	LDI 		R25, retardo_panel
000f06 940e 092a 	CALL		RETARDO
000f08 9ac6      	SBI			PORTB,  PANEL_CLK	; SEÑAL DEL RELOJ A UNO DATO VALIDO
000f09 e091      	LDI 		R25, retardo_panel
000f0a 940e 092a 	CALL		RETARDO
                 
                 ; BYT 6
000f0c 98c5      	CBI			PORTB,  PANEL_DATA	; PONE A CERO EL BIT 0 DEL PUERTO B
000f0d 98c6      	CBI			PORTB,  PANEL_CLK	; PONE A CERO EL NIVEL DEL RELOJ
                 ;	SBRC		R24, 1				; si es cero salta la siguiente instrucion
000f0e fd84      	SBRC		R24, 4				; si es cero salta la siguiente instrucion
000f0f 9ac5      	SBI			PORTB,  PANEL_DATA	; PONE A CERO EL BIT 0 DEL PUERTO B
000f10 e091      	LDI 		R25, retardo_panel
000f11 940e 092a 	CALL		RETARDO
000f13 9ac6      	SBI			PORTB,  PANEL_CLK	; SEÑAL DEL RELOJ A UNO DATO VALIDO
000f14 e091      	LDI 		R25, retardo_panel
000f15 940e 092a 	CALL		RETARDO
                 
                 
                 ; BYT 7
000f17 98c5      	CBI			PORTB,  PANEL_DATA	; PONE A CERO EL BIT 0 DEL PUERTO B
000f18 98c6      	CBI			PORTB,  PANEL_CLK	; PONE A CERO EL NIVEL DEL RELOJ
                 ;	SBRC		R24, 0				; si es cero salta la siguiente instrucion
000f19 fd87      	SBRC		R24, 7				; si es cero salta la siguiente instrucion
000f1a 9ac5      	SBI			PORTB,  PANEL_DATA	; PONE A CERO EL BIT 0 DEL PUERTO B
000f1b e091      	LDI 		R25, retardo_panel
000f1c da0d      	RCALL		RETARDO
000f1d 9ac6      	SBI			PORTB,  PANEL_CLK	; SEÑAL DEL RELOJ A UNO DATO VALIDO
000f1e e091      	LDI 		R25, retardo_panel
000f1f da0a      	RCALL		RETARDO
000f20 cfa6      	RJMP		PANEL_1
                 
                 .INCLUDE "TEXTO_LCD2.ASM"
                 
                 
                 ; PASA EL TEXTO A RAM POSICION $ 100 DE FLASN POSICION TEXTO6 Y TEXTO7 CSEG 1580
                 
                 ;cargamos TEXTO PANTALLA DOS   
                  
                 
                 
                 
                 INI_LCD_2: 
000f21 e0d4          LDI   			YH,0x04        	; direcion alta donde se pone el texto en RAM VALOR ANTIGUO 00
000f22 e2c0          LDI   			YL,0x20      	; direccion baja donde se pone el texto en RAM VALOR ANTIGUO EC
000f23 e2fa          LDI   			ZH,high(TEXTO6*2); direccion alta del TEXTO en Flash
000f24 e0e8          LDI   			ZL,low(TEXTO6*2) ; direccion baja del TEXTO en Flash 
000f25 eb04          LDI   			R16,180      	; longitud de texto a copiar en RAM
                 ;*** RURINA CARGAR TEXTO DE FLASH A RAM  
                 ;EN Y (YH,YL) POSICION EN RAM
                 ;EN Z (ZH,ZL) POSICION EN FLASH
                 ;EN R16 NUMERO DE LETRAS (BYTS)
                 
                 CARGATEXTO_2A:
000f26 95c8      	LPM      						; leemos TEXTO de FLASH y lo almacena en R0
000f27 9631      	ADIW  			ZL,1   			; apuntamos al siguiente elemento 
000f28 8208      	ST    			Y, R0			; guardamos en RAM POSICION Y EL CONTENIDO DE R0
000f29 9621      	ADIW  			YL,1      		
000f2a 950a      	DEC   			R16      		; Hemos terminado..?? 
000f2b f7d1      	BRNE  			CARGATEXTO_2A  	; NO...seguimos cargando 
                 
                 ; SEGUNDA PARTE NO SE PUEDE HACER EN UNA POR SUPERAR LOS 255 CARACTERES
000f2c e0d5          LDI   			YH,0x05        	; direcion alta donde se pone el texto en RAM
000f2d e1c0          LDI   			YL,0x10      	; direccion baja donde se pone el texto en RAM 
000f2e e2fa          LDI   			ZH,high(TEXTO7*2); direccion alta del TEXTO en Flash
000f2f ebec          LDI   			ZL,low(TEXTO7*2) ; direccion baja del TEXTO en Flash 
000f30 ef00          LDI   			R16,240      	; longitud de texto a copiar en RAM
                 ;*** RURINA CARGAR TEXTO DE FLASH A RAM  
                 ;EN Y (YH,YL) POSICION EN RAM
                 ;EN Z (ZH,ZL) POSICION EN FLASH
                 ;EN R16 NUMERO DE LETRAS (BYTS)
                 
                 CARGATEXTO_2AA:
000f31 95c8      	LPM      						; leemos TEXTO de FLASH y lo almacena en R0
000f32 9631      	ADIW  			ZL,1   			; apuntamos al siguiente elemento 
000f33 8208      	ST    			Y, R0			; guardamos en RAM POSICION Y EL CONTENIDO DE R0
000f34 9621      	ADIW  			YL,1      		
000f35 950a      	DEC   			R16      		; Hemos terminado..?? 
000f36 f7d1      	BRNE  			CARGATEXTO_2AA 	; NO...seguimos cargando 
                 
                 
                 ; SEGUNDA PARTE NO SE PUEDE HACER EN UNA POR SUPERAR LOS 255 CARACTERES
000f37 e0d6          LDI   			YH,0x06        	; direcion alta donde se pone el texto en RAM
000f38 e0c0          LDI   			YL,0x00      	; direccion baja donde se pone el texto en RAM 
000f39 e2fb          LDI   			ZH,high(TEXTO8*2); direccion alta del TEXTO en Flash
000f3a eaec          LDI   			ZL,low(TEXTO8*2) ; direccion baja del TEXTO en Flash 
000f3b ef00          LDI   			R16,240      	; longitud de texto a copiar en RAM
                 ;*** RURINA CARGAR TEXTO DE FLASH A RAM  
                 ;EN Y (YH,YL) POSICION EN RAM
                 ;EN Z (ZH,ZL) POSICION EN FLASH
                 ;EN R16 NUMERO DE LETRAS (BYTS)
                 
                 CARGATEXTO_2BA:
000f3c 95c8      	LPM      						; leemos TEXTO de FLASH y lo almacena en R0
000f3d 9631      	ADIW  			ZL,1   			; apuntamos al siguiente elemento 
000f3e 8208      	ST    			Y, R0			; guardamos en RAM POSICION Y EL CONTENIDO DE R0
000f3f 9621      	ADIW  			YL,1      		
000f40 950a      	DEC   			R16      		; Hemos terminado..?? 
000f41 f7d1      	BRNE  			CARGATEXTO_2BA 	; NO...seguimos cargando 
                 
000f42 e0d6          LDI   			YH,0x06        	; direcion alta donde se pone el texto en RAM
000f43 efc0          LDI   			YL,0xF0      	; direccion baja donde se pone el texto en RAM 
000f44 e2fc          LDI   			ZH,high(TEXTO9*2); direccion alta del TEXTO en Flash
000f45 e9ec          LDI   			ZL,low(TEXTO9*2) ; direccion baja del TEXTO en Flash 
000f46 ef00          LDI   			R16,240      	; longitud de texto a copiar en RAM
                 ;*** RURINA CARGAR TEXTO DE FLASH A RAM  
                 ;EN Y (YH,YL) POSICION EN RAM
                 ;EN Z (ZH,ZL) POSICION EN FLASH
                 ;EN R16 NUMERO DE LETRAS (BYTS)
                 
                 CARGATEXTO_2BB:
000f47 95c8      	LPM      						; leemos TEXTO de FLASH y lo almacena en R0
000f48 9631      	ADIW  			ZL,1   			; apuntamos al siguiente elemento 
000f49 8208      	ST    			Y, R0			; guardamos en RAM POSICION Y EL CONTENIDO DE R0
000f4a 9621      	ADIW  			YL,1      		
000f4b 950a      	DEC   			R16      		; Hemos terminado..?? 
000f4c f7d1      	BRNE  			CARGATEXTO_2BB 	; NO...seguimos cargando 
                 
000f4d e0d8          LDI   			YH,0x08        	; direcion alta donde se pone el texto en RAM
000f4e efc8          LDI   			YL,0xF8      	; direccion baja donde se pone el texto en RAM 
000f4f e2fd          LDI   			ZH,high(TEXTO10*2); direccion alta del TEXTO en Flash
000f50 e8ec          LDI   			ZL,low(TEXTO10*2) ; direccion baja del TEXTO en Flash 
000f51 ef00          LDI   			R16,240      	; longitud de texto a copiar en RAM
                 
                 CARGATEXTO_2BC:
000f52 95c8      	LPM      						; leemos TEXTO de FLASH y lo almacena en R0
000f53 9631      	ADIW  			ZL,1   			; apuntamos al siguiente elemento 
000f54 8208      	ST    			Y, R0			; guardamos en RAM POSICION Y EL CONTENIDO DE R0
000f55 9621      	ADIW  			YL,1      		
000f56 950a      	DEC   			R16      		; Hemos terminado..?? 
000f57 f7d1      	BRNE  			CARGATEXTO_2BC 	; NO...seguimos cargando 
                 
                 
                 ;  PONE EL TEXTO DE FLASH A RAM
000f58 e0d9         LDI   			YH,0x09        	; direcion alta donde se pone el texto en RAM
000f59 efcc          LDI   			YL,0xFC      	; direccion baja donde se pone el texto en RAM 
000f5a e2fe          LDI   			ZH,high(TEXTO11*2); direccion alta del TEXTO en Flash
000f5b e7ec          LDI   			ZL,low(TEXTO11*2) ; direccion baja del TEXTO en Flash 
000f5c ec08          LDI   			R16,200      	; longitud de texto a copiar en RAM
                 
                 CARGATEXTO_2BD:
000f5d 95c8      	LPM      						; leemos TEXTO de FLASH y lo almacena en R0
000f5e 9631      	ADIW  			ZL,1   			; apuntamos al siguiente elemento 
000f5f 8208      	ST    			Y, R0			; guardamos en RAM POSICION Y EL CONTENIDO DE R0
000f60 9621      	ADIW  			YL,1      		
000f61 950a      	DEC   			R16      		; Hemos terminado..?? 
000f62 f7d1      	BRNE  			CARGATEXTO_2BD 	; NO...seguimos cargando 
                 
                 
                 
000f63 9508      	RET     						; SI...terminamos 
                 
                 ;.CSEG 
                 ;.ORG 0x0E90; 
                 ;.INCLUDE "FRECUENCIMETRO.ASM"
                 ;.INCLUDE "PI2C.ASM"				; esta opcion es con i2c del propio micro atmega16
                 ;.CSEG 
                 ;.ORG 0x0F20;    
                 .INCLUDE "AJUSTE_PRODUCION.ASM"
                 
                 AJUSTE_PRODUCION: ; PONE EN LINEA 1  "PRODUCION %" EN LINEA 2 PORCENTAJE
000f64 e634      	LDI				R19, 100			; VALOR INICIAL DEL PORCENTAJE DE PRODUCION 100X100
000f65 e021      	LDI				R18, 1
000f66 2e52      	MOV				R5, R18
000f67 e0d2          LDI   			YH,0x02        		; direcion alta donde se pone el texto en RAM
000f68 e6c0          LDI   			YL,0x60      		; direccion baja donde se pone el texto en RAM 
000f69 e2f6          LDI   			ZH,high(TEXTO1*2)	; direccion alta del TEXTO en Flash
000f6a e2e0          LDI   			ZL,low(TEXTO1*2) 	; direccion baja del TEXTO en Flash 
000f6b e100          LDI   			R16,16      		; longitud de texto a copiar en RAM
                 CARGATEXTO_3P:
000f6c 95c8      	LPM      							; leemos TEXTO de FLASH y lo almacena en R0
000f6d 9631      	ADIW  			ZL,1   				; apuntamos al siguiente elemento 
000f6e 8208      	ST    			Y, R0				; guardamos en RAM POSICION Y EL CONTENIDO DE R0
000f6f 9621      	ADIW  			YL,1				; incrementa en una unidad      		
000f70 950a      	DEC   			R16      			; Hemos terminado..?? 
000f71 f7d1      	BRNE  			CARGATEXTO_3P  		; NO...seguimos cargando 
                 AJUSTE_PRODUCION_1:
000f72 e060      	LDI				R22, 00
                 AJUSTE_PRODUCION_2:						; RETARDO TECLADO
000f73 316e      	CPI				R22, 30
000f74 f3f0      	BRLO			AJUSTE_PRODUCION_2	
000f75 2f83      	MOV				R24, R19
000f76 940e 0590 	CALL			RADC
000f78 9210 026d 	STS				$26D, R1
000f7a 9220 026e 	STS				$26E, R2
000f7c 9230 026f 	STS				$26F, R3	
000f7e e800      	LDI				R16, 128			;  escribir en linea 1 
000f7f 940e 053e 	CALL			ENVINT
000f81 e0d5      	LDI				YH, HIGH(POR_PRO)	; POSICION ALTA DEL TAXTO EN RAM $0260
000f82 e8c8      	LDI				YL, LOW (POR_PRO)	; direccion BAJA DEL TEXTO EN RAM      	
000f83 e110        	LDI				R17,16 				; bytes a enviar 
000f84 940e 0925 	CALL			ENVIARTEXTO			; RUTINA PARA ENVIAR TEXTO A PANTALLA
                 ;LEC_TECLADO1:  ; RESULTADO EN R17 RUTINA LECTURA TECLADO
000f86 940e 04c0 	CALL			LEC_TEC
                 ; PARAMETRO DE REDUCION DE LA PRODUCION CON CUBIERTA
000f88 3e1f      	CPI				R17, 0B11101111		; IDEM
000f89 f029      	BREQ			SUBE_R19
000f8a 3f1d      	CPI				R17, 0B11111101		; IDEM
000f8b f049      	BREQ			BAJA_R19
000f8c 371f      	CPI				R17, 0B01111111		; IDEM
000f8d f069      	BREQ			SALE_AJUSTE			; GRABA EN EEPROM LA POSICION DE LAS DOS LINEAS
000f8e cfe3      	RJMP			AJUSTE_PRODUCION_1	
                 SUBE_R19:
000f8f 9533      	INC				R19
000f90 9533      	INC				R19
000f91 9533      	INC				R19
000f92 9533      	INC				R19
000f93 9533      	INC				R19
000f94 cfdd      	RJMP			AJUSTE_PRODUCION_1
                 BAJA_R19:
000f95 953a      	DEC				R19
000f96 953a      	DEC				R19
000f97 953a      	DEC				R19
000f98 953a      	DEC				R19
000f99 953a      	DEC				R19
000f9a cfd7      	RJMP			AJUSTE_PRODUCION_1
                 SALE_AJUSTE:
000f9b 2f23      	MOV				R18, R19
000f9c e214      	LDI				R17, RE_PRO			; GRABACION EN EEPROM POR PRIMERA VEZ
000f9d 940e 0587 	CALL			EEPROM_ES			; RUTINA DE GRABACION EN EEPROM
000f9f d9df      	RCALL			NO_TECLA			; ESPERA A QUE SE SUELTE LA TECLA
000fa0 9508      	RET
                 .INCLUDE "MULTIPLICAR.ASM"
                 
                 ; Y
                 ; CONVERTIR DOS REGISTROS HEXADECIMALES " EL RESULTADO" EN DECIMALES
                 ; COJE DE LA MEMORIA RAM "RAM_PRO_PRO" EL PORCENTAJE DE PRODUCION DIRECION 1E2 DE LA RAM Y 024 DE LA EEPROM
                 ; Y EN R18 SE DEBE CARGAR LA CANTIDAD O PRODUCION PROGRAMADA
                 ; R2 CENTENAS Y DECENAS DE MILLAR
                 ; R1 UNIDADES DE MILLAR Y CENTENAS
                 ; R0 UNIDADES Y DECENAS
                 
                 MULTIPLICAR_A:
000fa1 933f      	PUSH	R19
000fa2 2f92      	MOV		R25, R18
000fa3 9180 0212 	LDS		R24, RAM_PRO_PRO
000fa5 9f98      	MUL		R25, R24
000fa6 2d91      	MOV		R25, R1
000fa7 2d80      	MOV		R24, R0
000fa8 e624      	LDI		R18, 100
000fa9 2e42      	MOV		R4, R18
000faa e020      	LDI		R18, 0
000fab 2e52      	MOV		R5, R18
000fac 2e22      	MOV		R2, R18
000fad 2e12      	MOV		R1, R18
000fae 2e02      	MOV		R0, R18
                 	
                 MULTIPLICAR_A_1:
000faf 1595      	CP		R25, R5				; EL MAYOR ES CERO SALTA SI YA ES CERO
000fb0 f419      	BRNE	MULTIPLICAR_A_2		; SALTA SI ES DISTINTO
000fb1 1584      	CP		R24, R4				; SI ES MAYOR R24 QUE R4 SALTA
000fb2 f408      	BRCC	MULTIPLICAR_A_2		; SI ES IGUAL VA AQUI	
000fb3 c008      	RJMP	MULTIPLICAR_FIN
                 MULTIPLICAR_A_2:	; CENTENAS Y NIDADES DE MULLAR R5
000fb4 97c2      	SBIW	R25: R24, 50		; RESTA 50
000fb5 97c2      	SBIW	R25: R24, 50		; RESTA 50
000fb6 9413      	INC		R1					; INCREMENTA CENTENAS Y UNIDADES DE MILLAR
000fb7 1414      	CP		R1, R4
000fb8 f7b1      	BRNE	MULTIPLICAR_A_1			
000fb9 9423      	INC		R2					; LO MAS ALTO					
000fba 1814      	SUB		R1, R4
000fbb cff3      	RJMP	MULTIPLICAR_A_1
                 MULTIPLICAR_FIN:
000fbc 2d81      	MOV		R24, R1
000fbd 2d21      	MOV		R18, R1
000fbe 9380 0213 	STS		RAM_PRO_PRO_M, R24
000fc0 940e 0590 	CALL	RADC
000fc2 9210 025d 	STS		$25D, R1
000fc4 9220 025e 	STS		$25E, R2
000fc6 9230 025f 	STS		$25F, R3
000fc8 9180 0212 	LDS		R24, RAM_PRO_PRO
000fca 940e 0590 	CALL	RADC
000fcc 9210 0254 	STS		$254, R1
000fce 9220 0255 	STS		$255, R2
000fd0 9230 0256 	STS		$256, R3
000fd2 913f      	POP		R19
000fd3 9508      	RET
                 ;.INCLUDE "UART.ASM"
                 ;.INCLUDE "RRADIO.ASM"
                 .INCLUDE "INI_ATMEGA64.ASM"						; PARAMETROS DE INICIALIZACION DEL MICRO
                 
                 ; EN RS232 PONER LA DIVISION EN 47 Y EL CONTEO DE SEGUNDOS EN 33 EN VEZ DE 36
                 INI_ATMEGA64:
                 ; INICIALIZACION ATMEGA16
                 ; SFIOR
                 ;		ADTS2 ADTS1 ADTS0  ACME PUD PSR2 PSR10
                 		
                 ;		ADTS2		I
                 ;		ADTS1		I SELECIONES EL PUNTO DE DISPARO VER PAG 221
                 ;		ADTS0		I
                 ;		ACME		COMPARADOR ANALOGICA PAG 201
                 ;		PUD			CONTROL DE LA CARGA AL POSITIVO DE LOS PUERTOS VER PAG 52 0 CARGA ACTIVADA
                 ;		PRS2		PREESCALA TIMER 2
                 ;		PRS10		PREESCALA TIMER 0 Y 1 PAG 88
                 
                 ;  TCCR0: VER PAGINA 83
                 
                 ;		FOC0 WGM00 COM01 COM00 WGM01 CS02 CS01 CS00
                 
                 
                 ;				0				 0 								Normal 0xFF Immediate MAX
                 ;				1 				 0 								PWM, Phase Correct 0xFF TOP BOTTOM
                 ;				0				 1 								CTC OCR0 Immediate MAX
                 ;				1				 1 								Fast PWM 0xFF BOTTOM MAX
                 
                 ;					COM01 COM00 Description
                 ;						0 	0 Normal port operation, OC0 disconnected.
                 ;						0 	1 Reserved
                 ;						1 	0 Clear OC0 on compare match when up-counting. Set OC0 on compare match when downcounting.
                 ;						1 	1 Set OC0 on compare match when up-counting. Clear OC0 on compare match when downcounting.
                 
                 
                 ;									 CS02 CS01 CS00 Description
                 ;									 	0 	0 	0 	No clock source (Timer/Counter stopped).
                 ;									 	0 	0 	1 	clkI/O/(No prescaling)
                 ;									 	0 	1 	0 	clkI/O/8 (From prescaler)
                 ;									 	0 	1 	1 	clkI/O/64 (From prescaler)
                 ;									 	1 	0 	0 	clkI/O/256 (From prescaler)
                 ;									 	1 	0 	1 	clkI/O/1024 (From prescaler)
                 ;									 	1 	1 	0 	External clock source on T0 pin. Clock on falling edge.
                 ;									 	1 	1 	1 	External clock source on T0 pin. Clock on rising edge
                 
                 ;  TIFR:
                 
                 ;		OCF2 TOV2 ICF1 OCF1A OCF1B TOV1 OCF0 TOV0
                 ; OCR0  el valor introduciodo en este registr0 es comparado con el de TCNTO y se puede
                 ;		producir un interrupcion el ser iguales
                 ;TCNT0	REGISTRO DONDE SE CUENTAN LAS PASOS
                 
                 
                 // Timer/Counter 0 initialization
                 // Clock source: System Clock
                 // Clock value: 31,250 kHz
                 // Mode: Normal top=0xFF
                 // OC0 output: Disconnected
000fd4 e007      	LDI				R16, 07			; CUANTO MAS BAJO MAS RAPIDO EL TECLADO
000fd5 bf03      	OUT				TCCR0, R16
000fd6 e000      	LDI				R16, 00
000fd7 bf02      	OUT				TCNT0, R16
000fd8 bf00      	OUT				ASSR, R16
000fd9 e000      	LDI				R16, 0X00
000fda bf01      	OUT				OCR0, R16
                 
                 // Timer/Counter 1 initialization
                 // Clock source: System Clock
                 // Clock value: 1000,000 kHz
                 // Mode: Normal top=0xFFFF
                 // OC1A output: Discon.
                 // OC1B output: Discon.
                 // Noise Canceler: On
                 // Input Capture on Falling Edge
                 // Timer1 Overflow Interrupt: On
                 // Input Capture Interrupt: Off
                 // Compare A Match Interrupt: Off
                 // Compare B Match Interrupt: Off
                 ; inicializado a UN impulso por segundo y puesta a cero, cuenta en lec_rel y temp_tec
000fdb e000      	LDI				R16,00
000fdc bd0d      	OUT				TCNT1H, R16
000fdd e000      	LDI				R16,00
000fde bd0c      	OUT				TCNT1L, R16
000fdf e000      	LDI				R16,00
000fe0 bd07      	OUT				ICR1H, R16
000fe1 e000      	LDI				R16,00
000fe2 bd06      	OUT				ICR1L, R16
000fe3 e70a      	LDI				R16,0x7A
000fe4 bd0b      	OUT				OCR1AH, R16
000fe5 e102      	LDI				R16, 0x12		; UNA HORA SON 100 MINUTOS HALA
000fe6 bd0a      	OUT				OCR1AL, R16
000fe7 e000      	LDI				R16,00
000fe8 bd09      	OUT				OCR1BH, R16
000fe9 ef0a      	LDI				R16, 0xfa
000fea bd08      	OUT				OCR1BL, R16
000feb e000      	LDI				R16,00
000fec bd0f      	OUT				TCCR1A, R16		; control y divisor timer A
000fed e004      	LDI				R16, 4
000fee bd0e      	OUT				TCCR1B, R16		; control y divisor timer B
                 // Timer/Counter 2 initialization
                 // Clock source: System Clock
                 // Clock value: Timer2 Stopped
                 // Mode: Normal top=0xFF
                 // OC2 output: Disconnected
000fef e000      	LDI				R16,00
000ff0 bf00      	OUT				ASSR, R16
                 ;	LDI				R16,00
000ff1 bd05      	OUT				TCCR2, R16		; FRECUENCIA DEL RELOJ 2 SE UTILIZA EN LA RUTINA RADIO
                 ;	LDI				R16,00
000ff2 bd04      	OUT				TCNT2, R16
                 ;	LDI				R16,00
000ff3 bd03      	OUT				OCR2, R16
000ff4 bf06      	OUT				TIFR, R16
                 // External Interrupt(s) initialization
                 // INT0: Off
                 // INT1: Off
                 // INT2: Off
000ff5 e000      	LDI				R16,00	
000ff6 bf05      	OUT				MCUCR, R16
000ff7 e000      	LDI				R16,00	
000ff8 bf04      	OUT				MCUCSR, R16
                 
                 ; TIMSK		Ccontrol de interrupciones del timer    	
                 ;		OCIE2 TOIE2 TICIE1 OCIE1A OCIE1B TOIE1 OCIE0 TOIE0
                 		; TOIE0					;  bit 0 timer 0 por desbordamiento
                 		; OCIE0					;  bit 1 timer 0 por comparacion con OCR0 						
                 								;  bit 2 timer 1 desbordamiento
                 								;  bit 3 timer 1 compara OCR1B
                 								;  bit 4 timer 1 compara OCR1A
                 								;  bit 5 timer 1 entrada actiba
                 								;  bit 6 timer 2 desbordamiento
                 								;  bit 7 tomer 2 compara  con OCR2
                 
                 
000ff9 e501      	LDI				R16,0B01010001	
000ffa bf07      	OUT				TIMSK, R16
                 
                 ;********************* ACTIVAR EL CONVERTIDOR ANALOGICO DIGITAL CON INTERRUPCION **********
                 
                 
                 // TWI initialization
                 // Bit Rate: 100,000 kHz
                 ;TWBR=0x20; BIT RATE DE LA TRANSMISION
                 // Two Wire Bus Slave Address: 0x1A
                 // General Call Recognition: Off
                 
                 // Generate Acknowledge Pulse: On
                 // TWI Interrupt: On
                 ;	LDI				R16, 0x45
                 ;	OUT				TWCR, R16		; REGISTRO DE CONTROL
                 ;	LDI				R16, 0x00
                 ;	OUT				TWSR, R16		; REGISTRO DE ESTADO
                 ;	LDI				R16, 0x4F
                 ;	OUT				TWAR, R16		; DIRECION DEL SLAVE
                 
000ffb 9478      	SEI				; ACTIVA LAS INTERRUPCIONES
                 
                 // USART initialization
                 // USART disabled
                 ;	LDI				R16,00	
                 ;	OUT				UCSRB, R16
                 // Analog Comparator initialization
                 // Analog Comparator: Off
                 // Analog Comparator Input Capture by Timer/Counter 1: Off
                 	
                 ;	ACSR=0x80;
                 	
                 ;	SFIOR=0x00;
                 ;LDI R16,0B01001011
                 ;OUT ACSR,R16
                 // ADC initialization
                 // ADC Clock frequency: 1000,000 kHz
                 // ADC Voltage Reference: AREF pin
                 // ADC Auto Trigger Source: ADC Stopped
                 	
                 ;	ADMUX=ADC_VREF_TYPE & 0xff;
                 	
                 ;	ADCSRA=0x83;
                 
                 // SPI initialization
                 // SPI disabled
                 ;	SPCR=0x00;
                 ; DDR 		SALIDA A UNO ENTRADA A CERO
                 ; PORT		A UNO LA RESISTENCIA PUS-PULL ACTIVADA- EN OPCION SALIDA VALOR DE ESTA A CERO Ó A UNO
                 ; PIN		LECTURA DEL VALOR DE ENTRADA
                 ;cofiguramos los puertos A B C Y D  
                 ;programar primero la salida C para evitar micro-corto circuito con la salida D
                 ; ** PRECAUCION ** NO MODIFICAR EL ORDEN DE PROGRAMACION DE LOS PUERTOS C B D A
                 
                 
                 
000ffc ef0f       	LDI				R16, 0B11111111	; PC1 COMO ENTRADA CONTROL PANTALLA GRAFICA CORTAR PISTA EN PLACA PANTALLA
000ffd bb04      	OUT   			DDRC,R16		; TODAS SALIDAS MENOS SDL Y CLK CONTROL I2C
000ffe e10f      	LDI   			R16, 0B00011111	; salida 4 a 1 por ser el teclado 0,1,y 2 son los led amarillos
000fff bb05      	OUT   			PORTC,R16		; TODAS LAS SALIDA A CERO MENOS LA Pc3 LECTURA DE TACLADO A 1
                 
001000 e007      	LDI				R16,0B00000111	;PUERTO 4 REMOTO Y 3 TIPO DE FUENTE COMO ENTRADA SEÑAL
001001 bb07      	OUT   			DDRB, R16		; PUERTO 5 6 Y 7 ENTRADA DEL MESTRO
001002 e90f      	LDI				R16,0B10011111	;PUERTO 4 Y 3 COMO ENTRADA SEÑAL PARA EL CONTROL REMOTO	PUERTO 1 APOYA DE RDOX	
001003 bb08      	OUT   			PORTB, R16		; Y PUERTO 0 TIPO DE FUENTE
001004 9894      	CBI				PORTD, 4		; APAGA CONTROL REMOTO Y VENTILADOR
                 
001005 ef03      	LDI	  			R16, 0B11110011	; D2 y D3  ENTRADA SEÑAL RS232
001006 bb01      	OUT   			DDRD,R16		
001007 e10f      	LDI	  			R16, 0B00011111	; D2 Y D3 ACTIVADA RESISTENCIA A UNO	
001008 bb02      	OUT   			PORTD, R16
                 
001009 ef0f          SER   			R16 			;pone a FF r16
00100a bb0a          OUT   			DDRA,R16   		;todo salidas..DATOS a FF
00100b bb0b          OUT   			PORTA,R16 
                 
00100c eb00      	LDI				R16,0B10110000	; TODO ENTRADAS A CERO  E7 ANALOGICO DIGITAL  E3 CONTROL MOS-FET  E4 CONTROL CAUDAL Y E5 CONTROL MOTOR PASO A PASO
00100d b902      	OUT				DDRE,R16
00100e ef0f      	LDI				R16,0B11111111	; ACTIVADA RESISTENCIA A UNO E0 Y E1 RS232 SALIDA E3 CONTROL MOS-FET SALIDA E4 PARA CONTROL DE CAUDAL E7 PARA SEÑAL COMPARADOR ANALOGICO
00100f b903      	OUT				PORTE,R16
                 ; CONFIGURAR PUERTO G LINEA0 COMO SALIDA PARA CONTROL EQUIPO REMOTO
                 	
001010 e101      	LDI				R16,0B00010001	; PUERTO 0 COMO SALIDA
001011 9300 0064 	STS				DDRG,R16
001013 e100      	LDI				R16,0B00010000	; RESISTENCIA ACTIVADA SALIDA A 1
001014 9300 0065 	STS				PORTG,R16
                 
001016 2700      	CLR	  			R16				; LIMPIA EL REGISTRO 16
001017 2ef0      	MOV	  			VAL_LED, R16	; PASA EL VALOR DE R16 A LOS LED DE PANTALLA	
                 ;	RCALL			LED_PANT
                 
                 ; CONTROL MODELO DE FUENTE
001018 9bb3      	SBIS			PINB, E_FUENTE	; SALTA LA SIGUIENTE INSTRUCION SI ES UNO
001019 98c1      	CBI   			PORTB, 1		; SALIDA DEL PC817 A CERO APAGADA
00101a 9bb3      	SBIS			PINB, E_FUENTE	; SALTA LA SIGUIENTE INSTRUCION SI ES UNO
00101b 98b9      	CBI   			DDRB, 1 		; SALIDA DEL PC817 A UNO APAGADA
00101c 9894      	CBI				PORTD, 4		; APAGA CONTROL REMOTO Y VENTILADOR
                 
                 
                 ;  TEXTO DE INICIO : SELECIONA LA 1ª VEZ MODELO Y CLIENTE
                 ;  OPCION LEER EN EEPRON EL TEXTO DE PRESENTACION
00101d e112      	LDI				R17, texto_presentacion	; POSICION DE MEMORIA A LEER EN EEPROM $1DE
                 ;	RCALL			I2CL_2404			; A LA RUTINA DE LECTURA DE LA EEPROM
00101e 940e 057e 	CALL			EEPROM_RW			; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
001020 ef9a      	LDI				R25, 250
001021 940e 05d2 	CALL			COMP
001023 fd40      	SBRC			CONTROL, 0			; VERIFICA SI ES CERO EL BIT 0 SI ES CIERTO SALTA LA SIG. INSTRUCION
001024 940e 0050 	CALL			AJUSTE_PRESENTACION_INICIO ; LA MEMORIA NO ESTA PROGRAMADA Y SALTA A LA RUTINA DE PROGRAMACION
001026 9a95      	SBI				PORTD,b_acido		; ENCIENDE BOMBA DE ACIDO
001027 e112      	LDI				R17, texto_presentacion	; POSICION DE MEMORIA A LEER EN EEPROM $1DE
001028 940e 057e 	CALL			EEPROM_RW
00102a 2e42      	MOV				R4, R18
00102b e113      	LDI				R17, texto_presentacion + 1	; POSICION DE MEMORIA A LEER EN EEPROM $1DE
00102c 940e 057e 	CALL			EEPROM_RW
00102e 2e52      	MOV				R5, R18
                 
                 ;cargamos TEXTO PRESENTACION   
00102f e0d2          LDI   			YH,0x02        	; direcion alta donde se pone el texto en RAM
001030 e4c0          LDI   			YL,0x40      	; direccion baja donde se pone el texto en RAM 
001031 e2f6          LDI   			ZH,high(TEXTO*2); direccion alta del TEXTO en Flash
001032 e0e0          LDI   			ZL,low(TEXTO*2) ; direccion baja del TEXTO en Flash 
001033 ed00          LDI   			R16,208      	; longitud de texto a copiar en RAM
                 ;*** RURINA CARGAR TEXTO DE FLASH A RAM  
                 ;EN Y (YH,YL) POSICION EN RAM
                 ;EN Z (ZH,ZL) POSICION EN FLASH
                 ;EN R16 NUMERO DE LETRAS (BYTS)
                 
                 CARGATEXTO:
001034 95c8      	LPM      						; leemos TEXTO de FLASH y lo almacena en R0
001035 9631      	ADIW  			ZL,1   			; apuntamos al siguiente elemento 
001036 8208      	ST    			Y, R0			; guardamos en RAM POSICION Y EL CONTENIDO DE R0
001037 9621      	ADIW  			YL,1      		
001038 950a      	DEC   			R16      		; Hemos terminado..?? 
001039 f7d1      	BRNE  			CARGATEXTO   	; NO...seguimos cargando 
00103a 0000      	NOP     						; SI...terminamos 
00103b 940e 118e 	CALL			TEXTO_ERRORES	; ESTA EN RUTINA CONTROL DE CAUDAL
                 ; MODELO  
00103d e0d7          LDI   			YH,HIGH (LIN1P)        	; direcion alta donde se pone el texto en RAM
00103e eec0          LDI   			YL,LOW (LIN1P)      	; direccion baja donde se pone el texto en RAM 
00103f e2f8          LDI   			ZH,high(TEXTO3*2); direccion alta del TEXTO en Flash
001040 e0e0          LDI   			ZL,low(TEXTO3*2) ; direccion baja del TEXTO en Flash 
001041 e100      	LDI				R16, 16
001042 9d04      	MUL				R16, R4			; MULTIPLICA POR 16 EL VALOR DE LA POSICION EN EEPROM
001043 0de0      	ADD				ZL, R0			; Y SUMA EL RESULTADO A ZL
001044 e100          LDI   			R16,16      	; longitud de texto a copiar en RAM
                 CARGATEXTO_1:
001045 95c8      	LPM      						; leemos TEXTO de FLASH y lo almacena en R0
001046 9631      	ADIW  			ZL,1   			; apuntamos al siguiente elemento 
001047 8208      	ST    			Y, R0			; guardamos en RAM POSICION Y EL CONTENIDO DE R0
001048 9621      	ADIW  			YL,1      		
001049 950a      	DEC   			R16      		; Hemos terminado..?? 
00104a f7d1      	BRNE  			CARGATEXTO_1  	; NO...seguimos cargando 
                 ; FABRICANTE O VENDEDOR
00104b e0d7          LDI   			YH,HIGH (LIN2P)        	; direcion alta donde se pone el texto en RAM
00104c efc4          LDI   			YL,LOW (LIN2P)      	; direccion baja donde se pone el texto en RAM 
00104d e2f9          LDI   			ZH,high(TEXTO4*2); direccion alta del TEXTO en Flash
00104e e0e0          LDI   			ZL,low(TEXTO4*2) ; direccion baja del TEXTO en Flash 
00104f e100      	LDI				R16, 16
001050 e011      	LDI				R17, 1
001051 9d05      	MUL				R16, R5			; MULTIPLICA POR 16 EL VALOR DE LA POSICION EN EEPROM
001052 0de0      	ADD				ZL, R0			; Y SUMA EL RESULTADO A ZL
001053 e100          LDI   			R16,16      	; longitud de texto a copiar en RAM
                 CARGATEXTO_2:
001054 95c8      	LPM      						; leemos TEXTO de FLASH y lo almacena en R0
001055 9631      	ADIW  			ZL,1   			; apuntamos al siguiente elemento 
001056 8208      	ST    			Y, R0			; guardamos en RAM POSICION Y EL CONTENIDO DE R0
001057 9621      	ADIW  			YL,1      		
001058 950a      	DEC   			R16      		; Hemos terminado..?? 
001059 f7d1      	BRNE  			CARGATEXTO_2  	; NO...seguimos cargando 
00105a 9508      	RET
                 .INCLUDE "HORAS.ASM"
                 
                 
                 
                 									; SE PRESENTA EL RESULTADO
                 
                 
                 HORAS:		; RECUPERA EL CONTENIDO DE LA EEPROM Y LO PASA A YH,YL
                 
00105b e419      	LDI				R17, N_HORAS		; POSICION A LEER EN LA EEPROM
00105c 940e 057e 	CALL			EEPROM_RW			; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
00105e 2fc2      	MOV				YL, R18
00105f e41a      	LDI				R17, N_HORAS_1		; POSICION A LEER EN LA EEPROM
001060 940e 057e 	CALL			EEPROM_RW			; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
001062 2fd2      	MOV				YH, R18
001063 2788      	CLR				R24					; CENTENAS
001064 2799      	CLR				R25					; UNIDADES DE MILLAR
001065 27aa      	CLR				R26					; DECENAS DE MILLAR
001066 27bb      	CLR				R27					; DECENAS
                 										; EN R28 UNIDADES REGISTRO YL
001067 30d1      	CPI				YH, 1				; VERIFICAR QUE EL REGISTRO ALTO ES CERO
001068 f070      	BRLO			HORAS2
                 HORAS1:
001069 30d1      	CPI				YH, 1				; COMPRUEBA QUE EL REGISTRO ALTO ES CERO
00106a f060      	BRLO			HORAS2				; SI MENOR DE 1 VA A HORAS2
00106b 97e2      	SBIW			YH:YL , 50			; RESTA 50 A LOS REGOSTROS
00106c 97e2      	SBIW			YH:YL , 50			; RESTA 50 A LOS REGISTROS TOTAL 100
00106d 9583      	INC				R24					; INCREMENTA LAS CENTENAS EN 1
00106e 308a      	CPI				R24, 10				; COMPRUEBA QUE NO SON 10
00106f f3c8      	BRLO			HORAS1				; Y SALTA A HORAS1 SI ES MENOR
001070 9593      	INC				R25					; INCREMENTA LAS UNIDADES DE MILLAR
001071 508a      	SUBI			R24, 10				; Y RESTA 10 A LAS CENTENAS
001072 309a      	CPI				R25, 10				; COMPRUEBA LAS UNIDADES DE MILLAR
001073 f3a8      	BRLO			HORAS1				; SI ES MENOR MENOR SALTA A HORAS1
001074 509a      	SUBI			R25,10				; RESTA 10 E..
001075 95a3      	INC				R26					; INCREMENTA LAS UNIDADES DE MILLAR
001076 cff2      	RJMP			HORAS1				; SALTA A HORAS1
                 
                 HORAS2: ; DECODIFICA EL REGISTRO BAJO YL
001077 36c4      	CPI				YL, 100				; COMPRUEBA SI SON 100
001078 f050      	BRLO			HORAS3				; SI ES MENOR SALTA A HORAS3				
001079 56c4      	SUBI			YL, 100				; RESTA 100..
00107a 9583      	INC				R24					; E INCREMENTA LAS CENTENAS
00107b 308a      	CPI				R24, 10				; COMPRUEBA QUE ES 10...
00107c f3d0      	BRLO			HORAS2				; SI ES MENOR DE 10 SALTA A HORAS2 
00107d 508a      	SUBI			R24, 10				; RESTA 10 A LAS CENTANAS..
00107e 9593      	INC				R25					; E INCRAMENTA EN 1 LAS UNIDADES DE MILLAR
00107f 309a      	CPI				R25, 10				; COMPRUEBA SI LAS UNIDADES DE MILLAR SON 10
001080 f3b0      	BRLO			HORAS2				; SI ES MENOR VA A HORAS2
001081 95a3      	INC				R26					; INCREMENTA LAS DECENAS DE MILLAR
001082 cff4      	RJMP			HORAS2				; SALTA A HORAS2
                 
                 HORAS3:
001083 30ca      	CPI				YL,10				; COMPARA CON 10
001084 f018      	BRLO			HORAS4				; SI ES MENOR SALTA A HORAS 4
001085 95b3      	INC				R27					; INCREMENTA LAS DECENAS
001086 50ca      	SUBI			YL, 10				; RESTA 10 
001087 cffb      	RJMP			HORAS3				; SALTA A HORAS3	
                 
                 HORAS4:		; PASA EL RESULTADO A CARACTER ASCI SUMANDO A LOS REGISTROS 48 Y PASANDOLOS A RAM
001088 e320      	LDI				R18, 48
001089 0f82      	ADD				R24, R18
00108a 0f92      	ADD				R25, R18
00108b 0fa2      	ADD				R26, R18
00108c 0fb2      	ADD				R27, R18
00108d 0fc2      	ADD				R28, R18
                 ;	STS				$9E2, R26
00108e 9390 09e3 	STS				$9E3, R25
001090 9380 09e4 	STS				$9E4, R24
001092 93b0 09e5 	STS				$9E5, R27
001094 93c0 09e6 	STS				$9E6, R28
                 ; PARA LEER LOS VOLTIOS	
001096 e025      	LDI				R18, P_VFUENTE				; LINEA A LEER
001097 e4af      	LDI				R26, 79				; NUMERO DE LECTURAS VOLTIOS
001098 940e 013c 	CALL			ADC_P			
00109a 940e 0590 	CALL			RADC
00109c 9210 0128 	STS				$128, R1
00109e 9220 0129 	STS				$129, R2
0010a0 9230 012b 	STS				$12B, R3
                 ; PRESENTACION EN PANTALLA
0010a2 e428      	LDI				R18, 72				; IMPRIME LA H
0010a3 9320 0126 	STS				$126, R18
0010a5 e20e      	LDI				R16, 46				; PNE UN PUNTO
0010a6 9300 012a 	STS				$12A, R16
0010a8 e526      	LDI				R18, 86				; IMPRIME LA V
0010a9 9320 012d 	STS				$12D, R18	
0010ab e624      	LDI				R18, 100			; IMPRIME LA d
0010ac 9320 012e 	STS				$12E, R18
0010ae e623      	LDI				R18, 99				; IMPRIME LA c
0010af 9320 012f 	STS				$12F, R18	
0010b1 e220      	LDI				R18, 32				; IMPRIME UN ESPACIO
0010b2 9320 0125 	STS				$125,R18
0010b4 9320 0127 	STS				$127,R18
0010b6 9320 012c 	STS				$12C,R18
0010b8 9320 0130 	STS				$130,R18
0010ba 9320 0131 	STS				$131,R18
0010bc 9320 0132 	STS				$132,R18
0010be 9320 0133 	STS				$133,R18
0010c0 940e 04c0 	CALL			LEC_TEC
0010c2 371e      	CPI				R17, 0B01111110		; PRESENTAR LOS VOLTIOS 	 	"PRO Y SALIR"
0010c3 f1e1      	BREQ			HORAS6
0010c4 e026      	LDI				R18,P_TCL			; LEE LOS AMPERIOS
0010c5 e6ae      	LDI				R26, 110			; NUMERO DE LECTURAS AMPERIOS
0010c6 940e 013c 	CALL			ADC_P
0010c8 3084      	CPI				R24,4				; PARA QUE POR DEBAJO DE 2 GRAMOS PONGA CERO
0010c9 f008      	BRLO			HORAS5_1			; SI ES MENOR DE 3 VA A HORAS5_1
0010ca c001      	RJMP			HORAS5_2
                 
                 HORAS5_1:
0010cb e080      	LDI				R24,00
                 
                 HORAS5_2:
0010cc e300      	LDI				R16, 48				; PONE UN CERO
0010cd 9300 012b 	STS				0x12B,R16
0010cf 9586      	LSR				R24					; SI ES PAR
0010d0 f418      	BRCC			HORAS5				; SALTA SI EL ACARREO ES UNO QUEDA EL CINCO
0010d1 e305      	LDI				R16,53				; PONE UN CINCO EN LUGAR DEL 0
0010d2 9300 012b 	STS				$12B,R16
                 HORAS5:
0010d4 940e 0590 	CALL			RADC
0010d6 9220 0128 	STS				$128,R2				; PARA MAESTRO AL PULSAR SALIR
0010d8 9230 0129 	STS				$129,R3				; PARA MAESTRO AL PULSAR SALIR
0010da 9220 074b 	STS				$74B,R2				; PARA EL REMOTO 20X4
0010dc 9230 074c 	STS				$74C,R3				; PARA EL REMORO 24X4
                 ; PRESENTACION EN PANTALLA
0010de e428      	LDI				R18, 72				; IMPRIME LA H DE HORAS
0010df 9320 0126 	STS				$126, R18
0010e1 e20e      	LDI				R16, 46				; PONE UN PUNTO
0010e2 9300 012a 	STS				$12A, R16
0010e4 e627      	LDI				R18, 103			; IMPRIME LA g
0010e5 9320 012d 	STS				$12D, R18	
0010e7 e722      	LDI				R18, 114			; IMPRIME LA r
0010e8 9320 012e 	STS				$12E, R18
0010ea e22e      	LDI				R18,46				; IMPRIME UN .
0010eb 9320 012f 	STS				$12F,R18
0010ed e423      	LDI				R18, 67				; IMPRIME LA C
0010ee 9320 0130 	STS				$130, R18	
0010f0 e220      	LDI				R18, 32				; IMPRIME UN ESPACIO
0010f1 9320 0125 	STS				$125, R18
0010f3 9320 0127 	STS				$127, R18
0010f5 9320 012c 	STS				$12C, R18
0010f7 e60c      	LDI				R16,108
0010f8 9300 0131 	STS				$131,R16
0010fa e20f      	LDI				R16,47				; PONE UNA /
0010fb 9300 0132 	STS				$132,R16
0010fd e408      	LDI				R16,72
0010fe 9300 0133 	STS				$133,R16
                 
                 HORAS6:
                 ;	LDI				R16, 192			; 11000000 escribir en linea 2 linea (192)( linea 4 seria 212)
                 ;	CALL			ENVINT
                 ;	LDI				YH, HIGH (L_HORAS)	; POSICION ALTA DEL TAXTO EN RAM 080
                 ;	LDI				YL, LOW  (L_HORAS)	; direccion BAJA DEL TEXTO EN RAM      	
                  ; 	LDI				R17,20 				; bytes a enviar 
                 ;	CALL			ENVIARTEXTO			; RUTINA PARA ENVIAR TEXTO A PANTALLA
                 ;LDI R27, 1			; POSICION X LINEA 0 A 8
                 ;LDI	R26, 3			; POSICION Y DE 0 A 16
                 ;LDI	R24, 16		; NUMERO DE CARACTERES A ESCRIBIR
                 ;LDI	YH, HIGH (L_HORAS)
                 ;LDI	YL, LOW (L_HORAS)
                 ;CALL PRO_GRA_1	
                 
001100 9508      	RET
                 
                 
                 
                 
                 .INCLUDE "AYUDA_RD_CL.ASM"
                 
                 ; EN R18 VALOR PROGRAMADO
                 ; EN R19 VALOR REAL LEIDO
                 ; REDOX PROGRAMABLE HASTA MENOS 80mV PARA LA BOMBA A LA MITAD DEL VALOR PROGRAMADO MAS 5 MILIVOLTIOS
                 ; CLORO ENCIENDE LA BOMBA HASTA MENOS 8 DECIMAS PROGRAMABLES, APAGA A 0,8 DE CLORO FIJO
                 .equ  S_RD_CL	= 1			; salida para el apoyo de redox y cloro 
                 
                 AYUDA_RD:
001101 932f      	PUSH			R18
001102 feb7      	SBRS			CONTROL_1,7			; SALTA LA PROXIMA INSTRUCION SI ES UNO,NO SE A PRODUCIDO INVERSION
001103 c014      	RJMP			AYUDA_RD_A2			; NO TIENE EN CUENTA EL PRIMER CICLO FUNCIONA SI O SI
                 AYUDA_RD_A:
001104 9180 0216 	LDS				R24,RAM_RD_CL		; POSICION 216 EN RAM
001106 0f88      	LSL				R24					; MULTIPLICA POR 2
001107 1b28      	SUB				R18,R24				; DIFERENCIA PARA EL APOYO DE LA BOMBA CADO UNIDAD SON 5 mV
001108 1732      	CP				R19,R18				; SI EL REDOX MEDIDO ES MENOR QUE EL PROGRAMADO
001109 f040      	BRLO			AYUDA_RD_A1			; SALTA A PRO5A (OP1 > OP2 SALTA) ENCIENDE LA BOMBA
                 ; SOLO APAGA LA BOMBA CUANDO ALCANZA LA MITAD MAS 1 DEL VALOR PROGRAMADO
00110a 9586      	LSR				R24					; DIVIDE POR 2 
00110b 9583      	INC				R24
00110c 9583      	INC				R24
00110d 0f28      	ADD				R18,R24
00110e 1723      	CP				R18,R19				; PARA PARAR LA BOMBA CUANDO LLEGE AL VALOR DE RD PROGRAMAD0
00110f f044      	BRLT			AYUDA_RD_A2			; SALTA A AYUDA_RD_A1 SI OP1>OP2
001110 912f      	POP				R18
001111 9508      	RET
                 AYUDA_RD_A1:
001112 9ac1      	SBI				PORTB,S_RD_CL		; ENCIENDE LA BOMBA DE APOYO
001113 e021      	LDI				R18,1
001114 9320 0b05 	STS				APOYO_CL,R18		; PONE LA SEÑAL EN RS232 UN UNO
001116 912f      	POP				R18
001117 9508      	RET
                 AYUDA_RD_A2:
001118 98c1      	CBI				PORTB,S_RD_CL		; DESCONECTA LA BOMBA DE APOYO 
001119 e020      	LDI				R18,0
00111a 9320 0b05 	STS				APOYO_CL,R18		; PONE LA SEÑAL EN RS232 UN CERO
00111c 912f      	POP				R18
00111d 9508      	RET
                 ; RUTINA APOYO CLORO LIBRE CORTA LA DOSIFICACION EN 0,8 ************************************************
                 
                 AYUDA_CL:
00111e 932f      	PUSH			R18
00111f fcb7      	SBRC			CONTROL_1,7			; SALTA LA PROXIMA INSTRUCION SI ES CERO,NO SE A PRODUCIDO INVERSION
001120 c011      	RJMP			AYUDA_CL_A2			; SI NO ESTA VAA APAGAR LA BOMBA
                 AYUDA_CL_A:
001121 9180 0216 	LDS				R24,RAM_RD_CL		; POSICION EN RAM 216
                 ;CALL PRU2
001123 1b28      	SUB				R18,R24				; DIFERENCIA PARA EL APOYO DE LA BOMBA CADO UNIDAD SON 5 mV
001124 9523      	INC				R18
001125 1732      	CP				R19,R18				; SI EL REDOX MEDIDO ES MENOR QUE EL PROGRAMADO
001126 f028      	BRLO			AYUDA_CL_A1			; SALTA A PRO5A (OP1 > OP2 SALTA)
                 ;	LSR				R24
                 ;	INC				R24
                 ;	ADD				R18,R24
001127 e027      	LDI				R18,7				; PARA PARAR LA BOMBA A 0,8 PPM DE CLORO FIJO
001128 1723      	CP				R18,R19
001129 f044      	BRLT			AYUDA_CL_A2
00112a 912f      	POP				R18
00112b 9508      	RET
                 AYUDA_CL_A1:
00112c 9ac1      	SBI				PORTB,S_RD_CL		; ENCIENDE APOYO LA BOMBA
00112d e021      	LDI				R18,1
00112e 9320 0b05 	STS				APOYO_CL,R18		; PONE LA SEÑAL EN RS232 UN UNO
001130 912f      	POP				R18
001131 9508      	RET
                 AYUDA_CL_A2:
001132 98c1      	CBI				PORTB,S_RD_CL		; DESCONECTA EL  APOYO LA BOMBA 1
001133 e020      	LDI				R18,0
001134 9320 0b05 	STS				APOYO_CL,R18		; PONE LA SEÑAL EN RS232 A CERO
001136 912f      	POP				R18
001137 9508      	RET
                 
                 PRU2:
001138 938f      PUSH R24
001139 932f      PUSH R18
00113a 933f      PUSH R19
00113b 940e 0590 CALL RADC
00113d 9220 0230 STS $230,R2
00113f 9230 0231 STS $231,R3
                 
001141 2f82      MOV R24,R18
001142 940e 0590 CALL RADC
                 ;STS				$250,R1
001144 9220 0250 STS				$250,R2
001146 9230 0251 STS				$251,R3	
001148 2f83      MOV R24,R19
001149 940e 0590 CALL RADC
00114b 9210 0252 STS				$252,R1
00114d 9220 0253 STS				$253,R2
00114f 9230 0254 STS				$254,R3	
001151 913f      POP R19
001152 912f      POP R18
001153 918f      POP R24
001154 9508      RET
                 
                 .INCLUDE "VIDA_REJILLA.ASM"
                 
                 ; GRABA EN EEPROM LAS HORAS DE FUCIONAMIENTO TENIENDO EN CUENTA LA CONCENTRACION DE SAL, SIN COMPENSAR POR TEMPERAURA
                 ;	6 MAS DE 6
                 ;	5 DE 5 A 6
                 ;	4 DE 4 A 5
                 ;	3 DE 3 A 4
                 ;	2 DE 2 A 3
                 ;	1 DE 1 A 2
                 ;	0 DE 0 A 1
                 
                 REJILLA:
                 
001155 9180 0255 	LDS				R24,$0255				; CARGA EL PRIMER DIGITO DE LA CONCENTRACION DE SAL SIN COMPENSAR
001157 97c0      	SBIW			R24,48					; RESTA 48 PARA CONVERTIRLO DEL 0 AL 5 	
001158 2e58      	MOV				R5,R24
                 REJILLA_B:
                 
                 ; RUTINA DE GRAVACION EN EEPROM DE LA DATOS 
001159 e510      	LDI				R17,REG_REJILLA			; POSICION DE MEMORIA A LEER EN EEPROM 050
00115a 0d15      	ADD				R17,R5					; INCREMENTA LA POSICION EN FUNCION DE LA CONCENTRACION DE SAL
00115b 940e 057e 	CALL			EEPROM_RW				; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
00115d 2fc2      	MOV				YL,R18					; RESULTADO EN R18 Y LO PASA A YL VALOR BAJO
00115e e088      	LDI				R24,8					; INCREMENTA EL VALOR PARA LEER LA POSICION ALTA
00115f 0f18      	ADD				R17,R24
001160 940e 057e 	CALL			EEPROM_RW
001162 2fd2      	MOV				YH,R18					; Y LO PASA A YH VAL0R ALTO
001163 9621      	ADIW			YH:YL,1					; INCREMENTA EN 1 CON ACARREO
001164 2f2c      	MOV				R18,YL					; PASA A R18 EL VALOR A GRABAR EN EEPROM
001165 e510      	LDI				R17,REG_REJILLA			; POSICION DE MEMORIA A LEER EN EEPROM
001166 0d15      	ADD				R17,R5
001167 940e 0587 	CALL			EEPROM_ES				; ESCRIBE EL VALOR INCREMENTADO EN 1 HORA
001169 2f2d      	MOV				R18,YH
00116a 0f18      	ADD				R17,R24
00116b 940e 0587 	CALL			EEPROM_ES	
00116d 9508      	RET
                 
                 
                 
                 
                 .INCLUDE "CONTROL_CAUDAL.ASM"
                 
                 ; CONTROL DE CAUDAL DA ERROR TRANSCURRIDOS 120 SEGUNDOS Y NO RETORNA
                 ; ALMACENA LOS SEGUNDOS EN RAM POSICION
                 ; SI LA PRODUCION ES MENOS DE 2 DURANTE 120 SEGUNDOS CORTA
                 
                 CONTROL_CAUDAL:			; VIENE DE LA RUTINA MEDICION DE SL LINEA 44
00116e 9120 0215 	LDS				R18, RAM_CAUDAL		; LEE LOS SEGUNDOS TRANSCURRIDOS
001170 9523      	INC				R18
001171 9320 0215 	STS				RAM_CAUDAL, R18
001173 3728      	CPI				R18, 120				; Y LOS COMPRARA CON 120
001174 f0b8      	BRBS			0, CONTROL_CAUDAL_2	; SI ES MENOS RETORNA
                 
                 ; MENSAJE DE ERROR POR FALTA DE CaUDAL
001175 940e 02f2 	CALL			APAGAR_FUENTE
001177 9895      	CBI				PORTD,b_acido		; APAGA BOMBA DE ACIDO
001178 e800      	LDI				R16, 128			; 11000000 escribir en linea 2 linea (192)( linea 4 seria 212)
001179 940e 053e 	CALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION, " ESCRIBIR LINEA 2"
00117b e0d5      	LDI				YH, HIGH (LIN_2S)	; POSICION ALTA DEL TAXTO EN RAM 080
00117c e9cc      	LDI				YL, LOW  (LIN_2S)	; direccion BAJA DEL TEXTO EN RAM  "APAGAR EQUIPO"    	
00117d e110        	LDI				R17,16   			; bytes a enviar 
00117e 940e 0925 	CALL			ENVIARTEXTO			; RUTINA PARA ENVIAR TEXTO E PANTALLA
001180 ec00      	LDI				R16, 192			; 11000000 escribir en linea 2 linea (192)( linea 4 seria 212)
001181 940e 053e 	CALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION, " ESCRIBIR LINEA 2"
001183 e0d6      	LDI				YH, HIGH (F_PRO)	; POSICION ALTA DEL TAXTO EN RAM 080
001184 edcc      	LDI				YL, LOW  (F_PRO)	; direccion BAJA DEL TEXTO EN RAM  "FALLO PRODUCCION"    	
001185 e110        	LDI				R17,16   			; bytes a enviar 
001186 940e 0925 	CALL			ENVIARTEXTO			; RUTINA PARA 
                 CONTROL_CAUDAL_1:						; DETIENE EL PROGRAMA
001188 0000      	NOP
001189 0000      	NOP
00118a 9588      	SLEEP
00118b cffc      	RJMP			CONTROL_CAUDAL_1	; SE DETIENE EL EQUIPO
                 
                 CONTROL_CAUDAL_2:	; RETORNO A PRO3D NO A LLEGADO A 120 SIGUE FUNCIONANDO
00118c 940c 0c80 	JMP				PRO3D				
                 
                 TEXTO_ERRORES:
                 ;cargamos TEXTO NUEVO DE ERRORES   viene de ini_atmega16
00118e e0d3          LDI   			YH,0x03        	; direcion alta donde se pone el texto en RAM
00118f e3c0          LDI   			YL,0x30      	; direccion baja donde se pone el texto en RAM 
001190 e2f6          LDI   			ZH,high(TEXTO2*2); direccion alta del TEXTO en Flash
001191 ede0          LDI   			ZL,low(TEXTO2*2) ; direccion baja del TEXTO en Flash 
001192 ea00          LDI   			R16,160      	; longitud de texto a copiar en RAM
                 ;*** RURINA CARGAR TEXTO DE FLASH A RAM  
                 ;EN Y (YH,YL) POSICION EN RAM
                 ;EN Z (ZH,ZL) POSICION EN FLASH
                 ;EN R16 NUMERO DE LETRAS (BYTS)
                 
                 CARGATEXTO_A:
001193 95c8      	LPM      						; leemos TEXTO de FLASH y lo almacena en R0
001194 9631      	ADIW  			ZL,1   			; apuntamos al siguiente elemento 
001195 8208      	ST    			Y, R0			; guardamos en RAM POSICION Y EL CONTENIDO DE R0
001196 9621      	ADIW  			YL,1      		
001197 950a      	DEC   			R16      		; Hemos terminado..?? 
001198 f7d1      	BRNE  			CARGATEXTO_A  	; NO...seguimos cargando
001199 9508      	RET 
                 ;.INCLUDE "REMOTO_CONTROL.ASM"
                 .INCLUDE "VOLTIOS.ASM"
                 
                 VOLTIOS:
                 ; TENSION SALIDA DE FUENTE
00119a e025      	LDI				R18,P_VFUENTE		; LINEA A LEER
00119b e5a1      	LDI				R26,81				; NUMERO DE LECTURAS
00119c 940e 013c 	CALL			ADC_P
00119e 9380 0b0b 	STS				S_FUENTE,R24		; GRABA EL VALOR EN S_FUENTE
0011a0 940e 0590 	CALL			RADC
                 
                 ;	STS				$3B0,R1
0011a2 9220 03b0 	STS				$3B0,R2				; RESULTADO DE DECENAS
0011a4 9230 03b2 	STS				$3B2,R3				; RESULTADO UNIDADES
0011a6 9220 072c STS $72C,R2
0011a8 9230 072e STS $72E,R3			; PONE LOS VALORES DE LA TENSION DE LA FUENTE EN PANTALLA GRAFICA
                 ; LEE EL VOLTAJE DE SALIDA PARA DECIDIR TIPO DE AVERIA 
0011aa e024      	LDI				R18,P_VSAL			; LINEA A LEER
0011ab e5a1      	LDI				R26,81				; NUMERO DE LECTURAS
0011ac 940e 013c 	CALL			ADC_P
0011ae e42e      	LDI				R18,0x4E			; ESCRIBE UNA N
0011af 9320 03b4 	STS				$3B4,R18
0011b1 9320 0730 STS		$730,R18		; PONE EN PANTALLA GRAFICA
0011b3 e42f      	LDI				R18,0x4F			; ESCRIBE UNA O
0011b4 9320 03b5 	STS				$3B5,R18
0011b6 9320 0731 STS		$731,R18		; PONE EN PANTALLA GRAFICA
0011b8 3189      	CPI				R24,25
0011b9 f050      	BRLO			VOLTIOS_A
0011ba e523      	LDI				R18,0x53
0011bb 9320 03b4 	STS				$3B4,R18				; RESULTADO DE DECENAS
0011bd 9320 0730 STS		$730,R18		; PONE EN PANTALLA GRAFICA
0011bf e429      	LDI				R18,0x49
0011c0 9320 03b5 	STS				$3B5,R18				; RESULTADO UNIDADES
0011c2 9320 0731 STS		$731,R18		; PONE EN PANTALLA GRAFICA
                 VOLTIOS_A:
                 
0011c4 e026      	LDI				R18, P_TCL			; LEE LOS AMPERIOS
0011c5 e6ae      	LDI				R26, 110			; NUMERO DE LECTURAS
0011c6 940e 013c 	CALL			ADC_P
0011c8 e300      	LDI				R16, 48				; PONE UN CERO
0011c9 9300 03ba 	STS				0x3BA, R16
0011cb 9300 0736 	STS				0X736,R16
0011cd 9586      	LSR				R24					; SI ES PAR
0011ce f428      	BRCC			VOLTIOS_B			; SALTA SI EL ACARREO ES UNO QUEDA EL CINCO
0011cf e305      	LDI				R16,53				; PONE UN CINCO EN LUGAR DEL 0
0011d0 9300 03ba 	STS				$3BA,R16
0011d2 9300 0736 	STS				0X736,R16
                 VOLTIOS_B:
0011d4 940e 0590 	CALL			RADC
0011d6 9220 074b 	STS				$74B, R2
0011d8 9230 074c 	STS				$74C, R3			
0011da 9220 0733 STS				$733, R2
0011dc 9230 0734 STS				$734, R3		; PONE EL VALOR DE LA PRODUCION DE CLORO EN PANTALLA GRAFICA
                 
0011de 9508      	RET	
                 
                 
                 
                 .INCLUDE "RETARDO240.ASM"
                 
                 RETARDO240:
0011df 2777      		CLR LEC_REL
                 
                 
                 RETARDO240_A:
0011e0 940e 04c0 	CALL			LEC_TEC				; LEE EL TECLADO
0011e2 ea25      LDI R18,165 ; CODIGO ASCI DE LA R
0011e3 9320 09a9 STS $9A9,R18
0011e5 371f      	CPI				R17,0B01111111		; SI SE PULSA LA TECLA SALIR
0011e6 f0b9      	BREQ			RETARDO240_B		; VA A RETARDO240_B Y SALE
0011e7 2f97      	MOV				R25,LEC_REL
0011e8 ef80      	LDI				R24,240
0011e9 1b89      	SUB				R24,R25
0011ea 9380 0320 	STS				800,R24
0011ec 940e 0590 	CALL			RADC
0011ee 9210 0761 	STS				$761,R1
0011f0 9220 0762 	STS				$762,R2
0011f2 9230 0763 	STS				$763,R3
                 
0011f4 ed04      	LDI				R16,212				; ESCRIBIR LINEA 4
0011f5 940e 053e 	CALL			ENVINT				; En subrrutina Env_doi Envia instrucion para escribir en linea 1
0011f7 e0d7      	LDI				YH, HIGH(RETARDO_PRO)		; POSICION BIT ALTO DEL TEXTO A ENVIAR ram en 070
0011f8 e5c4      	LDI				YL, LOW(RETARDO_PRO)		; POSICION BIT BAJO DEL TEXTO A ENVIAR
0011f9 e114      	LDI				R17,20				; NUMERO DE DIGITOS A ENVIAR A PANTALLA
0011fa 940e 0925 	CALL			ENVIARTEXTO			; RUTINA EN ESTE FICHERO PRECISA SUBRRUTINA ENV_DOI	
0011fc 3f70      	CPI				LEC_REL, 240
0011fd f711      	BRNE			RETARDO240_A
                 RETARDO240_B:
0011fe 940e 097f 	CALL			NO_TECLA
001200 9508      	RET
                 
                 .INCLUDE "CALIBRAR_RD.ASM"
                 
                 ; EN ESTA RUTINA ESTA EL CONTROL DE LA PANTALLA
                 
                 PRO8:	; PARA AJUSTAR LA SAL DEL AGUA
001201 ff46      	SBRS			CONTROL,6			; SALTA LA PROXIMA INSTRUCION SI ES UNO, TIENE SONDA DE REDOX
001202 940c 1264 	JMP				PRO9				; VA A CALIBRACION DE CLORO
001204 940e 0645 	CALL			CAL_TECLA			; PROGRAMA PANTALLA CALIBRACCION
001206 91e0 020b 	LDS				R30, RAMC_RD		; VALOR PARA EL CALIBRADO DEL REDOX
001208 e060      	LDI				R22, 00
001209 2477      	CLR				R7					; PONE A CERO EL RETARDO SALIDA TECLADO
                 PRO8A:
00120a e060      	LDI				R22,00
00120b e220      	LDI				R18,32				; APAGA EL DIGITO SAL
00120c 9320 092d 	STS				$92D,R18			; PONE EN PANTALLA EL VALOR CALIBRADO DE LA SAL UNIDADES
00120e 9320 092e 	STS				$92E,R18			; PONE EN PANTALLA EL VALOR CALIBRADO DE LA SAL DECIMAS
001210 9320 092f 	STS				$92F,R18
001212 940e 0645 	CALL			CAL_TECLA
                 PRO8B:			; TIEMPO DIGITO APAGADO
001214 306c      	CPI				R22,RETARDO3		; VALOR DEL TIEMPO DE RATARDO LECTURA DEL TECLADO
001215 f3f0      	BRLO			PRO8B				; COMPRUEBA EL TIEMPO DE RETARDO 
001216 940e 091d 	CALL			LEDPANT
001218 95a8      	WDR
                 	; VALOR DE MEDICION REDOX	
001219 e022      	LDI				R18,P_RD			; LINEA DE ENTRADA
00121a 2fae      	MOV				R26,R30				; NUMERO DE LECTURAS Ó CALIBRACION
00121b 940e 013c 	CALL			ADC_P
                 			
00121d 528e      subi	r24, 46
00121e 9380 0209 	STS				RAM_RD, R24			; ALMACENA LA MEDICION EN LA MEMORIA RAM
001220 940e 05b1 	CALL			RADC5I
001222 9210 092d 	STS				$92D,R1
001224 9220 092e 	STS				$92E,R2
001226 9230 092f 	STS				$92F,R3
001228 940e 0645 	CALL			CAL_TECLA
                 PRO8C:
00122a 316a      	CPI				R22,RETARDO2		; VALOR DEL TIEMPO DE RATARDO LECTURA DEL TECLADO
00122b f3f0      	BRLO			PRO8C				; COMPRUEBA EL TIEMPO DE RETARDO 
                 
                 	; VALOR DE MEDICION 	
00122c 95a8      	WDR
00122d e060      	LDI				R22,00				; reatardo lectura de las valores 
00122e 940e 04c0 	CALL			LEC_TEC
001230 3f1d      	CPI				R17, 0B11111101		; TECLA - BAJA EL VALOR
001231 f051      	BREQ			BAJAR_RD
001232 3e1f      	CPI				R17, 0B11101111		; TECLA + INCREMENTA EL VALOR
001233 f081      	BREQ			SUBIR_RD
001234 371f      	CPI				R17, 0B01111111		; TECLA 7 SALIR VA A CALIBRACION REDOX
001235 f101      	BREQ			SALIR_RD1
001236 3f1b      	CPI				R17, 0B11111011		; TECLA FLECHA GRAVA Y VA A CALIBRACION CLORO
001237 f099      	BREQ			SALIR_RD
                 
001238 2d87      	MOV				R24, TEMP_TEC
001239 3382      	CPI				R24, 50				; PARA COMPARARLO CON EL RETARDO SIN PULSAR TECLA
00123a f4da      	BRPL			SALIR_RD1			; Y SALIR DE PROGRAMACION DE PARAMETROS
00123b cfce      	RJMP			PRO8A
                 BAJAR_RD:
00123c 2477      	CLR				R7					; PONE A CERO EL RETARDO SALIDA TECLADO
00123d 95ea      	DEC				R30
00123e e060      	LDI				R22,00
00123f 3ce8      	CPI				R30,200				; VALOR MINIMO DE REDOX
001240 f410      	BRBC			0, BAJAR_RD1 
001241 ece8      	LDI				R30,200
001242 cfc7      	RJMP			PRO8A
                 BAJAR_RD1:
001243 cfc6      	RJMP			PRO8A
                 SUBIR_RD:
001244 2477      	CLR				R7					; PONE A CERO EL RETARDO SALIDA TECLADO
001245 95e3      	INC				R30
001246 e060      	LDI				R22,00
001247 3fee      	CPI				R30,254				; REDOX MAXIMO
001248 f008      	BRBS			0, SUBIR_RD1		; SI MAYOR SALTA A SUBIR_PH1 Y PONE R31 CON EL VALOR MAZIMO
001249 efee      	LDI				R30,254
                 SUBIR_RD1:
00124a cfbf      	RJMP			PRO8A
                 SALIR_RD:  ; GRABA LOS NUEVOS VALORES Y VA A CALIBRAR CLORO
00124b 93e0 020b 	STS				RAMC_RD, R30		; VALOR PARA EL CALIBRADO DE LA CONCENTRACION DE SAL
00124d e017      	LDI				R17, RDC_MEN		; POSICION DE MEMORIA A ESCRIBIR EN EEPROM $005
00124e 2f2e      	MOV				R18, R30 
00124f 940e 0587 	CALL			EEPROM_ES			; GRABA EN EEPROM EL VALOR DE LA NUEVA CALIBRACCION
001251 940e 097f 	CALL			NO_TECLA			; PARA ESPERAR A QUE SE SUELTE LA TECLA SALIR
001253 940c 1264 	JMP				PRO9				; VA A CALIBRACION DE CLORO
001255 9508      	RET
                 SALIR_RD1:  ; GRABA LOS VALORES Y TERMINA
001256 93e0 020b 	STS				RAMC_RD, R30		; VALOR PARA EL CALIBRADO DE LA CONCENTRACION DE SAL
001258 e017      	LDI				R17, RDC_MEN		; POSICION DE MEMORIA A ESCRIBIR EN EEPROM $005
001259 2f2e      	MOV				R18, R30 
00125a 940e 0587 	CALL			EEPROM_ES			; GRABA EN EEPROM EL VALOR DE LA NUEVA CALIBRACCION
00125c 2d0f      	MOV				R16, VAL_LED		;APAGA LUZ PANTALLA
00125d 7b0f      	ANDI			R16, 0B10111111
00125e 2ef0      	MOV				VAL_LED, R16
00125f 940e 091d 	CALL			LEDPANT				; ACTUALIZAR LOS LED DE LA PANTALLA	
001261 940e 097f 	CALL			NO_TECLA
001263 9508      	RET
                 
                 .INCLUDE "CALIBRAR_CL.ASM"
                 
                 ;  RUTINA CALIBRAR PARAMETROS PRODUCCION DE CLORO LIBRE
                 
                 
                 PRO9:	; PARA AJUSTAR LA SAL DEL AGUA
001264 ff47      	SBRS			CONTROL,7			; SALTA LA PROXIMA INSTRUCION SI ES UNO, TIENE SONDA DE REDOX
001265 940c 05e8 	JMP				PRO6				; VA A CALIBRACION SAL
001267 940e 0645 	CALL			CAL_TECLA			; PROGRAMA PANTALLA CALIBRACCION
001269 91e0 0208 	LDS				R30, RAMC_CL		; VALOR PARA EL CALIBRADO DE LA CONCENTRACION DE CLORO
00126b e060      	LDI				R22, 00
00126c 2477      	CLR				R7					; PONE A CERO EL RETARDO SALIDA TECLADO
                 PRO9A:
00126d e060      	LDI				R22,00
00126e e220      	LDI				R18,32				; APAGA EL DIGITO SAL
00126f 9320 0941 	STS				$941,R18			; PONE EN PANTALLA EL VALOR CALIBRADO DE LA SAL UNIDADES
001271 9320 0942 	STS				$942,R18
001273 9320 0943 	STS				$943,R18			; PONE EN PANTALLA EL VALOR CALIBRADO DE LA SAL DECIMAS
                 ;	STS				$92F,R18
001275 940e 0645 	CALL			CAL_TECLA
                 PRO9B:			; TIEMPO DIGITO APAGADO
001277 306c      	CPI				R22,RETARDO3			; VALOR DEL TIEMPO DE RATARDO LECTURA DEL TECLADO
001278 f3f0      	BRLO			PRO9B				; COMPRUEBA EL TIEMPO DE RETARDO 
001279 940e 091d 	CALL			LEDPANT
00127b 95a8      	WDR
                 	; VALOR DE MEDICION REDOX	
00127c e021      	LDI				R18,P_CL			; LINEA DE ENTRADA
00127d 2fae      	MOV				R26,R30				; NUMERO DE LECTURAS Ó CALIBRACION
00127e 940e 013c 	CALL			ADC_P
001280 9586      LSR			R24
001281 9586      LSR			R24			
001282 508f      SUBI		R24,15
001283 9380 0206 	STS				RAM_CL, R24			; ALMACENA LA MEDICION EN LA MEMORIA RAM
001285 940e 0590 	CALL			RADC
                 ;	STS				$92D,R1
001287 9220 0941 	STS				$941,R2
001289 e20e      LDI	R16,46	; PONE UN PUNTO
00128a 9300 0942 STS $942,R16
00128c 9230 0943 	STS				$943,R3
00128e 940e 0645 	CALL			CAL_TECLA
                 PRO9C:				; DIGITO ENCENDIDO
001290 316a      	CPI				R22,RETARDO2				; VALOR DEL TIEMPO DE RATARDO LECTURA DEL TECLADO
001291 f3f0      	BRLO			PRO9C				; COMPRUEBA EL TIEMPO DE RETARDO 
                 
                 	; VALOR DE MEDICION 	
001292 95a8      	WDR
001293 e060      	LDI				R22,00				; reatardo lectura de las valores 
001294 940e 04c0 	CALL			LEC_TEC
001296 3f1d      	CPI				R17, 0B11111101		; TECLA - BAJA EL VALOR
001297 f051      	BREQ			BAJAR_CL
001298 3e1f      	CPI				R17, 0B11101111		; TECLA + INCREMENTA EL VALOR
001299 f079      	BREQ			SUBIR_CL
00129a 371f      	CPI				R17, 0B01111111		; TECLA 7 SALIR VA A CALIBRACION REDOX
00129b f119      	BREQ			SALIR_CL1
00129c 3f1b      	CPI				R17, 0B11111011		; TECLA FLECHA GRABA Y VA A CALIBRACION DE SAL
00129d f091      	BREQ			SALIR_CL
00129e 2d87      	MOV				R24, TEMP_TEC
00129f 3382      	CPI				R24, 50				; PARA COMPARARLO CON EL RETARDO SIN PULSAR TECLA
0012a0 f4f2      	BRPL			SALIR_CL1			; Y SALIR DE PROGRAMACION DE PARAMETROS
0012a1 cfcb      	RJMP			PRO9A
                 BAJAR_CL:
0012a2 2477      	CLR				R7					; PONE A CERO EL RETARDO SALIDA TECLADO
0012a3 50e8      	SUBI			R30,8
0012a4 e060      	LDI				R22,00
0012a5 39e6      	CPI				R30,150				; VALOR MINIMO DE REDOX
0012a6 f408      	BRBC			0, BAJAR_CL1 
0012a7 e9f6      	LDI				R31,150
                 BAJAR_CL1:
0012a8 cfc4      	RJMP			PRO9A
                 SUBIR_CL:
0012a9 2477      	CLR				R7					; PONE A CERO EL RETARDO SALIDA TECLADO
0012aa 9638      	ADIW			R30,8
0012ab e060      	LDI				R22,00
0012ac 3fe9      	CPI				R30,249				; REDOX MAXIMO
0012ad f008      	BRBS			0, SUBIR_CL1		; SI MAYOR SALTA A SUBIR_PH1 Y PONE R31 CON EL VALOR MAZIMO
0012ae efe9      	LDI				R30,249
                 SUBIR_CL1:
0012af cfbd      	RJMP			PRO9A
                 SALIR_CL:  ; GRABA LOS NUEVOS VALORES Y VA A CALIBRAR CLORO
0012b0 93e0 0208 	STS				RAMC_CL, R30		; VALOR PARA EL CALIBRADO DE LA CONCENTRACION DE SAL
0012b2 e014      	LDI				R17, CLC_MEN		; POSICION DE MEMORIA A ESCRIBIR EN EEPROM $005
0012b3 2f2e      	MOV				R18, R30 
0012b4 940e 0587 	CALL			EEPROM_ES			; GRABA EN EEPROM EL VALOR DE LA NUEVA CALIBRACCION
0012b6 2d0f      	MOV				R16, VAL_LED		; APAGA LUZ PANTALLA
0012b7 7b0f      	ANDI			R16, 0B10111111
0012b8 2ef0      	MOV				VAL_LED, R16
0012b9 940e 091d 	CALL			LEDPANT				; ACTUALIZAR LOS LED DE LA PANTALLA	
0012bb 940e 097f 	CALL			NO_TECLA			; PARA ESPERAR A QUE SE SUELTE LA TECLA SALIR
0012bd 940c 05e8 	JMP				PRO6				; VA A CLIBRACION DE SAL
                 
                 SALIR_CL1:  ; GRABA LOS VALORES Y TERMINA
0012bf 93e0 0208 	STS				RAMC_CL, R30		; VALOR PARA EL CALIBRADO DE LA CONCENTRACION DE SAL
0012c1 e014      	LDI				R17, CLC_MEN		; POSICION DE MEMORIA A ESCRIBIR EN EEPROM $005
0012c2 2f2e      	MOV				R18, R30 
0012c3 940e 0587 	CALL			EEPROM_ES			; GRABA EN EEPROM EL VALOR DE LA NUEVA CALIBRACCION
0012c5 2d0f      	MOV				R16, VAL_LED		;APAGA LUZ PANTALLA
0012c6 7b0f      	ANDI			R16, 0B10111111
0012c7 2ef0      	MOV				VAL_LED, R16
0012c8 940e 091d 	CALL			LEDPANT				; ACTUALIZAR LOS LED DE LA PANTALLA	
0012ca 940e 097f 	CALL 			NO_TECLA
0012cc 9508      	RET
                 
                 
                 ;*************TEXTO*************** 
                 
                 .CSEG 
                 .ORG 0x1300;       
                                         
001300 6452
001301 3030
001302 2030
001303 3053
001304 2030
001305 304d
001306 2030
001307 3043      TEXTO:		.DB "Rd000 S00 M00 C0"
001308 2020
001309 2020
00130a 2d20
00130b 2d2e
00130c 5020
00130d 5248
00130e 3720
00130f 342e      			.DB "     -.- PHR 7.4"
001310 5250
001311 444f
001312 4355
001313 4f49
001314 204e
001315 2025
001316 2020
001317 2020      TEXTO1:		.DB "PRODUCION %     " 
001318 5145
001319 4955
00131a 4f50
00131b 4420
00131c 5445
00131d 4e45
00131e 4449
00131f 204f      			.DB "EQUIPO DETENIDO "
001320 2020
001321 2e2d
001322 202d
001323 4b20
001324 7267
001325 4d2f
001326 2033
001327 2020      			.DB "  -.-  Kgr/M3   "
                 ;			           A  Ñ  A  D  I  R        S  A  L
001328 2020
001329 0041
00132a 4441
00132b 5249
00132c 2020
00132d 4153
00132e 204c
00132f 2020      			.DB "  A",00,"ADIR  SAL   "
001330 2020
001331 4120
001332 4a20
001333 5520
001334 5320
001335 5420
001336 4520
001337 2020      			.DB "   A J U S T E  "
001338 2020
001339 4953
00133a 204e
00133b 4320
00133c 5541
00133d 4144
00133e 204c
00133f 2020      			.DB "  SIN  CAUDAL   "
001340 4520
001341 5551
001342 5049
001343 204f
001344 5220
001345 4d45
001346 544f
001347 204f      			.DB " EQUIPO  REMOTO "
001348 2020
001349 4520
00134a 204e
00134b 4d20
00134c 5241
00134d 4843
00134e 2041
00134f 2020      			.DB "   EN  MARCHA   "
001350 5320
001351 4e49
001352 5020
001353 4f52
001354 5544
001355 4343
001356 4f49
001357 204e      			.DB " SIN PRODUCCION "
001358 4e20
001359 5649
00135a 4c45
00135b 4420
00135c 5045
00135d 534f
00135e 5449
00135f 204f      			.DB " NIVEL DEPOSITO "
001360 4554
001361 504d
001362 5245
001363 5441
001364 5255
001365 2041
001366 2020
001367 202e      			.DB "TEMPERATURA   . "
                 TEXTO2:		; se graba en ram en la rutina control de caudal
001368 2020
001369 4520
00136a 204e
00136b 5345
00136c 4550
00136d 4152
00136e 2020
00136f 2020      			.DB "   EN ESPERA    "
001370 2020
001371 2020
001372 2020
001373 4553
001374 5547
001375 444e
001376 534f
001377 2020      			.DB "      SEGUNDOS  "
001378 4f43
001379 534e
00137a 4c55
00137b 4154
00137c 2052
00137d 414d
00137e 554e
00137f 4c41      			.DB "CONSULTAR MANUAL"
001380 2020
001381 2041
001382 2056
001383 2045
001384 2052
001385 2049
001386 2041
001387 2020      			.DB "  A V E R I A   "
001388 4146
001389 4c4c
00138a 204f
00138b 5250
00138c 4455
00138d 4355
00138e 4943
00138f 4e4f      			.DB "FALLO PRUDUCCION"
001390 5320
001391 7375
001392 2e74
001393 5320
001394 6e6f
001395 6164
001396 5020
001397 2068      			.DB " Sust. Sonda Ph "
001398 4520
001399 5252
00139a 524f
00139b 4320
00139c 4e4f
00139d 5845
00139e 4f49
00139f 204e      			.DB " ERROR CONEXION "
0013a0 4656
0013a1 2075
0013a2 7356
0013a3 5020
0013a4 6320
0013a5 206c
0013a6 6554
0013a7 706d      			.DB "VFu Vs P cl Temp"
0013a8 2e30
0013a9 2030
0013aa 4f4e
0013ab 3020
0013ac 2e30
0013ad 2030
0013ae 2d2d
0013af 2d2e      			.DB "0.0 NO 00.0 --.-"
0013b0 7250
0013b1 646f
0013b2 202e
0013b3 6c43
0013b4 2d20
0013b5 202d
0013b6 7247
0013b7 482f      			.DB "Prod. Cl -- Gr/H" 
                 
                 .CSEG 
                 .ORG 0x1400
                 
                 TEXTO3: ; MODELO
                 
001400 2020
001401 3035
001402 2020
001403 3038
001404 3120
001405 3032
001406 3120
001407 3038      			.DB "  50  80 120 180"		; VALORES DE POTENCIA DEL EQUIPO			
001408 3220
001409 3032
00140a 2020
00140b 3034
00140c 2020
00140d 3037
00140e 3120
00140f 3030      			.DB " 220  40  70 100"
                 TEXTO3A:
001410 2020
001411 204c
001412 4c20
001413 2053
001414 4c20
001415 474d
001416 2020
001417 2051      			.DB "  L  LS  LMG  Q "
001418 5120
001419 2053
00141a 5120
00141b 474d
00141c 3120
00141d 3332
00141e 3420
00141f 3635      			.DB " QS  QMG 123 456"
001420 2020
001421 2020
001422 2020
001423 2020
001424 2020
001425 2020
001426 2020
001427 2020      			.DB "                "
001428 2020
001429 2020
00142a 2020
00142b 2020
00142c 2020
00142d 2020
00142e 2020
00142f 2020      			.DB "                "
001430 2020
001431 2020
001432 2020
001433 2020
001434 2020
001435 2020
001436 2020
001437 2020      			.DB "                "
001438 2020
001439 2020
00143a 2020
00143b 2020
00143c 2020
00143d 2020
00143e 2020
00143f 2020      			.DB "                "
001440 2020
001441 2020
001442 2020
001443 2020
001444 2020
001445 2020
001446 2020
001447 2020      			.DB "                "
001448 2020
001449 2020
00144a 2020
00144b 2020
00144c 2020
00144d 2020
00144e 2020
00144f 2020      			.DB "                "
001450 2020
001451 2020
001452 2020
001453 2020
001454 2020
001455 2020
001456 2020
001457 2020      			.DB "                "
001458 2020
001459 2020
00145a 2020
00145b 2020
00145c 2020
00145d 2020
00145e 2020
00145f 2020      			.DB "                "
001460 2020
001461 2020
001462 2020
001463 2020
001464 2020
001465 2020
001466 2020
001467 2020      			.DB "                "
                 TEXTO4A:
001468 544d
001469 5320
00146a 4c41
00146b 2054
00146c 2020
00146d 2020
00146e 2020
00146f 2020      			.DB "MT SALT         "			
001470 414d
001471 5453
001472 5245
001473 4153
001474 544c
001475 2020
001476 2020
001477 2020      			.DB "MASTERSALT      "					
001478 2020
001479 2020
00147a 2020
00147b 2020
00147c 2020
00147d 2020
00147e 2020
00147f 2020      			.DB "                "
                 
                 ;.CSEG 
                 ;.ORG 0x0F80 
                 TEXTO4:
001480 414d
001481 5453
001482 5245
001483 2020
001484 4153
001485 544c
001486 2020
001487 2020      			.DB "MASTER  SALT    "
001488 414d
001489 5453
00148a 5245
00148b 2020
00148c 4153
00148d 544c
00148e 2020
00148f 2020      			.DB "MASTER  SALT    "
001490 414d
001491 5453
001492 5245
001493 2020
001494 4153
001495 544c
001496 2020
001497 2020      			.DB "MASTER  SALT    " 
001498 2020
001499 2020
00149a 2020
00149b 2020
00149c 2020
00149d 2020
00149e 2020
00149f 2020      			.DB "                "
0014a0 554e
0014a1 5645
0014a2 204f
0014a3 4c43
0014a4 4549
0014a5 544e
0014a6 2045
0014a7 2031      			.DB "NUEVO CLIENTE 1 "
0014a8 554e
0014a9 5645
0014aa 204f
0014ab 4c43
0014ac 4549
0014ad 544e
0014ae 2045
0014af 2032      			.DB "NUEVO CLIENTE 2 "
0014b0 554e
0014b1 5645
0014b2 204f
0014b3 4c43
0014b4 4549
0014b5 544e
0014b6 2045
0014b7 2033      			.DB "NUEVO CLIENTE 3 "
0014b8 554e
0014b9 5645
0014ba 204f
0014bb 4c43
0014bc 4549
0014bd 544e
0014be 2045
0014bf 2034      			.DB "NUEVO CLIENTE 4 "
0014c0 554e
0014c1 5645
0014c2 204f
0014c3 4c43
0014c4 4549
0014c5 544e
0014c6 2045
0014c7 2035      			.DB "NUEVO CLIENTE 5 "
0014c8 554e
0014c9 5645
0014ca 204f
0014cb 4c43
0014cc 4549
0014cd 544e
0014ce 2045
0014cf 2036      			.DB "NUEVO CLIENTE 6 "
0014d0 554e
0014d1 5645
0014d2 204f
0014d3 4c43
0014d4 4549
0014d5 544e
0014d6 2045
0014d7 2037      			.DB "NUEVO CLIENTE 7 "
0014d8 554e
0014d9 5645
0014da 204f
0014db 4c43
0014dc 4549
0014dd 544e
0014de 2045
0014df 2038      			.DB "NUEVO CLIENTE 8 "
0014e0 2020
0014e1 2020
0014e2 2020
0014e3 2020
0014e4 2020
0014e5 2020
0014e6 2020
0014e7 2020      			.DB "                "
                 TEXTO5:
0014e8 2020
0014e9 2020
0014ea 4e45
0014eb 4520
0014ec 5053
0014ed 5245
0014ee 2041
0014ef 2020      			.DB "    EN ESPERA   "
0014f0 2020
0014f1 2020
0014f2 2020
0014f3 4553
0014f4 5547
0014f5 444e
0014f6 534f
0014f7 2020      			.DB "      SEGUNDOS  "
                 
                 .CSEG 
                 .ORG 0x1504 ; COLOCACION EN FLASH 2A08
                 TEXTO6:		; PARA PANTALLA 20X4
001504 2020
001505 2020
001506 2020
001507 2020
001508 2020
001509 2020
00150a 2020
00150b 2020
00150c 2020
00150d 2020      			.DB "                    "
00150e 2020
00150f 2020
001510 2020
001511 2020
001512 2020
001513 2020
001514 2020
001515 2020
001516 2020
001517 2020      			.DB "                    "
001518 2020
001519 2020
00151a 2020
00151b 2020
00151c 2020
00151d 2020
00151e 2020
00151f 2020
001520 2020
001521 2020      			.DB "                    "
001522 4870
001523 2070
001524 2e2d
001525 202d
001526 4870
001527 6120
001528 7567
001529 2061
00152a 2d20
00152b 2d2e      			.DB "pHp -.- pH agua  -.-"
00152c 4520
00152d 4946
00152e 4143
00152f 4943
001530 2041
001531 4c45
001532 4345
001533 202e
001534 2d2d
001535 252d      			.DB " EFICACIA ELEC. ---%"
001536 4554
001537 504d
001538 5245
001539 5441
00153a 5255
00153b 2041
00153c 2d2d
00153d 2d2e
00153e df20
00153f 2043      			.DB "TEMPERATURA --.- ",223,"C " ; LA Ñ ES 238
001540 5250
001541 2e4f
001542 4f54
001543 4154
001544 204c
001545 2d2d
001546 472d
001547 2f72
001548 6c43
001549 482f      			.DB "PRO.TOTAL ---Gr/Cl/H"
00154a 4156
00154b 4f4c
00154c 4552
00154d 2053
00154e 5250
00154f 474f
001550 4152
001551 414d
001552 4f44
001553 2053      			.DB "VALORES PROGRAMADOS "
001554 6850
001555 2d20
001556 2d2e
001557 5220
001558 2064
001559 2d2d
00155a 202d
00155b 6c43
00155c 2d20
00155d 2d2e      			.DB "Ph -.- Rd --- Cl -.-"
                 TEXTO7:  ; SE PRESENTA AL PULSAR SALIR
                 
00155e 2020
00155f 7250
001560 646f
001561 202e
001562 6f70
001563 2072
001564 6563
001565 646c
001566 2061
001567 2020      			.DB "  Prod. por celda   "
001568 2d31
001569 3032
00156a 3220
00156b 322d
00156c 2031
00156d 2d33
00156e 3132
00156f 3420
001570 312d
001571 2039      			.DB "1-20 2-21 3-21 4-19 "
001572 5420
001573 6e65
001574 6973
001575 6e6f
001576 7020
001577 726f
001578 6320
001579 6c65
00157a 6164
00157b 2020      			.DB " Tension por celda  "
00157c 3520
00157d 312e
00157e 2020
00157f 2e35
001580 2033
001581 3520
001582 322e
001583 2020
001584 2e35
001585 2033      			.DB " 5.1  5.3  5.2  5.3 "
                 
                 
001586 6452
001587 3020
001588 3030
001589 5320
00158a 3020
00158b 2030
00158c 204d
00158d 3030
00158e 4320
00158f 3020      			.DB "Rd 000 S 00 M 00 C 0"
001590 4870
001591 2070
001592 2d20
001593 2d2e
001594 5020
001595 5248
001596 3720
001597 342e
001598 2020
001599 2020      			.DB "pHp  -.- PHR 7.4    "
00159a 5250
00159b 444f
00159c 4355
00159d 4943
00159e 4e4f
00159f 2020
0015a0 2020
0015a1 2025
0015a2 2020
0015a3 2020      			.DB "PRODUCCION    %     " 
0015a4 2020
0015a5 4520
0015a6 5551
0015a7 5049
0015a8 204f
0015a9 4544
0015aa 4554
0015ab 494e
0015ac 4f44
0015ad 2020      			.DB "   EQUIPO DETENIDO  "
0015ae 0441
0015af 4441
0015b0 5249
0015b1 5320
0015b2 4c41
0015b3 2d20
0015b4 2d2e
0015b5 674b
0015b6 2f72
0015b7 334d      			.DB "A",04,"ADIR SAL -.-Kgr/M3"
                 ;			           A  Ñ  A  D  I  R        S  A  L
0015b8 2020
0015b9 0441
0015ba 4441
0015bb 5249
0015bc 2020
0015bd 4153
0015be 204c
0015bf 2020
0015c0 2020
0015c1 2020      			.DB "  A",04,"ADIR  SAL       "
0015c2 2020
0015c3 2020
0015c4 2041
0015c5 204a
0015c6 2055
0015c7 2053
0015c8 2054
0015c9 2045
0015ca 2020
0015cb 2020      			.DB "    A J U S T E     "
0015cc 2020
0015cd 4953
0015ce 204e
0015cf 4320
0015d0 5541
0015d1 4144
0015d2 204c
0015d3 2020
0015d4 2020
0015d5 2020      			.DB "  SIN  CAUDAL       "
0015d6 2020
0015d7 4520
0015d8 5551
0015d9 5049
0015da 204f
0015db 5220
0015dc 4d45
0015dd 544f
0015de 204f
0015df 2020      TEXTO8:		.DB "   EQUIPO  REMOTO   "
0015e0 2020
0015e1 2020
0015e2 4520
0015e3 204e
0015e4 4d20
0015e5 5241
0015e6 4843
0015e7 2041
0015e8 2020
0015e9 2020      			.DB "     EN  MARCHA     "
0015ea 2020
0015eb 5320
0015ec 4e49
0015ed 5020
0015ee 4f52
0015ef 5544
0015f0 4343
0015f1 4f49
0015f2 204e
0015f3 2020      			.DB "   SIN PRODUCCION   "
0015f4 2020
0015f5 4e20
0015f6 5649
0015f7 4c45
0015f8 4420
0015f9 5045
0015fa 534f
0015fb 5449
0015fc 204f
0015fd 2020      			.DB "   NIVEL DEPOSITO   "
0015fe 6554
0015ff 706d
001600 7265
001601 7461
001602 7275
001603 2061
001604 2020
001605 2e20
001606 2020
001607 43df      			.DB "Temperatura    .  ",223,"C" ; PRESENTAR º O CREARLO
001608 2020
001609 2020
00160a 2020
00160b 2020
00160c 2020
00160d 2020
00160e 2020
00160f 2020
001610 2020
001611 2020      			.DB "                    "
001612 2020
001613 4553
001614 534e
001615 524f
001616 4420
001617 2045
001618 4c46
001619 4a55
00161a 204f
00161b 2020      			.DB "  SENSOR DE FLUJO   "
00161c 2020
00161d 2020
00161e 4e45
00161f 2020
001620 5345
001621 4550
001622 4152
001623 2020
001624 2020
001625 2020      			.DB "    EN  ESPERA      "
001626 2020
001627 2020
001628 2020
001629 5320
00162a 4745
00162b 4e55
00162c 4f44
00162d 2053
00162e 2020
00162f 2020      			.DB "       SEGUNDOS     "
001630 2020
001631 4f43
001632 534e
001633 4c55
001634 4154
001635 2052
001636 4d20
001637 4e41
001638 4155
001639 204c      			.DB "  CONSULTAR  MANUAL "
00163a 2020
00163b 2020
00163c 2041
00163d 2056
00163e 2045
00163f 2052
001640 2049
001641 2041
001642 2020
001643 2020      			.DB "    A V E R I A     "
001644 2020
001645 4146
001646 4c4c
001647 204f
001648 5250
001649 4455
00164a 4355
00164b 4943
00164c 4e4f
00164d 2020      			.DB "  FALLO PRUDUCCION  "
00164e 2020
00164f 5320
001650 7375
001651 2e74
001652 5320
001653 6e6f
001654 6164
001655 5020
001656 2068
001657 2020      TEXTO9:		.DB "   Sust. Sonda Ph   "
001658 2020
001659 4520
00165a 5252
00165b 524f
00165c 4320
00165d 4e4f
00165e 5845
00165f 4f49
001660 204e
001661 2020      			.DB "   ERROR CONEXION   "
001662 4656
001663 2075
001664 7356
001665 4120
001666 706d
001667 2020
001668 6554
001669 706d
00166a 2020
00166b 2020      			.DB "VFu Vs Amp  Temp    "
00166c 2e30
00166d 2030
00166e 4f4e
00166f 3020
001670 2e30
001671 2030
001672 2d2d
001673 2d2e
001674 2020
001675 2020      			.DB "0.0 NO 00.0 --.-    "
001676 5020
001677 6f72
001678 632e
001679 6f6c
00167a 6f72
00167b 2d20
00167c 202d
00167d 7247
00167e 482f
00167f 2020      			.DB " Pro.cloro -- Gr/H  " 
001680 4520
001681 206e
001682 7365
001683 6570
001684 6172
001685 2020
001686 2d20
001687 2d2d
001688 6553
001689 2067      			.DB " En espera   ---Seg "
00168a 4320
00168b 6d6f
00168c 7270
00168d 626f
00168e 7261
00168f 6320
001690 6e6f
001691 7865
001692 6f69
001693 206e      			.DB " Comprobar conexion "
001694 2020
001695 4320
001696 6261
001697 656c
001698 6520
001699 656c
00169a 7463
00169b 6f72
00169c 6f64
00169d 2020      			.DB "   Cable electrodo  "
00169e 6956
00169f 6164
0016a0 6520
0016a1 656c
0016a2 7463
0016a3 6f72
0016a4 6f64
0016a5 2020
0016a6 2d2d
0016a7 252d      			.DB "Vida electrodo  ---%"
0016a8 2020
0016a9 2020
0016aa 2020
0016ab 2020
0016ac 2020
0016ad 2020
0016ae 2020
0016af 2020
0016b0 2020
0016b1 2020      			.DB "                    "
0016b2 4153
0016b3 204c
0016b4 4e45
0016b5 4120
0016b6 5547
0016b7 2041
0016b8 2d20
0016b9 2d2e
0016ba 6720
0016bb 6c2f      			.DB "SAL EN AGUA  -.- g/l"
0016bc 4120
0016bd 4104
0016be 4944
0016bf 2052
0016c0 2c2d
0016c1 202d
0016c2 2f67
0016c3 206c
0016c4 2020
0016c5 2020      			.DB " A",04,"ADIR -,- g/l     "
                 TEXTO10:
0016c6 4143
0016c7 494c
0016c8 5242
0016c9 5241
0016ca 5320
0016cb 4c41
0016cc 2d20
0016cd 2d2e
0016ce 6720
0016cf 6c2f      			.DB "CALIBRAR SAL -.- g/l"
0016d0 4143
0016d1 494c
0016d2 5242
0016d3 5241
0016d4 7020
0016d5 2048
0016d6 4e20
0016d7 442f
0016d8 2020
0016d9 2020      			.DB "CALIBRAR pH  N/D    "
0016da 4143
0016db 494c
0016dc 5242
0016dd 5241
0016de 5220
0016df 7864
0016e0 4e20
0016e1 442f
0016e2 6d20
0016e3 2056      			.DB "CALIBRAR Rdx N/D mV "
0016e4 4143
0016e5 494c
0016e6 5242
0016e7 5241
0016e8 4320
0016e9 206c
0016ea 4e20
0016eb 442f
0016ec 7020
0016ed 6d70      			.DB "CALIBRAR Cl  N/D ppm"
0016ee 694e
0016ef 6576
0016f0 206c
0016f1 6564
0016f2 7020
0016f3 6f72
0016f4 2064
0016f5 2d2d
0016f6 252d
0016f7 6c43      			.DB "Nivel de prod ---%Cl"
0016f8 4870
0016f9 6d20
0016fa 7861
0016fb 6520
0016fc 206e
0016fd 6761
0016fe 6175
0016ff 4e20
001700 442f
001701 2020      			.DB "pH max en agua N/D  "
001702 694e
001703 6576
001704 206c
001705 6452
001706 2078
001707 6761
001708 6175
001709 4e20
00170a 442f
00170b 764d      			.DB "Nivel Rdx agua N/DMv"
00170c 694e
00170d 6576
00170e 206c
00170f 6c43
001710 6120
001711 7567
001712 2061
001713 2f4e
001714 7044
001715 6d70      			.DB "Nivel Cl agua N/Dppm"
001716 6e49
001717 6576
001718 7472
001719 7269
00171a 5020
00171b 6c6f
00171c 6320
00171d 6461
00171e 2061
00171f 682d      			.DB "Invertir Pol cada -h"
001720 7250
001721 646f
001722 202e
001723 7541
001724 6f74
001725 5220
001726 7864
001727 2d20
001728 2d2d
001729 566d      			.DB "Prod. Auto Rdx ---mV"	
00172a 7250
00172b 646f
00172c 202e
00172d 7541
00172e 6f74
00172f 4320
001730 206c
001731 2e2d
001732 702d
001733 6d70      			.DB "Prod. Auto Cl -.-ppm"
001734 7355
001735 206f
001736 6564
001737 206c
001738 7165
001739 6975
00173a 6f70
00173b 2d20
00173c 2d2d
00173d 482d      			.DB "Uso del equipo ----H"
                 TEXTO11:		; INSTRUCCIONES NEXTION TEXTO
00173e 6170
00173f 6567
001740 3020
001741 2020
001742 6970
001743 2063
001744 7420
001745 2e30
001746 7874
001747 3d74      			.DB "page 0  pic  t0.txt="
001748 306a
001749 762e
00174a 6c61
00174b 203d
00174c 2031
00174d 2020
00174e 4e20
00174f 2030
001750 4953
001751 2020      			.DB "j0.val= 1    N0 SI  "
001752 3574
001753 622e
001754 6f63
001755 353d
001756 3730
001757 3231
001758 2020
001759 2020
00175a 2020
00175b 2020      			.DB "t5.bco=50712        "				; 12 gris claro
00175c 3574
00175d 622e
00175e 6f63
00175f 323d
001760 3130
001761 2036
001762 2020
001763 2020
001764 2020
001765 2020      		    .DB "t5.bco=2016         "				; 11 verde
001766 6552
001767 6f64
001768 2078
001769 6d6d
00176a 2056
00176b 2020
00176c 2020
00176d 2020
00176e 2020
00176f 2020      			.DB "Redox mmV           "
001770 6c43
001771 726f
001772 206f
001773 7070
001774 206d
001775 2020
001776 2020
001777 3071
001778 2030
001779 2009      			.DB "Cloro ppm     q00 	 "				; q00 PARA QUE EL MICRO VALLA A PAGINA CERO PRINCIPAL
00177a 6970
00177b 2063
00177c 3434
00177d 2c31
00177e 3532
00177f 332c
001780 2036
001781 2020
001782 2020
001783 2020      			.DB "pic 441,25,36       "				; ENVIA POLARIDAD 1 o 2	 1 ES 36 2 ES 35		
001784 2020
001785 7845
001786 6563
001787 6f73
001788 6420
001789 2065
00178a 6153
00178b 206c
00178c 2020
00178d 2020      			.DB "  Exceso de Sal     "
00178e 4853
00178f 4e55
001790 2054
001791 2020
001792 2020
001793 4d20
001794 534f
001795 2020
001796 2020
001797 2020      			.DB "SHUNT      MOS      "
001798 2020
001799 2020
00179a 2020
00179b 2020
00179c 2020
00179d 2020
00179e 2020
00179f 2020
0017a0 2020
0017a1 2020      			.DB "                    "
                 .equ	VERDE=0xA38
                 .equ	ROJO=0xA24
                 .CSEG 
                 .ORG 0x1800 ; COLOCACION EN FLASH 2E90
                 
                 
                 .INCLUDE "PRO_RD_CL.ASM"
                 
                 
                 
                 
                 
                 ; GRABA Y RETORNA A PROGRANACION DE REDOX O CLORO
                 TECLA6T:
001800 93f0 0216 	STS			RAM_RD_CL, R31		; ACTUALIZA EN RAM EL NUEVO VALOR PROGRAMADO DE LA PRODUCION
001802 e610      	LDI			R17, APOYO_RD_CL	; POSICION $060 EN EEPROM
001803 2f2f      	MOV			R18, R31			; GRABA EL VALOR DEL REDOX EN EEPROM POSICION 241
001804 940e 0587 	CALL		EEPROM_ES
001806 940e 097f 	CALL		NO_TECLA
001808 9508      	RET
                 
                 
                 
                 TECLA6U:  ; GRABA Y RETORNA A PROGRAMACION DE REOX O CLORO
001809 93f0 0216 	STS			RAM_RD_CL, R31		; ACTUALIZA EN RAM EL NUEVO VALOR PROGRAMADO DE LA PRODUCION
00180b e610      	LDI			R17, APOYO_RD_CL
00180c 2f2f      	MOV			R18, R31			; GRABA EL VALOR DEL REDOX EN EEPROM POSICION 241
00180d 940e 0587 	CALL		EEPROM_ES
00180f e000      	LDI			R16, 00				; PONE EL RETARDO DEL TECLADO A 0
001810 2e70      	MOV			TEMP_TEC, R16
001811 940e 097f 	CALL		NO_TECLA
001813 9508      	RET
                 
                 TECLA6V:	; 	si no tiene redox nI sonda de cloro va a PROGRAMAR EL PH
                 ;	LDI			R17, APOYO_RD_CL
                 ;	CALL		EEPROM_RW
001814 91f0 0216 	LDS			R31,RAM_RD_CL
                 
                 TECLA6:								; AJUSTAR EL VALOR DEL APOYO DE REDOX Y CLORO EN R31
001816 95a8      	WDR
001817 2d87      	MOV			R24, TEMP_TEC
001818 308f      	CPI			R24, retardo_programacion	; PARA COMPARARLO CON EL RETARDO 20 SEGUNDOS SIN PULSAR TECLA
001819 f732      	BRPL		TECLA6T						; Y SALIR DE PROGRAMACION DE PARAMETROS					
00181a 940e 04c0 	CALL		LEC_TEC
00181c 3f1f      	CPI			R17, 0B11111111		; COMPRUEBA SI SE A PULSADO ALGUNA TECLA
00181d f011      	BREQ		TECLA6A				; SI SE HA PULSADO SALTA A TECLA2A
00181e e000      	LDI			R16, 00				; SI ES ASI....
00181f 2e70      	MOV			TEMP_TEC, R16		; PONE EL CONTADOR DE RETARDO A CERO
                 TECLA6A:
                 
                 			; OPCION SALTAR PARA AJUSTE DE PH
001820 3f1b      	CPI			R17, 0B11111011		; TECLA 2
001821 f339      	BREQ		TECLA6U				; SALTA PARA AJUSTAR EL PH
                 			; OPCION SALIR DE LECTURA DE TECLADO 
001822 371f      	CPI			R17, 0B01111111		;TECLA 5
001823 f409      	BRNE		TECLA6B				; SI NO ES 80 SALTA A TECLA1D
001824 cfdb      	RJMP		TECLA6T				; TERMINA Y SALE PARA GRABAR
                 TECLA6B:	; OPCION AUMENTAR
001825 3e1f      	CPI			R17, 0B11101111		; IDEM
001826 f439      	BRNE		TECLA6C				; SI NO ESTA PULSADA SALTA PARA VERIFICAR OTRA TECLA
001827 e000      	LDI			R16, 00				; PONE EL RETARDO DEL TECLADO A 0
001828 2e70      	MOV			TEMP_TEC, R16
001829 95f3      	INC			R31					; INCREMENTA EL VALOR
00182a e060      	LDI			R22, 0				; CARGA EL RETARDO DE LECTURA DELTECLADO
00182b 30f8      	CPI			R31, 8				; VERIFICA SI ESTA EN EL VALOR MAXIMO
00182c f00c      	BRLT		TECLA6C				; SI NO SUPERA EL VALOR MAXIMO SALTA
00182d e0f8      	LDI			R31, 8				; SI SUPERA EL MAXIMO LO PONE AL MAXIMO
                 TECLA6C:	; OPCION DISMINUIR 
00182e 3f1d      	CPI			R17, 0B11111101		; IDEM
00182f f439      	BRNE		TECLA6E				; SI NO ESTA PULSADA SALTA
001830 e000      	LDI			R16, 00				; PONE EL RETARDO DEL TECLADO A 0
001831 2e70      	MOV			TEMP_TEC, R16
001832 95fa      	DEC			R31					; DISMINUYE EL VALOR
001833 e061      	LDI			R22, 1				; CARGA EL RETARDO DE LECTURA DEL TECLADO
001834 30f2      	CPI			R31, 2				; COMPRUEBA SI SE ELCANZA EL VALOR MINIMO
001835 f408      	BRBC 		0, TECLA6E			; SI NO SE ALCANZA SALTA
001836 e0f2      	LDI			R31, 2				; SI SE ALCANZA PONE EL VALOR MINIMO
                 
                 TECLA6E:
001837 316a      	CPI			R22, RETARDO2		; VALOR DEL TIEMPO DE RATARDO LECTURA DEL TECLADO
001838 f3f0      	BRLO		TECLA6E				; COMPRUEBA EL TIEMPO DE RETARDO 
001839 d001      	RCALL		TECLA6D
00183a cfdb      	RJMP		TECLA6	
                 
                 TECLA6D:	; PONER EL VALOR EN PANTALLA
00183b 2f8f      	MOV			R24, R31			; PONE EL VALOR EN R24 PARA CONVERTIRLO EN DECIMAL
00183c 940e 0590 	CALL		RADC   				; CONVERTIR UN NUMERO EN DIGITOS DATO EN R24
00183e 9230 01eb 	STS			$01EB, R3			; PONE EL RESULTADO EN PANTALLA MILIVOLTIOS DE REDOX
                 
                 ; ESCRIBIR LINEA 1
                 
                 ;LINEAP5: ; RUTINA PARA ESCRIBIR LAS DOS LINEAS EN ESTADO DE PROGRAMACION
001840 ec00      	LDI			R16, 192			; ESCRIBIR LINEA 2
001841 940e 053e 	CALL		ENVINT				; En subrrutina Env_doi Envia instrucion para escribir en linea 1
001843 e0d5      	LDI			YH,HIGH (LIN_1P)	; POSICION BIT ALTO DEL TEXTO A ENVIAR ram en 070
001844 edc8      	LDI			YL,LOW  (LIN_1P)	; POSICION BIT BAJO DEL TEXTO A ENVIAR
001845 e114      	LDI			R17,20				; NUMERO DE DIGITOS A ENVIAR A PANTALLA
001846 940e 0925 	CALL		ENVIARTEXTO			; RUTINA EN ESTE FICHERO PRECISA SUBRRUTINA ENV_DOI
001848 fd47      	SBRC		CONTROL, 7			; COMPRUEBA QUE TIENE SONDA DE CL
001849 c02f      	RJMP		LINEA2_CL			; PROGRAMACION DE CLORO
                 LINEA2_RD:
00184a e200      	LDI				R16, 32
00184b 9300 01e0 	STS				$1E0,R16
00184d 9300 01e1 	STS				$1E1,R16
00184f 9300 01e2 	STS				$1E2,R16
001851 9300 01e3 	STS				$1E3,R16
001853 9300 01e7 	STS				$1E7,R16
001855 9300 01e8 	STS				$1E8,R16
001857 9300 01e9 	STS				$1E9,R16
001859 9300 01ef 	STS				$1EF,R16
00185b 9300 01f0 	STS				$1F0,R16
00185d 9300 01f1 	STS				$1F1,R16
00185f 9300 01f2 	STS				$1F2,R16
001861 9300 01f3 	STS				$1F3,R16
                 
                 
001863 e502      	LDI				R16, 82			; PONE UNA R
001864 9300 01e4 	STS				$01E4,R16		
001866 e604      	LDI				R16, 100		; PONE UNA d
001867 9300 01e5 	STS				$01E5, R16	
001869 e708      	LDI				R16, 120		; PONE UNA x 
00186a 9300 01e6 	STS				$01E6, R16	
00186c e20d      	LDI				R16, 45			; PONE UN -
00186d 9300 01ea 	STS				$01EA, R16	
00186f e300      	LDI				R16, 48			; PONE UN 0
001870 9300 01ec 	STS				$1EC, R16
001872 e60d      	LDI				R16, 109		; PONE UNA m
001873 9300 01ed 	STS				$1ED, R16
001875 e506      	LDI				R16, 86			; PONE UNA V
001876 9300 01ee 	STS				$1EE, R16
001878 c035      	RJMP			LINEA2_RD_CL
                 LINEA2_CL:
                 
001879 e200      	LDI				R16, 32
00187a 9300 01e0 	STS				$1E0,R16
00187c 9300 01e1 	STS				$1E1,R16
00187e 9300 01e2 	STS				$1E2,R16
001880 9300 01e3 	STS				$1E3,R16
001882 9300 01e5 	STS				$1E5,R16
001884 9300 01e6 	STS				$1E6,R16
001886 9300 01e7 STS $1E7,R16
001888 9300 01ea STS	$1EA,R16
00188a 9300 01ee 	STS				$1EE,R16
00188c 9300 01ef 	STS				$1EF,R16
00188e 9300 01f0 	STS				$1F0,R16
001890 9300 01f1 	STS				$1F1,R16
001892 9300 01f2 	STS				$1F2,R16
001894 9300 01f3 	STS				$1F3,R16
001896 e403      	LDI				R16, 67			; PONE UNA C
001897 9300 01e4 	STS				$1E4,R16		
001899 e60c      	LDI				R16, 108		; PONE UNA l
00189a 9300 01e5 	STS				$1E5, R16	
00189c e20d      	LDI				R16, 45			; PONE UN -
00189d 9300 01e8 	STS				$01E8, R16	
00189f e300      	LDI				R16, 48			; PONE UN 0
0018a0 9300 01e9 	STS				$1E9, R16
0018a2 e20c      	LDI				R16, 44			; PONE UNA ,
0018a3 9300 01ea 	STS				$01EA, R16
0018a5 e700      	LDI				R16, 112		; PONE UNA p
0018a6 9300 01ec 	STS				$1EC, R16
0018a8 9300 01ed 	STS				$1ED, R16
0018aa e60d      	LDI				R16, 109		; PONE UNA m
0018ab 9300 01ee 	STS				$1EE, R16
0018ad c000      	RJMP			LINEA2_RD_CL
                 LINEA2_RD_CL:
0018ae e904      	LDI				R16, 148		; 11000000 escribir en linea 2 linea (192)
0018af 940e 053e 	CALL			ENVINT
0018b1 e0d1      	LDI				YH,HIGH (LIN_2P)	; POSICION ALTA DEL TAXTO EN RAM 080
0018b2 eec0      	LDI				YL,LOW  (LIN_2P)	; direccion BAJA DEL TEXTO EN RAM      	
0018b3 e114        	LDI				R17,20 			; bytes a enviar 
0018b4 940e 0925 	CALL			ENVIARTEXTO		; RUTINA PARA ENVIAR TEXTO E PANRALLA
0018b6 940e 1a97 CALL BORRA_LINEA_4
                 
                 ; BORRA LINEA 1
0018b8 e800      	LDI				R16,128			; BORRAR LINEA 1
0018b9 940e 053e 	CALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION, " ESCRIBIR LINEA 2"
0018bb e0d7      	LDI				YH,HIGH(BORRAR_LINEA)	; POSICION ALTA DEL TAXTO EN RAM 080
0018bc eac4      	LDI				YL,LOW (BORRAR_LINEA)	; direccion BAJA DEL TEXTO EN RAM  "CONSULTAR MANUAL"    	
0018bd e114        	LDI				R17,20   			; bytes a enviar 
0018be 940e 0925 	CALL			ENVIARTEXTO	
0018c0 9508      	RET
                 
                 
                 .INCLUDE "RETARDO.ASM"
                 
                 
                 RUT_RETARDO:
0018c1 940e 1a7f 	CALL			BORRAR_PANTALLA
0018c3 e081      	LDI				R24,1
0018c4 9380 0b03 	STS				0XB03,R24			; PONE UN 1  ACTIVAR EN ESPERA		
                 ; CAMBIAR EN PANTALLA COLOR AL NUMERO 6 "CUENTA"
0018c6 e306      		LDI			R16,54				; ESCRIBE EN RAM LA PAGINA A ENVIAR LA 06
0018c7 9300 0a01 		STS			0xA01,R16
0018c9 940e 1f9e 		CALL		P_NEXTION_PAGE		; VA A PANTALLA CUENTA
                 
                 RUT_RETARDO_1A:
                 
                 
0018cb feb0      	SBRS			CONTROL_1,0			; SALTA LA PROXIMA INSTRUCION SI ES UNO,
0018cc cffe      	RJMP			RUT_RETARDO_1A		; AJUSTE DE SEGUNDO
0018cd 94e8      	CLT									; PONE A CERO EL BIT T DE SREG
0018ce f8b0      	BLD				CONTROL_1,0			; PASA EL REGISTRO T A CONTROL_1
0018cf 953a      	DEC				R19
0018d0 f189      	BRBS			1,RUT_2_C			; SI LLEGA A CERO SALTA A RUT_2_B SI NO NO
                 ;	MOV				R24,R19
                 ;	STS				UDR1,R24			; ENVIA POR LA RS EL TIEMPO DE RETARDO
                 ;	CALL CADENA_UART
                 ; PRESENTACION DE TIEMPO QUE FALTA
                 ; ESCRIBE LINEA 1 " EN ESPERA
0018d1 ec00      	LDI				R16,192			; 11000000 escribir en linea 1 linea (192)
0018d2 940e 053e 	CALL			ENVINT
0018d4 e0d6      	LDI				YH,HIGH(EN_ESPERA)	; POSICION ALTA DEL TAXTO EN RAM
0018d5 e8cc      	LDI				YL,LOW (EN_ESPERA)	; direccion BAJA DEL TEXTO EN RAM      	
0018d6 e114        	LDI				R17,20 				; bytes a enviar 
0018d7 940e 0925 	CALL			ENVIARTEXTO			; RUTINA PARA ENVIAR TEXTO E PANRALLA
                 
                 ; ESCRIBE LINEA 2
0018d9 2f83      	MOV				R24,R19
0018da 940e 0590 	CALL			RADC
0018dc 9210 06a3 	STS				$6A3,R1
0018de 9220 06a4 	STS				$6A4,R2
0018e0 9230 06a5 	STS				$6A5,R3
0018e2 e904      	LDI				R16,148			; 11000000 escribir en linea 2 linea (192)
0018e3 940e 053e 	CALL			ENVINT
0018e5 e0d6      	LDI				YH,HIGH (N_SEG)		; POSICION ALTA DEL TAXTO EN RAM 080
0018e6 eac0      	LDI				YL,LOW  (N_SEG)		; direccion BAJA DEL TEXTO EN RAM      	
0018e7 e114        	LDI				R17,20 				; bytes a enviar 
0018e8 940e 0925 	CALL			ENVIARTEXTO			; RUTINA PARA ENVIAR TEXTO E PANRALLA
                 ; ENVIA SEGUNDOS DE ESPERA A NEXTION
0018ea 933f      PUSH	R19							; SALVA EL CONTROL DE SEGUNDOS ENESPERA
0018eb e734      		LDI			R19,116			; ENVIA UNA t
0018ec e3b9      		LDI			R27,57			; TEXTO 9
0018ed e003      		LDI			R16,3			; NUMERO DE CARACTERES A ESCRIBIR
0018ee e0d6      		LDI			YH,HIGH(N_ESP)	
0018ef eac3      		LDI			YL,LOW (N_ESP)
0018f0 940e 1dce 		CALL		P_NEXTION_TEXTO	
0018f2 913f      POP		R19							; RECUPERA LOS SEGUNDOS EN ESPERA
                 
                 
                 ; NUEVA MEDICION DE SAL SI ES MAYOR DE 08 SALE SI NO SIGUE CONTANDO
0018f3 940e 04c0 	CALL			LEC_TEC				; LEE EL TECLADO
0018f5 371f      	CPI				R17,0B01111111		; SI SE PULSA LA TECLA SALIR
0018f6 f059      	BREQ			RUT_2_C				; VA A RUT_2_C	Y SALE
0018f7 9110 0c02 	LDS				R17,RG_232+1		; LEE EL CODIGO ENVIADO POR NEXTION
0018f9 3614      	CPI				R17,100				; 100 ENVIADO POR NEXTION AL PULSAR SALIR
0018fa f039      	BREQ			RUT_2_C				; VA A RUT_2_C	Y SALE
0018fb e026      	LDI				R18,P_SAL			; LINEA DE ENTRADA EN EL CONVERTIDOR PCF8591
0018fc 91a0 020d 	LDS				R26,RAMC_SAL		; NUMERO DE MEDICIONES	
0018fe 940e 013c 	CALL			ADC_P
                 ;	LDS				R18,RAM_MED_INI_SAL	; CARGA EL ERROR INICIAL DEL TLC27 EN R18
                 ;	SUB				R24,R18
001900 3088      	CPI				R24,8
001901 f248      	BRBS			0,RUT_RETARDO_1A	; SI ES MENOR SIGUE CONTANDO
                 
                 RUT_2_C:
001902 e080      	LDI				R24,0
001903 9380 0b03 	STS				0XB03,R24			; PONE UN 0  DESACTIVAR EN ESPERA	
                 
001905 9508      	RET
                 .INCLUDE "VER_ERROR.ASM"
                 
                 ; PARA COMPROBAR EL TIPO DE ERROR
                 ; SI ES AVERIA O FALSA CONEXION
                 VER_ERROR:
                 	
001906 e024      	LDI				R18, P_VSAL			; LINEA A LEER VOLTAJE DE SALIDA TENSION EN BORNAS
001907 e5a3      	LDI				R26, 83				; NUMERO DE LECTURAS
001908 940e 013c 	CALL			ADC_P
00190a 3085      	CPI				R24, 5				; SI LA MEDICION REAL ES MAYOR DE 0,5 NO EJECUTA LA SIGUIENTE INSTRU
00190b f408      	BRBC			0, VER_ERROR_A		; MEDICION MAYOR DE 5 
00190c 9508      	RET
                 
                 VER_ERROR_A:				; ENVIA ERROR DE CONEXION REVISAR CONEXION ELECTRODO
                 
00190d 940e 02f2 	CALL			APAGAR_FUENTE
00190f 9895      	CBI				PORTD,b_acido		; APAGA BOMBA DE ACIDO
001910 2d0f      	MOV				R16, VAL_LED
001911 7f0e      	ANDI			R16, 0B11111110		; APAGA LED 0 FUENTE ENCENDIDA
001912 2ef0      	MOV				VAL_LED, R16	
001913 940e 091d 	CALL			LEDPANT
001915 e800      	LDI				R16, 128			; 11000000 escribir en linea 2 linea (192)( linea 4 seria 212)
001916 940e 053e 	CALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION, " ESCRIBIR LINEA 2"
001918 e0d7      	LDI				YH, HIGH (F_CONEX)	; POSICION ALTA DEL TAXTO EN RAM 080
001919 e0c4      	LDI				YL, LOW  (F_CONEX)	; direccion BAJA DEL TEXTO EN RAM  "EUIPO DETENIDO"    	
00191a e114        	LDI				R17,20   			; bytes a enviar 
00191b 940e 0925 	CALL			ENVIARTEXTO			; RUTINA PARA ENVIAR TEXTO E PANTALLA
00191d ec00      	LDI				R16, 192			; 11000000 escribir en linea 2 linea (192)( linea 4 seria 212)
00191e 940e 053e 	CALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION, " ESCRIBIR LINEA 2"
001920 e0d5      	LDI				YH, HIGH (LIN_2S)	; POSICION ALTA DEL TAXTO EN RAM 080
001921 e9cc      	LDI				YL, LOW  (LIN_2S)	; direccion BAJA DEL TEXTO EN RAM  "CONSULTAR MANUAL"    	
001922 e114        	LDI				R17,20   			; bytes a enviar 
001923 940e 0925 	CALL			ENVIARTEXTO			; RUTINA PARA 
001925 e904      	LDI				R16, 148			; 11000000 escribir en linea 2 linea (192)( linea 4 seria 212)
001926 940e 053e 	CALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION, " ESCRIBIR LINEA 2"
001928 e0d7      	LDI				YH, HIGH (CONEX_ELECT)	; POSICION ALTA DEL TAXTO EN RAM 080
001929 e6c8      	LDI				YL, LOW  (CONEX_ELECT)	; direccion BAJA DEL TEXTO EN RAM  "CONSULTAR MANUAL"    	
00192a e114        	LDI				R17,20   			; bytes a enviar 
00192b 940e 0925 	CALL			ENVIARTEXTO			; RUTINA PARA 
00192d ed04      	LDI				R16, 212			; 11000000 escribir en linea 2 linea (192)( linea 4 seria 212)
00192e 940e 053e 	CALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION, " ESCRIBIR LINEA 2"
001930 e0d7      	LDI				YH, HIGH (VER_SAL)	; POSICION ALTA DEL TAXTO EN RAM 080
001931 e7cc      	LDI				YL, LOW  (VER_SAL)	; direccion BAJA DEL TEXTO EN RAM  "CONSULTAR MANUAL"    	
001932 e114        	LDI				R17,20   			; bytes a enviar 
001933 940e 0925 	CALL			ENVIARTEXTO			; RUTINA PARA 
                 ; ENVIA LA PAGINA 4 A NEXTION
001935 e304      		LDI			R16,52				; ESCRIBE EN RAM LA PAGINA A ENVIAR LA 04
001936 9300 0a01 		STS			0xA01,R16			; ESCRIBE EN RAM LA PAGINA A ENVIAR
001938 940e 1f9e 		CALL		P_NEXTION_PAGE		; RUTINA PARA CAMBIAR DE PAGINA 
                 
                 
00193a e031      LDI				R19,1
00193b 9330 0b07 STS				ERROR_ELECTRODO, R19	; PONE UN 1 EN ERROR CONEXION ELECTRODO
00193d e030      LDI				R19,0
00193e 9330 0210 STS				RAM_SAL_C,R19	
                 ;	RJMP			VER_ERROR
                 VER_ERROR_B:
001940 feb0      	SBRS			CONTROL_1,0			; SALTA LA PROXIMA INSTRUCION SI ES UNO,
001941 cffe      RJMP			VER_ERROR_B
001942 94e8      	CLT									; PONE A CERO EL BIT T DE SREG
001943 f8b0      	BLD				CONTROL_1, 0		; PASA EL REGISTRO T A CONTROL_1
                 
001944 940e 1bac CALL 			CADENA_UART				; Y ENVIA LA CADENA COMPLETA Y LUEGO PARA A DORMIR
                 
001946 cff9      	RJMP			VER_ERROR_B
                 .INCLUDE "MED_INI_SAL.ASM"
                 
                 
                 MED_INI_SAL:
001947 91a0 020d 	LDS				R26, RAMC_SAL		; NUMERO DE MEDICIONES
001949 e026      	LDI				R18, P_SAL				; LINEA DE ENTRADA EN EL CONVERTIDOR PCF8591
                 ;	CALL			PCF					; VUELVE A MEDIR 
00194a 940e 013c 	CALL			ADC_P
00194c 2f38      	MOV				R19, R24
                 ;	STS				RAM_PRU, R24
00194d 940e 0590 	CALL			RADC				; PRESENTA EN LINEA 3 LA MEDICION DE SAL REAL
00194f 9210 0242 	STS				$242, R1			; DECENAS
001951 9220 0243 	STS				$243, R2			; UNIDADES
001953 9230 0244 	STS				$244, R3			; DECIMAS	
001955 2f83      	MOV				R24, R19
001956 9536      	LSR				R19					; DIVIDE POR DOS
001957 9536      	LSR				R19					; DIVIDE POR DOS
001958 1b83      	SUB				R24, R19			; RESTA EL 20% DE R24 A R24 QUEDA EL 80%
001959 9380 021e 	STS				RAM_MED_INI_SAL, R24; GUARDA EL RESULTADO EN RAM
00195b 9508      	RET
                 .INCLUDE "PANTALLA2.ASM"
                 
                 ; ESTO ES SOLO PARA AJUSTE DEL CIRCUITO
                 ; PONER A UNO EL PRUERTO C_2 LINEA ENABLE PREDEFINIDO EN RUTINA PARAMETROS
                 ; linea 1-128 DIRECION 0C0
                 ; linea 2-192 DIRECION 0D0	
                 ; linea 3-148 DIRECION 0E0
                 ; linea 4-212 DIRECION 0F0
                 
                 	.equ			TEXTO_LCD2_1	=0x100		; TEXTO "LINEA 1"
                 	.equ			TEXTO_LCD2_2	=0x114		; TEXTO "LINEA 2"
                 	.equ			TEXTO_LCD2_3	=0x128		; TEXTO "LINEA 3"
                 	.equ			TEXTO_LCD2_4	=0x13C		; TEXTO "LINEA 4"
                 	.equ			TEXTO_LCD2_5	=0x150		; TEXTO "LINEA 5"
                 	.equ			TEXTO_LCD2_6	=0x164		; TEXTO "LINEA 6"
                 	.equ			TEXTO_LCD2_7	=0x178		; TEXTO "LINEA 7"
                 	.equ			TEXTO_LCD2_8	=0x18C		; TEXTO "LINEA 8"
                 	.equ			TEXTO_LCD2_9	=0x1A0		; TEXTO "LINEA 9" MUESTRA "PRODUCION POR CELDA"
                 	.equ			TEXTO_LCD2_10	=0x1B4		; TEXTO "LINEA 10"MUESTRA "1-20 2-19 3-20 4-21"
                 	.equ			TEXTO_LCD2_11	=0x1C8		; TEXTO "LINEA 11"MUESTRA " TENSION POR CELDA "
                 	.equ			TEXTO_LCD2_12	=0x1DC		; TEXTO "LINEA 12"MUESTRA " 5,1  5,0  5,1  4,9"
                 
                 PANTALLA2_A:		; LINEA1 POSICION EN RAM 0X150
                 
00195c e800      	LDI				R16, 128			; 11000000 escribir en linea 1 
00195d 940e 0561 	CALL			ENVINT_2
00195f e0d1      	LDI				YH, HIGH (TEXTO_LCD2_1)	; POSICION ALTA DEL TAXTO EN RAM 080
001960 e0c0      	LDI				YL, LOW  (TEXTO_LCD2_1)	; direccion BAJA DEL TEXTO EN RAM      	
001961 e114        	LDI				R17,20   			; bytes a enviar 
001962 940e 0a4f 	CALL			ENVIARTEXTO_2	
                 
                 
001964 ec00      	LDI				R16, 192			; 11000000 escribir en linea 2
001965 940e 0561 	CALL			ENVINT_2
001967 e0d1      	LDI				YH, HIGH (TEXTO_LCD2_2)	; POSICION ALTA DEL TAXTO EN RAM 080
001968 e1c4      	LDI				YL, LOW  (TEXTO_LCD2_2)	; direccion BAJA DEL TEXTO EN RAM      	
001969 e114        	LDI				R17,20   			; bytes a enviar 
00196a 940e 0a4f 	CALL			ENVIARTEXTO_2	
                 
                 
00196c e904      	LDI				R16, 148			; 11000000 escribir en linea 3
00196d 940e 0561 	CALL			ENVINT_2
00196f e0d1      	LDI				YH, HIGH (TEXTO_LCD2_3)	; POSICION ALTA DEL TAXTO EN RAM 080
001970 e2c8      	LDI				YL, LOW  (TEXTO_LCD2_3)	; direccion BAJA DEL TEXTO EN RAM      	
001971 e114        	LDI				R17,20   			; bytes a enviar 
001972 940e 0a4f 	CALL			ENVIARTEXTO_2	
                 
                 
001974 ed04      	LDI				R16, 212			; 11000000 escribir en linea 4
001975 940e 0561 	CALL			ENVINT_2
001977 e0d1      	LDI				YH, HIGH (TEXTO_LCD2_4)	; POSICION ALTA DEL TAXTO EN RAM 080
001978 e3cc      	LDI				YL, LOW  (TEXTO_LCD2_4)	; direccion BAJA DEL TEXTO EN RAM      	
001979 e114        	LDI				R17,20   			; bytes a enviar 
00197a 940e 0a4f 	CALL			ENVIARTEXTO_2	
00197c 9508      	RET
                 
                 
                 
                 
                 PANTALLA2_B:		; LINEA1 POSICION EN RAM 0X150
                 
00197d e800      	LDI				R16, 128			; 11000000 escribir en linea 1 
00197e 940e 0561 	CALL			ENVINT_2
001980 e0d1      	LDI				YH, HIGH (TEXTO_LCD2_5)	; POSICION ALTA DEL TAXTO EN RAM 080
001981 e5c0      	LDI				YL, LOW  (TEXTO_LCD2_5)	; direccion BAJA DEL TEXTO EN RAM      	
001982 e114        	LDI				R17,20   			; bytes a enviar 
001983 940e 0a4f 	CALL			ENVIARTEXTO_2	
                 
                 
001985 ec00      	LDI				R16, 192			; 11000000 escribir en linea 2
001986 940e 0561 	CALL			ENVINT_2
001988 e0d1      	LDI				YH, HIGH (TEXTO_LCD2_6)	; POSICION ALTA DEL TAXTO EN RAM 080
001989 e6c4      	LDI				YL, LOW  (TEXTO_LCD2_6)	; direccion BAJA DEL TEXTO EN RAM      	
00198a e114        	LDI				R17,20   			; bytes a enviar 
00198b 940e 0a4f 	CALL			ENVIARTEXTO_2	
                 
                 
00198d e904      	LDI				R16, 148			; 11000000 escribir en linea 3
00198e 940e 0561 	CALL			ENVINT_2
001990 e0d1      	LDI				YH, HIGH (TEXTO_LCD2_7)	; POSICION ALTA DEL TAXTO EN RAM 080
001991 e7c8      	LDI				YL, LOW  (TEXTO_LCD2_7)	; direccion BAJA DEL TEXTO EN RAM      	
001992 e114        	LDI				R17,20   			; bytes a enviar 
001993 940e 0a4f 	CALL			ENVIARTEXTO_2	
                 
                 ; PRESENTA LOS VALORES DE PH REDOX Y CLORO
001995 9180 0201 	LDS				R24, RAMP_PH
001997 940e 0590 	CALL			RADC
001999 9210 018e 	STS				$18E, R1
00199b 9220 018f 	STS				$18F, R2
00199d 9230 0191 	STS				$191, R3
00199f 9180 0207 	LDS				R24, RAMP_CL
0019a1 940e 0590 	CALL			RADC
0019a3 9220 019d 	STS				$19D, R2
0019a5 9230 019f 	STS				$19F, R3
0019a7 9180 020a 	LDS				R24, RAMP_RD
0019a9 940e 05b1 	CALL			RADC5I
0019ab 9210 0196 	STS				$196, R1
0019ad 9220 0197 	STS				$197, R2
0019af 9230 0198 	STS				$198, R3
                 
0019b1 ed04      	LDI				R16, 212			; 11000000 escribir en linea 4
0019b2 940e 0561 	CALL			ENVINT_2
0019b4 e0d1      	LDI				YH, HIGH (TEXTO_LCD2_8)	; POSICION ALTA DEL TAXTO EN RAM 080
0019b5 e8cc      	LDI				YL, LOW  (TEXTO_LCD2_8)	; direccion BAJA DEL TEXTO EN RAM      	
0019b6 e114        	LDI				R17,20   			; bytes a enviar 
0019b7 940e 0a4f 	CALL			ENVIARTEXTO_2	
0019b9 9508      	RET
                 
                 
                 PANTALLA2_C:		; LINEA1 POSICION EN RAM 0X1A0
                 
0019ba e800      	LDI				R16, 128			; 11000000 escribir en linea 1 
0019bb 940e 0561 	CALL			ENVINT_2
0019bd e0d1      	LDI				YH, HIGH (TEXTO_LCD2_9)	; POSICION ALTA DEL TAXTO EN RAM 080
0019be eac0      	LDI				YL, LOW  (TEXTO_LCD2_9)	; direccion BAJA DEL TEXTO EN RAM      	
0019bf e114        	LDI				R17,20   			; bytes a enviar 
0019c0 940e 0a4f 	CALL			ENVIARTEXTO_2	
                 
                 
0019c2 ec00      	LDI				R16, 192			; 11000000 escribir en linea 2
0019c3 940e 0561 	CALL			ENVINT_2
0019c5 e0d1      	LDI				YH, HIGH (TEXTO_LCD2_10)	; POSICION ALTA DEL TAXTO EN RAM 080
0019c6 ebc4      	LDI				YL, LOW  (TEXTO_LCD2_10)	; direccion BAJA DEL TEXTO EN RAM      	
0019c7 e114        	LDI				R17,20   			; bytes a enviar 
0019c8 940e 0a4f 	CALL			ENVIARTEXTO_2	
                 
                 
0019ca e904      	LDI				R16, 148			; 11000000 escribir en linea 3
0019cb 940e 0561 	CALL			ENVINT_2
0019cd e0d1      	LDI				YH, HIGH (TEXTO_LCD2_11)	; POSICION ALTA DEL TAXTO EN RAM 080
0019ce ecc8      	LDI				YL, LOW  (TEXTO_LCD2_11)	; direccion BAJA DEL TEXTO EN RAM      	
0019cf e114        	LDI				R17,20   			; bytes a enviar 
0019d0 940e 0a4f 	CALL			ENVIARTEXTO_2	
                 
                 
0019d2 ed04      	LDI				R16, 212			; 11000000 escribir en linea 4
0019d3 940e 0561 	CALL			ENVINT_2
0019d5 e0d1      	LDI				YH, HIGH (TEXTO_LCD2_12)	; POSICION ALTA DEL TAXTO EN RAM 080
0019d6 edcc      	LDI				YL, LOW  (TEXTO_LCD2_12)	; direccion BAJA DEL TEXTO EN RAM      	
0019d7 e114        	LDI				R17,20   			; bytes a enviar 
0019d8 940e 0a4f 	CALL			ENVIARTEXTO_2	
0019da 9508      	RET
                 
                 PANTALLA2_D:  ;BORRAR LINEA 
                 ; EN R16 INICIO DE LINEA 128-192-148- 0-210
0019db 940e 0561 	CALL			ENVINT_2
0019dd e0d1      	LDI				YH, HIGH (TEXTO_LCD2_12)	; POSICION ALTA DEL TAXTO EN RAM 080
0019de edcc      	LDI				YL, LOW  (TEXTO_LCD2_12)	; direccion BAJA DEL TEXTO EN RAM      	
0019df e114        	LDI				R17,20   			; bytes a enviar 
0019e0 940e 0a4f 	CALL			ENVIARTEXTO_2	
0019e2 9508      	RET
                 	
                 ;.INCLUDE "P_GRAFICO.ASM"
                 ;.INCLUDE "TEXTO_LCD.ASM"
                 .INCLUDE "DESGASTE_ELECTRODO.ASM"
                 
                 ; PRIMERO MULTIPLICAR POR 3
                 ; SEGUNDO MLTIPLICAR POR . 3/DETERIORO  Y DIVIDIR 256 ENTRE EL RESULTADO UNA CHAPUZA
                 ; RESULTADO EN R16
                 ; GRABA EL RESULTADO EN EEPRON POSICION 9C
                 ;					VALOR DE R18
                 ; 0-1 DESGASTE 		NO FUNCIONA
                 ; 1-2 DESGASTE 3 	VALOR 255
                 ; 2-3 DESGASTE 2,5 	VALOR 214
                 ; 3-4 DESGASTE 2	VALOR 171
                 ; 4-5 DESGASTE 1,5	VALOR 128
                 ; 5-6 DESGASTE 1	VALOR 86
                 ; <-6 DESGASTE 1	VALOR 86
                 ; EL RESULTADO EN R1
                 
                 DES_ELECTRODO:							;0-1
0019e3 27bb      CLR XH
0019e4 e510      	LDI				R17,REG_REJILLA			; POSICION DE MEMORIA A LEER EN EEPROM 050
0019e5 940e 057e 	CALL			EEPROM_RW				; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
0019e7 2fc2      	MOV				YL,R18					; RESULTADO EN R18 Y LO PASA A YL VALOR BAJO
0019e8 e088      	LDI				R24,8					; INCREMENTA EL VALOR PARA LEER LA POSICION ALTA
0019e9 0f18      	ADD				R17,R24
0019ea 940e 057e 	CALL			EEPROM_RW				; LEE LA EEPROM POSICION ALTA
0019ec 2fd2      	MOV				YH,R18					; Y LO PASA A YH VAL0R ALTO
0019ed fdc7      	SBRC			YL,7					; VERIFICA EL BIT 7 SI EL REGISTRO TIENE UN VALOR SUPERIOR A 125
0019ee 95d3      	INC				YH						; SI ES MAYOR INCREMENTA EL REGISTRO ALTO
                 ;LDI YH,00
0019ef ef2f      	LDI				R18,255					; POR 3
0019f0 940e 1a4f 	CALL			DES_ELECTRODO_A
                 
0019f2 e511      	LDI				R17,REG_REJILLA	+ 1		;1 - 2  "255"
0019f3 940e 057e 	CALL			EEPROM_RW				; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
0019f5 2fc2      	MOV				YL,R18					; RESULTADO EN R18 Y LO PASA A YL VALOR BAJO
0019f6 e088      	LDI				R24,8					; INCREMENTA EL VALOR PARA LEER LA POSICION ALTA
0019f7 0f18      	ADD				R17,R24
0019f8 940e 057e 	CALL			EEPROM_RW				; LEE LA EEPROM POSICION ALTA
0019fa 2fd2      	MOV				YH,R18					; Y LO PASA A YH VAL0R ALTO
0019fb fdc7      	SBRC			YL,7					; VERIFICA EL BIT 7 SI EL REGISTRO TIENE UN VALOR SUPERIOR A 125
0019fc 95d3      	INC				YH						; SI ES MAYOR INCREMENTA EL REGISTRO ALTO
                 ;LDI YH,00
0019fd ef2f      	LDI				R18,255					; POR 3
0019fe 940e 1a4f 	CALL			DES_ELECTRODO_A
                 
001a00 e512      	LDI				R17,REG_REJILLA	+ 2		;2 - 3
001a01 940e 057e 	CALL			EEPROM_RW				; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
001a03 2fc2      	MOV				YL,R18					; RESULTADO EN R18 Y LO PASA A YL VALOR BAJO
001a04 e088      	LDI				R24,8					; INCREMENTA EL VALOR PARA LEER LA POSICION ALTA
001a05 0f18      	ADD				R17,R24
001a06 940e 057e 	CALL			EEPROM_RW				; LEE LA EEPROM POSICION ALTA
001a08 2fd2      	MOV				YH,R18					; Y LO PASA A YH VAL0R ALTO
001a09 fdc7      	SBRC			YL,7					; VERIFICA EL BIT 7 SI EL REGISTRO TIENE UN VALOR SUPERIOR A 125
001a0a 95d3      	INC				YH						; SI ES MAYOR INCREMENTA EL REGISTRO ALTO
                 ;LDI YH, 20
001a0b ed26      	LDI				R18,214					; POR 2,5
001a0c 940e 1a4f 	CALL			DES_ELECTRODO_A
                 
001a0e e513      	LDI				R17,REG_REJILLA	+ 3		;3 - 4
001a0f 940e 057e 	CALL			EEPROM_RW				; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
001a11 2fc2      	MOV				YL,R18					; RESULTADO EN R18 Y LO PASA A YL VALOR BAJO
001a12 e088      	LDI				R24,8					; INCREMENTA EL VALOR PARA LEER LA POSICION ALTA
001a13 0f18      	ADD				R17,R24
001a14 940e 057e 	CALL			EEPROM_RW				; LEE LA EEPROM POSICION ALTA
001a16 2fd2      	MOV				YH,R18					; Y LO PASA A YH VAL0R ALTO
001a17 fdc7      	SBRC			YL,7					; VERIFICA EL BIT 7 SI EL REGISTRO TIENE UN VALOR SUPERIOR A 125
001a18 95d3      	INC				YH						; SI ES MAYOR INCREMENTA EL REGISTRO ALTO
                 ;LDI YH,0
001a19 ea2b      	LDI				R18,171					; POR 2
001a1a 940e 1a4f 	CALL			DES_ELECTRODO_A
                 
001a1c e514      	LDI				R17,REG_REJILLA	+ 4		;4 - 5
001a1d 940e 057e 	CALL			EEPROM_RW				; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
001a1f 2fc2      	MOV				YL,R18					; RESULTADO EN R18 Y LO PASA A YL VALOR BAJO
001a20 e088      	LDI				R24,8					; INCREMENTA EL VALOR PARA LEER LA POSICION ALTA
001a21 0f18      	ADD				R17,R24
001a22 940e 057e 	CALL			EEPROM_RW				; LEE LA EEPROM POSICION ALTA
001a24 2fd2      	MOV				YH,R18					; Y LO PASA A YH VAL0R ALTO
001a25 fdc7      	SBRC			YL,7					; VERIFICA EL BIT 7 SI EL REGISTRO TIENE UN VALOR SUPERIOR A 125
001a26 95d3      	INC				YH						; SI ES MAYOR INCREMENTA EL REGISTRO ALTO
                 ;LDI YH, 00
001a27 e820      	LDI				R18,128					; POR 1,5
001a28 940e 1a4f 	CALL			DES_ELECTRODO_A
                 
001a2a e515      	LDI				R17,REG_REJILLA	+ 5		; 5 -6 				;
001a2b 940e 057e 	CALL			EEPROM_RW				; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
001a2d 2fc2      	MOV				YL,R18					; RESULTADO EN R18 Y LO PASA A YL VALOR BAJO
001a2e e088      	LDI				R24,8					; INCREMENTA EL VALOR PARA LEER LA POSICION ALTA
001a2f 0f18      	ADD				R17,R24
001a30 940e 057e 	CALL			EEPROM_RW				; LEE LA EEPROM POSICION ALTA
001a32 2fd2      	MOV				YH,R18					; Y LO PASA A YH VAL0R ALTO
001a33 fdc7      	SBRC			YL,7					; VERIFICA EL BIT 7 SI EL REGISTRO TIENE UN VALOR SUPERIOR A 125
001a34 95d3      	INC				YH						; SI ES MAYOR INCREMENTA EL REGISTRO ALTO
                 ;LDI YH,00
001a35 e526      	LDI				R18,86					; por 1
001a36 940e 1a4f 	CALL			DES_ELECTRODO_A
                 
                 
001a38 e516      	LDI				R17,REG_REJILLA	+ 6		; MAS DE 6
001a39 940e 057e 	CALL			EEPROM_RW				; RUTINA LECTURA EEPROM DEVUELVE EL VALOR EN R18
001a3b 2fc2      	MOV				YL,R18					; RESULTADO EN R18 Y LO PASA A YL VALOR BAJO
001a3c e088      	LDI				R24,8					; INCREMENTA EL VALOR PARA LEER LA POSICION ALTA
001a3d 0f18      	ADD				R17,R24
001a3e 940e 057e 	CALL			EEPROM_RW				; LEE LA EEPROM POSICION ALTA
001a40 2fd2      	MOV				YH,R18					; Y LO PASA A YH VAL0R ALTO
001a41 fdc7      	SBRC			YL,7					; VERIFICA EL BIT 7 SI EL REGISTRO TIENE UN VALOR SUPERIOR A 125
001a42 95d3      	INC				YH						; SI ES MAYOR INCREMENTA EL REGISTRO ALTO
                 ;LDI YH,00
001a43 e526      	LDI				R18,86					; por 1
001a44 940e 1a4f 	CALL			DES_ELECTRODO_A
                 
                 
                 
001a46 93b0 0403 STS $403,XH		; posicion de almacenamiento en ram
001a48 e91b      ldi r17,des_elect	; posicion en eeprom 9b
001a49 2f2b      mov r18,XH
                 
001a4a 940e 0587 call eeprom_es
                 
001a4c 940e 1a58 CALL	CAL_DESGASTE
                 
001a4e 9508      	RET
                 
                 
                 DES_ELECTRODO_A:
001a4f 3fdf      cpi yh,255				; COMPARA CON FF SI ES DISTINTO
001a50 f409      brne DES_ELECTRODO_B	; VA A DES_ELECTRODO_B
001a51 9508      ret						; SI ES IGUAL NO CUENTA RETORNA
                 
                 
                 DES_ELECTRODO_B:
                 ; PRIMERO MULTIPLICA POR 3
001a52 2f3d      	MOV R19,YH
001a53 0fdd      	LSL YH
001a54 0fd3      	ADD YH,R19
                 ; AQUI DIVIDE POR ALGO VER VALOR DE R18 EN LA TABLA SUPERIOR SEGUN LA SAL .RESULTADO EN R1
001a55 9fd2      	MUL YH,R18
                 ; SUMA EL RESULTADO A R24 DA LAS HORAS SEGUN DESGASTE 
001a56 0db1      	ADD XH,R1
001a57 9508      	RET
                 
                 ; CALCULA EL % DE DESGASTE
                 CAL_DESGASTE:
001a58 e2a1      	LDI				XL,33		; 33X3=99%
001a59 1bab      	SUB				XL,XH		; LE RESTA 33 QUE SERIA EL 99%
001a5a e0a3      	LDI				XL,3		; MULTIPLICA POR 3
001a5b 9fba      	MUL				XH,XL
001a5c e624      LDI R18,100
001a5d 1920      SUB R18,R0
001a5e 3625      CPI R18,101			; PARA CUANDO HAY DESBORDAMIENTO PONE R18 A 00 SI NO NO
001a5f f008      BRLO			CAL_DESGASTE_1	; SALTA SI ES MENOR
001a60 e020      LDI			R18,00
                 CAL_DESGASTE_1:					; SALTA SI ES MENOR
001a61 e91c      ldi r17,des_elect + 1	; posicion en eeprom 9C
001a62 940e 0587 call eeprom_es			; ESCRIBE EN EEPRON EL PORCENTAJE DE DESGASTE
                 
                 ; PRESENTA EN PANTALLA 20X4 LINEA 4 EL DESGASTE Y EN LA RUTINA PROGRAMACION DE CICLOS
001a64 2f82      MOV R24, R18
001a65 940e 0590 CALL RADC
                 ;STS $220,R1
001a67 9210 07a0 STS $7A0,R1
                 ;STS $221,R2
001a69 9220 07a1 STS $7A1,R2
                 ;STS $222,R3
001a6b 9230 07a2 STS $7A2,R3
                 ;	LDI				R16,227			; 11000000 escribir en linea 4 linea (192)( linea 4 seria 212)
                 ;	CALL			ENVINT
                 ;	LDI				YH,HIGH(PRUEBA_2)	; POSICION ALTA DEL TAXTO EN RAM 220
                 ;	LDI				YL,LOW (PRUEBA_2)	; direccion BAJA DEL TEXTO EN RAM      	
                  ; 	LDI				R17,3   			; bytes a enviar 
                 ;	CALL			ENVIARTEXTO			; RUTINA PARA ENVIAR TEXTO E PANRALLA
                 
                 
                 		
001a6d 9508      RET
                 .INCLUDE "SCR.ASM"
                 
                 
                 SCR:			;RUTINA DE CONTROL
001a6e ed04      	LDI				R16,212				; 11000000 escribir en linea 2 linea (192)( linea 4 seria 212)
001a6f 940e 053e 	CALL			ENVINT
001a71 e0d7      	LDI				YH,HIGH(SCR_LIN)	; POSICION ALTA DEL TAXTO EN RAM
001a72 eac9      	LDI				YL,LOW (SCR_LIN)+5	; direccion BAJA DEL TEXTO EN RAM      	
001a73 0fc7       	ADD				YL,LEC_REL
001a74 e114        	LDI				R17,20 				; bytes a enviar 
001a75 940e 0925 	CALL			ENVIARTEXTO			; RUTINA PARA ENVIAR TEXTO A PANTALLA
001a77 9508      	RET
                 ;       20x4        16x4   tipo de display
                 ; linea 1-128 		128 
                 ; linea 2-192		192
                 ; linea 3-148		144
                 ; linea 4-212		208
                 .INCLUDE "BORRAR_EEPROM.ASM" ; RUTINA A ELIMINAR BORRA LA EPROM INTERNA DEL MICRO
                 
                 BORRA_EEPROM:
001a78 ef2f      LDI R18,255				; VALOR A GRABAR FF
001a79 ef1f      LDI R17,255
                 
                 BORRA_EEPROM_1:
                 
001a7a 940e 0587 CALL EEPROM_ES
001a7c 951a      DEC R17
001a7d f7e1      BRNE BORRA_EEPROM_1
                 
001a7e 9508      RET
                 ;       20x4        16x4   tipo de display
                 ; linea 1-128 		128 
                 ; linea 2-192		192
                 ; linea 3-148		144
                 ; linea 4-212		208
                 BORRAR_PANTALLA:
001a7f e800      	LDI				R16,128			; BORRAR LINEA 1
001a80 940e 053e 	CALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION
001a82 e0d7      	LDI				YH,HIGH(BORRAR_LINEA)	; POSICION ALTA DEL TAXTO EN RAM 7A4
001a83 eac4      	LDI				YL,LOW (BORRAR_LINEA)	; direccion BAJA DEL TEXTO EN RAM
001a84 e114        	LDI				R17,20   			; bytes a enviar 
001a85 940e 0925 	CALL			ENVIARTEXTO	
001a87 ec00      	LDI				R16,192			; BORRAR LINEA 2
001a88 940e 053e 	CALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION
001a8a e0d7      	LDI				YH,HIGH(BORRAR_LINEA)	; POSICION ALTA DEL TAXTO EN RAM 7A4
001a8b eac4      	LDI				YL,LOW (BORRAR_LINEA)	; direccion BAJA DEL TEXTO EN RAM
001a8c e114        	LDI				R17,20   			; bytes a enviar 
001a8d 940e 0925 	CALL			ENVIARTEXTO	
001a8f e904      	LDI				R16,148			; BORRAR LINEA 3
001a90 940e 053e 	CALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION
001a92 e0d7      	LDI				YH,HIGH(BORRAR_LINEA)	; POSICION ALTA DEL TAXTO EN RAM 7A4
001a93 eac4      	LDI				YL,LOW (BORRAR_LINEA)	; direccion BAJA DEL TEXTO EN RAM 	
001a94 e114        	LDI				R17,20   			; bytes a enviar 
001a95 940e 0925 	CALL			ENVIARTEXTO	
                 borra_linea_4:
001a97 ed04      	LDI				R16,212			; BORRAR LINEA 4
001a98 940e 053e 	CALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION
001a9a e0d7      	LDI				YH,HIGH(BORRAR_LINEA)	; POSICION ALTA DEL TAXTO EN RAM 7A4
001a9b eac4      	LDI				YL,LOW (BORRAR_LINEA)	; direccion BAJA DEL TEXTO EN RAM
001a9c e114        	LDI				R17,20   			; bytes a enviar 
001a9d 940e 0925 	CALL			ENVIARTEXTO	
001a9f 9508      	RET
                 .INCLUDE "UART0.ASM"
                 
                 ;  EN LA RUTINA P_NEXTION_RS0 ENVIA A PANTALLA NEXTION TODO
                 
                 ; RUTINA PARA LA TRANSMISION DE DATOS A TRAVES DE LA UART
                 ; CONFIGURAR A 9600 EN UBRRH Y UBRRL VALORES 00 Y 51
                 
                 ;	fOSC
                 ;UBRR= _________ - 1  EJEMPLO UBRR =(8.000.000 /16X 9600) -1  ESTO DA 51
                 ;	16 BAUD
                 ; TABLA DE VALORES Y ERRORES PAG 168 Y SIGUIENTES
                 
                 
                 UART_INI0:  			;BAUDIOS A 9600
001aa0 e090      		LDI			R25, 00
001aa1 9390 0090 		STS			UBRR0H, R25
001aa3 e394      		LDI			R25, 52
001aa4 b999      		OUT			UBRR0L, R25
                 
                 
                 ;						UCSRnA
                 ;		Bit 7 	6 	5 		4 	3 	2 	1 	0
                 ;			RXC	TXC	UDRE	FE	DOR PE 	U2X MPCM
                 
                 ; CONFIGURAR 8 BIT 1 STOP NO PARIDAD Y ASINCRONO EN UCSRB
                 ;BIT 7 RXC: Recepción completa del USART.
                 ;BIT 6 TXC: Transmisión completa del USART.
                 ;BIT 5 UDRE: Registro de datos vacío del USART.
                 ;BIT 4 FE: Error de frame.
                 ;BIT 3 DOR: Datos sobre-escritos.
                 ;BIT 2 PE: Error de paridad.
                 ;BIT 1 U2X: Velocidad de transmisión doble.
                 ;BIT 0 MPCM: Modo de comunicación multiprocesador.
                 
001aa5 e090      		LDI			R25, 00
001aa6 b99b      		OUT			UCSR0A, R25
                 
                 
                 ;							UCSRnB:
                 ;		Bit 	7 	6 	5 	4 	3 	2 	1 	0
                 ;			RXCIE 	TXCIE 	UDRIE 	RXEN 	TXEN 	UCSZ2 	RXB8 	TXB8
                 ;RXCIE: Habilitación de interrupción de RX Completa.
                 ;TXCIE: Habilitación de interrupción de TX Completa.
                 ;UDRIE: Habilitación de interrupción de Registro de Datos Vacío del USART.
                 ;RXEN: Habilitación de Receptor.
                 ;TXEN: Habilitación de Transmisor.
                 ;UCSZ2: Tamaño del carácter. 0 8 BIT, 1 9 BIT
                 ;RXB8: Bit 8 de datos de Recepción (En el caso que haya sido configurado a 8 bits).
                 ;TXB8: Bit 8 de datos de Transmisión (En el caso que haya sido configurado a 8 bits).
                 
001aa7 e998      		LDI			R25,(1<<RXEN0)|(1<<TXEN0)|(1<<RXCIE0); ACTIVAR TRANSMISION Y RECEPCION E INTERRUPCION
001aa8 b99a      		OUT			UCSR0B, R25
                 
                 ;UCSRnC:
                 ;		Bit 	7 	6 	5 	4 	3 	2 	1 	0
                 ;			URSEL 	UMSEL 	UPM1 	UPM0 	USBS 	UCSZ1 	UCSZ0 	UCPOL
                 
                 ;URSEL: Registro de Selección. Con 1 se escribe en UCSRC y con 0 en UBRRH (UCSRC y UBRRH tienen la misma dirección).
                 ;UMSEL: Selección del moodo USART, 1 síncrona y 0 asíncrona.
                 ;UPM1:0. Modo de paridad.
                 ;USBS: Selección del bit de Stop, 1 dos bits y 0 un bit.
                 ;Seleccionando tamaño del carácter:
                 ;UCPOL: Polaridad del reloj (Obviamente solo en modo síncrono), 1 flanco ascendente y 0 flanco descendente.
                 
                 ;		LDI			R25, 0b00000110		; modo asincrono sin bit de paridad y 1 bit de parada
001aa9 e096      		LDI			R25,(0<<USBS0)|(3<<UCSZ00)
001aaa 9390 0095 		STS			UCSR0C, R25
001aac d046      		RCALL		UART_TXC1			; VERIFICA SI ESTA OCUPADO EL PUERTO UART
001aad 9508      		RET
                 
                 DATOS_RS232_0:			; ALMCENA LOS DATOS VALIDOS EN RAM
                 
001aae 3721      		CPI			R18,113			; COMPRUEBA SI ES EL CARACTER 0x71 113 EN DECIMAL LO GRABA EN 0xC01
001aaf f439      		BRNE		DATOS_RS232_0_A	; SI ES DISTINTO VA A DATOS_RS232_1_A
001ab0 e0dc      		LDI			YH,0x0C			; CARGA EL BIT ALTO
001ab1 e0c1      		LDI			YL,0x01			; CARGA EL BIT BAJO CON EL VALOR GRABADO EN RAM
001ab2 8328      		ST			Y,R18			; GRABA EN RAM EL VALOR DE R18
001ab3 95c3      		INC			YL				; INCREMENTA EL VALOR CON LA NUEVA POSICION A GRABAR EN RAM
001ab4 93c0 0c00 		STS			0xC00,YL
001ab6 9508      		RET
                 
                 DATOS_RS232_0_A:		; COMPRUEBA SI ES FF CARACTER FINAL ENVIADO POR NEXTION
001ab7 3f2f      		CPI			R18,0xFF		; 
001ab8 f421      		BRNE		DATOS_RS232_0_B	; SI ES DISTINTO GRABA EL VALOR RECIBIDO
001ab9 27cc      		CLR			YL				; PONE A CERO INICIO LA POSICION DE GRABADO EN RAM
001aba 93c0 0c00 		STS			0xC00,YL
001abc 9508      		RET
                 
                 DATOS_RS232_0_B:		; CARACTER VALIDO LO GRABA EN RAM		********* LO GRABA EN 0xC02 o 0XC03 ********
001abd e0dc      		LDI			YH,0x0C			; CARGA EL BIT ALTO
001abe 91c0 0c00 		LDS			YL,0xC00		; CARGA EL BIT BAJO CON EL VALOR GRABADO EN RAM
001ac0 8328      		ST			Y,R18			; GRABA EN RAM EL VALOR DE R18
001ac1 95c3      		INC			YL				; INCREMENTAEL VALOR CON LA NUEVA POSICION A GRABAR EN RAM
001ac2 93c0 0c00 		STS			0xC00,YL
001ac4 9508      		RET
                 
                 
                 
                 BIT_REC_0:							; SALVA LOS REGISTROS
001ac5 0000      		NOP
001ac6 930f      		PUSH		R16
001ac7 931f      		PUSH		R17
001ac8 932f      		PUSH		R18
001ac9 933f      		PUSH		R19
001aca 938f      		PUSH		R24
001acb b70f      		IN			R16,SREG		; SALVA EL REGISTRO DE ESTADO
001acc 930f      		PUSH		R16
                 
                 ;				***********************			ESPERA A RECIBIR EL  DATO	****************************
                 BIT_REC_01:
001acd 9b5f      		SBIS		UCSR0A,RXC0
001ace cffe      		RJMP		BIT_REC_01		; ESPERA A RECIBIR EL VALOR
001acf b12c      		IN			R18,UDR0
001ad0 940e 1aae 		CALL		DATOS_RS232_0	; RUTINA CONTROL DE DATOS A GRABAR EN RAM 0xC01 0xC02 0xC03
                 
001ad2 910f      		POP			R16
001ad3 bf0f      		OUT			SREG,R16
001ad4 918f      		POP			R24
001ad5 913f      		POP			R19
001ad6 912f      		POP			R18
001ad7 911f      		POP			R17
001ad8 910f      		POP			R16
001ad9 e090      		LDI			R25, 00
001ada 9390 000b 		STS			UCSR0A, R25
001adc 940e 1d97 CALL DATO_ASCI
001ade 9508      		RET
                 
                 ;******************************************  TERMINA RECEPCION DEL PUERTO SERIE POR INTERRUPCION  **********************
                 
                 
                 UART_TXC_FLASH:
                 ; ENVIAR TEXTO DE FLASH
001adf e5ff          	LDI   		ZH,high(TEXTO*5)	; direccion alta del TEXTO en Flash
001ae0 e0e0      		LDI   		ZL,low(TEXTO*5) 	; direccion baja del TEXTO en Flash 
001ae1 e104      		LDI   		R16,20     		; longitud de texto a TRANSMITIR
001ae2 e011      		LDI			R17, 1			; NUMERO DE LINEAS A ENVIAR
                 UART_TXC:
001ae3 95c8      		LPM      				; leemos TEXTO de FLASH y lo almacena en R0
001ae4 9631      		ADIW  		ZL,1   			; apuntamos al siguiente elemento 
001ae5 b80c      		OUT 		UDR0,R0			; pone el valor de dato en el registro de transmision
001ae6 d00c      		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
001ae7 950a      		DEC   		R16      		; Hemos terminado..?? 
001ae8 f7d1      		BRNE  		UART_TXC  		; NO...seguimos cargando 
                 ; ENVIAR RETARNO DE CARRO Y LINEA NUEVA
001ae9 e00a      		LDI			R16, 10			; AQUI ENVIA UN RETARNO DE CARRO NUEVA LINEA
001aea b90c      		OUT			UDR0, R16
001aeb d007      		RCALL		UART_TXC1
001aec e00d      		LDI			R16, 13			; AQUI ENVIA UN RETARNO DE CARRO NUEVA LINEA
001aed b90c      		OUT			UDR0, R16
001aee d004      		RCALL		UART_TXC1
001aef e100      		LDI			R16,16
001af0 951a      		DEC   		R17      		; Hemos terminado..?? 
001af1 f789      		BRNE  		UART_TXC  		; NO...seguimos cargando 
001af2 9508      		RET
                         
                 UART_TXC1:  ; Rutina verificacion del termino en al envio de un bit BUFER VACIO
001af3 9b5d      		SBIS		UCSR0A,UDRE0	; VERIFICA EL ENVIO DE LOS BITS BUFER VACIO
001af4 cffe      		RJMP		UART_TXC1		; EN CUYO CASO SALTA ESTA INSTRUCION
001af5 9508      		RET
                 
                 ; ENVIAR TEXTO DE RAM: ANTES INDICAR DIRECION A LEER EN RAM (YH,high  E  YL,low)
                 UART_TXC_RAM:
001af6 e104      		LDI   		R16,20     		; longitud de texto a TRANSMITIR
001af7 dffb      		RCALL		UART_TXC1		; VERIFICA SI ESTA OCUPADO EL PUERTO UART
001af8 e011      		LDI			R17,1			; NUMERO DE LINEAS A ENVIAR
                 UART_TXC_RAM_1A:
001af9 9009          	LD			R0,Y+
001afa b80c      		OUT 		UDR0,R0			; pone el valor de dato en el registro de transmision
001afb dff7      		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
001afc 950a      		DEC   		R16      		; Hemos terminado..?? 
001afd f7d9      		BRNE  		UART_TXC_RAM_1A	; NO...seguimos cargando 
                 ; ENVIAR RETARNO DE CARRO Y LINEA NUEVA
001afe e00a      		LDI			R16,10			; AQUI ENVIA UN SALTO DE LINEA NUEVA LINEA
001aff b90c      		OUT			UDR0,R16
001b00 dff2      		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
001b01 e00d      		LDI			R16,13			; AQUI ENVIA UN RETORNO DE CARRO NUEVA LINEA
001b02 b90c      		OUT			UDR0,R16
001b03 dfef      		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
001b04 e104      		LDI			R16,20
001b05 951a      		DEC   		R17      		; Hemos terminado..?? 
001b06 f791      		BRNE  		UART_TXC_RAM_1A	; NO...seguimos cargando 
001b07 9508      		RET
                 ; ENVIAR SOLO UN DATO AL PUERTO UAR VALOR A ENVIAR EN R16
                 ;UART_TXC_1:
001b08 930f      PUSH		R16
001b09 b90c      		OUT 		UDR0,R16		; pone el valor de dato en el registro de transmision
001b0a dfe8      		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO	
001b0b 910f      POP			R16
001b0c 9508      		RET
                 
                 
                 ;ENVIAR UN BIT POR SEGUNDO
                 BIT_SEG:
001b0d e23f      		LDI			R19,47
                 BIT_SEG_A:
001b0e 9533      		INC			R19
001b0f b93c      		OUT			UDR0,R19
001b10 dfe2      		RCALL		UART_TXC1
                 
                 ; MANDA SEÑAL CONTROL DE INSTRUCION ESCRIBIR LINEA1 CODIGO 128
                 
001b11 e800      	LDI				R16,128				; ESCRIBIR LINEA 1 MODELO DEL EQUIPO
                 ;	CALL			ENVINT				; En subrrutina Env_doi Envia instrucion para escribir en linea 1
001b12 940e 055a 	CALL 			R_BUSY
001b14 98ad      	CBI   			PORTC, lcd_rs		; en instruccion a 0
001b15 9aae      	SBI   			PORTC, lcd_e		; activa enable
001b16 bb0b      	OUT   			PORTA,R16   		; ponemos el byte de TEXTO 
001b17 e590      	LDI   			R25,80      		; retardo total 230 us
001b18 940e 092a 	CALL 			RETARDO   			; 
001b1a 98ae      	CBI   			PORTC,lcd_e   		; STROBE=0 dato valido
                 
                 
                 ; MANDA EL CODIGO A PANTALLA ESCRIBIR TEXTO 
001b1b 940e 055a 	CALL 			R_BUSY
001b1d 9aad      	SBI  	 		PORTC, lcd_rs		; en datos a 1 
001b1e 2f03      	MOV				R16,R19
001b1f 9aae      	SBI  	 		PORTC, lcd_e		; activa enable
001b20 bb0b      	OUT 	  		PORTA,R16   		; ponemos el byte de TEXTO 
001b21 e590      	LDI  	 		R25,80      		; retardo total 230 us
001b22 940e 092a 	CALL 			RETARDO   			; 
001b24 98ae      	CBI  	 		PORTC,lcd_e   		; STROBE=0 dato valido
                 
                 
                 BIT_SEG_B:							; ESPERA UN SEGUNDO
001b25 feb0      		SBRS		CONTROL_1,0			; SALTA LA PROXIMA INSTRUCION SI ES UNO,
001b26 cffe      		RJMP		BIT_SEG_B
001b27 94e8      		CLT
001b28 f8b0      		BLD			CONTROL_1, 0		; PASA EL REGISTRO T A CONTROL_1
                 
001b29 cfe4      		RJMP		BIT_SEG_A
                 
                 
                 .INCLUDE "UART1.ASM"
                 
                 
                 ; RUTINA PARA LA TRANSMISION DE DATOS A TRAVES DE LA UART ENVIA LA CADENA AL LOLIN
                 ; CONFIGURAR A 9600 EN UBRRH Y UBRRL VALORES 00 Y 33
                 
                 ;		fOSC
                 ;UBRR= _________ - 1  EJEMPLO UBRR =(8.000.000 /16X 9600) -1  ESTO DA 51 PERO FUNCIONA CON 54, 47 PARA CUARZO DE 7.3728
                 ;		16 BAUD
                 ; TABLA DE VALORES Y ERRORES PAG 168 Y SIGUIENTES
                 
                 
                 ;UART_INI1:  			;BAUDIOS A 9600
001b2a e090      		LDI			R25, 00
001b2b 9390 0098 		STS			UBRR1H, R25
001b2d e394      		LDI			R25, 52
001b2e 9390 0099 		STS			UBRR1L, R25
                 
                 ;						UCSRnA
                 ;		Bit 7 	6 	5 		4 	3 	2 	1 	0
                 ;			RXC	TXC	UDRE	FE	DOR PE 	U2X MPCM
                 
                 ; CONFIGURAR 8 BIT 1 STOP NO PARIDAD Y ASINCRONO EN UCSRB
                 ;BIT 7 RXC: Recepción completa del USART.
                 ;BIT 6 TXC: Transmisión completa del USART.
                 ;BIT 5 UDRE: Registro de datos vacío del USART.
                 ;BIT 4 FE: Error de frame.
                 ;BIT 3 DOR: Datos sobre-escritos.
                 ;BIT 2 PE: Error de paridad.
                 ;BIT 1 U2X: Velocidad de transmisión doble.
                 ;BIT 0 MPCM: Modo de comunicación multiprocesador.
                 
001b30 e090      		LDI			R25, 00
001b31 9390 009b 		STS			UCSR1A, R25
                 
                 
                 ;							UCSRnB:
                 ;		Bit 	7 	6 	5 	4 	3 	2 	1 	0
                 ;			RXCIE 	TXCIE 	UDRIE 	RXEN 	TXEN 	UCSZ2 	RXB8 	TXB8
                 ;RXCIE: Habilitación de interrupción de RX Completa.
                 ;TXCIE: Habilitación de interrupción de TX Completa.
                 ;UDRIE: Habilitación de interrupción de Registro de Datos Vacío del USART.
                 ;RXEN: Habilitación de Receptor.
                 ;TXEN: Habilitación de Transmisor.
                 ;UCSZ2: Tamaño del carácter. 0 8 BIT, 1 9 BIT
                 ;RXB8: Bit 8 de datos de Recepción (En el caso que haya sido configurado a 8 bits).
                 ;TXB8: Bit 8 de datos de Transmisión (En el caso que haya sido configurado a 8 bits).
                 
001b33 e998      		LDI			R25,(1<<RXEN1)|(1<<TXEN1)|(1<<RXCIE1); ACTIVA TRANSMISION Y RECEPCION E INTERRUPCION EN RECEPCION
001b34 9390 009a 		STS			UCSR1B, R25
                 
                 ;UCSRnC:
                 ;		Bit 	7 	6 			5 		4 		3 		2 		1 		0
                 ;			URSEL 	UMSEL 	UPM1 	UPM0 	USBS 	UCSZ1 	UCSZ0 	UCPOL
                 
                 ;URSEL: Registro de Selección. Con 1 se escribe en UCSRC y con 0 en UBRRH (UCSRC y UBRRH tienen la misma dirección).
                 ;UMSEL: Selección del moodo USART, 1 síncrona y 0 asíncrona.
                 ;UPM1:0. Modo de paridad.
                 ;USBS: Selección del bit de Stop, 1 dos bits y 0 un bit.
                 ;Seleccionando tamaño del carácter:
                 ;UCPOL: Polaridad del reloj (Obviamente solo en modo síncrono), 1 flanco ascendente y 0 flanco descendente.
                 
001b36 e096      		LDI			R25, 0b00000110		; modo asincrono sin bit de paridad y 1 bit de parada
                 ;		LDI			R25,(0<<USBS1)|(1<<UCSZ01)
001b37 9390 009d 		STS			UCSR1C, R25
001b39 d052      		RCALL		UART_TXC2			; VERIFICA SI ESTA OCUPADO EL PUERTO UART
001b3a 9508      		RET
                 ; 	TERMINA INICIALIZACION UART1********************************************************************************************
                 
                 ; 	ALAMCENA LOS DATOS RECIBIDOS EN RAM************************************************************************************
                 
                 DATOS_RS232_1:
                 
                 
                 
001b3b 3721      		CPI			R18,113			; COMPRUEBA SI ES EL CARACTER 0x71 113 EN DECIMAL LO GRABA EN 0xC01
                 ;		CPI			R18,35			; COMPRUEBA SI ES EL CARACTER 0x23 35 EN DECIMAL LO GRABA EN 0xC01 ALMOHADILLA ######
001b3c f469      		BRNE		DATOS_RS232_1_B	; SI ES DISTINTO VA A DATOS_RS232_1_A
001b3d e0dc      		LDI			YH,0x0C			; CARGA EL BIT ALTO
001b3e e0c1      		LDI			YL,0x01			; CARGA EL BIT BAJO CON EL VALOR GRABADO EN RAM
001b3f 8328      		ST			Y,R18			; GRABA EN RAM EL VALOR DE R18
001b40 95c3      		INC			YL				; INCREMENTA EL VALOR CON LA NUEVA POSICION A GRABAR EN RAM
001b41 93c0 0c00 		STS			0xC00,YL
001b43 9508      		RET
                 
                 DATOS_RS232_1_A:		; COMPRUEBA SI ES FF CARACTER FINAL ENVIADO POR NEXTION
001b44 3f2f      		CPI			R18,0xFF		; 
001b45 f421      		BRNE		DATOS_RS232_1_B	; SI ES DISTINTO GRABA EL VALOR RECIBIDO
001b46 27cc      		CLR			YL				; PONE A CERO INICIO LA POSICION DE GRABADO EN RAM
001b47 93c0 0c00 		STS			0xC00,YL
001b49 9508      		RET
                 
                 DATOS_RS232_1_B:		; CARACTER VALIDO LO GRABA EN RAM		********* LO GRABA EN 0xC02 o 0XC03 ********
                 
001b4a 322d      	CPI				R18,45
001b4b f411      	BRBC			1,DATOS_RS232_1_C				; SI ES DISTINTO SALTA A RELIJ1B
001b4c e021      	LDI				R18,1
001b4d c003      	RJMP			DATOS_RS232_1_D
                 DATOS_RS232_1_C:
001b4e 322b      	CPI				R18,43
001b4f f409      	BRBC			1,DATOS_RS232_1_D					; SI ES DISTINTO SALTA A RELIJ1B
001b50 e020      	LDI				R18,00
                 DATOS_RS232_1_D:
                 
001b51 e0dc      		LDI			YH,0x0C			; CARGA EL BIT ALTO
001b52 91c0 0c00 		LDS			YL,0xC00		; CARGA EL BIT BAJO CON EL VALOR GRABADO EN RAM
001b54 8328      		ST			Y,R18			; GRABA EN RAM EL VALOR DE R18
001b55 95c3      		INC			YL				; INCREMENTAEL VALOR CON LA NUEVA POSICION A GRABAR EN RAM
001b56 93c0 0c00 		STS			0xC00,YL
001b58 9508      		RET
                 
                 
                 ; 	LEE LOS DATOS RECIBIDOS DEL WIFI ***************************************************************************************
                 ;RS_RET_S:
                 ;JMP	RS_FIN
                 
                 ; 							SALVA LOS REGISTROS A USAR*********************************
                 BIT_REC_1:
                 
001b59 930f      		PUSH		R16
001b5a 931f      		PUSH		R17
001b5b 932f      		PUSH		R18
001b5c 933f      		PUSH		R19
001b5d 938f      		PUSH		R24
001b5e b70f      		IN			R16,SREG			; SALVA EL REGISTRO DE ESTADO
001b5f 930f      		PUSH		R16
                 
                 ;							ESPERA A RECIBIR EL PRIMER DATO****************************
                 BIT_REC_11:
001b60 9100 009b 		LDS			R16,UCSR1A
001b62 ff07      		SBRS		R16,RXC1
001b63 cffc      		RJMP		BIT_REC_11			; ESPERA A RECIBIR EL VALOR
001b64 9120 009c 		LDS			R18,UDR1
001b66 940e 1b3b 		CALL		DATOS_RS232_1
                 ;							RECUPERA LOS REGISTROS USADOS *****************************
001b68 910f      		POP			R16
001b69 bf0f      		OUT			SREG,R16
001b6a 918f      		POP			R24
001b6b 913f      		POP			R19
001b6c 912f      		POP			R18
001b6d 911f      		POP			R17
001b6e 910f      		POP			R16
001b6f e090      		LDI			R25, 00
001b70 9390 009b 		STS			UCSR1A, R25
001b72 940e 1d97 CALL DATO_ASCI									;   SOLO PARA DEPURACION LUEGO ELIMINAR ?????????????????????????????????????????????
001b74 9508      		RET
                 
                 ;  *************************************************************************************************************************************
                 ;  TERMINA LA INTERRUPCION ALMACENANDO LOS 3 DATOS RECIBIDOS EN RG_232   +1 Y +2  DESPUES DE LEERLO EN LEC_TEC HAY QUE PONER RG_232+1 A 0xFF
                 
                 
                 UART_TXC_FLASH1:
                 ; ENVIAR TEXTO DE FLASH
001b75 e5ff          	LDI   		ZH,high(TEXTO*5)	; direccion alta del TEXTO en Flash
001b76 e0e0      		LDI   		ZL,low(TEXTO*5) 	; direccion baja del TEXTO en Flash 
001b77 e104      		LDI   		R16,20     		; longitud de texto a TRANSMITIR
001b78 e011      		LDI			R17, 1			; NUMERO DE LINEAS A ENVIAR
                 UART_TXC_2:
001b79 95c8      		LPM      					; leemos TEXTO de FLASH y lo almacena en R0
001b7a 9631      		ADIW  		ZL,1   			; apuntamos al siguiente elemento 
001b7b 9200 009c 		STS 		UDR1,R0			; pone el valor de dato en el registro de transmision
001b7d d00e      		RCALL		UART_TXC2		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
001b7e 950a      		DEC   		R16      		; Hemos terminado..?? 
001b7f f7c9      		BRNE  		UART_TXC_2 		; NO...seguimos cargando 
                 ; ENVIAR RETARNO DE CARRO Y LINEA NUEVA
001b80 e00a      		LDI			R16, 10			; AQUI ENVIA UN RETARNO DE CARRO NUEVA LINEA
001b81 9300 009c 		STS			UDR1, R16
001b83 d008      		RCALL		UART_TXC2
001b84 e00d      		LDI			R16, 13			; AQUI ENVIA UN RETARNO DE CARRO NUEVA LINEA
001b85 9300 009c 		STS			UDR1, R16
001b87 d004      		RCALL		UART_TXC2
001b88 e100      		LDI			R16,16
001b89 951a      		DEC   		R17      		; Hemos terminado..?? 
001b8a f771      		BRNE  		UART_TXC_2  		; NO...seguimos cargando 
001b8b 9508      		RET
                         
                 UART_TXC2:  ; Rutina verificacion del termino en al envio de un bit BUFER VACIO
001b8c 9180 009b 		LDS			R24,UCSR1A
001b8e ff85      		SBRS		R24,UDRE1		; VERIFICA EL ENVIO DE LOS BITS BUFER VACIO
001b8f cffc      		RJMP		UART_TXC2		; EN CUYO CASO SALTA ESTA INSTRUCION
001b90 9508      		RET
                 
                 ; ENVIAR TEXTO DE RAM: ANTES INDICAR DIRECION A LEER EN RAM (YH,high  E  YL,low)
                 UART_TXC_RAM2:
001b91 e104      		LDI   		R16,20     		; longitud de texto a TRANSMITIR
001b92 dff9      		RCALL		UART_TXC2		; VERIFICA SI ESTA OCUPADO EL PUERTO UART
                 ;		LDI			R17,1			; NUMERO DE LINEAS A ENVIAR
                 UART_TXC_RAM_2A:
001b93 9009          	LD			R0,Y+
001b94 0c80      ADD	R8,R0						; CONTROL DEL CHECKSUM
001b95 9200 009c 		STS 		UDR1,R0			; pone el valor de dato en el registro de transmision
001b97 dff4      		RCALL		UART_TXC2		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
001b98 950a      		DEC   		R16      		; Hemos terminado..?? 
001b99 f7c9      		BRNE  		UART_TXC_RAM_2A	; NO...seguimos cargando 
001b9a 9508      RET
                 
                 ; ENVIAR RETORNO DE CARRO Y LINEA NUEVA
001b9b e00a      		LDI			R16,10			; AQUI ENVIA UN SALTO DE LINEA NUEVA LINEA
001b9c 9300 009c 		STS			UDR1,R16
001b9e dfed      		RCALL		UART_TXC2
001b9f e00d      		LDI			R16,13			; AQUI ENVIA UN RETORNO DE CARRO NUEVA LINEA
001ba0 9300 009c 		STS			UDR1,R16
001ba2 dfe9      		RCALL		UART_TXC2		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
001ba3 e104      		LDI			R16,20
001ba4 951a      		DEC   		R17      		; Hemos terminado..?? 
001ba5 f769      		BRNE  		UART_TXC_RAM_2A	; NO...seguimos cargando 
001ba6 9508      		RET
                 ; ENVIAR SOLO UN DATO AL PUERTO UAR VALOR A ENVIAR EN R16
                 UART_TXC_3:
001ba7 9300 009c 		STS 		UDR1,R16		; pone el valor de dato en el registro de transmision
001ba9 0e80      		ADD			R8,R16			; suma al control chekchun
001baa dfe1      		RCALL		UART_TXC2		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO	
001bab 9508      		RET
                 
                 
                 ; GENERAR LA CADENA A ENVIAR POR UART PRIMER DATO $
                 
                 CADENA_UART:
001bac e204      		LDI			R16,36				; ENVIA EL SIMBOLO $
001bad 940e 1ba7 		CALL		UART_TXC_3			; RUTINA ENVIA UN BIT EL BIT EN R16	
                 ; EMPIEZO EL CONTROL CHECKSUM
                 
001baf 2488      CLR 	R8							; R8 CHECHSUM
001bb0 2400      CLR		R0							; R0 ES UTILIZADO PARA TRANSMITIR LA RAM
                 ; ENVIA LA LINEA DEL MODELO
                 
001bb1 e0d7      		LDI			YH,HIGH(LIN1P-2)
001bb2 edce      		LDI			YL,LOW(LIN1P-2)
001bb3 940e 1b91 		CALL		UART_TXC_RAM2		; ENVIA UNA LINEA DE 20 CARACTERES
                 
                 ;	PRODUCCION								; POSICION 22 - $16
                 
001bb5 9100 0205 		LDS			R16,$205			; ENVIA LA PRODUCCION
001bb7 940e 1ba7 		CALL		UART_TXC_3			; RUTINA ENVIA UN BIT EL BIT EN R16	
                 
                 ;	PH PROGRAMADO							; POSICION 23 - $17
                 
001bb9 9100 0201 		LDS			R16,$201			; ENVIA EL PH PROGRAMADO
001bbb 940e 1ba7 		CALL		UART_TXC_3			; RUTINA ENVIA UN BIT EL BIT EN R16			
                 
                 ;	PH REAL									; POSICION 24 - $18
                 											; ENVIA FF SI NO TIENE SONDA
                 		
001bbd ef0f      		LDI			R16,$FF
001bbe fb44      		BST			CONTROL,4			; PONE EL BIT DETECTOR DE SANDA DE PH EN T
001bbf f416      		BRTC		PH_A				; SI T ES CERO VA A PH_A NO TIENE SONDA
001bc0 9100 0200 		LDS			R16,$200			; ENVIA EL PH REAL
                 PH_A:
001bc2 940e 1ba7 		CALL		UART_TXC_3			; RUTINA ENVIA UN BIT EL BIT EN R16			
                 
                 ;	CONCENTRACION DE SAL					; POSICION 25 - $19
                 		
001bc4 9100 0b0d 		LDS			R16,SAL_UART		; ENVIA LA CONCENTRACION DE SAL
001bc6 940e 1ba7 		CALL		UART_TXC_3			; RUTINA ENVIA UN BIT EL BIT EN R16			
                 
                 ;	REDOX PROGRAMADO						; POSICION 26 - $1A
                 			
001bc8 9100 020a 		LDS			R16,RAMP_RD			; ENVIA EL REDOX PROGRAMADO
001bca 940e 1ba7 		CALL		UART_TXC_3			; RUTINA ENVIA UN BIT EL BIT EN R16			
                 
                 ;	REDOX REAL								; POSICION 27 - $1B
                 
001bcc ef0f      		LDI			R16,$FF
001bcd fb46      		BST			CONTROL,6			; PONE EL BIT DETECTOR DE SANDA DE REDOX EN T
001bce f416      		BRTC		RD_A				; SI T ES CERO VA A PH_A NO TIENE SONDA
001bcf 9100 0223 		LDS			R16,REDOX_REAL		; ENVIA REDOX REAL
                 RD_A:
001bd1 940e 1ba7 		CALL		UART_TXC_3			; RUTINA ENVIA UN BIT EL BIT EN R16			
                 
                 ;	CLORO PROGRAMADO						; POSICION 28 - $1C
                 		
001bd3 9100 0207 		LDS			R16,$207			; ENVIA CLORO PROGRAMADO
001bd5 940e 1ba7 		CALL		UART_TXC_3			; RUTINA ENVIA UN BIT EL BIT EN R16			
                 
                 ;	CLORO REAL								; POSICION 29 - $1D
                 
001bd7 ef0f      		LDI			R16,$FF
001bd8 fb47      		BST			CONTROL,7			; PONE EL BIT DETECTOR DE SANDA DE REDOX EN T
001bd9 f416      		BRTC		CL_A				; SI T ES CERO VA A PH_A NO TIENE SONDA
001bda 9100 0206 		LDS			R16,$206			; ENVIA REDOX REAL
                 CL_A:
001bdc 940e 1ba7 		CALL		UART_TXC_3			; RUTINA ENVIA UN BIT EL BIT EN R16			
                 
                 ;	CICLOS									; POSICION 30 - $1E
                 		
001bde 9100 0214 		LDS			R16,$214			; ENVIA CICLOS PARA LA INVERSION
001be0 940e 1ba7 		CALL		UART_TXC_3			; RUTINA ENVIA UN BIT EL BIT EN R16			
                 
                 ; HORAS DE FUNCIONAMIENTO					; POSICION 31 - $1F
                 
001be2 e41a      		LDI			R17,$4A				; PARTE ALTA X256 LEE DE LA EPROM
001be3 940e 057e 		CALL		EEPROM_RW
001be5 2f02      		MOV			R16,R18				; ENVIA HORAS DE FUNCIONAMIENTO
001be6 940e 1ba7 		CALL		UART_TXC_3			; RUTINA ENVIA UN BIT EL BIT EN R16		
                 
                 ; HORAS DE FUNCIONAMIENTO					; POSICION 32 - $20
                 
001be8 e419      		LDI			R17,$49				; PARTE BAJA
001be9 940e 057e 		CALL		EEPROM_RW
001beb 2f02      		MOV			R16,R18				; ENVIA HORAS DE FUNCIONAMIENTO
001bec 940e 1ba7 		CALL		UART_TXC_3			; RUTINA ENVIA UN BIT EL BIT EN R16	
                 
                 ;	VIDA DEL ELECTRODO						; POSICION 33 - $21
                 
001bee e91c      		LDI			R17,$9C
001bef 940e 057e 		CALL		EEPROM_RW
001bf1 2f02      		MOV			R16,R18	
001bf2 940e 1ba7 		CALL		UART_TXC_3			; RUTINA ENVIA UN BIT EL BIT EN R16		
                 
                 ;	LED  									; POSICION 34 - $22
                 		
001bf4 2d0f      		MOV			R16,VAL_LED			; ENVIA LOS DATOS DE LOS LED
001bf5 940e 1ba7 		CALL		UART_TXC_3			; RUTINA ENVIA UN BIT EL BIT EN R16		
                 
                 ;  TEMPERATURA								; POSICION 35 - $23
                 											; PONE FF SI ES MENOR DE 5 GRADOS
                 		
001bf7 9100 020f 		LDS			R16,RAM_TEMP		; LEE LA TEMPERARURA DE LA RAM
001bf9 e025      		LDI			R18,5				; TEMPERATURA MINIMA PARA PONER FF
001bfa 1720      		CP			R18,R16					
001bfb f00c      		BRLT		TEMP_A				; PRIMERO MENOR QUE SEGUNDA VA A
001bfc ef0f      		LDI			R16,$FF
                 TEMP_A:
001bfd 940e 1ba7 		CALL		UART_TXC_3			; RUTINA ENVIA UN BIT EL BIT EN R16	
                 
                 ; SONDA DE FLUJO O CAUDAL					; POSICION 36 - $24 1 ES SI 0 ES NO
                 ;LDI	R16,15								; POSICION 15 ENVIA UNA F							;
                 ;		CALL		UART_TXC_3			; RUTINA ENVIA UN BIT EL BIT EN R16			
                 ;		LDS			R16,FLUJO			; POSICION EN RAM B04 EN RAM B04
001bff e000      LDI R16,00
001c00 feb6      		SBRS		CONTROL_1,6
001c01 e001      		LDI			R16,1				; UN CERO SIN SONDA UN 1 CON SONDA
001c02 940e 1ba7 		CALL		UART_TXC_3			; RUTINA ENVIA UN BIT EL BIT EN R16		
                 
                 ; RESERVADO									; POSICION 37 - $25					
                 		
001c04 ef0f      		LDI			R16,$FF
001c05 940e 1ba7 		CALL		UART_TXC_3			; RUTINA ENVIA UN BIT EL BIT EN R16		
                 
                 ;	EN ESPERA								; POSICION 38 - $26
                 		
001c07 9100 0b03 		LDS			R16,ESPERA_ERROR	; POSICION EN RAM 0XB03
001c09 940e 1ba7 		CALL		UART_TXC_3			; RUTINA ENVIA UN BIT EL BIT EN R16		
                 
                 ;EN ESPERA 240 SEGUNDOS						; POSICION 39 - $27
                 		
001c0b 2f03      		MOV			R16,R19				; ENVIA UN CERO 0 UN 1
001c0c 940e 1ba7 		CALL		UART_TXC_3			; RUTINA ENVIA UN BIT EL BIT EN R16		
                 
                 ; FLUJO SI O NO								; POSICION 40 - $28
                 		
                 ;		LDS			R16,S_FLUJO			; ENVIA B0A
001c0e e001      LDI		R16,1
001c0f 940e 1ba7 		CALL		UART_TXC_3			; RUTINA ENVIA UN BIT EL BIT EN R16		
                 
                 ;	APOYO DE CLORO Y REDOX					; POSICION 41 - $29
                 		
001c11 9100 0b05 		LDS			R16,APOYO_CL		; ENVIA LA POSICION B05
001c13 940e 1ba7 		CALL		UART_TXC_3			; RUTINA ENVIA UN BIT EL BIT EN R16		
                 
                 ; RESERVADO									; POSICION 42 - $2A
                 		
001c15 ef0f      		LDI			R16,$FF				; ENVIA FF
001c16 940e 1ba7 		CALL		UART_TXC_3
                 
                 ;	BAJO EN SAL								; POSICION 43 - $2B
                 		
001c18 9100 0b06 		LDS			R16,BAJO_SAL		; ENVIA LA POSICION B06
001c1a 940e 1ba7 		CALL		UART_TXC_3
                 
                 ;	ERROR DE CONEXION						; POSICION 44 - $2C
                 		
001c1c 9100 0b07 		LDS			R16,ERROR_ELECTRODO	; ENVIA LA POSICION B07
001c1e 940e 1ba7 		CALL		UART_TXC_3
                 
                 ;	AVERIA FUENTE GRANDE					; POSICION 45 - $2D
                 		
001c20 9100 0b08 		LDS		R16,AVERIA_FUENTE	; ENVIA LA POSICION B08
001c22 940e 1ba7 		CALL		UART_TXC_3
                 
                 ;	AVERIA MOS-FET							; POSICION 46 - $2E
                 
001c24 9100 0b09 		LDS		R16,AVERIA_CPU		; ENVIA LA POSICION B09
001c26 940e 1ba7 		CALL		UART_TXC_3
                 
                 ;	RESERVADO								; POSICION 47 - $2F
                 		
001c28 ef0f      		LDI			R16,$FF				; ENVIA UN CERO 0 UN UNO
001c29 940e 1ba7 		CALL		UART_TXC_3
                 
                 ; CHECKSUM									; POSICION 48 - $30
                 
001c2b 2d08      		MOV			R16,R8				; ENVIA CHECKSUM
001c2c 940e 1ba7 		CALL		UART_TXC_3
                 
001c2e 9508      RET		
                 		
                 		
                 		
                 		
                 			
                 .INCLUDE "PRO_PAR.ASM"
                 
                 
                 ; RUTINA PARA RS232 PROGRAMAR AJUSTAR Y CALIBRAR PARAMETROS
                 ; LEE Y ALMACENA EN RG_232 LOS DATOS LEIDOS DE LA INTERRUPCION
                 ; EN FUNCION DEL VALOR LEIDO AJUSTA LA PRODUCCION PH RD ETC Y LO ALMACENA DE NUEVO
                 
                 
                 ; RUTINA PARA RECIBIR DATOS DE LA UART1 **********RECIBE 3 DATOS Y LO GRABA EN EEPRON POSICION 200- C8**** POSICION Y VALOR
                 
                 ;	RUTINA PARA GUARDAR LOS DATOS RECIBIDOS EN RAM
                 
                 
                 
                 
                 
                 
                 
                 
                 N_PRO_PAR:
                 ; COMPRUEBA EL CODIGO A MEDIFICAR QUE ES EL SEGUNDO ENVIADO RG_232+1
001c2f 930f      		PUSH		R16
001c30 931f      		PUSH		R17
001c31 932f      		PUSH		R18
001c32 933f      		PUSH		R19
001c33 938f      		PUSH		R24
001c34 b70f      		IN			R16,SREG			; SALVA EL REGISTRO DE ESTADO
001c35 930f      		PUSH		R16
                 
001c36 ef2f      LDI	R18,0xFF
001c37 9320 0c01 STS	RG_232,R18
001c39 9120 0c02 		LDS			R18,RG_232+1		; LEE DE LA RAM LA POSICION A PROGRAMAR O CALIBRAR
001c3b 3125      		CPI			R18,21				; 15 EN HEX
001c3c f049      		BREQ		RS_PRO				; PROGRAMAR LA PRODUCION
001c3d 3126      		CPI			R18,22
001c3e f139      		BREQ		RS_PH				; PROGRAMAR EL PH 
001c3f 3129      		CPI			R18,25
001c40 f021      		BREQ		RS_RD_SALTO				; PROGRAMAR EL REDOX
001c41 312b      		CPI			R18,27
001c42 f009      		BREQ		RS_CL_SALTO			; PROGRAMAR EL CLORO
001c43 c0b8      		RJMP		RS_SALTO
                 RS_CL_SALTO:
001c44 c058      		RJMP		RS_CL
                 RS_RD_SALTO:
001c45 c03f      		RJMP		RS_RD
                 
                 ; PONE LOS VALORES RECIEN PROGRAMADOS EN RAM Y EPROM
                 
                 RS_PRO:	; RECIBO UN 21		PROGRAMAR LA PRODUCCION POSICION EN RAN 0x956 *****************************
                 
001c46 9110 0c03 	LDS			R17,RG_232+2
001c48 9120 0205 	LDS			R18,RAMP_PRO
001c4a 3011      	CPI			R17,1
001c4b f031      	BREQ		RS_PRO_B			; SI ES IGUAL VA A BAJAR PRODUCCION
001c4c 9523      	INC			R18
001c4d 9523      	INC			R18
001c4e 3624      	CPI			R18,100
001c4f f03c      	BRLT		RS_PRO_C
001c50 e624      	LDI			R18,100
001c51 c005      	RJMP		RS_PRO_C
                 RS_PRO_B:
001c52 952a      	DEC			R18
001c53 952a      	DEC			R18
001c54 3025      	CPI			R18,5
001c55 f408      	BRBC		0,RS_PRO_C
001c56 e025      	LDI			R18,5
                 RS_PRO_C:
001c57 9320 0205 	STS			RAMP_PRO,R18		; GRAMA EN RAN EL VALOR DE LA PRODUCCION
001c59 e011      	LDI			R17,PRO_MEN
001c5a 940e 0587 	CALL		EEPROM_ES			; GRABA EN EEPROM EL NUEVO VALOR DE LA PRODUCCION
001c5c 2f82      	MOV			R24,R18
001c5d 940e 0590 	CALL		RADC   				; CONVERTIR UN NUMERO EN DIGITOS DATO EN R24
001c5f 9210 0956 	STS			$0956, R1			
001c61 9220 0957 	STS			$0957, R2			; PONE EL RESULTADO EN PANTALLA DECENAS DE PRODUCCION
001c63 9230 0958 	STS			$0958, R3			; PONE EL RESULTADO EN PANTALLA UNIDADES DE PRODUCCION
001c65 c124      	RJMP		RS_FIN
                 
                 
                 RS_PH:	; RECIBO UN 22			 PROGRAMAR EL PHP PROGRAMADO POSICCION 0x96B ****************************
001c66 9110 0c03 	LDS			R17,RG_232+2
001c68 9120 0201 	LDS			R18,RAMP_PH
001c6a 3011      	CPI			R17,1
001c6b f029      	BREQ		RS_PH_B
001c6c 9523      	INC			R18
001c6d 3520      	CPI			R18,80
001c6e f034      	BRLT		RS_PH_C
001c6f e520      	LDI			R18,80
001c70 c004      	RJMP		RS_PH_C
                 RS_PH_B:
001c71 952a      	DEC			R18
001c72 3421      	CPI			R18,65
001c73 f408      	BRBC		0,RS_PH_C
001c74 e421      	LDI			R18,65
                 RS_PH_C:
001c75 9320 0201 	STS			RAMP_PH,R18			; GRAMA EN RAM DEL NUEVO PH
001c77 e010      	LDI			R17,PH_MEN
001c78 940e 0587 	CALL		EEPROM_ES			; GRABA EN EEPROM EL NUEVO VALOR DEL PH
001c7a 2f82      	MOV			R24, R18			; PONE EL VALOR EN R24 PARA CONVERTIRLO EN DECIMAL
001c7b 940e 0590 	CALL		RADC   				; CONVERTIR UN NUMERO EN DIGITOS DATO EN R24
001c7d 9220 096b 	STS			$96B, R2			; PONE EL RESULTADO EN PANTALLA DECENAS DE PH
001c7f e20e      	LDI			R16, 46				; pone un punto
001c80 9300 096c 	STS			$096C, R16
001c82 9230 096d 	STS			$096D, R3			; PONE EL RESULTADO EN PANTALLA UNIDADES DE PH
001c84 c105      	RJMP		RS_FIN
                 
                 RS_RD:	; RECIBO UN 25			PROGRAMAR EL REDOX PROGRAMADO POSICION  POSICION 0x97F******************************
001c85 9110 0c03 	LDS			R17,RG_232+2
001c87 9120 020a 	LDS			R18,RAMP_RD
001c89 3011      	CPI			R17,1
001c8a f011      	BREQ		RS_RD_B
001c8b 9523      	INC			R18
001c8c c001      	RJMP		RS_RD_C
                 RS_RD_B:
001c8d 952a      	DEC			R18
                 RS_RD_C:
001c8e 9320 020a 	STS			RAMP_RD,R18			; GRABA EN RAM DEL NUEVO REDOX
001c90 e013      	LDI			R17,RD_MEN
001c91 940e 0587 	CALL		EEPROM_ES			; GRABA EN EEPROM EL NUEVO VALOR DE REDOX
001c93 2f82      	MOV			R24, R18
001c94 940e 05b1 	CALL		RADC5I    			; CONVERTIR UN NUMERO EN DIGITOS DATO EN R24
001c96 9210 097f 	STS			$097F, R1			; PARA VER LA FRECUENCIA EN PANTALLA
001c98 9220 0980 	STS			$0980, R2
001c9a 9230 0981 	STS			$0981, R3
001c9c c0ed      	RJMP		RS_FIN
                 ;	RET
                 
                 RS_CL:	; RECIBO UN 27  PASICION EN RAM 0x992 CLORO PROGRAMADO ***************************************
001c9d 9110 0c03 	LDS			R17,RG_232+2
001c9f 9120 0207 	LDS			R18,RAMP_CL
001ca1 3011      	CPI			R17,1
001ca2 f029      	BREQ		RS_CL_B
001ca3 9523      	INC			R18
001ca4 3124      	CPI			R18,20
001ca5 f030      	BRBS		0, RS_CL_C			; SI NO SUPERA EL VALOR MAXIMO SALTA
001ca6 e124      	LDI			R18,20
001ca7 c004      	RJMP		RS_CL_C
                 RS_CL_B:
001ca8 952a      	DEC			R18
001ca9 3026      	CPI			R18,6
001caa f408      	BRBC		0,RS_CL_C
001cab e026      	LDI			R18,6
                 RS_CL_C:
001cac 9320 0207 	STS			RAMP_CL,R18			; GRABA EN RAM DEL NUEVO DEEL CLORO PROGRAMADO
001cae e012      	LDI			R17,CL_MEN
001caf 940e 0587 	CALL		EEPROM_ES			; GRABA EL NUEVO VALOR DEL CLORO PROGRAMADO EN EEPROM
001cb1 2f82      	MOV			R24, R18		; PONE EL VALOR EN R24 PARA CONVERTIRLO EN DECIMAL
001cb2 940e 0590 	CALL		RADC   			; CONVERTIR UN NUMERO EN DIGITOS DATO EN R24
001cb4 9220 0992 	STS			$992, R2		; PONE EL RESULTADO EN PANTALLA DECENAS DE CL
001cb6 e20e      	LDI			R16, 46
001cb7 9300 0993 	STS			$993, R16
001cb9 9230 0994 	STS			$994, R3		; PONE EL RESULTADO EN PANTALLA UNIDADES DE CL
001cbb c0ce      	RJMP		RS_FIN
                 ;	RET
                 
                 RS_CI:	; RECIBO UN 29				; PROGRAMAR CICLOS  0x9AA POSICION EN RAM   *****************
001cbc 9110 0c03 	LDS			R17,RG_232+2
001cbe 9120 0214 	LDS			R18,RAM_CICLOS
001cc0 3011      	CPI			R17,1
001cc1 f029      	BREQ		RS_CI_B
001cc2 9523      	INC			R18
001cc3 3024      	CPI			R18,4
001cc4 f034      	BRLT		RS_CI_C
001cc5 e024      	LDI			R18,4
001cc6 c004      	RJMP		RS_CI_C
                 RS_CI_B:
001cc7 952a      	DEC			R18
001cc8 3021      	CPI			R18,1
001cc9 f408      	BRBC		0,RS_CI_C
001cca e021      	LDI			R18,1
                 RS_CI_C:
001ccb 9320 0214 	STS			RAM_CICLOS,R18			; GRABA EN RAM LOS NUEVOS CICLOS
001ccd e218      	LDI			R17,CICLOS_MINUTO
001cce 940e 0587 	CALL		EEPROM_ES	
001cd0 2f82      	MOV			R24, R18			; PONE EL VALOR EN R24 PARA CONVERTIRLO EN DECIMAL
001cd1 940e 0590 	CALL		RADC   				; CONVERTIR UN NUMERO EN DIGITOS DATO EN R24
001cd3 9230 09aa 	STS			$09AA, R3			; PONE EL RESULTADO EN PANTALLA UNIDADES DE CICLOS
001cd5 c0b4      	RJMP		RS_FIN
                 ;	RET
                 
                 ; OPCION PARA CALIBRAR SAL PH RD CL
                 ; PRIMERO ENVIA EL CODIGO DE ORDEN Y LUEGO EL VALOR
                 
                 
                 RSC_SAL:			; CALIBRAR LA SAL + -  CODIGO 24
001cd6 91e0 020d 	LDS			R30, RAMC_SAL		; VALOR PARA EL CALIBRADO DE LA CONCENTRACION DE SAL
                 ;SUBIR SAL
001cd8 9110 0c03 	LDS			R17,RG_232+2
001cda 3011      	CPI			R17,1				; CODIGO ASCI DEL MENOS
001cdb f039      	BREQ		REC_SAL_B			; SI ES IGUAL VA A REC_SAL_B
001cdc 95e3      	INC			R30
001cdd 95e3      	INC			R30
001cde 95e3      	INC			R30
001cdf 3be4      	CPI			R30, 180			; VALOR MAXIMO DE NUMERO DE VECES DE LECTURA.
001ce0 f044      	BRLT		REC_SAL_A		; SI MENOR SALTA
001ce1 ebe4      	LDI			R30,180				; COMO ES MAYOR PONE EL MAXIMO
001ce2 c006      	RJMP		REC_SAL_A
                 REC_SAL_B:						; BAJAR LA CONCENTRACION DE SAL
001ce3 95ea      	DEC			R30
001ce4 95ea      	DEC			R30
001ce5 95ea      	DEC			R30
001ce6 33e2      	CPI			R30, 50				; COMPRARA SI ES MENOR
001ce7 f408      	BRBC		0, REC_SAL_A 		; SI ES MAYOR SALTA
001ce8 e3e2      	LDI			R30, 50				; PONE EL VALOR MINIMO
                 REC_SAL_A:
001ce9 e026      	LDI			R18, P_SAL			; LINEA DE ENTRADA EN EL CONVERTIDOR PCF8591
001cea 2fae      	MOV			R26, R30			; NUMERO DE LECTURAS Ó CALIBRACION
001ceb 940e 013c 	CALL		ADC_P
                 ;	LDS			R18,RAM_MED_INI_SAL	; CARGA EL ERROR INICIAL DEL TLC26 EN R18
                 ;	SUB			R24,R18				; RESTA EL ERROR INICIAL DE LA MEDICION
001ced 9380 0210 	STS			RAM_SAL_C, R24		; ALMACENA LA MEDICION EN LA MEMORIA RAM VALOR A ENVIAR POR RS ****+
001cef 93e0 020d 	STS			RAMC_SAL, R30		; VALOR PARA EL CALIBRADO DE LA CONCENTRACION DE SAL
001cf1 e016      	LDI			R17, SAC_MEN		; POSICION DE MEMORIA A ESCRIBIR EN EEPROM $005
001cf2 2f2e      	MOV			R18, R30 
001cf3 940e 0587 	CALL		EEPROM_ES			; GRABA EN EEPROM EL VALOR DE LA NUEVA CALIBRACCION
001cf5 940e 0590 	CALL		RADC   				; CONVERTIR UN NUMERO EN DIGITOS DATO EN R24
001cf7 9220 0905 	STS			$0905, R2			
001cf9 9230 0907 	STS			$0907, R3			; PONE EL RESULTADO EN PANTALLA DECENAS DE PRODUCCION
001cfb c08e      	RJMP		RS_FIN
                 ;	RET
                 
                 RS_SALTO:		; VIENE DE LA LINEA 85
                 
001cfc 312d      	CPI			R18,29
001cfd f039      	BREQ		RS_CI_SALTO				; PROGRAMAR LOS CICLOS
001cfe 3128      	CPI			R18,24
001cff f2b1      	BREQ		RSC_SAL				; CALIBRAR LA CONCENTRACCION DE SAL
001d00 3127      	CPI			R18,23
001d01 f021      	BREQ		RSC_PH				; CALIBRAR EL PH DEL AGUA
001d02 312a      	CPI			R18,26
001d03 f161      	BREQ		RSC_RD				; CALIBRAR EL REDOX DEL AGUA
001d04 c052      	RJMP		RS_SALTO2
                 RS_CI_SALTO:
001d05 cfb6      	RJMP		RS_CI
                 			; REPITE VA A LEER UN NUEVO VALOR
                 RSC_PH:		; CALIBRAR EL PH RECIBE DE LA NEXTION UN 23  ********************************* COMPLETADO *******************
001d06 91e0 0202 	LDS			R30, RAMC_PH		; VALOR PARA EL CALIBRADO DEL PH
001d08 9110 0c03 	LDS			R17,RG_232+2		; LEE LA POSICION PARA INCREMENTAR O BAJAR
001d0a 3011      	CPI			R17,1				; CODIGO ASCI DEL MENOS
001d0b f029      	BREQ		RSC_PH_B			; ES MENOS VA A BAJAR
001d0c 95e3      	INC			R30					; INCREMENTA EL PH
001d0d 31e6      	CPI			R30,22				; LO COMPARA CON EL MAXIMO
001d0e f034      	BRLT		RSC_PH_A			; SI ES MAS BAJO VA A RSC_PH_A
001d0f e1e6      	LDI			R30,22				; EN CASO DE SER MAS ALTO PONE EL MAXIMO		
001d10 c004      	RJMP		RSC_PH_A
                 RSC_PH_B:
001d11 95ea      	DEC			R30					; BAJA EL PH
001d12 30e2      	CPI			R30,2				; LO COMPARA CON EL VALOR MINIMO
001d13 f408      	BRBC		0,RSC_PH_A			; SI ES MAS ALTO VA A RCS_PH_A
001d14 e0e2      	LDI			R30,2				; SI ES MAS BAJO PONE EL MINIMO
                 RSC_PH_A:
001d15 e023      	LDI			R18, P_PH			; LINEA DE ENTRADA EN EL CONVERTIDOR PCF8591
001d16 eea7      	LDI			R26, 231			; NUMERO DE LECTURAS Ó CALIBRACION
001d17 940e 013c 	CALL		ADC_P				; DEVUELVE EL RESULTADO EN R24
001d19 ed08      	LDI			R16, 216			; RESTA 10 PARA LUEGO SUMARLE LA CALIBRACION ENTRE 0 Y 20
001d1a 1b08      	SUB			R16, R24			; Y RESTANDOLO DEL LEIDO			
001d1b 2f3e      	MOV			R19, R30			; LEE EL VALOR DE CALIBRACION que suele ser 10
001d1c 0f03      	ADD			R16, R19			; SE LA SUMA AL LEIDO
001d1d 2f80      	MOV			R24,R16
001d1e 9380 0200 	STS			RAM_PH, R24			; ALMACENA LA MEDICION EN LA MEMORIA RAM
001d20 940e 0590 	CALL		RADC   				; CONVERTIR UN NUMERO EN DIGITOS DATO EN R24
001d22 9220 046d 	STS			$046D, R2			; PONE EL RESULTADO EN PANTALLA DECENAS DE PH
001d24 e20e      	LDI			R16, 46				; pone un punto
001d25 9300 046e 	STS			$046E, R16
001d27 9230 046f 	STS			$046F, R3			; PONE EL RESULTADO EN PANTALLA UNIDADES DE PH
001d29 93e0 0202 	STS			RAMC_PH, R30		; VALOR PARA EL CALIBRADO DEL PH
001d2b e015      	LDI			R17, PHC_MEN		; POSICION DE MEMORIA A ESCRIBIR EN EEPROM $005
001d2c 2f2e      	MOV			R18, R30 
001d2d 940e 0587 	CALL		EEPROM_ES			; GRABA EN EEPROM EL VALOR DE LA NUEVA CALIBRACCION
001d2f c05a      	RJMP		RS_FIN
                 
                 
                 RSC_RD:
001d30 91e0 020b 	LDS			R30,RAMC_RD			; VALOR PARA EL CALIBRADO DE LA CONCENTRACION DE SAL
001d32 9110 0c03 	LDS			R17,RG_232+2		; LEE LA POSICION PARA INCREMENTAR O BAJAR
001d34 3011      	CPI			R17,1				; CODIGO ASCI DEL MENOS
001d35 f031      	BREQ		RSC_RD_B			; ES MENOS VA A BAJAR
001d36 95e3      	INC			R30					; INCREMENTA EL PH
001d37 95e3      	INC			R30
001d38 3fee      	CPI			R30,254				; LO COMPARA CON EL MAXIMO
001d39 f038      	BRBS		0,RSC_RD_A			; SI ES MAS BAJO VA A RSC_PH_A
001d3a efee      	LDI			R30,254				; EN CASO DE SER MAS ALTO PONE EL MAXIMO		
001d3b c005      	RJMP		RSC_RD_A
                 RSC_RD_B:
001d3c 95ea      	DEC			R30
001d3d 95ea      	DEC			R30					; BAJA EL PH
001d3e 3ce8      	CPI			R30,200				; LO COMPARA CON EL VALOR MINIMO
001d3f f408      	BRBC		0,RSC_RD_A			; SI ES MAS ALTO VA A RCS_PH_A
001d40 ece8      	LDI			R30,200		
                 RSC_RD_A:
001d41 e022      	LDI			R18,P_RD			; LINEA DE ENTRADA
001d42 2fae      	MOV			R26,R30				; NUMERO DE LECTURAS Ó CALIBRACION
001d43 940e 013c 	CALL		ADC_P
001d45 528e      	SUBI		R24,46
001d46 9380 0209 	STS			RAM_RD,R24			; ALMACENA LA MEDICION EN LA MEMORIA RAM
001d48 940e 05b1 	CALL		RADC5I
001d4a 9210 09bb 	STS			$9BB,R1
001d4c 9220 09bc 	STS			$9BC,R2
001d4e 9230 09bd 	STS			$9BD,R3
001d50 93e0 020b 	STS			RAMC_RD,R30			; VALOR PARA EL CALIBRADO DE LA CONCENTRACION DE SAL
001d52 e017      	LDI			R17,RDC_MEN			; POSICION DE MEMORIA A ESCRIBIR EN EEPROM $005
001d53 2f2e      	MOV			R18,R30 
001d54 940e 0587 	CALL		EEPROM_ES			; GRABA EN EEPROM EL VALOR DE LA NUEVA CALIBRACCION
001d56 c033      	RJMP		RS_FIN
                 
                 RS_SALTO2:
                 
001d57 312e      	CPI			R18,30
001d58 f011      	BREQ		RSC_CL				; CALIBRAR EL CLORO DEL AGUA
001d59 3320      	CPI			R18,0+48
                 ;	BREQ		RS_RET1				; PARA FINALIZAR SI ME ENVIA UN CERO
001d5a c02f      	RJMP		RS_FIN	
                 ;	RET
                 
                 RSC_CL:
001d5b 91e0 0208 	LDS			R30, RAMC_CL		; VALOR PARA EL CALIBRADO DE LA CONCENTRACION DE CLORO
001d5d 9110 0c03 	LDS			R17,RG_232+2		; LEE LA POSICION PARA INCREMENTAR O BAJAR
001d5f 3011      	CPI			R17,1				; CODIGO ASCI DEL MENOS
001d60 f029      	BREQ		RSC_CL_B			; ES MENOS VA A BAJAR
001d61 9638      	ADIW		R30,8				; INCREMENTA EL VALOR DEL CLORO LEIDO
001d62 3fe9      	CPI			R30,249				; LO COMPARA CON EL MAXIMO
001d63 f030      	BRBS		0,RSC_CL_A			; SI ES MAS BAJO VA A RSC_PH_A
001d64 efe9      	LDI			R30,249				; EN CASO DE SER MAS ALTO PONE EL MAXIMO		
001d65 c004      	RJMP		RSC_CL_A
                 RSC_CL_B:
001d66 50e8      	SUBI		R30,8				; BAJA EL CLORO LEIDO
001d67 39e6      	CPI			R30,150				; LO COMPARA CON EL VALOR MINIMO
001d68 f408      	BRBC		0,RSC_CL_A			; SI ES MAS ALTO VA A RSC_CL
001d69 e9e6      	LDI			R30,150		
                 RSC_CL_A:
001d6a e021      	LDI			R18,P_CL			; LINEA DE ENTRADA
001d6b 2fae      	MOV			R26,R30				; NUMERO DE LECTURAS Ó CALIBRACION
001d6c 940e 013c 	CALL		ADC_P
001d6e 9586      	LSR			R24
001d6f 9586      	LSR			R24			
001d70 508f      	SUBI		R24,15
001d71 9380 0206 	STS			RAM_CL, R24			; ALMACENA LA MEDICION EN LA MEMORIA RAM
001d73 940e 0590 	CALL		RADC   				; CONVERTIR UN NUMERO EN DIGITOS DATO EN R24
001d75 9220 09ce 	STS			$09CE, R2			; PONE EL RESULTADO EN PANTALLA DECENAS DE CL
001d77 e20e      	LDI			R16, 46				; pone un punto
001d78 9300 09cf 	STS			$09CF, R16
001d7a 9230 09d0 	STS			$09D0, R3			; PONE EL RESULTADO EN PANTALLA UNIDADES DE CL
001d7c 93e0 0208 	STS			RAMC_CL, R30		; VALOR PARA EL CALIBRADO PARA EL CLORO
001d7e e014      	LDI			R17, CLC_MEN		; POSICION DE MEMORIA A ESCRIBIR EN EEPROM $005
001d7f 2f2e      	MOV			R18, R30 
001d80 940e 0587 	CALL		EEPROM_ES			; GRABA EN EEPROM EL VALOR DE LA NUEVA CALIBRACCION
001d82 c007      	RJMP		RS_FIN
                 ;	RET
                 
                 
                 
                 ;	RJMP			RS_RET1
                 ;	RJMP			BIT_REC_11
                 ; ENVIO DEL RESULTADO POR RS 232 VALOR A ENVIAR EN R24
                 
                 ;RS_ENVIO:							; ENVIA EL NUMERO DE ORDEN Y EL NUEVO VALOR
001d83 9380 009c 	STS 		UDR1,R24		; pone el valor de dato en el registro de transmision
                 RS_ENVIO_A:
001d85 9100 009b 	LDS			R16,UCSR1A
001d87 ff05      	SBRS		R16,UDRE1		; VERIFICA EL ENVIO DE LOS BITS BUFER VACIO
001d88 cffc      	RJMP		RS_ENVIO_A		; EN CUYO CASO SALTA ESTA INSTRUCION
001d89 9508      	RET			
                 RS_FIN:
                 								; TERMINA Y RESTAURA LOS REGISTROS TERMINA CON RETI
001d8a 910f      	POP			R16
001d8b bf0f      	OUT			SREG,R16
001d8c 918f      	POP			R24
001d8d 913f      	POP			R19
001d8e 912f      	POP			R18
001d8f 911f      	POP			R17
001d90 910f      	POP			R16
001d91 e090      	LDI			R25, 00
001d92 9390 009b 	STS			UCSR1A, R25
001d94 940e 1bac CALL		CADENA_UART				;  =================  PARA VER SI SE ACELERA EL ENVIO A LA APP =================================
001d96 9508      	RET
                 
                 
                 ;  ***********************************************************************************************
                 
                 
                 DATO_ASCI:				;**************** PONE EN MEMORIA RAM LOS VALORES DE LA RS232 ??????????SOLO VERIFICACION
                 
                 
001d97 9180 0c01 	LDS				R24,RG_232
001d99 940e 0590 	CALL			RADC				; PRESENTA EN LINEA 3 LA MEDICION DE SAL REAL
001d9b 9210 0ac4 	STS				$AC4, R1			; DECENAS
001d9d 9220 0ac5 	STS				$AC5, R2			; UNIDADES
001d9f 9230 0ac6 	STS				$AC6, R3			; DECIMAS	
                 
001da1 9180 0c02 	LDS				R24,RG_232+1
001da3 940e 0590 	CALL			RADC				; PRESENTA EN LINEA 3 LA MEDICION DE SAL REAL
001da5 9210 0ac8 	STS				$AC8, R1			; DECENAS
001da7 9220 0ac9 	STS				$AC9, R2			; UNIDADES
001da9 9230 0aca 	STS				$ACA, R3			; DECIMAS	
                 
001dab 9180 0c03 	LDS				R24,RG_232+2
001dad 940e 0590 	CALL			RADC				; PRESENTA EN LINEA 3 LA MEDICION DE SAL REAL
001daf 9210 0acc 	STS				$ACC, R1			; DECENAS
001db1 9220 0acd 	STS				$ACD, R2			; UNIDADES
001db3 9230 0ace 	STS				$ACE, R3			; DECIMAS	
                 
001db5 e230      	LDI				R19,32				; LIMPIA POSICIONES VACIAS PONE UN ESPACIO
001db6 9330 0ac7 	STS				$AC7,R19
001db8 9330 0acb 	STS				$ACB,R19
001dba 9330 0acc 	STS				$ACC,R19
001dbc 9330 0acf 	STS				$ACF,R19
001dbe e800      	LDI				R16,128				; ESCRIBIR LINEA 1 DATOS ENVIADOS POR RS-232
001dbf 940e 053e 	CALL			ENVINT				; En subrrutina Env_doi Envia instrucion para escribir en linea 1
001dc1 e0d7      	LDI				YH,HIGH(LIN1P)		; POSICION BIT ALTO DEL TEXTO A ENVIAR ram en 070
001dc2 eec0      	LDI				YL,LOW (LIN1P)		; POSICION BIT BAJO DEL TEXTO A ENVIAR
001dc3 e114      	LDI				R17,20				; NUMERO DE DIGITOS A ENVIAR A PANTALLA
001dc4 940e 0925 	CALL			ENVIARTEXTO			; RUTINA EN ESTE FICHERO PRECISA SUBRRUTINA ENV_DOI
                 
001dc6 9508      	RET
                 .INCLUDE "P_NEXTION_RS0.ASM"
                 
                 ;page 4
                 ;draw 30,21,450,244,GREEN
                 ;draw 29,20,451,245,GREEN
                 
                 
                 
                 
                 
                 
                 ; RUTINA PARA ENVIAR DATOS A LA PANTALLA NEXTION  DE 480X272
                 ; EN R16 INDICAR EL NUMERO DE LINEA EN HY HIGK Y HY LOW LA POSICION DE INICIO EN RAN
                 .equ		N_PRO	=0x956			; NIVEL DE PRODUCCION
                 .equ		N_POL	=0x9AA			; CAMBIO POLARIDAD
                 .equ		N_PHP	=0x96B			; PH PROGRAMADO
                 .equ		N_TEM	=0x65D			; TEMPERATURA ( TAMBIEN VALE 738
                 .equ		N_ELE	=0x9E3			; USO DEL EQUIPO HORAS ENVIAR 4 BIT
                 .equ		N_VEL	=0x7A0			; VIDA DEL ELECTRODO %
                 .equ		N_SALC	=0x905			; NIVEL DE SAL EN EL AGUA CALIBRACION
                 .equ		N_SALP	=0x7C5			; PROGRAMADA
                 .equ		N_PH	=0x46D			; PH DEL AGUA 46D CALIBRAR
                 .equ		N_RDP	=0x92D			; REDOX PROGRAMADO 
                 .equ		N_RD	=0x9BB			; REDOX DEL AGUA
                 .equ		N_CLP	=0x992			; CLORO PROGRAMADO
                 .equ		N_CL	=0X9CE			; CLORO EN LA PISCINA
                 .equ		N_FLU	=0xA1D			; SENSOR DE FLUJO		
                 .equ		N_ESP	=0x6A3			; EN ESPERA SEGUNDOS
                 .equ		N_BAR	=0x56E			; VALOR MINUTOS ???????
                 .equ		N_PAG	=0X9FC			; TEXTO EN RAM (page 0) enviar 6 caracteres incluye espacio
                 .equ		N_VAL	=0xA10			; TEXTO EN RAM (j0.VAL=) enviar 7 caracteres
                 .equ		N_TXT	=0xA0B			; TEXTO EN RAM (.txt=) enviar 5 caracteres
                 .equ		N_PIC	=0xA04			; TEXTO EN RAM (pic ) enviar 4 caracteres incluido el espacio
                 .equ		N_AUT	=0x9C6			; TEXTO "AUTO"
                 .equ		N_TRD	=0xA4C			; TEXTO "Redox en mmV"
                 .equ		N_TCL	=0xA60			; TEXTO "Cloro ppm"
                 .equ		N_POS	=0xA18			; 0 O 1 SEGUN POSICION DE POLARIDAD DIRECTA O INVERSA LED NARANJA
                 .equ		N_NO	=0xA1E			; POSICION DEL TEXTO NO
                 .equ		N_SI	=0xA20			; POSICION DEL TEXTO SI PARA FLUJO
                 .equ		N_P00	=0xA6E			; ORDEN DEL NEXTION AL MICRO IR A PAGINA CERO
                 .equ		N_POL1	=0xA74			; POSICION ANAGRAMA DE POLARIDAD CON CIRCULO 1 o 2
                 
                 
                 ; RUTINA PARA LA TRANSMISION DE DATOS A TRAVES DE LA UART
                 ; CONFIGURAR A 9600 EN UBRRH Y UBRRL VALORES 00 Y 33
                 
                 ;  ******************************************************************************************************************
                 
                 
                 ; ENVIAR TEXTO DE RAM: ANTES INDICAR DIRECION A LEER EN RAM (YH,high (R29)  E  YL,low(R28)) EN R16 NUMERO DE CARACTERES
                 UARTN_TXC_RAM2:
                 ;		LDI   		R16,20     		; longitud de texto a TRANSMITIR
001dc7 dd2b      		RCALL		UART_TXC1		; VERIFICA SI ESTA OCUPADO EL PUERTO UART
                 UARTN_TXC_RAM_2A:
001dc8 9009          	LD			R0,Y+
001dc9 b80c      		OUT 		UDR0,R0			; pone el valor de dato en el registro de transmision
001dca dd28      		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
001dcb 950a      		DEC   		R16      		; Hemos terminado..?? 
001dcc f7d9      		BRNE  		UARTN_TXC_RAM_2A	; NO...seguimos cargando 
001dcd 9508      		RET
                 
                 P_NEXTION_TEXTO:	; ENVIAR TEXTO INICIAL  t1.txt=" TEXTO "  EN R26 Y R27 LINEA A ENVIAR EN YH HIG E YH LOW TEXTO A ENVIAR
                 
                 ;		LDI			R19,116			; ENVIA UNA t
001dce b93c      		OUT			UDR0,R19
001dcf dd23      		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO		
001dd0 b9bc      		OUT 		UDR0,R27		; PONE LA LINEA A ESCRIBIR UNIDADES
001dd1 dd21      		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
001dd2 e23e      		LDI			R19,46			; ENVIA UNA .
001dd3 b93c      		OUT			UDR0,R19
001dd4 dd1e      		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
001dd5 e734      		LDI			R19,116			; ENVIA UNA t
001dd6 b93c      		OUT			UDR0,R19
001dd7 dd1b      		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
001dd8 e738      		LDI			R19,120			; ENVIA UNA x
001dd9 b93c      		OUT			UDR0,R19
001dda dd18      		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
001ddb e734      		LDI			R19,116			; ENVIA UNA t
001ddc b93c      		OUT			UDR0,R19
001ddd dd15      		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO		
001dde e33d      		LDI			R19,61			; ENVIA UN =
001ddf b93c      		OUT			UDR0,R19
001de0 dd12      		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO	
001de1 e232      		LDI			R19,34			; ENVIA UN "
001de2 b93c      		OUT			UDR0,R19
001de3 dd0f      		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO	
                 P_NEXTION_LINEA:
                 ; ENVIA UNA LINEA DE 20 CARACTERES
001de4 940e 1dc7 		CALL		UARTN_TXC_RAM2	; ENVIA LA 20 CARACTERES DE RAM Y TERMINA
001de6 e232      		LDI			R19,34			; ENVIA UN "
001de7 b93c      		OUT			UDR0,R19
001de8 dd0a      		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
                 
                 ; ENVIA 3 FF
                 P_NEXTION_FINAL:
001de9 ef3f      		LDI			R19,0xFF			; ENVIA UN FF
001dea b93c      		OUT			UDR0,R19
001deb dd07      		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
001dec ef3f      		LDI			R19,0xFF			; ENVIA UN FF
001ded b93c      		OUT			UDR0,R19
001dee dd04      		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
001def ef3f      		LDI			R19,0xFF			; ENVIA UN FF
001df0 b93c      		OUT			UDR0,R19
001df1 dd01      		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
001df2 9508      		RET
                 
                 
                 
                 
                 ; ENVIAR TEXTO DE RAM: ANTES INDICAR DIRECION A LEER EN RAM (YH,high  E  YL,low)  EN R26 NUMERO DE CARACTERES
                 UARTN_TXT_RAM3:
                 ;		LDI   		R26,20     		; longitud de texto a TRANSMITIR
001df3 dcff      		RCALL		UART_TXC1		; VERIFICA SI ESTA OCUPADO EL PUERTO UART
                 UARTN_TXT_RAM_3A:
001df4 9009          	LD			R0,Y+
001df5 b80c      		OUT 		UDR0,R0			; pone el valor de dato en el registro de transmision
001df6 dcfc      		RCALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
001df7 95aa      		DEC   		R26     		; Hemos terminado..?? 
001df8 f7d9      		BRNE  		UARTN_TXT_RAM_3A	; NO...seguimos cargando 
001df9 9508      		RET		
                 
                 INI_NEXTION_P:		;*********************************"PANTALLA PRINCIPAL"************************************************** 
001dfa 9120 0c02 	LDS			R18,RG_232+1		; ES LA POSICION DONDE GRABA LA PANTALLA DONDE ESTA SE USA EN LA RUTINA PAGE
001dfc 3029      	CPI				R18,9	
001dfd f409      	BRBC			1,INI_NEXTION_P1	; SI ESTA LA NEXTION EN PANTALLA DE DATOS DEL EQUIPO NO VERIFICA NADA MAS
001dfe 9508      	RET
                 
                 INI_NEXTION_P1:
                 ; t0 ENVIA MODELO DEL EQUIPO         t0 CARACTERES 20 PANTALLA INFORMACION Y PRINCIPAL
001dff e734      		LDI			R19,116			; ENVIA UNA t			
001e00 e3b0      		LDI			R27,48			; TEXTO 0 
001e01 e104      		LDI			R16,20			; NUMERO DE CARACTERES A ESCRIBIR
001e02 e0d7      		LDI			YH,HIGH(LIN1P)
001e03 eec0      		LDI			YL,LOW(LIN1P)
001e04 940e 1dce 		CALL		P_NEXTION_TEXTO
                 
                 ; t1 ENVIA HORAS CAMBIO DE POLARIDAD t1 CARACTERES 1
                 ;		LDI			R19,116			; ENVIA UNA t
                 ;		LDI			R27,49			; TEXTO 1
                 ;		LDI			R16,1			; NUMERO DE CARACTERES A ESCRIBIR
                 ;		LDI			YH,HIGH(N_POL)
                 ;		LDI			YL,LOW (N_POL)	; PARA ENVIAR UN 52 ASCI DEL 4
                 ;		CALL		P_NEXTION_TEXTO	
                 
                 ; t2 ENVIA NIVEL DE SAL EN EL AGUA	t2 EN PRINCIPAL Y PARAMETROS	
001e06 e734      		LDI			R19,116			; ENVIA UNA t
001e07 e3b2      		LDI			R27,50			; TEXTO 2
001e08 e003      		LDI			R16,3			; NUMERO DE CARACTERES A ESCRIBIR
001e09 e0d7      		LDI			YH,HIGH(N_SALP)
001e0a ecc5      		LDI			YL,LOW (N_SALP)
001e0b 940e 1dce 		CALL		P_NEXTION_TEXTO	
                 
                 ; t3 ENVIA EL PH DEL AGUA	        t3 ENVIAR 3 CARACTERES EN PANTALLA PRINCIPAL Y CALIBRACION	
001e0d e734      		LDI			R19,116			; ENVIA UNA t
001e0e e3b3      		LDI			R27,51			; TEXTO 3
001e0f e003      		LDI			R16,3			; NUMERO DE CARACTERES A ESCRIBIR
001e10 e0d4      		LDI			YH,HIGH(N_PH)
001e11 e6cd      		LDI			YL,LOW (N_PH)
001e12 940e 1dce 		CALL		P_NEXTION_TEXTO	
                 
                 
001e14 fd47      SBRC		CONTROL,7				; SI HAY SONDA DE CLORO NO PONE EL PORCENTAJE PONE AUTO y TEXTO EN t6 "Cloro ppm"
001e15 c00a      RJMP		N_NEXTION_P1C
001e16 fd46      SBRC		CONTROL,6				; SI HAY SONDA DE REDOX NO PONE EL PORCENTAJE PONE AUTO Y TEXTO EN t6 "Redox en mmV"
001e17 c025      RJMP		N_NEXTION_P1R
                 
                 ; t5 ENVIA PORCENTAJE DE PRODUCCION t5 CARACTERES 3 PANTALLA PRINCIPAL Y PARAMETROS O DATOS DE CLORO O REDOX
001e18 e734      		LDI			R19,116			; TEXTO t
001e19 e3b5      		LDI			R27,53			; TEXTO 5
001e1a e004      		LDI			R16,4			; NUMERO DE CARACTERES A ESCRIBIR
001e1b e0d9      		LDI			YH,HIGH (N_PRO)
001e1c e5c6      		LDI			YL,LOW  (N_PRO)
001e1d 940e 1dce 		CALL		P_NEXTION_TEXTO
001e1f c039      		RJMP		N_NEXTION_P2
                 
                 N_NEXTION_P1C: ; PONE AUTO Y TEXTO "Cloro ppm" EN t6
001e20 e734      		LDI			R19,116			; TEXTO t
001e21 e3b5      		LDI			R27,53			; TEXTO 5
001e22 e004      		LDI			R16,4			; NUMERO DE CARACTERES A ESCRIBIR
001e23 e0d9      		LDI			YH,HIGH (N_AUT)
001e24 ecc6      		LDI			YL,LOW  (N_AUT)
001e25 940e 1dce 		CALL		P_NEXTION_TEXTO
001e27 e734      		LDI			R19,116			; TEXTO t
001e28 e3b6      		LDI			R27,54			; TEXTO 6
001e29 e00a      		LDI			R16,10			; NUMERO DE CARACTERES A ESCRIBIR
001e2a e0da      		LDI			YH,HIGH (N_TCL)
001e2b e6c0      		LDI			YL,LOW  (N_TCL)
001e2c 940e 1dce 		CALL		P_NEXTION_TEXTO
                 
                 ; t4 ENVIA EL CLORO DEL AGUA
001e2e e734      		LDI			R19,116			; TEXTO t
001e2f e3b4      		LDI			R27,52			; TEXTO 4
001e30 e003      		LDI			R16,3			; NUMERO DE CARACTERES A ESCRIBIR
001e31 e0d9      		LDI			YH,HIGH(N_CL)
001e32 ecce      		LDI			YL,LOW (N_CL)
001e33 940e 1dce 		CALL		P_NEXTION_TEXTO	
                 
                 ; ENVIA EL NIVEL DE CLORO PROGRAMADO
001e35 e734      		LDI			R19,116			; TEXTO t
001e36 e3b9      		LDI			R27,57			; TEXTO 9
001e37 e003      		LDI			R16,3			; NUMERO DE CARACTERES A ESCRIBIR
001e38 e0d9      		LDI			YH,HIGH(N_CLP)
001e39 e9c2      		LDI			YL,LOW (N_CLP)
001e3a 940e 1dce 		CALL		P_NEXTION_TEXTO	
001e3c c01c      		RJMP		N_NEXTION_P2
                 
                 N_NEXTION_P1R: ; PONE AUTO Y TEXTO "Redox en mmV"
001e3d e734      		LDI			R19,116			; TEXTO t
001e3e e3b5      		LDI			R27,53			; TEXTO 5
001e3f e004      		LDI			R16,4			; NUMERO DE CARACTERES A ESCRIBIR
001e40 e0d9      		LDI			YH,HIGH (N_AUT)
001e41 ecc6      		LDI			YL,LOW  (N_AUT)
001e42 940e 1dce 		CALL		P_NEXTION_TEXTO
001e44 e734      		LDI			R19,116			; TEXTO t
001e45 e3b6      		LDI			R27,54			; TEXTO 6
001e46 e00a      		LDI			R16,10			; NUMERO DE CARACTERES A ESCRIBIR
001e47 e0da      		LDI			YH,HIGH (N_TRD)
001e48 e4cc      		LDI			YL,LOW  (N_TRD)
001e49 940e 1dce 		CALL		P_NEXTION_TEXTO
                 ; t4 ENVIA EL REDOX DEL AGUA		t4 EN PANTALLA PRINCIPAL Y CALIBRACION
001e4b e734      		LDI			R19,116			; TEXTO t
001e4c e3b4      		LDI			R27,52			; TEXTO 4
001e4d e003      		LDI			R16,3			; NUMERO DE CARACTERES A ESCRIBIR
001e4e e0d9      		LDI			YH,HIGH(N_RD)
001e4f ebcb      		LDI			YL,LOW (N_RD)
001e50 940e 1dce 		CALL		P_NEXTION_TEXTO	
                 
                 ; t9 ENVIA EL REDOX PROGRAMADO TEXTO t9
001e52 e734      		LDI			R19,116			; ENVIA UNA t
001e53 e3b9      		LDI			R27,57			; TEXTO 9
001e54 e003      		LDI			R16,3			; NUMERO DE CARACTERES A ESCRIBIR
001e55 e0d9      		LDI			YH,HIGH(N_RDP)
001e56 e2cd      		LDI			YL,LOW (N_RDP)
001e57 940e 1dce 		CALL		P_NEXTION_TEXTO	
                 
                 N_NEXTION_P2:
                 
                 ; j0 ENVIA EL VALOR PARA LA BARRA PROGRESIVA (j0.val=90)
                 ;		RCALL		P_NEXTION_VAL	; ENVIA EL VALOR DE LA PRODUCCION PARA LA BARRA Y TERMINA CON 0xFF
                 
                 ; j7 ENVIA LOS MINUTOS TEXTO EN LA BARRA
001e59 e63a      		LDI			R19,106			; ENVIA UNA J
001e5a e3b7      		LDI			R27,55			; TEXTO 7
001e5b e002      		LDI			R16,2			; NUMERO DE CARACTERES A ESCRIBIR
001e5c e0d5      		LDI			YH,HIGH (N_BAR)
001e5d e6ce      		LDI			YL,LOW  (N_BAR)
001e5e 940e 1dce 		CALL		P_NEXTION_TEXTO
                 
                 ; ENVIA EL COLOR DE FONDO DE PRODUCCION. GRIS O VERDE
001e60 9994      		SBIC		PORTD,4
001e61 c00b      		RJMP		N_NEXTION_P3
001e62 e0ac      		LDI			R26,12				; NUMERO DE CARACTERES A ENVIAR A LA PANTALLA
001e63 e335      		LDI			R19,53				; UN 5 QUE ES EL TEXTO PRODUCCION
001e64 9330 0a25 		STS			0xA25,R19
001e66 e0da      		LDI			YH,HIGH(ROJO)		; CAMBIA EL COLOR DEL FONDO Y LO PONE GRIS CON PRODUCION
001e67 e2c4      		LDI			YL,LOW(ROJO)
001e68 940e 1df3 		CALL		UARTN_TXT_RAM3
001e6a 940e 1de9 		CALL		P_NEXTION_FINAL 	; ENVIA 3 0xFF
001e6c c00b      		RJMP		N_NEXTION_P4
                 N_NEXTION_P3:
                 ;		CALL		UART_INI1
001e6d e0ab      		LDI			R26,11				; NUMERO DE CARACTERES A ENVIAR A LA PANTALLA
001e6e e335      		LDI			R19,53				; POSICION EN RAM DEL NUMERO DEL TEXTO PRODUCCION
001e6f 9330 0a39 		STS			0xA39,R19
001e71 e0ab      		LDI			R26,11				; NUMERO DE CARACTERES A ENVIAR A LA PANTALLA
001e72 e0da      		LDI			YH,HIGH(VERDE)		; CAMBIA EL COLOR DEL FONDO Y LO PONE VERDE CON PRODUCION
001e73 e3c8      		LDI			YL,LOW(VERDE)
001e74 940e 1df3 		CALL		UARTN_TXT_RAM3
001e76 940e 1de9 		CALL		P_NEXTION_FINAL
                 
                 N_NEXTION_P4:	; ENVIA POSICION DE POLARIDAD 1 O 2 LEE LOS LED ES EL LED 7
                 ; t8 ENVIA LA POLARIDAD ACTIVA 1 O 2
001e78 e331      		LDI			R19,49				; PONE UN 1
001e79 fef7      		SBRS		VAL_LED,7			; SALTA LA PROXIMA INSTRUCION SI ES UNO,
001e7a e332      		LDI			R19,50				; PONE UN 2
001e7b 9330 0a18 		STS			N_POS,R19			; GRABA EN RAM en 1 o un 2
001e7d e734      		LDI			R19,116				; ENVIA UNA t			
001e7e e3b8      		LDI			R27,56				; TEXTO 8 
001e7f e001      		LDI			R16,1				; NUMERO DE CARACTERES A ESCRIBIR
001e80 e0da      		LDI			YH,HIGH(N_POS)
001e81 e1c8      		LDI			YL,LOW(N_POS)
001e82 940e 1dce 		CALL		P_NEXTION_TEXTO		
                 
                 
                 N_NEXTION_PH:					; ENVIA SEÑAL DE BOMBA DE PH EN MARCHA "VERDE" O PARADA "GRIS"
001e84 fcf4      		SBRC		VAL_LED,4			; SALTA LA PROXIMA INSTRUCION SI ES UNO, LED DE PH ENCENDIDO
001e85 c00b      		RJMP		N_NEXTION_PH1
001e86 e337      		LDI			R19,55				; UN 7 QUE ES EL TEXTO A ENVIAR
001e87 9330 0a25 		STS			0xA25,R19
001e89 e0ac      		LDI			R26,12				; NUMERO DE CARACTERES A ENVIAR
001e8a e0da      		LDI			YH,HIGH(ROJO)		; CAMBIA EL COLOR DEL FONDO Y LO PONE rojo CON PRODUCION
001e8b e2c4      		LDI			YL,LOW(ROJO)
001e8c 940e 1df3 		CALL		UARTN_TXT_RAM3		; ENVIA SOLO TEXTO DE RAM
001e8e 940e 1de9 		CALL		P_NEXTION_FINAL		; ENVIA 3 0xFF
001e90 c00a      		RJMP		N_NEXTION_PH2
                 
                 N_NEXTION_PH1:
001e91 e337      		LDI			R19,55				; POSICION EN RAM DEL NUMERO DEL TEXTO A ENVIAR UN 7
001e92 9330 0a39 		STS			0xA39,R19
001e94 e0ab      		LDI			R26,11				; NUMERO DE CARACTERES A ENVIAR A LA PANTALLA
001e95 e0da      		LDI			YH,HIGH(VERDE)		; CAMBIA EL COLOR DEL FONDO Y LO PONE VERDE CON PRODUCION
001e96 e3c8      		LDI			YL,LOW(VERDE)
001e97 940e 1df3 		CALL		UARTN_TXT_RAM3		; ENVIA SOLO TEXTO DE RAM
001e99 940e 1de9 		CALL		P_NEXTION_FINAL		; ENVIA 3 0xFF
                 
                 N_NEXTION_PH2:							;j6 0x96B			; PH PROGRAMADO
                 ; envia ph programado
001e9b e63a      		LDI			R19,106				; ENVIA UNA j
001e9c e3b6      		LDI			R27,54				; TEXTO 6
001e9d e003      		LDI			R16,3				; NUMERO DE CARACTERES A ESCRIBIR
001e9e e0d9      		LDI			YH,HIGH(N_PHP)
001e9f e6cb      		LDI			YL,LOW (N_PHP)
001ea0 940e 1dce 		CALL		P_NEXTION_TEXTO		
001ea2 9508      RET
                 ; ENVIA ANAGRAMA POLARIDAD 1 o 2 CON CIRCULO PIC 36 Y 35 RESPACTIVAMENTE
                 
001ea3 e336      		LDI			R19,54				; PONE UN 6
001ea4 fef7      		SBRS		VAL_LED,7			; SALTA LA PROXIMA INSTRUCION SI ES UNO,
001ea5 e335      		LDI			R19,53				; PONE UN 5
001ea6 9330 0a80 		STS			0xA80,R19			; GRABA EN RAM en 1 o un 2
001ea8 e0ad      		LDI			R26,13				; NUMERO DE CARACTERES A ENVIAR
001ea9 e0da      		LDI			YH,HIGH(N_POL1)		; CAMBIA EL COLOR DEL FONDO Y LO PONE rojo CON PRODUCION
001eaa e7c4      		LDI			YL,LOW(N_POL1)
001eab 940e 1df3 		CALL		UARTN_TXT_RAM3		; ENVIA SOLO TEXTO DE RAM
001ead 940e 1de9 		CALL		P_NEXTION_FINAL		; ENVIA 3 0xFF
                 
                 
                 ; *******************OPCIONAL ENVIA UN RETORNO DE CARRO *******************************
                 ;		LDI			R16,13				; ENVIA 13
                 ;		OUT 		UDR0,R16			; pone el valor de dato en el registro de transmision
001eaf 9508      		RET
                 
                 ;				******************TERMINA PANTALLA PRINCIPAL*************************************
                 ;             	*********************************PANTALLA INFORMACION*****************************
                 INI_NEXTION_I:
                 
001eb0 940e 105b 		CALL		HORAS				; ACTUALIZA LAS HORAS DE USO DEL EQUIPO
                 ;  ENVIA HORAS DE USO DEL EQUIPO   i1 CARACTERES 4 PANTALLA INFORMACION
001eb2 e639      		LDI			R19,105				; ENVIA UNA i
001eb3 e3b1      		LDI			R27,49				; TEXTO 1
001eb4 e004      		LDI			R16,4				; NUMERO DE CARACTERES A ESCRIBIR
001eb5 e0d9      		LDI			YH,HIGH(N_ELE)	
001eb6 eec3      		LDI			YL,LOW (N_ELE)
001eb7 940e 1dce 		CALL		P_NEXTION_TEXTO	
                 
                 ;  PORCENTAJE DE USO DEL ELECTRODO i2 CARACTERES 3 PANTALLA INFORMACION
001eb9 e639      		LDI			R19,105				; ENVIA UNA i
001eba e3b2      		LDI			R27,50				; TEXTO 2
001ebb e004      		LDI			R16,4				; NUMERO DE CARACTERES A ESCRIBIR
001ebc e0d7      		LDI			YH,HIGH(N_VEL)
001ebd eac0      		LDI			YL,LOW (N_VEL)
001ebe 940e 1dce 		CALL		P_NEXTION_TEXTO	
                 
                 
                 ;  TEMPERATURA DEL AGUA				i3 CARACTERES 3 PANTALLA INFORMACION
001ec0 e639      		LDI			R19,105				; ENVIA UNA i
001ec1 e3b3      		LDI			R27,51				; TEXTO 3
001ec2 e004      		LDI			R16,4				; NUMERO DE CARACTERES A ESCRIBIR
001ec3 e0d6      		LDI			YH,HIGH(N_TEM)
001ec4 e5cd      		LDI			YL,LOW (N_TEM)
001ec5 940e 1dce 		CALL		P_NEXTION_TEXTO	
                 
                 ;  SENSOR DE FLUJO				i4 CARACTERES 3 PANTALLA INFORMACION
001ec7 e639      		LDI			R19,105				; ENVIA UNA i
001ec8 e3b4      		LDI			R27,52				; TEXTO 4
001ec9 e002      		LDI			R16,2				; NUMERO DE CARACTERES A ESCRIBIR
001eca e0da      		LDI			YH,HIGH(N_FLU)
001ecb e1cd      		LDI			YL,LOW (N_FLU)
001ecc 940e 1dce 		CALL		P_NEXTION_TEXTO	
                 
                 ; ENVIA UNA VEZ POR SEGUNDO Y CUENTA SEGUNDOS HASTA 10 VIENE DE LA ULTIMA LINEA DE LECTURA TECLADO 
                 N_PRU:
001ece feb0      		SBRS		CONTROL_1,0			; SALTA LA PROXIMA INSTRUCION SI ES UNO,
001ecf cffe      		RJMP		N_PRU
001ed0 94e8      		CLT								; PONE A CERO EL BIT T DE SREG
001ed1 f8b0      		BLD			CONTROL_1, 0		; PASA EL REGISTRO T A CONTROL_1
001ed2 95fa      		DEC			R31					; DESCUENTA UN SEGUNDO	
001ed3 f431      		BRNE		N_PRU1
001ed4 e300      		LDI			R16,48				; ESCRIBE EN RAM LA PAGINA A ENVIAR LA 00
001ed5 9300 0a01 		STS			0xA01,R16
001ed7 940e 1f9e 		CALL		P_NEXTION_PAGE
001ed9 9508      		RET
                 N_PRU1:
001eda 9100 0c02 		LDS			R16,RG_232+1		; LEE EL VALOR ENVIADO POR LA PANTALLA TECLA SALIR
001edc 3000      		CPI			R16,00				; COMPARA R16 CON 00
001edd f691      		BRNE		INI_NEXTION_I		; SALTA ESTA INSTRUCION SI NO ES IGUAL
001ede e300      		LDI			R16,48
001edf 9300 0a01 		STS			0xA01,R16
001ee1 940e 1f9e 		CALL		P_NEXTION_PAGE
001ee3 9508      		RET
                 
                 
                 
                 ; 		*************************************************  TERMINA PANTALLA INFORMACION *********************************
                 ; 		************************************************* PROGRAMACION DE LOS PARAMETROS ********************************
                 INI_NEXTION_PA:
                 
                 ; ENVIA PORCENTAJE DE PRODUCION	PROGRAMADO		t5
001ee4 e734      		LDI			R19,116				; TEXTO t
001ee5 e3b5      		LDI			R27,53				; TEXTO 5
001ee6 e004      		LDI			R16,4				; NUMERO DE CARACTERES A ESCRIBIR
001ee7 e0d9      		LDI			YH,HIGH (N_PRO)
001ee8 e5c6      		LDI			YL,LOW  (N_PRO)
001ee9 940e 1dce 		CALL		P_NEXTION_TEXTO
                 
                 ;  ENVIA EL PH PROGRAMADO              	j6 EN PANTALLA PARAMETROS ENVIAR 3 CARACTERES	
001eeb e63a      		LDI			R19,106				; ENVIA UNA j
001eec e3b6      		LDI			R27,54				; TEXTO 6
001eed e003      		LDI			R16,3				; NUMERO DE CARACTERES A ESCRIBIR
001eee e0d9      		LDI			YH,HIGH(N_PHP)
001eef e6cb      		LDI			YL,LOW (N_PHP)
001ef0 940e 1dce 		CALL		P_NEXTION_TEXTO		
                 
                 
                 ;  ENVIA EL RD	                	j7 EN PANTALLA PARAMETROS ENVIAR 3 CARACTERES	
001ef2 e63a      		LDI			R19,106				; ENVIA UNA j
001ef3 e3b7      		LDI			R27,55				; TEXTO 7
001ef4 e003      		LDI			R16,3				; NUMERO DE CARACTERES A ESCRIBIR
001ef5 e0d9      		LDI			YH,HIGH(N_RDP)
001ef6 e2cd      		LDI			YL,LOW (N_RDP)
001ef7 940e 1dce 		CALL		P_NEXTION_TEXTO		
                 
                 ; ENVIA HORAS CAMBIO DE POLARIDAD 	j5 CARACTERES 1
001ef9 e63a      		LDI			R19,106				; ENVIA UNA j
001efa e3b5      		LDI			R27,53				; TEXTO 5
001efb e001      		LDI			R16,1				; NUMERO DE CARACTERES A ESCRIBIR
001efc e0d9      		LDI			YH,HIGH(N_POL)
001efd eaca      		LDI			YL,LOW (N_POL)		; PARA ENVIAR UN 52 ASCI DEL 4
001efe 940e 1dce 		CALL		P_NEXTION_TEXTO	
                 
                 ; ENVIA EL NIVEL PROGRAMADO DE CLORO j8
001f00 e63a      		LDI			R19,106				; ENVIA UNA j
001f01 e3b8      		LDI			R27,56				; TEXTO 8
001f02 e003      		LDI			R16,3				; NUMERO DE CARACTERES A ESCRIBIR
001f03 e0d9      		LDI			YH,HIGH(N_CLP)
001f04 e9c2      		LDI			YL,LOW (N_CLP)		; PARA ENVIAR UN 52 ASCI DEL 4
001f05 940e 1dce 		CALL		P_NEXTION_TEXTO	
                 
                 
                 N_PRUA:
001f07 feb0      		SBRS		CONTROL_1,0			; SALTA LA PROXIMA INSTRUCION SI ES UNO,
001f08 cffe      		RJMP		N_PRUA
001f09 94e8      		CLT								; PONE A CERO EL BIT T DE SREG
001f0a f8b0      		BLD			CONTROL_1, 0		; PASA EL REGISTRO T A CONTROL_1
001f0b 95fa      		DEC			R31					; DESCUENTA UN SEGUNDO
001f0c f431      		BRNE		N_PRU1A
001f0d e300      		LDI			R16,48				; ESCRIBE EN RAM LA PAGINA A ENVIAR LA 00
001f0e 9300 0a01 		STS			0xA01,R16
001f10 940e 1f9e 		CALL		P_NEXTION_PAGE		; TERMINA EL TIEMPO Y VA A PANTALLA PRINCIPAL
001f12 9508      		RET
                 
                 N_PRU1A:			
001f13 9120 0c01 		LDS			R18,RG_232
001f15 3721      		CPI			R18,0x71
001f16 f419      		BRBC		1,N_PRU2A			; SI DISTINTO VA A N_PRU2A
001f17 940e 1c2f 		CALL		N_PRO_PAR			; PROGRAMAR PARAMETROS LEYENDO RG_232+1
001f19 cfca      		RJMP		INI_NEXTION_PA
                 N_PRU2A:
001f1a 9120 0c02 		LDS			R18,RG_232+1
001f1c 3020      		CPI			R18,00				; 
001f1d f631      		BRBC		1,INI_NEXTION_PA	; SI ES DISTINTO VA A INI_NEXTION_PA
                 
001f1e e300      		LDI			R16,48
001f1f 9300 0a01 		STS			0xA01,R16
001f21 940e 1f9e 		CALL		P_NEXTION_PAGE		; ENVIA NEXTION A PAGINA 0
001f23 9508      		RET
                 
                 ;           *********************************** TERMINA PANTALLA PARAMETROS ***************************
                 ;			*********************************** PANTALLA CALIBRACION **********************************
                 
                 ;  PANTALLA CALIBRACION
                 
                 INI_NEXTION_CA:
                 
                 ; t2 ENVIA NIVEL DE SAL EN EL AGUA	t2 EN PRINCIPAL Y PARAMETROS	
001f24 e734      		LDI			R19,116				; ENVIA UNA t
001f25 e3b2      		LDI			R27,50				; TEXTO 2
001f26 e003      		LDI			R16,3				; NUMERO DE CARACTERES A ESCRIBIR
001f27 e0d9      		LDI			YH,HIGH(N_SALC)
001f28 e0c5      		LDI			YL,LOW (N_SALC)
001f29 940e 1dce 		CALL		P_NEXTION_TEXTO			
                 
                 
                 ;t3  ENVIA EL PH DEL AGUA           t3 EN PANTALLA PARAMETROS ENVIAR 3 CARACTERES	
001f2b e734      		LDI			R19,116				; ENVIA UNA t
001f2c e3b3      		LDI			R27,51				; TEXTO 3
001f2d e003      		LDI			R16,3				; NUMERO DE CARACTERES A ESCRIBIR
001f2e e0d4      		LDI			YH,HIGH(N_PH)
001f2f e6cd      		LDI			YL,LOW (N_PH)
001f30 940e 1dce 		CALL		P_NEXTION_TEXTO			
                 
                 ;t4 ENVIA EL REDOX DEL AGUA			c8 EN PANTALLA PARAMETROS ENVIAR 3 CARACTERES
001f32 e734      		LDI			R19,116				; ENVIA UNA t
001f33 e3b4      		LDI			R27,52				; TEXTO 4
001f34 e003      		LDI			R16,3				; NUMERO DE CARACTERES A ESCRIBIR
001f35 e0d9      		LDI			YH,HIGH(N_RD)
001f36 ebcb      		LDI			YL,LOW (N_RD)
001f37 940e 1dce 		CALL		P_NEXTION_TEXTO
                 
                 
                 ;c7 ENVIA EL CLORO DEL AGUA			c7 EN PANTALLA PARAMETROS ENVIAR 3 CARACTERES
001f39 e633      		LDI			R19,99				; ENVIA UNA C
001f3a e3b7      		LDI			R27,55				; TEXTO 7
001f3b e003      		LDI			R16,3				; NUMERO DE CARACTERES A ESCRIBIR
001f3c e0d9      		LDI			YH,HIGH(N_CL)
001f3d ecce      		LDI			YL,LOW (N_CL)
001f3e 940e 1dce 		CALL		P_NEXTION_TEXTO	
                 .
                 N_PRUB:
001f40 feb0      		SBRS		CONTROL_1,0			; SALTA LA PROXIMA INSTRUCION SI ES UNO,
001f41 cffe      		RJMP		N_PRUB
001f42 94e8      		CLT								; PONE A CERO EL BIT T DE SREG
001f43 f8b0      		BLD			CONTROL_1, 0		; PASA EL REGISTRO T A CONTROL_1
001f44 95fa      		DEC			R31					; DESCUENTA UN SEGUNDO
001f45 f431      		BRNE		N_PRU1B
001f46 e300      		LDI			R16,48				; ESCRIBE EN RAM LA PAGINA A ENVIAR LA 00
001f47 9300 0a01 		STS			0xA01,R16
001f49 940e 1f9e 		CALL		P_NEXTION_PAGE		; TERMINA EL TIEMPO Y VA A PANTALLA PRINCIPAL
001f4b 9508      		RET
                 
                 N_PRU1B:			
001f4c 9120 0c01 		LDS			R18,RG_232
001f4e 3721      		CPI			R18,0x71
001f4f f419      		BRBC		1,N_PRU1C
001f50 940e 1c2f 		CALL		N_PRO_PAR
001f52 cfd1      		RJMP		INI_NEXTION_CA
                 N_PRU1C:
001f53 9100 0c02 		LDS			R16,RG_232+1
001f55 3009      CPI		R16,9				; SI SE HA PULSADO LA TECLA DE DATOS EQUIPO
001f56 f431      BRBC	1,N_PRU1D
001f57 e309      LDI		R16,57				; ESCRIBE EN RAM LA PAGINA A ENVIAR LA 09
001f58 9300 0a01 STS		0xA01,R16
001f5a 940e 1f9e CALL	P_NEXTION_PAGE		; TERMINA EL TIEMPO Y VA A PANTALLA PRINCIPAL
001f5c 9508      RET
                 N_PRU1D:
001f5d 3000      		CPI			R16,00
001f5e f629      		BRBC		1,INI_NEXTION_CA	; SI NO ES CERO VA A INI_NEXTION_CA
001f5f e300      		LDI			R16,48				; ESCRIBE EN RAM LA PAGINA A ENVIAR LA 00
001f60 9300 0a01 		STS			0xA01,R16
001f62 940e 1f9e 		CALL		P_NEXTION_PAGE		; TERMINA EL TIEMPO Y VA A PANTALLA PRINCIPAL
001f64 9508      		RET
                 
                 ;   ******************************************TERMINA PANTALLA CALIBRACION *****************************
                 ;	****************************************** PANTALLA SEGUNDOS DE ESPERA *****************************
                 N_ESPERA:
                 ; tE ENVIA LOS SEGUNDOS DE ESPERA	tE SEGUNDOS DE ESPERA PARA LA PANTALLA DE CUENTA ENVIA 3 CARACTERES
001f65 e7a4      		LDI			R26,116				; ENVIA UNA t
001f66 e4b5      		LDI			R27,69				; ENVIA UNA E
001f67 e003      		LDI			R16,3				; NUMERO DE CARACTERES A ESCRIBIR
001f68 e0d6      		LDI			YH,HIGH(N_ESP)
001f69 eac3      		LDI			YL,LOW (N_ESP)
001f6a 940e 1dce 		CALL		P_NEXTION_TEXTO	
                 
001f6c 9508      		RET
                 
                 
                 ; ENVIA ANAGRAMA PEQUEÑO DE TEAP  REQUIERE ENVIA PRIMERO (pic) LUEGO COORDENADAS X E Y, Y CODIGO DEL DIBUJO QUE ES 29
                 P_NEXTION_TEAP:
001f6d 940e 1f8f 		CALL		P_NEXTION_PIC	; ENVIA pic Y  UN ESPACIO
001f6f e334      		LDI			R19,52			; 4
001f70 940e 1fa4 		CALL		P_NEXTION_BIT
001f72 e333      		LDI			R19,51			; 3
001f73 940e 1fa4 		CALL		P_NEXTION_BIT
001f75 e335      		LDI			R19,53			; 5
001f76 940e 1fa4 		CALL		P_NEXTION_BIT
001f78 e23c      		LDI			R19,44			; ,
001f79 940e 1fa4 		CALL		P_NEXTION_BIT
001f7b e331      		LDI			R19,49			; 1
001f7c 940e 1fa4 		CALL		P_NEXTION_BIT
001f7e e333      		LDI			R19,51			; 3
001f7f 940e 1fa4 		CALL		P_NEXTION_BIT
001f81 e337      		LDI			R19,55			; 7
001f82 940e 1fa4 		CALL		P_NEXTION_BIT
001f84 e23c      		LDI			R19,44			; ,
001f85 940e 1fa4 		CALL		P_NEXTION_BIT
001f87 e332      		LDI			R19,50			; 2
001f88 940e 1fa4 		CALL		P_NEXTION_BIT
001f8a e339      		LDI			R19,57			; 9
001f8b 940e 1fa4 		CALL		P_NEXTION_BIT
001f8d 940c 1de9 		JMP			P_NEXTION_FINAL	; ENVIA FIN CADENA Y RETORNA
                 
                 ; ENVIAR PIC DIBUJO POSICION X R24 POSICION Y R25 DIBUJO R26
                 P_NEXTION_PIC:				; 		envia pic y un espacio 4 caracteres
                 
001f8f e004      		LDI			R16,4			; NUMERO DE CARACTERES A ESCRIBIR
001f90 e0da      		LDI			YH,HIGH (N_PIC)
001f91 e0c4      		LDI			YL,LOW  (N_PIC)
001f92 de34      		RCALL		UARTN_TXC_RAM2	; ENVIA 7 CARACTERES DE LA RAM PORCENTAJE DE PRODUCCION
001f93 9508      		RET	
                 
                 P_NEXTION_VAL:					; PARA LA BARRA PROGRESIVA ENVIAR (j0.val=80)
                 ; ENVIA j0.val=
001f94 e007      		LDI			R16,7			; NUMERO DE CARACTERES A ESCRIBIR
001f95 e0da      		LDI			YH,HIGH (N_VAL)
001f96 e1c0      		LDI			YL,LOW  (N_VAL)
001f97 de2f      		RCALL		UARTN_TXC_RAM2	; ENVIA 7 CARACTERES DE LA RAM PORCENTAJE DE PRODUCCION
                 
                 ; ENVIA EL VALOR DE MINUTOS
001f98 e002      		LDI			R16,2			; NUMERO DE CARACTERES A ESCRIBIR
001f99 e0d5      		LDI			YH,HIGH (N_BAR)
001f9a e6ce      		LDI			YL,LOW  (N_BAR)
001f9b de2b      		RCALL		UARTN_TXC_RAM2	; ENVIA 2 CARACTERES DE LA RAM PORCENTAJE DE PRODUCCION
001f9c de4c      		RCALL		P_NEXTION_FINAL	; ENVIA 3 FF Y TERMINA
001f9d 9508      		RET
                 
                 
                 P_NEXTION_PAGE:		; ENVIAR CAMBIO DE PAGINA **PAGE 0**	ESCRIBIR EN RAM PASICION A01 EL NUMERO DE LA PAGINA
001f9e e006      		LDI			R16,6			; NUMERO DE CARACTERES A ESCRIBIR
001f9f e0d9      		LDI			YH,HIGH (N_PAG)
001fa0 efcc      		LDI			YL,LOW  (N_PAG)
001fa1 de25      		RCALL		UARTN_TXC_RAM2	; ENVIA 7 CARACTERES DE LA RAM PORCENTAJE DE PRODUCCION
001fa2 940c 1de9 		JMP			P_NEXTION_FINAL	; ENVIA 3 FF Y TERMINA
                 
                 
                 ; NEXTION ENVIAR UN BIT EN R19 Y UNA COMA
                 P_NEXTION_BIT:
                 ;		LDI			R19,32
001fa4 9330 000c 		STS			UDR0,R19		; ENVIA UN ESPACIO EN BLANCO
001fa6 940e 1af3 		CALL		UART_TXC1		; RUTINA PARA VERIFICAR EL FIN DEL ENVIO DEL DATO
001fa8 9508      		RET
                 
                 ; ACTUALIZAR VALOR DE TEMPERATURA, HORAS DE USO Y VIDA DEL ELECTRODO
                 P_NEXTION_AC:
                 
001fa9 e027      		LDI			R18,P_TEMP			; LINEA A LEER
001faa e5a0      		LDI			R26,80				; NUMERO DE LECTURAS
001fab 940e 013c 		CALL		ADC_P
                 ;LDI R24,00
001fad 9380 020f 		STS			RAM_TEMP,R24		; GUARDA LA LECTURA EN LA MEMORIA RAM
001faf 940e 06c8 		CALL		PCF2_T				; RUTINA QUE PREPARA LA PRESENTACION DE LA TEMPERATURA
001fb1 940e 105b 		CALL		HORAS				; PRESENTA HORAS Y AMPERIOS (PROD CLORO)
001fb3 fcb6      		SBRC		CONTROL_1,6			; SALTA LA PROXIMA INSTRUCION SI ES CERO, CONTROL DE FLUJO
001fb4 c006      		RJMP		P_NEXTION_AC1		; SI ES CERO A P_NEXYION_AC1 Y DEJA EL NO, "NO PONE EL SI"
                 ; CAMBIA TEXTO EN 0x7A0 NO POR SI
                 
001fb5 e533      		LDI			R19,83				; UNA S
001fb6 9330 0a1d 		STS			0xA1D,R19			
001fb8 e439      		LDI			R19,73				; UNA I
001fb9 9330 0a1e 		STS			0xA1E,R19
                 P_NEXTION_AC1:
001fbb 9508      		RET
                 
                 
                 
                 
                 
                 
                 
                 
                 	
                 .INCLUDE "PWM_ATMEGA.ASM"
                 
                 ;		7		6		5		4		3		2		1		0
                 ;		FOC0	WGM00	COM01	C0M00	WGM01	CS02	CS01	CS00
                 
                 
                 ;
                 ;	Modo de Comparación de Salida, Modo rapido PWM
                 ;
                 ;	WGM01		WGM00		Descripción
                 ;		0 		0 		Modo en operación normal, OC0A desconectado.
                 ;
                 ;		0 		1 		PWM control
                 ;
                 ;		1 		0 		CTC
                 ;
                 ;
                 ;		1 		1 		Fast pwm
                 ;
                 ;
                 ;	Modo de Comparación de Modo fase correcta PWM
                 ;
                 ;		COM01 	COM00 Descripción
                 ;		0 		0 		Modo en operación normal, OC0A desconectado.
                 ;
                 ;		0 		1 		Reservado
                 ;
                 ;		1 		0 		Pone a cero oc0
                 ;
                 ;		1 		1 		Pone a 1 oc0
                 
                 ;CS02,CS01,CS00 DIVISIR DE FRECUENCIA
                 ; DDR 		SALIDA A UNO ENTRADA A CERO
                 ; PORT		A UNO LA RESISTENCIA PUS-PULL ACTIVADA- EN OPCION SALIDA VALOR DE ESTA A CERO Ó A UNO
                 ; PIN		LECTURA DEL VALOR DE ENTRADA
                 
                 ;	CS02 	CS01 	CS00 	Descripción
                 ;	0 		0 		0 		Sin fuente de Reloj(Timer/Contador parados)
                 ;	0 		0 		1 		Clk I/O (Sin prescalador)
                 ;	0 		1 		0 		Clk I/O /8(Prescalador)    FRECUENCI /   4000
                 ;	0 		1 		1 		Clk I/O /64(Prescalador)   FRECUENCIA / 16000
                 ;	1 		0 		0 		Clk I/O /256(Prescalador)  FRECUENCIA / 32000
                 ;	1 		0 		1 		Clk I/O /1024(Prescalador) FRECUENCIA / 64000
                 ;	1 		1 		0 		Fuente de Reloj Externo pin T0. Reloj con flanco de bajada
                 ;	1 		1 		1 		Fuente de Reloj Externo pin T0. Reloj con flanco de subida
                 
                 ; INICILAIZA EL TIMER 0 COMO PWM SALIDA POR PUERTO B4
                 
                 .equ	AMP_PWM= 0xAC4	; POSICION EN RAM DEL CICLO PWM AMPERIOS REALES
                 ; 0xAC6 
                 .equ	EXC_SAL= 0xA88	; POSICION TEXTO EXCESO DE SAL
                 .equ	SHUNT_MOS=0xA9C
                 ;DC_PWM_0:			; INICIALIZA EL RELOJ	TCCR0 VER DC_MOTOR ATMEGA 32 EN CARPETA DATA
001fbc e107      	LDI				R16,0B00010111	; PUERTO 4 SALIDA DE SEÑAL PWM
001fbd bb07      	OUT   			DDRB, R16		; 
001fbe e90f      	LDI				R16,0B10011111	; 
001fbf bb08      	OUT   			PORTB, R16		; 
001fc0 e703       	LDI				R16,(1<<WGM00)|(0<<WGM01)|(1<<COM00)|(1<<COM01)|(0<<CS02)|(1<<CS01)|(1<<CS00)
001fc1 bf03      	OUT				TCCR0,R16
001fc2 e604      	LDI				R16,100			; VELOCIDAD INICIAL
001fc3 bf01      	OUT				OCR0,R16
001fc4 9508      	RET
                 
                 ; INICIALIZA EL PUERTO 2 COMO PWM SALIDA POR PUERTO B7
                 DC_PWM_2:
                 
001fc5 e907      	LDI				R16,0B10010111	; PUERTO 7 SALIDA DE SEÑAL PWM
001fc6 bb07      	OUT   			DDRB, R16		; 
001fc7 e90f      	LDI				R16,0B10011111	; 
001fc8 bb08      	OUT   			PORTB, R16		; 
001fc9 e603       	LDI				R16,(1<<WGM20)|(0<<WGM21)|(0<<COM20)|(1<<COM21)|(0<<CS22)|(1<<CS21)|(1<<CS20)
001fca bd05      	OUT				TCCR2,R16
001fcb e604      	LDI				R16,100			; VELOCIDAD INICIAL
001fcc bd03      	OUT				OCR2,R16
001fcd 9508      	RET
                 
                 
                 DC_PWM_3:							; viene de la linea 348 del programa principal
                 ; INICIALIZA PUERTO 3 COMO SALIDA PWM POR PUERTO E3 OC3A PATA 5 
001fce ee0f      	LDI				R16,0B11101111	; PUERTO E3 SALIDA DE SEÑAL PWM
001fcf b902      	OUT   			DDRE, R16		; 
001fd0 ef0f      	LDI				R16,0B11111111	; 
001fd1 b903      	OUT   			PORTE, R16		; 
                 
                 ;	LDI				R16,(1<<COM3A1)|(0<<COM3A0)|(0<<COM3B1)|(0<<COM3B0)|(0<<COM3C1)|(0<<COM3C0)|(1<<WGM31)|(0<<WGM30)
001fd2 ec02      	LDI				R16,(1<<COM3A1)|(1<<COM3A0)|(0<<COM3B1)|(0<<COM3B0)|(0<<COM3C1)|(0<<COM3C0)|(1<<WGM31)|(0<<WGM30)
001fd3 9300 008b 	STS				TCCR3A,R16
                 ;	LDI				R16,(0<<ICNC3)|(0<<ICES3)|(1<<WGM33)|(1<<WGM32)|(0<<CS32)|(0<<CS31)|(1<<CS30) ; EL REGISTRO 5 NO SE USA
001fd5 e10a      	LDI				R16,(0<<ICNC3)|(0<<ICES3)|(1<<WGM33)|(1<<WGM32)|(0<<CS32)|(1<<CS31)|(0<<CS30) ; EL REGISTRO 5 NO SE USA(010% 60 ciclos 001 500 ciclos)
001fd6 9300 008a 	STS				TCCR3B,R16
                 
001fd8 e000      	LDI				R16,0x00
001fd9 9300 0089 	STS				TCNT3H,R16
001fdb e000      	LDI				R16,0x00
001fdc 9300 0088 	STS				TCNT3L,R16
                 
001fde e400      	LDI				R16,0x40					; CON ICR3H E ICR3L SE CONTROLA LA FECUENCIA
001fdf 9300 0081 	STS				ICR3H,R16
001fe1 e000      	LDI				R16,0x00
001fe2 9300 0080 	STS				ICR3L,R16
                 
001fe4 e000      	LDI				R16,0x00					; SE CONTROLA LOS AMPERIOS EMPIEZO CON CERO
001fe5 9300 0087 	STS				OCR3AH,R16
001fe7 e000      	LDI				R16,0x00
001fe8 9300 0086 	STS				OCR3AL,R16
001fea e302      	LDI				R16,0x32						; ESTE VALOR CORRESPONDE AL 80% EN TIEMPO DE TRABAJO DEL MOS-FET VALOR DE INICIO
                 
001feb 9300 0ac4 	STS				AMP_PWM,R16					; VALOR INICIAL DE LA INTENSIDAD AL ACTIVAR LA PRODUCCION VALOR NORMAL 50
001fed e684      	ldi				r24,100	; valor inicial para el control por teclado
001fee 9380 0ac6 	STS				AMP_PWM+2,R24
                 
001ff0 9508      	RET
                 
                 ; RUTINA CONTROL DE LOS AMPERIOS POR LA SEÑAL DEL SHUNT PATA 5 DEL MICRO E3 OC3A
                 DC_PWM_0A:
001ff1 940e 2081 	CALL			PW_POT_0					; RUTINA CONTROL POR POTENCIOMETRO SELECION PUERTO DE ENTRADA LINEA 203
                 ;	CALL			PW_PUL_0					; RUTINA CONTROL POR PULSADOR
                 ; CONTROL DE AMPERIOS VALOR 50 EL VALOR SE GRABA EN RAM POSICION 0xAC4
                 ;	LSR				R24
                 
001ff3 91a0 0ac4 	LDS				R26,AMP_PWM
001ff5 3288      	CPI				R24,40
001ff6 f038      	BRBS			0,DC_PWM_40					; SI ES MENOR DE 40 VA A SUMARLE 10
001ff7 3381      	CPI				R24,49	
001ff8 f438      	BRBC			0,DC_PWM_0A1				; SI ES MAYOR DE 49 O IGUAL VA A DC_PWM_0A1
                 ;INC		R26
001ff9 95a3      	INC				R26							; INCREMENTA UNA UNIDAD
001ffa 34a0      	CPI				R26,64
001ffb f070      	BRBS			0,DC_PWM_0A3				; SI R26 ES MENOR DE 64 VA A DC_PWM_0A3
001ffc e4a0      	LDI				R26,64						; SI ES IGUAL O MAYOR PONE 64 MAXIMA PRODUCCION
001ffd c00c      	RJMP			DC_PWM_0A3
                 DC_PWM_40:
001ffe 961a      	ADIW			R26,10						; INCREMENTA EN 10 UNIDADES
001fff c00a      	RJMP			DC_PWM_0A3
                 DC_PWM_0A1:
002000 338c      	CPI				R24,60
002001 f438      	BRBC			0,DC_PWM_60					; SI ES MAYOR DE 60 O IGUAL VA A REDUCIR 10 UNIDADES
002002 3384      	CPI				R24,52
002003 f030      	BRBS			0,DC_PWM_0A3				; SI ES MENOR DE 52 VA A DC_PWM_0A3
002004 95aa      	DEC				R26							; DISMINUYE UNA UNIDAD
                 ;DEC		R26
002005 30a2      	CPI				R26,2
002006 f418      	BRBC			0,DC_PWM_0A3				; SI ES MAYOR DE 2 O IGUAL NO HACE NADA SI ES MENOR LO PONE A 2
002007 e0a2      	LDI				R26,2
002008 c001      	RJMP			DC_PWM_0A3
                 DC_PWM_60:
002009 50aa      	SUBI			R26,10						; INCREMENTA 10 UNIDADES
                 
                 DC_PWM_0A3:
                 
                 
00200a 34a0      CPI			R26, 64
00200b f008      BRBS		0,DC_PWM_0A3_A		; SI ES MENOR DE 64 VA A
00200c e4a0      LDI			R26,64
                 
                 DC_PWM_0A3_A:
00200d 93a0 0ac4 	STS		AMP_PWM,R26
                 ; PARA PONER EN LA LINEA 1 AL FINAL EL PORCENTAJE DE PRODUCCION
                 
                 
                 ; O J O SELECIONAR REGISTRO DE CONTROL
                 ;	OUT				OCR0,R24					; SALIDA TIMER 0
                 ;	OUT				OCR2,R24					; SALIDA TIMER 2
                 ;LSR	R24
00200f 93a0 0ac7 STS		AMP_PWM+3,R26
002011 93a0 0087 	STS				OCR3AH,R26					; SALIDA TIMER 3 LOS DOS REGISTROS SI NO NO FUNCIONA
002013 93a0 0086 	STS				OCR3AL,R26
                 ;	STS				OCR3BH,R26					; SALIDA TIMER 3 LOS DOS REGISTROS SI NO NO FUNCIONA
                 ;	STS				OCR3BL,R26
                 ;	STS				OCR3CH,R26					; SALIDA TIMER 3 LOS DOS REGISTROS SI NO NO FUNCIONA
                 ;	STS				OCR3CL,R26
                 
                 ;	COM				R24
                 
                 ;	LDI				R16,128						; ESCRIBIR LINEA 2
                 ;	CALL			ENVINT						; En subrrutina Env_doi Envia instrucion para escribir en linea 1
                 ;	LDI				YH, HIGH(LIN1)				; POSICION BIT ALTO DEL TEXTO A ENVIAR ram en 070
                 ;	LDI				YL, LOW(LIN1)				; POSICION BIT BAJO DEL TEXTO A ENVIAR
                 ;	LDI				R17,20						; NUMERO DE DIGITOS A ENVIAR A PANTALLA
                 ;	CALL			ENVIARTEXTO					; RUTINA EN ESTE FICHERO PRECISA SUBRRUTINA ENV_DOI	
                 ;	RJMP			DC_PWM_0A
                 ; AQUI EL CONTROL DE CORTE POR EXCESO DE PICO DE AMPERIOS
002015 9180 0ac4 	LDS				R24,AMP_PWM 
002017 328d      	CPI				R24,0x02D
002018 f008      	BRBS			0,DC_PWM_CORTE				; SI EL % ES MENOR DE  VA A OPCION CORTE POR EXCESO DE AMPERIOS
002019 9508      	RET
                 ;       20x4        16x4   tipo de display
                 ; linea 1-128 		128 
                 ; linea 2-192		192
                 ; linea 3-148		144
                 ; linea 4-212		208
                 
                 DC_PWM_CORTE:								; OPCION CORTE POR EXCESO  DE SAL
                 
00201a e202      	LDI				R16,0x22			; SE PONE UN VALOR FIJO PARA MEDIR LA  SAL 50% DE PRODUCCION 0x020
00201b 9300 0087 	STS				OCR3AH,R16
00201d e202      	LDI				R16,0x22
00201e 9300 0086 	STS				OCR3AL,R16	
002020 ef9a      LDI				R25,250
002021 940e 092a CALL			RETARDO
002023 ef9a      LDI				R25,250
002024 940e 092a CALL			RETARDO
002026 ef9a      LDI				R25,250
002027 940e 092a CALL			RETARDO
002029 ef9a      LDI				R25,250
00202a 940e 092a CALL			RETARDO
                 
00202c e026      	LDI				R18,P_SAL			; LINEA DE ENTRADA EN EL CONVERTIDOR PCF8591
00202d eda2      	LDI				R26,210; RAMC_SAL		; NUMERO DE MEDICIONES	
00202e 940e 013c 	CALL			ADC_P
                 
002030 940e 0590 	CALL			RADC				; PRESENTA EN LINEA 3 LA MEDICION DE SAL REAL
002032 9210 0a98 	STS				$A98, R1			; DECENAS
002034 9220 0a99 	STS				$A99, R2			; UNIDADES
002036 9230 0a9b 	STS				$A9B, R3			; DECIMAS	
002038 e23e      LDI			R19,46
002039 9330 0a9a STS			$A9A,R19
00203b 940e 02f2 	CALL			APAGAR_FUENTE				; APAGA LOS MOS-FET NO EL OSCILADOR
                 
                 
                 
                 
00203d 940e 091d 	CALL			LEDPANT						; ACTUALIZA LOS LED DE LA PANTALLA
                 ;	ESCRIBE  LINEA 2 EXCESO DE SAL
00203f ec00      	LDI				R16, 192			; 11000000 escribir en linea 2 linea (192)( linea 4 seria 212)
002040 940e 053e 	CALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION, " ESCRIBIR LINEA 2"
002042 e0da      	LDI				YH, HIGH (EXC_SAL)	; POSICION ALTA DEL TAXTO EN RAM 080
002043 e8c8      	LDI				YL, LOW  (EXC_SAL)	; direccion BAJA DEL TEXTO EN RAM  "EXCESO DE SAL"    	
002044 e114        	LDI				R17,20   			; bytes a enviar 
002045 940e 0925 	CALL			ENVIARTEXTO			; RUTINA PARA 
                 ;	ESCRIBE  LINEA 3 EQUIPO DETENIDO
002047 e904      	LDI				R16, 148			; 11000000 escribir en linea 2 linea (192)( linea 4 seria 212)
002048 940e 053e 	CALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION, " ESCRIBIR LINEA 2"
00204a e0d5      	LDI				YH, HIGH (LIN_2S)	; POSICION ALTA DEL TAXTO EN RAM 080
00204b e9cc      	LDI				YL, LOW  (LIN_2S)	; direccion BAJA DEL TEXTO EN RAM  "EQUIPO DETENIDO"    	
00204c e114        	LDI				R17,20   			; bytes a enviar 
00204d 940e 0925 	CALL			ENVIARTEXTO			; RUTINA PARA 
                 ; BORRA LINEA 1
00204f e800      	LDI				R16, 128			; 11000000 escribir en linea 2 linea (192)( linea 4 seria 212)
002050 940e 053e 	CALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION, " ESCRIBIR LINEA 2"
002052 e0d7      	LDI				YH, HIGH (BORRAR_LINEA)	; POSICION ALTA DEL TAXTO EN RAM 080
002053 eac4      	LDI				YL, LOW  (BORRAR_LINEA)	; direccion BAJA DEL TEXTO EN RAM  "CONSULTAR MANUAL"    	
002054 e114        	LDI				R17,20   			; bytes a enviar 
002055 940e 0925 	CALL			ENVIARTEXTO			; RUTINA PARA 
                 ; BORRA LINEA 4
002057 ed04      	LDI				R16, 212			; 11000000 escribir en linea 2 linea (192)( linea 4 seria 212)
002058 940e 053e 	CALL			ENVINT				; RUTINA PARA ENVIAR A LA PANTALLA UNA INSTRUCION, " ESCRIBIR LINEA 2"
00205a e0d7      	LDI				YH, HIGH (BORRAR_LINEA)	; POSICION ALTA DEL TAXTO EN RAM 080
00205b eac4      	LDI				YL, LOW  (BORRAR_LINEA)	; direccion BAJA DEL TEXTO EN RAM  "CONSULTAR MANUAL"    	
00205c e114        	LDI				R17,20   			; bytes a enviar 
00205d 940e 0925 	CALL			ENVIARTEXTO			; RUTINA PARA 
                 
00205f e035      	LDI				R19,5				; TIEMPO DE ESPERA PARA REARME
                 DC_PWM_CORTE1:
002060 0000      	NOP
002061 0000      	NOP
                 
002062 feb0      	SBRS			CONTROL_1,0			; SALTA LA PROXIMA INSTRUCION SI ES UNO,
002063 cffc      	RJMP			DC_PWM_CORTE1		; AJUSTE DE SEGUNDO
002064 94e8      	CLT									; PONE A CERO EL BIT T DE SREG
002065 f8b0      	BLD				CONTROL_1,0			; PASA EL REGISTRO T A CONTROL_1
002066 953a      	DEC				R19
002067 f099      	BRBS			1,DC_PWM_CORTE2		; SI LLEGA A CERO SALTA A RUT_2_B SI NO NO
                 ;	MOV				R24,R19
                 ;	STS				UDR1,R24			; ENVIA POR LA RS EL TIEMPO DE RETARDO
                 ;	CALL CADENA_UART
                 ; PRESENTACION DE TIEMPO QUE FALTA
                 ; ESCRIBE LINEA 1 " EN ESPERA
                 ;	LDI				R16,192			; 11000000 escribir en linea 1 linea (192)
                 ;	CALL			ENVINT
                 ;	LDI				YH,HIGH(EN_ESPERA)	; POSICION ALTA DEL TAXTO EN RAM
                 ;	LDI				YL,LOW (EN_ESPERA)	; direccion BAJA DEL TEXTO EN RAM      	
                 ; 	LDI				R17,20 				; bytes a enviar 
                 ;	CALL			ENVIARTEXTO			; RUTINA PARA ENVIAR TEXTO E PANRALLA
                 
                 ; ESCRIBE LINEA 2
002068 2f83      	MOV				R24,R19
002069 940e 0590 	CALL			RADC
00206b 9210 06a3 	STS				$6A3,R1
00206d 9220 06a4 	STS				$6A4,R2
00206f 9230 06a5 	STS				$6A5,R3
                 ;	LDI				R16,148				; 11000000 escribir en linea 2 linea (192)
                 ;	CALL			ENVINT
                 ;	LDI				YH,HIGH (N_SEG)		; POSICION ALTA DEL TAXTO EN RAM 080
                 ;	LDI				YL,LOW  (N_SEG)		; direccion BAJA DEL TEXTO EN RAM      	
                  ; 	LDI				R17,20 				; bytes a enviar 
                 ;	CALL			ENVIARTEXTO			; RUTINA PARA ENVIAR TEXTO E PANRALLA
                 ; ENVIA SEGUNDOS DE ESPERA A NEXTION
002071 933f      PUSH	R19							; SALVA EL CONTROL DE SEGUNDOS ENESPERA
002072 e734      		LDI			R19,116			; ENVIA UNA t
002073 e3b9      		LDI			R27,57			; TEXTO 9
002074 e003      		LDI			R16,3			; NUMERO DE CARACTERES A ESCRIBIR
002075 e0d6      		LDI			YH,HIGH(N_ESP)	
002076 eac3      		LDI			YL,LOW (N_ESP)
002077 940e 1dce 		CALL		P_NEXTION_TEXTO	
002079 913f      POP		R19
00207a cfe5      RJMP  DC_PWM_CORTE1
                 DC_PWM_CORTE2:
00207b 940e 0300 CALL	ENCENDER_FUENTE
00207d e3b0      LDI R27,0x030
00207e 93b0 0ac4 STS	AMP_PWM,R27
                 
002080 cf70      RJMP	DC_PWM_0A
                 
                 
                 PW_POT_0:			; CONTROL DE LA VELOCIDAD POR POTENCIOMETRO RESULTADO EN R24
002081 2788      	CLR				R24
                 ; CONFIGURAR TENSION DE REFERENCIA A VDD, FORMA DE ALMACENAMIENTO CON EL REGISTRO ADLAR A 1 Y CANAL A LEER
                 ;	LD1				R16, (0<<REFS1)|(1<<REFS0)|(0<<ADLAR) LEER LINEA ADC0 ES LA PATA 40
                 ;	LDI				R16,0B11100000				; SEÑAL INTERNA DE REFERENCIA A  VDC BIT 7Y6 A 2,5VOLTIOS
                 												; BIT DE ADLAR A 1 
002082 e8ac      	LDI				R26,140; RAMC_SAL			; NUMERO DE MEDICIONES
002083 e026      	LDI				R18,6;P_SAL					; LINEA DE ENTRADA EN EL CONVERTIDOR
002084 940e 013c 	CALL			ADC_P
002086 9380 0ac8 	STS				AMP_PWM+4,R24
                 ;	CALL			RADC
                 ;	STS				$7DE,R1
                 ;	STS				$7DF,R2						; VALOR DE LAS DECENAS LO COLOCA EN LA LINEA 1 DE MODELO
                 ;	STS				$7E0,R3						; VALOR DE LAS UNIDADES
002088 9508      	RET
                 
                 ; CONTROL DE LA POTENCIA POR EL TECLADO TECLAS + Y -	
                 PW_PUL_0:
002089 9380 0ac6 	STS				AMP_PWM+2,R24				; LEE DE RAM		
00208b 2700      	CLR				R16
00208c bb0a      	OUT				DDRA, R16					; PUERTO A COMO ENTRADA
00208d bb0b      	OUT				PORTA, R16					; CON VALOR 1 EN TODAS LAS SALIDAS
00208e 98ab      	CBI				PORTC, TEC					; pone a 0 el bit de PARA ACTIVAR EL TECLADO
00208f 0000      	NOP
002090 b319      	IN				R17, PINA					; lee el valor del puerto a y lo almacena en r17
002091 ef0f      	SER				R16							; PONE R16 TODO A 1
002092 9aab      	SBI				PORTC, TEC					; pone a 1 el bit PARA DESACTIVAR TECLADO
002093 bb0a      	OUT				DDRA, R16					; PUERTO A COMO SALIDA
002094 3e1f      	CPI				R17, 0B11101111				; TECLA +	SUBE PRODUCCION
002095 f091      	BREQ			PWM_B
002096 3f1d      	CPI				R17, 0B11111101				; TECLA -	BAJA PRODUCCION
002097 f021      	BREQ			PWM_A_0
002098 e684      ldi	r24,100	; valor inicial para el control por teclado " CUANDO NO SE PULSA SE PONE A 100 NI SUBE NI BAJA
002099 9380 0ac6 	STS				AMP_PWM+2,R24
00209b 9508      	RET
                 
                 PWM_A_0:
00209c 9583      	INC				R24
00209d 9583      	INC				R24
00209e 9583      	INC				R24
00209f 9583      	INC				R24
0020a0 9583      	INC				R24
0020a1 9583      	INC				R24
0020a2 3687      	CPI				R24,103
0020a3 f008      	BRBS			0,PWM_AA
0020a4 e688      	LDI				R24,104
                 PWM_AA:
0020a5 9380 0ac6 	STS				AMP_PWM+2,R24
0020a7 9508      	RET
                 
                 PWM_B:
0020a8 958a      	DEC				R24
0020a9 958a      	DEC				R24
0020aa 958a      	DEC				R24
0020ab 958a      	DEC				R24
0020ac 958a      	DEC				R24
0020ad 958a      	DEC				R24
0020ae 3680      	CPI				R24,96
0020af f408      	BRBC			0,PWM_BB
0020b0 e680      	LDI				R24,96
                 PWM_BB:
0020b1 9380 0ac6 	STS				AMP_PWM+2,R24	
0020b3 9508      	RET
                 ; ESTA ES LA OPCION PARA CONTROLAR LOS MOS ANTIGUA
0020b4 ee00      	LDI				R16,0b11100000				; SEÑAL DE REFERENCIA A 5 VOLTIOS BIT 7 A CERO PARA SEÑAL 2,5 BIT 7 A UNO 0B11100000
0020b5 0f02      	ADD				R16,R18						; EN R18 EL CANAL A LEER Y GANANCIA VER PAG 245
0020b6 b907      	OUT				ADMUX,R16
0020b7 ed07      	LDI				R16,0B11010111				; PREESCALA A 128 "8.000.000/128=62.500Hz
0020b8 b906      	OUT				ADCSRA,R16
                 ADC_P2B_0:
0020b9 b106      	IN				R16,ADCSRA
0020ba 0000      	NOP
0020bb fb06      	BST				R16,6						; CARGA EN EL REGISTRO T DE SREG EL 6 ACSRA
0020bc f3e6      	BRTS			ADC_P2B_0					; SALTA A ADC_P1 SI EL REGISTRO ES UNO SE PONE A CERO AL TERMINAR 
0020bd b185      	IN	 			R24,ADCH
0020be 9508      	RET
                 ; OPCION PONER EN PANTALLA EL % DE PRODUCCION
                 PONER_AJUSTE:
                 
0020bf 938f      	PUSH			R24
0020c0 9180 0ac7 	LDS				R24,AMP_PWM+3
0020c2 0f88      	LSL				R24
0020c3 ec38      	LDI				R19,200
0020c4 9f83      	MUL				R24,R19
0020c5 2d81      	MOV				R24,R1
                 
                 DC_PWM_0A4:
0020c6 940e 0590 	CALL			RADC
0020c8 9210 0aac 	STS				$AAC,R1						; VALOR DE LAS CENTENAS
0020ca 9220 0aad 	STS				$AAD,R2						; VALOR DE LAS DECENAS LO COLOCA EN LA LINEA 1 DE MODELO
0020cc 9230 0aae 	STS				$AAE,R3						; VALOR DE LAS UNIDADES
0020ce e285      	LDI				R24,37						; SIMBOLO ASCI DEL %
0020cf 9380 0aaf 	STS				$AAF,R24
0020d1 918f      	POP				R24
                 
                 ; SEÑAL DEL SHUNT AMPERIOS LINEA 1 POSICION 00
0020d2 2788      	CLR				R24
0020d3 e8ac      	LDI				R26,140; RAMC_SAL			; NUMERO DE MEDICIONES
0020d4 e026      	LDI				R18,6;P_SAL					; LINEA DE ENTRADA EN EL CONVERTIDOR
0020d5 940e 013c 	CALL			ADC_P
0020d7 9380 0ac8 	STS				AMP_PWM+4,R24
0020d9 940e 0590 	CALL			RADC
0020db 9210 0aa2 	STS				$AA2,R1						; VALOR DE LAS CENTENAS
0020dd 9220 0aa3 	STS				$AA3,R2						; VALOR DE LAS DECENAS LO COLOCA EN LA LINEA 1 DE MODELO
0020df 9230 0aa4 	STS				$AA4,R3						; VALOR DE LAS UNIDADES			
                 
0020e1 e800      	LDI				R16,128				; ESCRIBIR LINEA 1 MODELO DEL EQUIPO
0020e2 940e 053e 	CALL			ENVINT				; En subrrutina Env_doi Envia instrucion para escribir en linea 1
0020e4 e0da      	LDI				YH,HIGH(SHUNT_MOS)	; POSICION BIT ALTO DEL TEXTO A ENVIAR ram en 070
0020e5 e9cc      	LDI				YL,LOW (SHUNT_MOS)	; POSICION BIT BAJO DEL TEXTO A ENVIAR
0020e6 e114      	LDI				R17,20				; NUMERO DE DIGITOS A ENVIAR A PANTALLA
0020e7 940e 0925 	CALL			ENVIARTEXTO			; RUTINA EN ESTE FICHERO PRECISA SUBRRUTINA ENV_DOI
                 
0020e9 9508      	RET
                 .INCLUDE "SERVO.ASM"
                 
                 ; 0 VOLTIOS A -90 1,3 VOLTIOS A +90
                 
                 SERVO: ; MEDICION DE LA SEÑAL DEL POTENCIOMETRO RESULTADO EN R24
                 
                 ;	SBI				PORTE,5			; PONE A 1 LA SEÑAL DEL SEVO
                 
                 							; LINEA DE ENTRADA DE AMPERIOS LA 6 PARA PRUEBAS LA 4 pH
                 ; CONFIGURAR TENSION DE REFERENCIA A 2,5 SEÑAL INTERNA, FORMA DE ALMACENAMIENTO CON EL REGISTRO ADLAR A 1 Y CANAL A LEER
                 
0020ea 9a1d      	SBI				PORTE,5						; PONE A 1 LA SEÑAL DEL SERVO
0020eb 2788      	CLR				R24
0020ec e023       	LDI				R18, 3						; LENEA DE ENTRADA POTENCIOMETRO
0020ed ee00      	LDI				R16,0b11100000				; SEÑAL DE REFERENCIA A 5 VOLTIOS BIT 7 A CERO PARA SEÑAL 2,5 BIT 7 A UNO 0B11100000
0020ee 0f02      	ADD				R16,R18						; EN R18 EL CANAL A LEER Y GANANCIA VER PAG 245
0020ef b907      	OUT				ADMUX,R16
0020f0 ed07      	LDI				R16,0B11010111				; PREESCALA A 128 "8.000.000/128=62.500Hz
0020f1 b906      	OUT				ADCSRA,R16
                 ADC_P2B_1:
0020f2 b106      	IN				R16,ADCSRA
0020f3 0000      	NOP
0020f4 fb06      	BST				R16,6						; CARGA EN EL REGISTRO T DE SREG EL 6 ACSRA
0020f5 f3e6      	BRTS			ADC_P2B_1					; SALTA A ADC_P1 SI EL REGISTRO ES UNO SE PONE A CERO AL TERMINAR 
0020f6 b185      	IN	 			R24,ADCH
0020f7 9586      	LSR				R24							; DIVIDO ENTRE DOS POR RECORRIDO POTENCIOMETRO
0020f8 9583      	INC				R24							; SUMO UNO PARA QUE NUNCASEA CERO
0020f9 e238      	LDI				R19,40						; PARA EL AJUSTE DE CERO VOLTIOS POSICION -90 GRADOS
0020fa 0f83      	ADD				R24,R19
                 
                 ; TRANSCURRE 1 MILISEGUNDO ENTRE 1 Y 2 RECORRIDO MINIMO A MAXIMO
0020fb ef9a      	LDI				R25,250
                 SERVO1:
0020fc 95a8      	WDR
0020fd 0000      	NOP
0020fe 959a      	DEC				R25 
0020ff f7e1      	BRNE			SERVO1 						; HASTA AQUI 1 MILISEGUNDO  		;
002100 e199      	LDI				R25,25
002101 958a      	DEC				R24							; DESPLAZAMIENTO MAXIMO 1 MILISEGUNDO
002102 f7c9      	BRNE			SERVO1
002103 981d      	CBI				PORTE,5						; CORTA LA SEÑAL DEL SERVO
002104 9508      	RET
                 
                 ;	TIEMPO MUERTO SE ANULA EN PROGRAMACION NORMAL ????????????????????????????????????????????????????
002105 ef9a      LDI			R25,250
002106 ef8a      LDI			R24,250
                 SERVO2:
002107 95a8      	WDR
002108 0000      	NOP
002109 959a      	DEC				R25 
00210a f7e1      	BRNE			SERVO2 				; HASTA AQUI 1 MILISEGUNDO  		;
00210b ef9a      	LDI				R25,250
00210c 958a      	DEC				R24					; DESPLAZAMIENTO MAXIMO 1 MILISEGUNDO
00210d f7c9      	BRNE			SERVO2
                 
                 
00210e cfdb      RJMP		SERVO
                 ;  HASTA AQUI??????????????????????????????????????????????????????????????????????????????????????????
                 .INCLUDE "MOTOR_PAP.ASM"
                 
                 
                 ; SE USA EL PUERTO C SALIDAS 39 40 41 42 QUE SON RESPECTIVAMENTE C4,C5,C6,C7
                 ; PARA EL CONTROL DE LA VELOCIDAD SE USA ADC2 PATA 59
                 
                 
                   
                 ; SECUENCIA DE GIRO
                 MOTOR_PAP:
00210f e130      	LDI				R19,0b00010000
002110 bb35      	OUT				PORTC,R19
002111 940e 2120 	CALL			VELOCIDAD
                 ;	CALL			VELOCIDAD
002113 e230      	LDI				R19,0b00100000
002114 bb35      	OUT				PORTC,R19
002115 940e 2120 	CALL			VELOCIDAD
                 ;	CALL			VELOCIDAD
002117 e430      	LDI				R19,0b01000000
002118 bb35      	OUT				PORTC,R19
002119 940e 2120 	CALL			VELOCIDAD
                 ;	CALL			VELOCIDAD
00211b e830      	LDI				R19,0b10000000
00211c bb35      	OUT				PORTC,R19
00211d 940e 2120 	CALL			VELOCIDAD
                 ;	CALL			VELOCIDAD
00211f 9508      RET
                 ;	RJMP			MOTOR_PAP
                 
                 ; MEDICION DE LA VELOCIDAD
                 VELOCIDAD:
                 
002120 2788      	CLR				R24
002121 e023       	LDI				R18,3				; LINEA DE ENTRADA EN EL CONVERTIDOS PCF8591
                 ;	LDI				R26, 10				; NUMERO DE LECTURAS Ó CALIBRACION
                 ; CONFIGURAR TENSION DE REFERENCIA A VDD, FORMA DE ALMACENAMIENTO CON EL REGISTRO ADLAR A 1 Y CANAL A LEER
                 ;	LD1				R16, (0<<REFS1)|(1<<REFS0)|(0<<ADLAR) LEER LINEA ADC0 ES LA PATA 40
002122 ee00      	LDI				R16,0B11100000		; SEÑAL INTERNA DE REFERENCIA A  VDC BIT 7Y6 
                 										; BIT DE ADLAR A 1 
002123 0f02      	ADD				R16,R18				; EN R18 EL CANAL A LEER Y GANANCIA VER PAG 245
002124 b907      	OUT				ADMUX,R16
002125 ed07      	LDI				R16,0B11010111		; PREESCALA A 128 "8.000.000/128=62.500Hz
002126 b906      	OUT				ADCSRA,R16
                 ADC_P2A:
002127 b106      	IN				R16,ADCSRA
002128 0000      	NOP
002129 fb06      	BST				R16,6				; CARGA EN EL REGISTRO T DE SREG EL 6 ACSRA
00212a f3e6      	BRTS			ADC_P2A				; SALTA A ADC_P1 SI EL REGISTRO ES UNO SE PONE A CERO AL TERMINAR LA CONVERSION
00212b b185      	IN	 			R24,ADCH			; CARGA EL RESULTADO EN R17
00212c 9586      	LSR				R24
00212d e238      LDI				R19,40				; PARAMETRO PARA LIMITAR LA VELOCIDAD MAXIMA
00212e 0f83      ADD				R24,R19
00212f e392      LDI				R25,50
                 SERVO_1:
002130 95a8      WDR
002131 0000      NOP
002132 959a      DEC				R25
002133 f7e1      BRNE			SERVO_1
002134 ef9a      LDI				R25,250
002135 958a      DEC				R24
002136 f7c9      BRNE			SERVO_1
002137 9508      	RET
                 
                 .INCLUDE "CONTROL_ELECTRODO.ASM"
                 
                 ; CONTROL DESGASTE ELECTRODO ****inicia con la polaridad mas eficaz***************
                 CONTROL_ELECTRODO:
002138 e010      	LDI				R17,00
002139 9310 0220 	STS				SAL_ELECTRODO,R17
                 	
00213b e91e      	LDI				R17, POLARIDAD_0	; LEER LA SAL EN POLARIDAD 0
00213c 940e 057e 	CALL			EEPROM_RW
00213e 2f32      	MOV				R19,R18				; SE ALMACENA EN R19
00213f e91f      	LDI				R17, POLARIDAD_1	; LEER LA SAL EN POLARIDAD 1
002140 940e 057e 	CALL			EEPROM_RW
002142 e0ea      	LDI				R30,INC_POLARIDAD	; ALMACENA EN R20 LA DIFERENCIA DE POLARIDAD
002143 0f2e      	ADD				R18,R30				; SUMA LA DIFERENCIA DE POLARIDAD
002144 1732      	CP				R19,R18
002145 f42c      	BRGE			POL_1				; SI R18 + R20 MENOR QUE R19
002146 1b2e      	SUB				R18,R30
002147 0f3e      	ADD				R19,R30
002148 1723      	CP				R18,R19			
002149 f444      	BRGE			POL_2				; SI R19 + R20 MENOR QUE R18
00214a c00d      	RJMP			POL_3
                 POL_1:
00214b 9330 0220 	STS				SAL_ELECTRODO,R19
                 
00214d ea10      	LDI				R17,MEJOR_POLARIDAD	; DIRECION A GRABAR
00214e e020      	LDI				R18,0				; VALOR A GRABAR
00214f 940e 0587 	CALL			EEPROM_ES			; OPCION GRABAR LA EERPOM
002151 c006      	RJMP			POL_3
                 POL_2:
002152 9320 0220 	STS				SAL_ELECTRODO,R18
002154 ea10      	LDI				R17,MEJOR_POLARIDAD	; DIRECION A GRABAR
002155 e021      	LDI				R18,1				; VALOR A GRABAR
002156 940e 0587 	CALL			EEPROM_ES			; OPCION GRABAR LA EERPOM
                 
                 POL_3: ;****************** COLOCA EL VALOR MAXIMO DE SAL EN LA TERCERA LINEA DE PRODUCION
                 ;	RET
002158 9180 0220 	LDS				R24,SAL_ELECTRODO 	; SOLO EN CASO DE SUPERCLORACION
00215a 940e 0590 	CALL			RADC				; RUTINA PARA CONVERTIR EN ANALOGICO
00215c 9210 04e8 	STS				$4E8, R1			; PONE EN PANTALLA NORMAL
00215e 9220 04e9 	STS				$4E9, R2
002160 9230 04ea 	STS				$4EA, R3
002162 e280      	LDI				R24,32
002163 9210 04eb 	STS				$4EB, R1			; PONE EN PANTALLA NORMAL
002165 9220 04ec 	STS				$4EC, R2
002167 9230 04ed 	STS				$4ED, R3
002169 ea10      LDI R17,MEJOR_POLARIDAD
00216a 940e 057e CALL EEPROM_RW
00216c 2f82      MOV R24,R18
00216d 940e 0590 	CALL			RADC				; RUTINA PARA CONVERTIR EN ANALOGICO
00216f 9230 04ec 	STS				$4EC, R3			; PONE EN PANTALLA NORMAL
                 ;	STS				$599, R2
                 ;	STS				$59A, R3
002171 9508      	RET
                 
                 ;.org SMALLBOOTSTART ;	= 0x7e00 que es fc00
                 ;.INCLUDE "FLASH_SPM.ASM"
                 ;.INCLUDE "CONTROL_REMOTO.ASM"
                 ;****HASTA AQUÍ EL PROGRAMA******* 
                 
                 


RESOURCE USE INFORMATION
------------------------

Notice:
The register and instruction counts are symbol table hit counts,
and hence implicitly used resources are not counted, eg, the
'lpm' instruction without operands implicitly uses r0 and z,
none of which are counted.

x,y,z are separate entities in the symbol table and are
counted separately from r26..r31 here.

.dseg memory usage only counts static data declared with .byte

ATmega64 register use summary:
r0 :  41 r1 :  67 r2 :  92 r3 :  98 r4 :  16 r5 :  17 r6 :  16 r7 :  50 
r8 :   4 r9 :   0 r10:   8 r11:  50 r12:   0 r13:   0 r14:   0 r15:  68 
r16: 983 r17: 370 r18: 513 r19: 274 r20:  69 r21:   0 r22:  71 r23:  26 
r24: 400 r25: 153 r26:  62 r27:  53 r28: 249 r29: 192 r30: 218 r31:  42 
x  :   0 y  :  55 z  :   0 
Registers used: 28 out of 35 (80.0%)

ATmega64 instruction use summary:
.lds  :   0 .sts  :   0 adc   :   2 add   :  54 adiw  :  44 and   :   0 
andi  :  21 asr   :   0 bclr  :   0 bld   :  37 brbc  :  46 brbs  :  31 
brcc  :   7 brcs  :   2 break :   0 breq  :  77 brge  :   5 brhc  :   0 
brhs  :   0 brid  :   0 brie  :   0 brlo  :  67 brlt  :  20 brmi  :   0 
brne  : 109 brpl  :  10 brsh  :   5 brtc  :   5 brts  :   5 brvc  :   1 
brvs  :   0 bset  :   0 bst   :  11 call  : 534 cbi   :  70 cbr   :  11 
clc   :   0 clh   :   0 cli   :   0 cln   :   0 clr   :  56 cls   :   0 
clt   :  20 clv   :   0 clz   :   0 com   :   0 cp    :  39 cpc   :   1 
cpi   : 284 cpse  :   0 dec   :  99 eor   :   0 fmul  :   0 fmuls :   0 
fmulsu:   0 icall :   0 ijmp  :   0 in    :  20 inc   : 103 jmp   :  18 
ld    :  19 ldd   :   0 ldi   :1559 lds   : 137 lpm   :  60 lsl   :   8 
lsr   :  15 mov   : 249 movw  :   0 mul   :  12 muls  :   0 mulsu :   0 
neg   :   0 nop   :  66 or    :   0 ori   :   9 out   : 122 pop   :  46 
push  :  39 rcall : 377 ret   : 195 reti  :  34 rjmp  : 246 rol   :   0 
ror   :   0 sbc   :   0 sbci  :   0 sbi   :  55 sbic  :   7 sbis  :  11 
sbiw  :   5 sbr   :   7 sbrc  :  54 sbrs  :  46 sec   :   0 seh   :   0 
sei   :   1 sen   :   0 ser   :   8 ses   :   0 set   :  14 sev   :   0 
sez   :   0 sleep :   1 spm   :   0 st    :  36 std   :   0 sts   : 626 
sub   :  18 subi  :  23 swap  :   0 tst   :   0 wdr   :  37 
Instructions used: 65 out of 113 (57.5%)

ATmega64 memory use summary [bytes]:
Segment   Begin    End      Code   Data   Used    Size   Use%
---------------------------------------------------------------
[.cseg] 0x000000 0x0042e4  14462   2204  16666   65536  25.4%
[.dseg] 0x000100 0x0010ff      0      0      0    4096   0.0%
[.eseg] 0x000000 0x000000      0      0      0    2048   0.0%

Assembly complete, 0 errors, 0 warnings
